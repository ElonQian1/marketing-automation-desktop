# 🧪 决策链按钮修复测试指南

## ✅ 修复内容

已修复步骤卡片上的决策链配置按钮（"🧠 智能·自动链"、"🎯 第一个"、"👆 点击"）在保存脚本后丢失的问题。

---

## 📋 测试步骤

### 第一步：创建带有配置的步骤

1. **启动应用**，打开脚本构建器
2. **创建一个新步骤**（通过智能分析或手动创建）
3. **配置决策链**：
   - 点击 `🧠 智能·自动链` 按钮（如果有其他选项，保持默认即可）
   - 点击 `🎯 第一个` 按钮，选择其他模式，例如：
     - `🎯 最后一个`
     - `🔍 精确匹配`
     - `🎲 随机选择`
     - `📋 批量全部`
   - 点击 `👆 点击` 按钮，选择其他操作，例如：
     - `⏸️ 长按`
     - `👆👆 双击`
     - `⌨️ 输入`

4. **验证配置已应用**：
   - 确认按钮显示为你选择的配置
   - 例如：`🧠 智能·自动链 ✅`、`🎯 最后一个 ✅`、`⏸️ 长按 ✅`

---

### 第二步：保存脚本

1. 点击 **"保存脚本"** 按钮
2. 输入脚本名称，例如 `测试决策链保存`
3. 确认保存成功

---

### 第三步：关闭并重新打开脚本

1. **关闭当前脚本**（如果有关闭功能）或切换到其他页面
2. 打开 **脚本管理器**
3. **加载刚才保存的脚本** `测试决策链保存`

---

### 第四步：验证配置是否恢复

✅ **期望结果**：

- 步骤卡片上的决策链按钮**正确显示**
- 显示的配置**与保存前一致**
  - 例如：`🧠 智能·自动链 ✅`
  - 例如：`🎯 最后一个 ✅`（或你选择的其他模式）
  - 例如：`⏸️ 长按 ✅`（或你选择的其他操作）
- 所有辅助按钮（刷新、日志、搜索）也正确显示

❌ **修复前的错误现象**：

- 决策链按钮全部消失
- 只显示测试按钮，其他按钮都不见了

---

## 🔍 高级测试场景

### 场景1：测试批量模式配置

1. 创建步骤并选择 `📋 批量全部` 模式
2. 配置批量参数：
   - 间隔时间：2000ms
   - 最大数量：10
   - 错误后继续：是
3. 保存并重新加载脚本
4. 验证批量配置是否正确恢复

### 场景2：测试精确匹配配置

1. 创建步骤并选择 `🔍 精确匹配` 模式
2. 配置精确匹配参数：
   - 最小置信度：0.85
   - 失败时回退到第一个：是
   - 严格模式：是
3. 保存并重新加载脚本
4. 验证精确匹配配置是否正确恢复

### 场景3：测试随机选择配置

1. 创建步骤并选择 `🎲 随机选择` 模式
2. 配置随机参数：
   - 自定义种子：（可选）
   - 确保稳定排序：是
3. 保存并重新加载脚本
4. 验证随机配置是否正确恢复

---

## 🐛 常见问题排查

### 问题1：按钮仍然消失

**可能原因**：
- 缓存问题，需要强制刷新
- 旧版本的脚本文件（保存于修复前）

**解决方法**：
1. 清除浏览器缓存（如果是Web应用）
2. 重新创建一个新步骤并保存
3. 不要使用修复前保存的脚本进行测试

### 问题2：配置恢复不正确

**可能原因**：
- 序列化/反序列化过程中数据转换错误

**解决方法**：
1. 打开浏览器开发者工具（F12）
2. 查看控制台是否有错误信息
3. 搜索关键字：`decisionChain`、`CompactStrategyMenu`
4. 将错误信息报告给开发团队

### 问题3：只有部分配置恢复

**可能原因**：
- 某些配置未正确保存

**解决方法**：
1. 检查控制台日志，查找 `🔄 [CompactStrategyMenu] 更新决策链配置` 消息
2. 验证是否所有配置都被记录
3. 如果缺少某个配置，报告具体是哪个配置

---

## 📊 测试结果记录

请填写测试结果：

### 基础功能测试

| 测试项 | 结果 | 备注 |
|--------|------|------|
| 创建步骤并配置 | ☐ 通过 ☐ 失败 | |
| 保存脚本 | ☐ 通过 ☐ 失败 | |
| 重新加载脚本 | ☐ 通过 ☐ 失败 | |
| 决策链按钮显示 | ☐ 通过 ☐ 失败 | |
| 配置正确恢复 | ☐ 通过 ☐ 失败 | |

### 高级场景测试

| 场景 | 结果 | 备注 |
|------|------|------|
| 批量模式 | ☐ 通过 ☐ 失败 | |
| 精确匹配 | ☐ 通过 ☐ 失败 | |
| 随机选择 | ☐ 通过 ☐ 失败 | |

---

## 🎉 测试通过标准

测试通过的条件：

1. ✅ 所有基础功能测试通过
2. ✅ 至少2个高级场景测试通过
3. ✅ 没有控制台错误或警告
4. ✅ 配置恢复准确无误

---

## 📞 问题反馈

如果测试失败，请提供以下信息：

1. **失败的测试项**
2. **浏览器控制台截图**
3. **步骤重现方式**
4. **预期结果 vs 实际结果**

将以上信息反馈给开发团队进行进一步排查。

---

**祝测试顺利！** 🚀
