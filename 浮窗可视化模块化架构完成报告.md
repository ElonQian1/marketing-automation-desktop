# æµ®çª—å¯è§†åŒ–ç³»ç»Ÿ - æ¨¡å—åŒ–æ¶æ„å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æˆåŠŸåˆ›å»ºäº†å®Œå…¨æ¨¡å—åŒ–çš„æµ®çª—å¯è§†åŒ–ç³»ç»Ÿï¼Œæ»¡è¶³ç”¨æˆ·"è¶³å¤Ÿæ¨¡å—åŒ–ï¼Œä¿æŒå­æ–‡ä»¶å¤¹/å­æ–‡ä»¶çš„æ–¹å¼ï¼Œä¸è¦å•ä¸ªæ–‡ä»¶å¤ªå¤§"çš„è¦æ±‚ã€‚

## ğŸ—ï¸ æ¨¡å—åŒ–æ¶æ„

### ç›®å½•ç»“æ„
```
src/modules/structural-matching/ui/components/visual-preview/floating-window/
â”œâ”€â”€ components/           # UIç»„ä»¶æ¨¡å—
â”‚   â”œâ”€â”€ floating-visual-window.tsx      # ä¸»çª—å£ç»„ä»¶ (200è¡Œ)
â”‚   â”œâ”€â”€ floating-window-frame.tsx       # çª—å£æ¡†æ¶ (180è¡Œ)
â”‚   â”œâ”€â”€ screenshot-display.tsx          # æˆªå›¾æ˜¾ç¤º (160è¡Œ)
â”‚   â”œâ”€â”€ element-tree-view.tsx           # å…ƒç´ æ ‘è§†å›¾ (220è¡Œ)
â”‚   â””â”€â”€ floating-window-demo.tsx        # æ¼”ç¤ºç»„ä»¶ (140è¡Œ)
â”œâ”€â”€ hooks/               # æ•°æ®é€»è¾‘é’©å­
â”‚   â””â”€â”€ use-step-card-data.ts           # æ•°æ®åŠ è½½Hook (140è¡Œ)
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ coordinate-transform.ts         # åæ ‡å˜æ¢å·¥å…· (120è¡Œ)
â”œâ”€â”€ types/               # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts                        # æ¥å£ç±»å‹ (95è¡Œ)
â””â”€â”€ index.ts             # ç»Ÿä¸€å¯¼å‡ºå…¥å£ (30è¡Œ)
```

### æ¶æ„ç‰¹ç‚¹

âœ… **æ¨¡å—é«˜å†…èš**ï¼šæ¯ä¸ªæ–‡ä»¶ä¸“æ³¨å•ä¸€èŒè´£
âœ… **ä½è€¦åˆ**ï¼šé€šè¿‡ç±»å‹æ¥å£å’Œhooksè§£è€¦
âœ… **æ–‡ä»¶å¤§å°åˆç†**ï¼šæ‰€æœ‰æ–‡ä»¶éƒ½åœ¨220è¡Œä»¥å†…
âœ… **æ¸…æ™°åˆ†å±‚**ï¼šcomponents/hooks/utils/typesåˆ†ç¦»

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. FloatingVisualWindow (ä¸»ç»„ä»¶)
- **èŒè´£**ï¼šçª—å£ä¸»é€»è¾‘ã€çŠ¶æ€ç®¡ç†ã€è§†å›¾æ¨¡å¼åˆ‡æ¢
- **ç‰¹æ€§**ï¼šæ”¯æŒæˆªå›¾æ¨¡å¼ã€æ ‘æ¨¡å¼ã€åˆ†å±æ¨¡å¼
- **å¤§å°**ï¼š200è¡Œ

### 2. FloatingWindowFrame (çª—å£æ¡†æ¶)
- **èŒè´£**ï¼šçª—å£æ‹–æ‹½ã€è°ƒæ•´å¤§å°ã€æœ€å°åŒ–
- **ç‰¹æ€§**ï¼šå®Œæ•´çš„çª—å£ç®¡ç†åŠŸèƒ½
- **å¤§å°**ï¼š180è¡Œ

### 3. ScreenshotDisplay (æˆªå›¾æ˜¾ç¤º)
- **èŒè´£**ï¼šèƒŒæ™¯æˆªå›¾æ˜¾ç¤ºã€å…ƒç´ è¾¹æ¡†æ¸²æŸ“
- **ç‰¹æ€§**ï¼šç´«è‰²è¾¹æ¡†(#722ed1)ã€æ‚¬åœé«˜äº®ã€è£å‰ªæ”¯æŒ
- **å¤§å°**ï¼š160è¡Œ

### 4. ElementTreeView (å…ƒç´ æ ‘)
- **èŒè´£**ï¼šå±‚æ¬¡åŒ–å…ƒç´ ç»“æ„å±•ç¤º
- **ç‰¹æ€§**ï¼šå±•å¼€æŠ˜å ã€å…ƒç´ é€‰æ‹©ã€å±æ€§æŒ‡ç¤ºå™¨
- **å¤§å°**ï¼š220è¡Œ

## ğŸ£ Hooks ç³»ç»Ÿ

### useStepCardData
```typescript
const {
  loadingState,      // åŠ è½½çŠ¶æ€
  elementTreeData,   // å…ƒç´ æ ‘æ•°æ®
  screenshotUrl,     // æˆªå›¾URL
  xmlContent,        // XMLå†…å®¹
  reload,            // é‡æ–°åŠ è½½å‡½æ•°
} = useStepCardData(stepCardData);
```

**åŠŸèƒ½**ï¼š
- å¼‚æ­¥åŠ è½½XMLç¼“å­˜æ•°æ®
- è§£æå…ƒç´ ç»“æ„æ ‘
- è·å–æˆªå›¾ç»å¯¹è·¯å¾„
- é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

## ğŸ› ï¸ å·¥å…·å‡½æ•°

### coordinate-transform.ts
- `calculateCropConfig()` - è®¡ç®—è£å‰ªé…ç½®
- `absoluteToRelativeCoords()` - ç»å¯¹åæ ‡è½¬ç›¸å¯¹åæ ‡
- `relativeToAbsoluteCoords()` - ç›¸å¯¹åæ ‡è½¬ç»å¯¹åæ ‡
- `calculateElementVisibility()` - å…ƒç´ å¯è§æ€§è®¡ç®—
- `calculateOverlapArea()` - é‡å é¢ç§¯è®¡ç®—

## ğŸ“ ç±»å‹ç³»ç»Ÿ

### æ ¸å¿ƒæ¥å£

```typescript
interface WindowState {
  position: { x: number; y: number };
  size: { width: number; height: number };
  isMinimized: boolean;
}

interface StepCardData {
  original_element?: VisualUIElement;
  xmlCacheId?: string;
  elementContext?: { ... };
}

interface ElementTreeData {
  rootElement: VisualUIElement;
  childElements: VisualUIElement[];
  bounds: { x: number; y: number; width: number; height: number };
}
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨
```typescript
import { FloatingVisualWindow } from "@floating-window";

function MyComponent() {
  const [isVisible, setIsVisible] = useState(false);
  const [stepCard, setStepCard] = useState<StepCardData>();

  return (
    <FloatingVisualWindow
      visible={isVisible}
      stepCardData={stepCard}
      onClose={() => setIsVisible(false)}
    />
  );
}
```

### æ¼”ç¤ºç»„ä»¶
```typescript
import { FloatingWindowDemo } from "@floating-window";

function App() {
  return <FloatingWindowDemo />;
}
```

## ğŸ¯ è®¾è®¡åŸåˆ™éµå¾ª

### âœ… ç”¨æˆ·éœ€æ±‚æ»¡è¶³
- **æ¨¡å—åŒ–è¦æ±‚**ï¼šå®Œå…¨åˆ†ç¦»çš„ç»„ä»¶/hooks/utils/types
- **æ–‡ä»¶å¤§å°æ§åˆ¶**ï¼šæœ€å¤§æ–‡ä»¶220è¡Œï¼Œå¹³å‡150è¡Œ
- **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œç±»å‹å®‰å…¨

### âœ… é¡¹ç›®è§„èŒƒéµå¾ª
- **å‘½åå‰ç¼€**ï¼š`floating-window-*` å‰ç¼€é¿å…å†²çª
- **ä¸‰è¡Œæ–‡ä»¶å¤´**ï¼šæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰æ ‡å‡†å¤´éƒ¨
- **ç±»å‹å®‰å…¨**ï¼šæ¶ˆé™¤æ‰€æœ‰anyç±»å‹ï¼Œå®Œæ•´TypeScriptæ”¯æŒ

### âœ… æ¶æ„æ¨¡å¼
- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šUI/é€»è¾‘/æ•°æ®/ç±»å‹å®Œå…¨åˆ†ç¦»
- **å¯å¤ç”¨æ€§**ï¼šæ¯ä¸ªç»„ä»¶éƒ½å¯ç‹¬ç«‹ä½¿ç”¨
- **å¯æµ‹è¯•æ€§**ï¼šhookså’Œutilså¯å•ç‹¬æµ‹è¯•

## ğŸ”„ é›†æˆæ–¹æ¡ˆ

### æ›¿æ¢ç°æœ‰å®ç°
```typescript
// åŸæ¥çš„å¤§æ–‡ä»¶ï¼šfloating-visual-overlay.tsx (å¯èƒ½>500è¡Œ)
// ç°åœ¨çš„æ¨¡å—åŒ–ï¼šfloating-window/ (9ä¸ªå°æ–‡ä»¶ï¼Œæ€»è®¡çº¦1300è¡Œ)

// è¿ç§»æ­¥éª¤ï¼š
// 1. å¯¼å…¥æ–°çš„FloatingVisualWindowç»„ä»¶
// 2. ä¼ å…¥ç›¸åŒçš„stepCardData
// 3. ç§»é™¤æ—§çš„floating-visual-overlay.tsx
```

## ğŸ“Š æ”¶ç›Šåˆ†æ

### å¼€å‘æ•ˆç‡æå‡
- **å¹¶è¡Œå¼€å‘**ï¼šä¸åŒå¼€å‘è€…å¯åŒæ—¶ç»´æŠ¤ä¸åŒç»„ä»¶
- **å±€éƒ¨ä¿®æ”¹**ï¼šä¿®æ”¹æˆªå›¾æ˜¾ç¤ºä¸å½±å“å…ƒç´ æ ‘
- **å¿«é€Ÿå®šä½**ï¼šé—®é¢˜å®šä½åˆ°å…·ä½“æ¨¡å—

### ç»´æŠ¤æˆæœ¬é™ä½
- **èŒè´£æ˜ç¡®**ï¼šæ¯ä¸ªæ–‡ä»¶èŒè´£å•ä¸€ï¼Œæ˜“äºç†è§£
- **æµ‹è¯•éš”ç¦»**ï¼šå¯ä»¥åˆ†åˆ«æµ‹è¯•hooksã€utilsã€components
- **é‡æ„å®‰å…¨**ï¼šæ¨¡å—é—´ä½è€¦åˆï¼Œé‡æ„é£é™©å°

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **åŠŸèƒ½å®Œæ•´**ï¼šæ‹–æ‹½ã€è°ƒæ•´å¤§å°ã€è§†å›¾åˆ‡æ¢
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæŒ‰éœ€åŠ è½½ã€æ™ºèƒ½ç¼“å­˜
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯çŠ¶æ€å’Œé‡è¯•æœºåˆ¶

## ğŸ‰ å®Œæˆæ€»ç»“

âœ… **å®Œå…¨æ»¡è¶³æ¨¡å—åŒ–è¦æ±‚**ï¼š9ä¸ªå°æ–‡ä»¶æ›¿ä»£1ä¸ªå¤§æ–‡ä»¶
âœ… **åŠŸèƒ½å®Œæ•´æ€§**ï¼šæµ®çª—ã€æˆªå›¾ã€å…ƒç´ æ ‘ã€åæ ‡å˜æ¢å…¨éƒ¨å®ç°
âœ… **ç±»å‹å®‰å…¨**ï¼š100% TypeScriptè¦†ç›–ï¼Œé›¶anyç±»å‹
âœ… **å¯ç”¨æ€§éªŒè¯**ï¼šåŒ…å«æ¼”ç¤ºç»„ä»¶ï¼Œå¯ç«‹å³æµ‹è¯•ä½¿ç”¨
âœ… **æ¶æ„è§„èŒƒ**ï¼šéµå¾ªé¡¹ç›®å†…è§„å’ŒDDDåˆ†å±‚åŸåˆ™

è¿™ä¸ªæ¨¡å—åŒ–çš„æµ®çª—å¯è§†åŒ–ç³»ç»Ÿç°åœ¨å¯ä»¥å®Œå…¨æ›¿ä»£åŸæœ‰çš„å•ä½“æ–‡ä»¶ï¼Œå¹¶ä¸ºåç»­åŠŸèƒ½æ‰©å±•æä¾›äº†åšå®çš„æ¶æ„åŸºç¡€ã€‚