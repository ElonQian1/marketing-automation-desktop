# æ™ºèƒ½åˆ†æé€‚é…å™¨æ¶æ„è¯¦è§£

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦é€‚é…å™¨ï¼Ÿ

åœ¨å¼€å‘æ™ºèƒ½åˆ†æåŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªç»å…¸çš„è½¯ä»¶å·¥ç¨‹é—®é¢˜ï¼š
- **å¼€å‘æœŸé—´**ï¼šåç«¯è¿˜åœ¨å¼€å‘ä¸­ï¼Œå‰ç«¯éœ€è¦å…ˆè¡Œå¼€å‘å’Œæµ‹è¯•
- **é›†æˆæœŸé—´**ï¼šéœ€è¦å¹³æ»‘åœ°ä»æ¨¡æ‹Ÿæ•°æ®åˆ‡æ¢åˆ°çœŸå®åç«¯
- **ç»´æŠ¤æœŸé—´**ï¼šéœ€è¦èƒ½å¤Ÿå¿«é€Ÿåœ¨çœŸå®å’Œæ¨¡æ‹Ÿä¹‹é—´åˆ‡æ¢ç”¨äºè°ƒè¯•

## ğŸ—ï¸ é€‚é…å™¨æ¨¡å¼è§£å†³æ–¹æ¡ˆ

### æ¶æ„å›¾ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI ç»„ä»¶å±‚                                â”‚
â”‚  (ElementSelectionPopover, StrategyAnalysisModal, etc.)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ ç»Ÿä¸€æ¥å£è°ƒç”¨
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           useIntelligentAnalysisAdapter                    â”‚
â”‚                    (é€‚é…å™¨å±‚)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   é…ç½®åˆ¤æ–­é€»è¾‘      â”‚ --> â”‚     åŠ¨æ€è·¯ç”±é€‰æ‹©            â”‚â”‚
â”‚  â”‚ useRealBackend?     â”‚     â”‚   Real vs Simulated        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ¨¡æ‹Ÿç‰ˆæœ¬ Hook           â”‚    â”‚       çœŸå®åç«¯ Hook          â”‚
â”‚   useStrategyAnalysis       â”‚    â”‚ useIntelligentAnalysisReal  â”‚
â”‚                             â”‚    â”‚                             â”‚
â”‚ ğŸ­ çº¯å‰ç«¯JavaScripté€»è¾‘      â”‚    â”‚ ğŸš€ è°ƒç”¨Ruståç«¯å‘½ä»¤          â”‚
â”‚ ğŸ² éšæœºç”Ÿæˆæµ‹è¯•æ•°æ®          â”‚    â”‚ ğŸ“¡ Tauri IPCé€šä¿¡             â”‚
â”‚ âš¡ å³æ—¶å“åº”ï¼Œæ— ç½‘ç»œå»¶è¿Ÿ       â”‚    â”‚ ğŸ”„ äº‹ä»¶ç›‘å¬å’ŒçŠ¶æ€åŒæ­¥         â”‚
â”‚ ğŸ› ï¸ ä¾¿äºå‰ç«¯å¼€å‘å’Œè°ƒè¯•        â”‚    â”‚ ğŸ’¾ çœŸå®åˆ†æç®—æ³•å’Œæ•°æ®         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ¨¡æ‹Ÿç‰ˆæœ¬ (Simulated Backend) è¯¦è§£

### ğŸ­ æ¨¡æ‹Ÿç‰ˆæœ¬çš„èŒè´£

**æ–‡ä»¶**: `src/hooks/universal-ui/useStrategyAnalysis.ts`

#### 1. å‰ç«¯å¼€å‘æ”¯æŒ
```typescript
// æ¨¡æ‹Ÿ7æ­¥åˆ†ææµç¨‹
const ANALYSIS_STEPS = [
  { name: 'è§„èŒƒåŒ–è¾“å…¥', description: 'è§£æå…ƒç´ å±æ€§å’Œå±‚çº§ç»“æ„' },
  { name: 'è‡ªæˆ‘å¯å®šä½', description: 'æ£€æŸ¥å…ƒç´ è‡ªèº«å”¯ä¸€æ€§ç‰¹å¾' },
  { name: 'å­æ ‘æ‰¾é”šç‚¹', description: 'åˆ†æå­å…ƒç´ é”šç‚¹å¯ç”¨æ€§' },
  { name: 'åŒºåŸŸé™å®š', description: 'è¯„ä¼°å®¹å™¨è¾¹ç•Œå’Œç›¸å¯¹ä½ç½®' },
  { name: 'é‚»å±…ç›¸å¯¹', description: 'æ£€æŸ¥ç›¸é‚»å…ƒç´ å…³ç³»' },
  { name: 'ç´¢å¼•å…œåº•', description: 'è®¡ç®—ç´¢å¼•å®šä½å¯é æ€§' },
  { name: 'ç­–ç•¥ç»¼åˆ', description: 'æ•´åˆåˆ†æç»“æœå¹¶æ¨èæœ€ä½³ç­–ç•¥' }
];
```

#### 2. æ™ºèƒ½ç­–ç•¥æ¨¡æ‹Ÿ
```typescript
// æ¨¡æ‹Ÿç­–ç•¥åº“ï¼ŒåŒ…å«5ç§ç­–ç•¥ç±»å‹
const STRATEGY_TEMPLATES = {
  'self_anchor': {
    name: 'è‡ªæˆ‘å®šä½ç­–ç•¥',
    description: 'åŸºäºå…ƒç´ è‡ªèº«çš„å”¯ä¸€æ€§ç‰¹å¾è¿›è¡Œå®šä½',
    performance: { speed: 'fast', stability: 'high' },
    pros: ['æ‰§è¡Œé€Ÿåº¦æœ€å¿«', 'è·¨è®¾å¤‡å…¼å®¹æ€§æœ€å¥½'],
    cons: ['éœ€è¦å…ƒç´ å…·å¤‡å”¯ä¸€æ€§ç‰¹å¾']
  },
  'child_driven': {
    name: 'å­æ ‘é”šç‚¹ç­–ç•¥', 
    description: 'é€šè¿‡å­å…ƒç´ ç‰¹å¾å®šä½çˆ¶å®¹å™¨',
    // ... æ›´å¤šç­–ç•¥å®šä¹‰
  }
};
```

#### 3. çœŸå®çš„ç”¨æˆ·ä½“éªŒæ¨¡æ‹Ÿ
```typescript
// æ¨¡æ‹Ÿåˆ†æè¿›åº¦ (200-800msæ¯æ­¥)
const simulateAnalysisStep = async (stepIndex: number) => {
  const stepTime = 200 + Math.random() * 600;
  // çœŸå®çš„è¿›åº¦æ›´æ–°UIåé¦ˆ
  setAnalysisProgress({
    currentStep: stepIndex + 1,
    totalSteps: ANALYSIS_STEPS.length,
    stepName: step.name,
    stepDescription: step.description
  });
};
```

#### 4. æ™ºèƒ½åŒ–çš„æµ‹è¯•æ•°æ®ç”Ÿæˆ
```typescript
// åŸºäºå…ƒç´ ç‰¹å¾ç”Ÿæˆåˆç†çš„ç½®ä¿¡åº¦
const calculateMockConfidence = (element: UIElement): number => {
  let confidence = 60;
  
  // æœ‰resource-idåŠ åˆ†
  if (element.resource_id) confidence += 25;
  
  // æœ‰unique textåŠ åˆ†
  if (element.text && element.text.length > 2) confidence += 15;
  
  // å¯ç‚¹å‡»å…ƒç´ åŠ åˆ†
  if (element.is_clickable) confidence += 10;
  
  return Math.min(95, confidence + Math.random() * 10);
};
```

### ğŸ¯ æ¨¡æ‹Ÿç‰ˆæœ¬çš„ä»·å€¼

1. **ğŸš€ å¿«é€Ÿå¼€å‘**: å‰ç«¯å¼€å‘è€…æ— éœ€ç­‰å¾…åç«¯å®Œæˆ
2. **ğŸ­ çœŸå®ä½“éªŒ**: æ¨¡æ‹ŸçœŸå®çš„å¼‚æ­¥æµç¨‹å’Œè¿›åº¦åé¦ˆ
3. **ğŸ› ï¸ ä¾¿äºè°ƒè¯•**: å¯æ§çš„æ•°æ®ï¼Œä¾¿äºæµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
4. **ğŸ“± æ¼”ç¤ºå‹å¥½**: ç¨³å®šçš„æ¼”ç¤ºæ•ˆæœï¼Œä¸ä¾èµ–ç½‘ç»œæˆ–åç«¯çŠ¶æ€

---

## ğŸš€ çœŸå®åç«¯ (Real Backend) è¯¦è§£

### ğŸ’ çœŸå®åç«¯çš„èŒè´£

**æ–‡ä»¶**: `src/modules/universal-ui/hooks/use-intelligent-analysis-real.ts`

#### 1. Tauri IPC é€šä¿¡
```typescript
// è°ƒç”¨Ruståç«¯å‘½ä»¤
const response = await invoke<AnalysisJobResponse>(
  'start_intelligent_analysis',
  { config: analysisJobConfig }
);

// ç›‘å¬åç«¯äº‹ä»¶
await listen<AnalysisProgressEvent>('analysis_progress', (event) => {
  // å®æ—¶è¿›åº¦æ›´æ–°
});

await listen<AnalysisDoneEvent>('analysis_done', (event) => {
  // åˆ†æå®Œæˆå¤„ç†
});
```

#### 2. çœŸå®çš„AIåˆ†æç®—æ³•
```rust
// Ruståç«¯å®ç° (src-tauri/src/commands/intelligent_analysis.rs)
pub async fn start_intelligent_analysis(
    app_handle: AppHandle,
    config: AnalysisJobConfig,
) -> Result<AnalysisJobResponse, String> {
    // ğŸ§  çœŸå®çš„æœºå™¨å­¦ä¹ åˆ†æ
    // ğŸ” XPathç­–ç•¥æ™ºèƒ½ç”Ÿæˆ
    // ğŸ“Š ç½®ä¿¡åº¦ç§‘å­¦è®¡ç®—
    // ğŸ¯ è·¨è®¾å¤‡å…¼å®¹æ€§è¯„ä¼°
}
```

#### 3. ä¸‰é‡æ ¡éªŒæœºåˆ¶
```typescript
// jobId + selectionHash + stepId ä¸‰é‡æ ¡éªŒ
const verifyAnalysisContext = (event: AnalysisEvent) => {
  return event.jobId === currentJobId &&
         event.selectionHash === expectedHash &&
         event.stepId === contextStepId;
};
```

#### 4. äº‹ä»¶é©±åŠ¨çš„çŠ¶æ€ç®¡ç†
```typescript
// å¼‚æ­¥äº‹ä»¶å¤„ç†
useEffect(() => {
  const setupEventListeners = async () => {
    // è¿›åº¦ç›‘å¬
    await backendService.listenToAnalysisProgress((progress, step) => {
      setRealAnalysisProgress({ currentStep: progress * 7, stepName: step });
    });
    
    // å®Œæˆç›‘å¬
    await backendService.listenToAnalysisComplete((result) => {
      setRealAnalysisState('completed');
      setRealAnalysisResult(result);
    });
  };
}, []);
```

### ğŸ¯ çœŸå®åç«¯çš„ä»·å€¼

1. **ğŸ§  çœŸå®AIç®—æ³•**: åŸºäºæœºå™¨å­¦ä¹ çš„ç­–ç•¥ä¼˜åŒ–
2. **ğŸ“Š å‡†ç¡®æ•°æ®**: çœŸå®çš„ç½®ä¿¡åº¦è®¡ç®—å’Œæ€§èƒ½è¯„ä¼°  
3. **ğŸ”„ æŒä¹…åŒ–**: åˆ†æç»“æœå¯ä»¥ä¿å­˜å’ŒæŸ¥è¯¢å†å²
4. **âš¡ æ€§èƒ½ä¼˜åŒ–**: Ruståç«¯çš„é«˜æ€§èƒ½è®¡ç®—èƒ½åŠ›

---

## ğŸ”„ é€‚é…å™¨çš„åŠ¨æ€åˆ‡æ¢é€»è¾‘

### é…ç½®é©±åŠ¨çš„æ™ºèƒ½è·¯ç”±
```typescript
export const useIntelligentAnalysisAdapter = (config: IntelligentAnalysisConfig) => {
  const { useRealBackend, debug } = config;
  
  // æ ¹æ®é…ç½®é€‰æ‹©åç«¯å®ç°
  const startAnalysis = useCallback(async (context: UnifiedAnalysisContext) => {
    if (useRealBackend) { 
      // ğŸš€ è·¯ç”±åˆ°çœŸå®åç«¯
      const response = await backendService.startAnalysis(context.element);
      console.log('âœ… ä½¿ç”¨çœŸå®Ruståç«¯åˆ†æ');
    } else {
      // ğŸ­ è·¯ç”±åˆ°æ¨¡æ‹Ÿç‰ˆæœ¬  
      await simulatedHook.startAnalysis(context);
      console.log('ğŸ­ ä½¿ç”¨æ¨¡æ‹Ÿå‰ç«¯åˆ†æ');
    }
  }, [useRealBackend]);
  
  // è¿”å›ç»Ÿä¸€çš„æ¥å£
  return {
    analysisState: useRealBackend ? realAnalysisState : simulatedHook.analysisState,
    analysisProgress: useRealBackend ? realAnalysisProgress : simulatedHook.analysisProgress,
    analysisResult: useRealBackend ? realAnalysisResult : simulatedAnalysisResult,
    startAnalysis,
    cancelAnalysis: useRealBackend ? cancelRealAnalysis : simulatedHook.cancelAnalysis,
    resetAnalysis: useRealBackend ? resetRealAnalysis : simulatedHook.resetAnalysis,
  };
};
```

### ç¯å¢ƒæ„ŸçŸ¥çš„è‡ªåŠ¨åˆ‡æ¢
```typescript
// é…ç½®æ–‡ä»¶è‡ªåŠ¨åˆ¤æ–­ç¯å¢ƒ
export const defaultIntelligentAnalysisConfig = {
  // ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ä½¿ç”¨çœŸå®åç«¯
  useRealBackend: isProduction() || 
                  getEnvVar('VITE_USE_REAL_BACKEND') === 'true',
  
  // å¼€å‘ç¯å¢ƒå¯ç”¨è°ƒè¯•æ¨¡å¼                
  debug: isDevelopment(),
};
```

### ä¸€é”®åˆ‡æ¢æµ‹è¯•
```typescript
// å¼€å‘è€…å¯ä»¥è½»æ¾åˆ‡æ¢æµ‹è¯•ä¸åŒåç«¯
const testSimulated = getIntelligentAnalysisConfig({ useRealBackend: false });
const testReal = getIntelligentAnalysisConfig({ useRealBackend: true });

// UIç»„ä»¶å®Œå…¨æ— æ„ŸçŸ¥åˆ‡æ¢
const adapter1 = useIntelligentAnalysisAdapter(testSimulated); // ğŸ­ æ¨¡æ‹Ÿç‰ˆæœ¬
const adapter2 = useIntelligentAnalysisAdapter(testReal);      // ğŸš€ çœŸå®åç«¯
```

---

## ğŸ“Š ä»·å€¼å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§ | ğŸ­ æ¨¡æ‹Ÿç‰ˆæœ¬ | ğŸš€ çœŸå®åç«¯ |
|------|-------------|-------------|
| **å¼€å‘é€Ÿåº¦** | âš¡ æå¿« - æ— éœ€ç­‰å¾…åç«¯ | ğŸŒ ä¾èµ–åç«¯å¼€å‘è¿›åº¦ |
| **æ•°æ®å‡†ç¡®æ€§** | ğŸ² æ¨¡æ‹Ÿæ•°æ®ï¼Œç”¨äºæ¼”ç¤º | ğŸ’ AIç®—æ³•ï¼Œç”Ÿäº§çº§å‡†ç¡®æ€§ |
| **å“åº”æ—¶é—´** | âš¡ å³æ—¶å“åº” (200-800ms) | ğŸ”„ çœŸå®ç½‘ç»œå»¶è¿Ÿ |
| **è°ƒè¯•ä¾¿åˆ©æ€§** | ğŸ› ï¸ å®Œå…¨å¯æ§ï¼Œä¾¿äºè°ƒè¯• | ğŸ” éœ€è¦åç«¯æ—¥å¿—é…åˆ |
| **æ¼”ç¤ºæ•ˆæœ** | ğŸ­ ç¨³å®šå¯é¢„æµ‹ | ğŸ“Š çœŸå®ä½†å¯èƒ½ä¸ç¨³å®š |
| **åŠŸèƒ½å®Œæ•´æ€§** | ğŸš§ åŠŸèƒ½å­é›† | ğŸŒŸ å®Œæ•´åŠŸèƒ½ |
| **æ€§èƒ½è¡¨ç°** | ğŸƒ çº¯å‰ç«¯ï¼Œè½»é‡çº§ | ğŸš€ Ruståç«¯ï¼Œé«˜æ€§èƒ½ |
| **ç»´æŠ¤æˆæœ¬** | ğŸ’° éœ€è¦ä¿æŒä¸çœŸå®ç‰ˆæœ¬åŒæ­¥ | ğŸ”§ åç«¯ç»´æŠ¤å’Œéƒ¨ç½² |

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### å¼€å‘é˜¶æ®µ (Development)
```typescript
// å‰ç«¯å¼€å‘è€…ä½¿ç”¨æ¨¡æ‹Ÿç‰ˆæœ¬è¿›è¡ŒUIå¼€å‘
const config = { useRealBackend: false, debug: true };
```

### é›†æˆæµ‹è¯• (Integration Testing)  
```typescript
// æµ‹è¯•çœŸå®åç«¯é›†æˆ
const config = { useRealBackend: true, debug: true };
```

### ç”Ÿäº§ç¯å¢ƒ (Production)
```typescript  
// è‡ªåŠ¨ä½¿ç”¨çœŸå®åç«¯
const config = getIntelligentAnalysisConfig(); // useRealBackend: true
```

### æ¼”ç¤ºå±•ç¤º (Demo)
```typescript
// ä½¿ç”¨ç¨³å®šçš„æ¨¡æ‹Ÿç‰ˆæœ¬è¿›è¡Œäº§å“æ¼”ç¤º
const config = { useRealBackend: false, debug: false };
```

---

## ğŸš€ æ€»ç»“

é€‚é…å™¨æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼åœ¨äºï¼š

1. **ğŸ”„ å¹³æ»‘è¿‡æ¸¡**: ä»å¼€å‘åˆ°ç”Ÿäº§çš„æ— ç¼åˆ‡æ¢
2. **ğŸ› ï¸ å¼€å‘æ•ˆç‡**: å‰åç«¯å¹¶è¡Œå¼€å‘ï¼Œä¸ç›¸äº’é˜»å¡  
3. **ğŸ¯ çµæ´»æµ‹è¯•**: å¿«é€Ÿåœ¨ä¸åŒå®ç°é—´åˆ‡æ¢è°ƒè¯•
4. **ğŸ“¦ ç»Ÿä¸€æ¥å£**: UIç»„ä»¶å®Œå…¨ä¸æ„ŸçŸ¥åº•å±‚å®ç°å·®å¼‚
5. **ğŸ”§ ç»´æŠ¤å‹å¥½**: å•ä¸€é…ç½®æ§åˆ¶å…¨å±€è¡Œä¸º

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦"æ”¯æŒçœŸå®åç«¯å’Œæ¨¡æ‹Ÿç‰ˆæœ¬åŠ¨æ€åˆ‡æ¢"çš„é€‚é…å™¨æ¶æ„ï¼ ğŸ‰