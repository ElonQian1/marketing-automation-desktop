# 🔍 视口对齐修复验证指南

## 🚨 立即验证修复是否生效

### 步骤 1: 启用调试模式

1. **打开浏览器开发者工具** (F12)
2. **切换到 Console 标签**
3. **复制粘贴以下代码并回车**：

```javascript
// 启用详细调试日志
window.DEBUG_VISUAL_LOGS = true;
window.DEBUG_BOUNDS_CORRECTION = true;

// 监听修复相关日志
const originalLog = console.log;
console.log = function (...args) {
  const msg = args.join(" ");
  if (
    msg.includes("边界修正") ||
    msg.includes("ElementBoundsCorrector") ||
    msg.includes("🚨") ||
    msg.includes("🔧")
  ) {
    console.warn("🔍 VIEWPORT FIX LOG:", ...args);
  }
  originalLog.apply(console, args);
};

console.log("✅ 调试模式已启用，现在打开悬浮窗...");
```

### 步骤 2: 触发悬浮窗

1. **进行正常操作流程**（点击结构匹配等）
2. **打开悬浮窗**
3. **观察控制台输出**

### 步骤 3: 查找关键日志

你应该看到以下日志：

**✅ 修复正在工作的标志**:

```
🚨 [useStepCardData] 准备执行边界修正...
🚨 [ElementBoundsCorrector] ===== 边界修正函数被调用 =====
🔧 [ElementBoundsCorrector] 开始修正元素边界:
```

**❌ 如果没有看到这些日志**:

- 说明修复代码未被调用
- 可能是路径问题或集成问题

### 步骤 4: 检查修复条件

如果看到修复函数被调用，查找：

**需要修复的情况**:

```
🔧 [解析] 应用边界修正: xxx原因
✅ 边界修正完成
```

**不需要修复的情况**:

```
✅ [ElementBoundsCorrector] 无需修正
```

---

## 🔧 手动测试 Element_43 案例

在控制台运行以下代码来测试具体案例：

```javascript
// 测试Element_43修复逻辑
function testElement43() {
  console.log("🧪 手动测试Element_43案例...");

  // 模拟有问题的数据（clickable=false）
  const problematicCase = {
    rootElement: { id: "element_43", clickable: false },
    bounds: { x: 13, y: 1158, width: 521, height: 865 },
  };

  const stepCardData = {
    original_element: { id: "element_43", clickable: false },
  };

  console.log("📍 测试数据:", problematicCase);
  console.log("❓ 应该需要修正 (clickable=false)");

  // 如果修复工作正常，应该会检测到需要修正
  return { problematicCase, stepCardData };
}

// 运行测试
testElement43();
```

---

## 🚨 如果修复没有生效

### 可能原因 1: 代码未重新编译

```bash
# 重新编译TypeScript
npm run type-check
```

### 可能原因 2: 开发服务器需要重启

```bash
# 重启开发服务器
npm run tauri dev
```

### 可能原因 3: 路径或导入问题

检查控制台是否有编译错误：

- ❌ `Cannot resolve module`
- ❌ `Type error`

### 可能原因 4: 条件不满足

修复只在以下条件下触发：

- ✅ `stepCardData.original_element` 存在
- ✅ 元素 ID 不匹配 **或** 边界差异>50px **或** clickable=false

---

## 📊 期望的修复效果

**修复前**:

- 视口显示父容器
- 目标元素只占 1/4 视口
- 可能文本提取错误

**修复后**:

- 视口精确对齐目标元素
- 完整显示元素结构
- 正确的文本提取

---

## 🆘 如果仍有问题

请截图以下信息发给我：

1. **控制台完整日志**（特别是 🚨 标记的）
2. **悬浮窗显示效果**（修复前后对比）
3. **你的操作步骤**

这样我可以快速定位问题所在！
