# åç«¯æ ¸å¿ƒæ–‡ä»¶ç›¸äº’å…³ç³»å›¾

## ğŸ“Š æ•°æ®æµå‘æ€»è§ˆ

```
å‰ç«¯ä¿å­˜æ­¥éª¤
    â†“
[original_data] { original_xml: "", children_texts: [], ... }
    â†“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€æ‰§è¡Œé˜¶æ®µã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£ intelligent_preprocessing.rs
   ğŸ“‹ åŠŸèƒ½ï¼šæå‰æ£€æµ‹å‚æ•°ï¼Œå†³å®šæ˜¯å¦è§¦å‘æ™ºèƒ½åˆ†æ
   âš™ï¸ å…³é”®å‡½æ•°ï¼š
      - check_and_trigger_early_analysis()
      - optimize_steps_with_intelligent_analysis()
   
   ğŸ” æ£€æµ‹åˆ°å‚æ•°ä¸ºç©º â†’ æå‰è§¦å‘æ™ºèƒ½åˆ†æ
   ğŸ” æ£€æµ‹åˆ°å€™é€‰è´¨é‡å·® â†’ æ™ºèƒ½ä¼˜åŒ–
   
   â†“ è°ƒç”¨
   
2ï¸âƒ£ analysis_helpers.rs (æœªåœ¨é™„ä»¶ä¸­ï¼Œä½†è¢«è°ƒç”¨)
   ğŸ“‹ åŠŸèƒ½ï¼šæ‰§è¡Œæ™ºèƒ½åˆ†æï¼Œè°ƒç”¨æ™ºèƒ½åˆ†ææœåŠ¡
   âš™ï¸ å…³é”®å‡½æ•°ï¼š
      - perform_intelligent_strategy_analysis_from_raw()
      - call_frontend_intelligent_analysis_with_context()
   
   â†“ è°ƒç”¨
   
3ï¸âƒ£ intelligent_analysis_service.rs
   ğŸ“‹ åŠŸèƒ½ï¼šStep 0-6 æ™ºèƒ½ç­–ç•¥åˆ†ææ ¸å¿ƒæœåŠ¡
   âš™ï¸ å…³é”®å‡½æ•°ï¼š
      - mock_intelligent_analysis()
      - perform_fallback_analysis() âš ï¸ è¿™é‡Œæœ‰Bugï¼
   
   ğŸ”¥ é—®é¢˜æ‰€åœ¨ï¼š
      âŒ ä¸»åˆ†æè·¯å¾„ï¼šæ­£ç¡®æ·»åŠ  original_data âœ…
      âŒ å›é€€åˆ†æè·¯å¾„ï¼šä¹‹å‰å¿˜è®°æ·»åŠ  original_data âŒ â†’ å·²ä¿®å¤ âœ…
   
   ğŸ“¦ è¾“å‡ºï¼šVec<StrategyCandidate> (æ¯ä¸ªéƒ½åº”åŒ…å« original_data)
   
   â†“ è½¬æ¢
   
4ï¸âƒ£ strategy_generation.rs
   ğŸ“‹ åŠŸèƒ½ï¼šè½¬æ¢åˆ†æç»“æœä¸º V3 æ­¥éª¤æ ¼å¼
   âš™ï¸ å…³é”®å‡½æ•°ï¼š
      - convert_analysis_result_to_v3_steps()
   
   ğŸ”„ æ•°æ®ä¼ é€’ï¼š
      - æ£€æŸ¥ candidate.execution_params["original_data"]
      - å¦‚æœå­˜åœ¨ â†’ å…‹éš†åˆ° V3 æ­¥éª¤çš„ params["original_data"]
      - å¦‚æœä¸å­˜åœ¨ â†’ âš ï¸ è­¦å‘Šæ—¥å¿—
   
   ğŸ“¦ è¾“å‡ºï¼šVec<StepRefOrInline> (V3 æ­¥éª¤æ ¼å¼)
   
   â†“ æ‰§è¡Œ
   
5ï¸âƒ£ step_executor.rs
   ğŸ“‹ åŠŸèƒ½ï¼šæ‰§è¡Œ V3 æ­¥éª¤ï¼ŒåŒ…å«å¤šå€™é€‰è¯„ä¼°
   âš™ï¸ å…³é”®å‡½æ•°ï¼š
      - execute_intelligent_analysis_step()
      - evaluate_best_candidate()
   
   ğŸ” æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ (lines 82-108)ï¼š
      - æ£€æŸ¥ params["original_data"] æ˜¯å¦å­˜åœ¨
      - æ£€æŸ¥ original_xml æ˜¯å¦ä¸ºç©º
      - æ£€æŸ¥ selected_xpath æ˜¯å¦å­˜åœ¨
      - æ£€æŸ¥ children_texts æ˜¯å¦ä¸ºç©º
   
   âš ï¸ å¦‚æœæ•°æ®ç¼ºå¤± â†’ æ—¥å¿—è­¦å‘Š â†’ å¤šå€™é€‰è¯„ä¼°èƒ½åŠ›ä¸‹é™
   
   â†“ è°ƒç”¨
   
6ï¸âƒ£ multi_candidate_evaluator.rs
   ğŸ“‹ åŠŸèƒ½ï¼šå¤šå€™é€‰ç»¼åˆè¯„åˆ†ç³»ç»Ÿ
   âš™ï¸ å…³é”®å‡½æ•°ï¼š
      - evaluate_candidates()
      - score_candidate()
      - check_child_text_match()
   
   ğŸ¯ è¯„åˆ†æ ‡å‡† (7é¡¹)ï¼š
      1. Bounds å®Œå…¨åŒ¹é…: +0.4 åˆ† (æœ€é«˜ä¼˜å…ˆçº§)
      2. å­å…ƒç´ æ–‡æœ¬å®Œå…¨åŒ¹é…: +0.3 åˆ† (çˆ¶å®¹å™¨+å­æ–‡æœ¬æ¨¡å¼)
      3. Resource-ID åŒ¹é…: +0.15 åˆ†
      4. æ–‡æœ¬/æè¿°åŒ¹é…: +0.1 åˆ†
      5. å…ƒç´ å¯ç‚¹å‡»: +0.1 åˆ†
      6. XPath åŒ¹é…: +0.05 åˆ†
      7. ä½ç½®åå¥½: +0.05 åˆ† (æœ€åä¸€ä¸ª)
   
   ğŸ“¥ è¾“å…¥ï¼š
      - xml_content: Option<String> (ç”¨äºå­æ–‡æœ¬æå–)
      - original_bounds: Option<String> (ç”¨æˆ·é€‰æ‹©çš„ç²¾ç¡®è¾¹ç•Œ)
      - children_texts: Vec<String> (ç”¨æˆ·é€‰æ‹©å…ƒç´ çš„å­æ–‡æœ¬)
   
   ğŸ”¥ å…³é”®ä¾èµ–ï¼š
      - å¦‚æœ original_xml ä¸ºç©º â†’ å­æ–‡æœ¬åŒ¹é…å¤±æ•ˆ âŒ
      - å¦‚æœ original_bounds ä¸ºç©º â†’ Bounds åŒ¹é…å¤±æ•ˆ âŒ
      - å¦‚æœ children_texts ä¸ºç©º â†’ å­æ–‡æœ¬åŒ¹é…å¤±æ•ˆ âŒ
   
   ğŸ“¦ è¾“å‡ºï¼šOption<ScoredCandidate> (æœ€ä½³å€™é€‰ + è¯„åˆ†ç†ç”±)
```

---

## ğŸ”— è°ƒç”¨é“¾è·¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ intelligent_preprocessing.rs                            â”‚
â”‚                                                            â”‚
â”‚ check_and_trigger_early_analysis()                        â”‚
â”‚   â”œâ”€ æ£€æµ‹æ­¥éª¤å‚æ•°æ˜¯å¦ä¸ºç©º                                  â”‚
â”‚   â”œâ”€ å¦‚æœä¸ºç©º â†’ æå‰è§¦å‘æ™ºèƒ½åˆ†æ                           â”‚
â”‚   â””â”€ è°ƒç”¨ perform_intelligent_strategy_analysis_from_raw() â”‚
â”‚                                                            â”‚
â”‚ optimize_steps_with_intelligent_analysis()                â”‚
â”‚   â”œâ”€ æ£€æŸ¥å€™é€‰æ­¥éª¤è´¨é‡                                      â”‚
â”‚   â”œâ”€ å†³å®šæ˜¯å¦è§¦å‘æ™ºèƒ½åˆ†æ                                  â”‚
â”‚   â””â”€ æå– original_data ä¼ é€’ç»™æ™ºèƒ½åˆ†æ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ analysis_helpers.rs (æœªåœ¨é™„ä»¶ä¸­)                        â”‚
â”‚                                                            â”‚
â”‚ perform_intelligent_strategy_analysis_from_raw()          â”‚
â”‚   â”œâ”€ è·å– UI XML å¿«ç…§                                      â”‚
â”‚   â”œâ”€ æ„å»º IntelligentAnalysisRequest                      â”‚
â”‚   â””â”€ è°ƒç”¨ intelligent_analysis_service                     â”‚
â”‚                                                            â”‚
â”‚ call_frontend_intelligent_analysis_with_context()         â”‚
â”‚   â”œâ”€ ä» original_data æå–ç”¨æˆ·é€‰æ‹©ä¸Šä¸‹æ–‡                   â”‚
â”‚   â””â”€ è°ƒç”¨å¢å¼ºç‰ˆæ™ºèƒ½åˆ†ææœåŠ¡                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ intelligent_analysis_service.rs                         â”‚
â”‚                                                            â”‚
â”‚ mock_intelligent_analysis()                               â”‚
â”‚   â”œâ”€ è§£æ UI XML (parse_ui_elements)                      â”‚
â”‚   â”œâ”€ ä½¿ç”¨ StrategyEngine è¿›è¡Œ Step 0-6 åˆ†æ               â”‚
â”‚   â”œâ”€ æ„å»º original_data_from_request                      â”‚
â”‚   â”‚   â””â”€ ä» request.user_selection æå–                   â”‚
â”‚   â”‚       - original_xml: request.ui_xml_content          â”‚
â”‚   â”‚       - selected_xpath                                â”‚
â”‚   â”‚       - children_texts                                â”‚
â”‚   â”‚       - element_bounds                                â”‚
â”‚   â”œâ”€ æ·»åŠ  original_data åˆ°æ¯ä¸ªå€™é€‰çš„ execution_params     â”‚
â”‚   â””â”€ å¦‚æœç½®ä¿¡åº¦ä½ â†’ è°ƒç”¨ perform_fallback_analysis()       â”‚
â”‚                                                            â”‚
â”‚ perform_fallback_analysis() âš ï¸ å·²ä¿®å¤                      â”‚
â”‚   â”œâ”€ ç”Ÿæˆå›é€€ç­–ç•¥å€™é€‰                                      â”‚
â”‚   â”œâ”€ ğŸ”¥ ä¿®å¤ï¼šæ„å»º original_data_from_request              â”‚
â”‚   â””â”€ ğŸ”¥ ä¿®å¤ï¼šæ·»åŠ åˆ°å€™é€‰çš„ execution_params                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ strategy_generation.rs                                  â”‚
â”‚                                                            â”‚
â”‚ convert_analysis_result_to_v3_steps()                     â”‚
â”‚   â”œâ”€ éå†æ¯ä¸ª StrategyCandidate                           â”‚
â”‚   â”œâ”€ æå– candidate.execution_params["original_data"]     â”‚
â”‚   â”œâ”€ å¦‚æœå­˜åœ¨ â†’ å…‹éš†åˆ° V3 æ­¥éª¤ params["original_data"]    â”‚
â”‚   â”‚   â””â”€ æ—¥å¿—: "âœ… æ­¥éª¤ X åŒ…å«original_data"               â”‚
â”‚   â””â”€ å¦‚æœä¸å­˜åœ¨ â†’ è­¦å‘Šæ—¥å¿—                                 â”‚
â”‚       â””â”€ "âš ï¸ æ­¥éª¤ X ç¼ºå°‘original_data"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£ step_executor.rs                                        â”‚
â”‚                                                            â”‚
â”‚ execute_intelligent_analysis_step()                       â”‚
â”‚   â”œâ”€ ğŸ“Š æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ (lines 82-108)                     â”‚
â”‚   â”‚   â”œâ”€ original_data æ˜¯å¦å­˜åœ¨ï¼Ÿ                          â”‚
â”‚   â”‚   â”œâ”€ original_xml æ˜¯å¦ä¸ºç©ºï¼Ÿ                           â”‚
â”‚   â”‚   â”œâ”€ selected_xpath æ˜¯å¦å­˜åœ¨ï¼Ÿ                         â”‚
â”‚   â”‚   â””â”€ children_texts æ˜¯å¦ä¸ºç©ºï¼Ÿ                         â”‚
â”‚   â”œâ”€ æ”¶é›†å€™é€‰å…ƒç´                                           â”‚
â”‚   â””â”€ è°ƒç”¨ evaluate_best_candidate()                       â”‚
â”‚                                                            â”‚
â”‚ evaluate_best_candidate()                                 â”‚
â”‚   â”œâ”€ ä» original_data æå–è¯„ä¼°å‡†åˆ™                         â”‚
â”‚   â”‚   â”œâ”€ element_text                                     â”‚
â”‚   â”‚   â”œâ”€ element_bounds                                   â”‚
â”‚   â”‚   â”œâ”€ children_texts                                   â”‚
â”‚   â”‚   â”œâ”€ selected_xpath                                   â”‚
â”‚   â”‚   â””â”€ resource_id                                      â”‚
â”‚   â”œâ”€ æ„å»º EvaluationCriteria                              â”‚
â”‚   â”‚   â””â”€ xml_content: Some(ui_xml.to_string())            â”‚
â”‚   â””â”€ è°ƒç”¨ MultiCandidateEvaluator::evaluate_candidates()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6ï¸âƒ£ multi_candidate_evaluator.rs                            â”‚
â”‚                                                            â”‚
â”‚ evaluate_candidates()                                     â”‚
â”‚   â”œâ”€ éå†æ¯ä¸ªå€™é€‰å…ƒç´                                       â”‚
â”‚   â”œâ”€ è°ƒç”¨ score_candidate() è¯„åˆ†                          â”‚
â”‚   â””â”€ é€‰æ‹©æœ€é«˜åˆ†å€™é€‰                                        â”‚
â”‚                                                            â”‚
â”‚ score_candidate()                                         â”‚
â”‚   â”œâ”€ 1ï¸âƒ£ Bounds å®Œå…¨åŒ¹é…æ£€æŸ¥ (+0.4)                         â”‚
â”‚   â”œâ”€ 2ï¸âƒ£ å­å…ƒç´ æ–‡æœ¬åŒ¹é…æ£€æŸ¥ (+0.3)                          â”‚
â”‚   â”‚   â””â”€ è°ƒç”¨ check_child_text_match()                    â”‚
â”‚   â”œâ”€ 3ï¸âƒ£ Resource-ID åŒ¹é… (+0.15)                          â”‚
â”‚   â”œâ”€ 4ï¸âƒ£ æ–‡æœ¬/æè¿°åŒ¹é… (+0.1)                               â”‚
â”‚   â”œâ”€ 5ï¸âƒ£ å…ƒç´ å¯ç‚¹å‡»æ€§ (+0.1)                                â”‚
â”‚   â”œâ”€ 6ï¸âƒ£ XPath åŒ¹é… (+0.05)                                â”‚
â”‚   â””â”€ 7ï¸âƒ£ ä½ç½®åå¥½ (+0.05)                                   â”‚
â”‚                                                            â”‚
â”‚ check_child_text_match()                                  â”‚
â”‚   â”œâ”€ ç­–ç•¥1: ä»å€™é€‰å…ƒç´ çš„ children å±æ€§è¯»å–                 â”‚
â”‚   â”œâ”€ ç­–ç•¥2: ä½¿ç”¨ helper å‡½æ•°æå–å­å…ƒç´                      â”‚
â”‚   â””â”€ ç­–ç•¥3: ä» XML ä¸­æ ¹æ® bounds å®šä½å¹¶æå–å­æ–‡æœ¬          â”‚
â”‚       â””â”€ ğŸ”¥ ä¾èµ– xml_content å‚æ•°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”¥ æ•°æ®ä¾èµ–å…³ç³»

### original_data å­—æ®µç»“æ„

```json
{
  "original_xml": "å®Œæ•´çš„58KB XMLå†…å®¹",      // ğŸ”¥ å…³é”®ï¼ç”¨äºå­æ–‡æœ¬æå–
  "selected_xpath": "//*[@resource-id='...']", // ğŸ”¥ ç”¨æˆ·ç²¾ç¡®é€‰æ‹©çš„XPath
  "element_bounds": "[45,1059][249,1263]",     // ğŸ”¥ ç”¨äº Bounds å®Œå…¨åŒ¹é…
  "element_text": "é€šè®¯å½•",
  "children_texts": ["é€šè®¯å½•"],               // ğŸ”¥ ç”¨äºå­æ–‡æœ¬å®Œå…¨åŒ¹é…
  "key_attributes": {
    "resource-id": "com.ss.android.ugc.aweme:id/iwk",
    "class": "android.widget.LinearLayout",
    "content-desc": ""
  },
  "data_integrity": {
    "has_original_xml": true,
    "has_user_xpath": true,
    "has_children_texts": true,
    "extraction_timestamp": 1761625597676
  }
}
```

### å„æ–‡ä»¶å¯¹ original_data çš„ä¾èµ–

| æ–‡ä»¶ | å¯¹ original_data çš„ä½œç”¨ | ä¾èµ–å­—æ®µ |
|------|------------------------|---------|
| **intelligent_preprocessing.rs** | ğŸ“¤ æå–å¹¶ä¼ é€’ç»™æ™ºèƒ½åˆ†æ | å®Œæ•´å¯¹è±¡ |
| **intelligent_analysis_service.rs** | ğŸ“¦ æ„å»ºå¹¶æ·»åŠ åˆ°å€™é€‰ | request.ui_xml_content<br>user_selection |
| **strategy_generation.rs** | ğŸ”„ ä¼ é€’åˆ° V3 æ­¥éª¤ | execution_params["original_data"] |
| **step_executor.rs** | ğŸ” æ£€æŸ¥å®Œæ•´æ€§ + æå–è¯„ä¼°å‡†åˆ™ | original_xml<br>selected_xpath<br>children_texts<br>element_bounds |
| **multi_candidate_evaluator.rs** | ğŸ¯ ç»¼åˆè¯„åˆ†ï¼ˆ7é¡¹ï¼‰ | original_xml (å­æ–‡æœ¬æå–)<br>original_bounds (BoundsåŒ¹é…)<br>children_texts (å­æ–‡æœ¬åŒ¹é…)<br>selected_xpath (XPathåŒ¹é…) |

---

## ğŸ› Bug ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰çš„æ•°æ®æµ

```
intelligent_analysis_service.rs
  â”œâ”€ mock_intelligent_analysis()
  â”‚   â””â”€ ä¸»åˆ†æè·¯å¾„: âœ… æ·»åŠ  original_data
  â”‚
  â””â”€ perform_fallback_analysis()
      â””â”€ å›é€€è·¯å¾„: âŒ æ²¡æœ‰æ·»åŠ  original_data
          â†“
      strategy_generation.rs
          â””â”€ âš ï¸ æ—¥å¿—: "æ­¥éª¤ 1 ç¼ºå°‘original_data"
          â†“
      step_executor.rs
          â””â”€ âŒ æ—¥å¿—: "original_data å®Œå…¨ç¼ºå¤±ï¼"
          â†“
      multi_candidate_evaluator.rs
          â””â”€ âŒ æ— æ³•è¿›è¡Œå­æ–‡æœ¬åŒ¹é… (ç¼ºå°‘ xml_content)
          â””â”€ âŒ æ— æ³•è¿›è¡Œ Bounds åŒ¹é… (ç¼ºå°‘ original_bounds)
          â””â”€ è¯„åˆ†ä¸¥é‡é™çº§ï¼šåªèƒ½ç”¨åŸºç¡€åŒ¹é… (0.1åˆ†)
```

### ä¿®å¤åçš„æ•°æ®æµ

```
intelligent_analysis_service.rs
  â”œâ”€ mock_intelligent_analysis()
  â”‚   â””â”€ ä¸»åˆ†æè·¯å¾„: âœ… æ·»åŠ  original_data
  â”‚
  â””â”€ perform_fallback_analysis() âœ… å·²ä¿®å¤
      â”œâ”€ æ„å»º original_data_from_request
      â”‚   â”œâ”€ original_xml: request.ui_xml_content âœ…
      â”‚   â”œâ”€ selected_xpath âœ…
      â”‚   â”œâ”€ children_texts âœ…
      â”‚   â””â”€ element_bounds âœ…
      â””â”€ æ·»åŠ åˆ° execution_params["original_data"] âœ…
          â†“
      strategy_generation.rs
          â””â”€ âœ… æ—¥å¿—: "æ­¥éª¤ 1 åŒ…å«original_dataï¼Œå·²ä¼ é€’åˆ°æ‰§è¡Œå±‚"
          â†“
      step_executor.rs
          â””â”€ âœ… æ—¥å¿—: "original_xml å­˜åœ¨ä¸”æœ‰æ•ˆ"
          â””â”€ âœ… ä¼ é€’å®Œæ•´ EvaluationCriteria
          â†“
      multi_candidate_evaluator.rs
          â””â”€ âœ… å¯ä»¥è¿›è¡Œå­æ–‡æœ¬åŒ¹é… (+0.3åˆ†)
          â””â”€ âœ… å¯ä»¥è¿›è¡Œ Bounds åŒ¹é… (+0.4åˆ†)
          â””â”€ å®Œæ•´è¯„åˆ†ï¼šæœ€é«˜ 0.98 åˆ†
```

---

## ğŸ“ˆ è¯„åˆ†å½±å“åˆ†æ

### ç¼ºå°‘ original_data æ—¶çš„è¯„åˆ†

| è¯„åˆ†é¡¹ | å¾—åˆ† | å¯ç”¨æ€§ |
|--------|------|--------|
| Bounds å®Œå…¨åŒ¹é… | 0.0 | âŒ æ—  original_bounds |
| å­å…ƒç´ æ–‡æœ¬åŒ¹é… | 0.0 | âŒ æ—  children_texts |
| Resource-ID åŒ¹é… | 0.0 | âŒ å¯èƒ½ç¼ºå¤± |
| æ–‡æœ¬/æè¿°åŒ¹é… | 0.1 | âœ… åŸºç¡€åŒ¹é… |
| å…ƒç´ å¯ç‚¹å‡»æ€§ | 0.1 | âœ… å¯ç”¨ |
| XPath åŒ¹é… | 0.0 | âŒ æ—  selected_xpath |
| ä½ç½®åå¥½ | 0.05 | âœ… å¯ç”¨ |
| **æ€»åˆ†** | **0.25** | **ä¸¥é‡é™çº§** |

### æœ‰å®Œæ•´ original_data æ—¶çš„è¯„åˆ†

| è¯„åˆ†é¡¹ | å¾—åˆ† | å¯ç”¨æ€§ |
|--------|------|--------|
| Bounds å®Œå…¨åŒ¹é… | 0.4 | âœ… ç²¾ç¡®åŒ¹é… |
| å­å…ƒç´ æ–‡æœ¬åŒ¹é… | 0.3 | âœ… å®Œå…¨åŒ¹é… "é€šè®¯å½•" |
| Resource-ID åŒ¹é… | 0.15 | âœ… åŒ¹é… |
| æ–‡æœ¬/æè¿°åŒ¹é… | 0.1 | âœ… åŒ¹é… |
| å…ƒç´ å¯ç‚¹å‡»æ€§ | 0.1 | âœ… å¯ç‚¹å‡» |
| XPath åŒ¹é… | 0.05 | âœ… åŒ¹é… |
| ä½ç½®åå¥½ | 0.05 | âœ… æ­£ç¡®ä½ç½® |
| **æ€»åˆ†** | **0.98** | **å®Œç¾è¯„åˆ†** |

---

## âœ… ä¿®å¤æ€»ç»“

### ä¿®å¤å†…å®¹

1. **æ–‡ä»¶**: `intelligent_analysis_service.rs`
2. **å‡½æ•°**: `perform_fallback_analysis()`
3. **ä¿®å¤**: 
   - å°†å‚æ•°ä» `_request` æ”¹ä¸º `request`ï¼ˆå¯ç”¨å‚æ•°ï¼‰
   - æ·»åŠ  `original_data_from_request` æ„å»ºé€»è¾‘ï¼ˆ45è¡Œä»£ç ï¼‰
   - å°† `original_data` æ·»åŠ åˆ°å›é€€å€™é€‰çš„ `execution_params`
   - æ·»åŠ æ—¥å¿—è¿½è¸ª

### å½±å“èŒƒå›´

- **ç›´æ¥å½±å“**: å›é€€åˆ†æç”Ÿæˆçš„å€™é€‰ç°åœ¨åŒ…å«å®Œæ•´æ•°æ®
- **é—´æ¥å½±å“**: 
  - step_executor å¯ä»¥è¿›è¡Œå®Œæ•´æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
  - multi_candidate_evaluator å¯ä»¥è¿›è¡Œå®Œæ•´è¯„åˆ†
  - å¤±è´¥æ¢å¤èƒ½åŠ›å¤§å¹…æå‡

### éªŒè¯æ–¹æ³•

æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦å‡ºç°ï¼š
```
âœ… [å›é€€åˆ†æ] å›é€€å€™é€‰å·²åŒ…å« original_data (xml_size=58524 bytes)
ğŸ”„ [æ•°æ®ä¼ é€’] æ­¥éª¤ 1 åŒ…å«original_dataï¼Œå·²ä¼ é€’åˆ°æ‰§è¡Œå±‚
âœ…âœ…âœ… [æ•°æ®å®Œæ•´æ€§] original_xml å­˜åœ¨ä¸”æœ‰æ•ˆ
âœ…âœ…âœ…âœ… [Boundså®Œå…¨åŒ¹é…] '[45,1059][249,1263]' å¾—åˆ†: 0.400
âœ…âœ…âœ…   [å­å…ƒç´ æ–‡æœ¬å®Œå…¨åŒ¹é…] 'é€šè®¯å½•' å¾—åˆ†: 0.300
ğŸ† [æœ€ä½³å€™é€‰] score=0.980
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

ç°åœ¨åç«¯å·²ç»å®Œå…¨ä¿®å¤ï¼Œä½†å‰ç«¯ä»ç„¶å‘é€ç©ºæ•°æ®ï¼š
- `original_xml: ""` âŒ
- `children_texts: []` âŒ
- `element_bounds: "[0,1321][1080,1447]"` âŒ (é”™è¯¯çš„å®¹å™¨)

**éœ€è¦ä¿®å¤å‰ç«¯**ï¼š
1. é™æ€åˆ†ææ—¶è·å– XML å¿«ç…§
2. ç²¾ç¡®é€‰æ‹©å¯ç‚¹å‡»å…ƒç´ ï¼ˆä¸æ˜¯å®¹å™¨ï¼‰
3. ç”Ÿæˆç²¾ç¡®çš„ XPath (å¸¦ resource-id)
4. æå–å­å…ƒç´ æ–‡æœ¬åˆ—è¡¨
5. ä¿å­˜æ—¶éªŒè¯æ•°æ®å®Œæ•´æ€§
