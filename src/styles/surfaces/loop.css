/* 循环卡片独立样式基准线 */
/* src/styles/surfaces/loop.css */

/* ===== 循环卡片简化样式基准 - 颜色区分设计 ===== */

.loop-step-card {
  /* 循环卡片专用颜色主题 - 绿色系 */
  --loop-card-bg: #065f46;           /* 深绿色背景 */
  --loop-card-border: #047857;       /* 绿色边框 */
  --loop-card-text: #ecfdf5;         /* 浅绿色文字 */
  --loop-card-text-secondary: #a7f3d0; /* 次要文字 */
  
  /* 布局变量 */
  --loop-card-radius: 12px;
  --loop-card-padding: 16px;
  --loop-spacing-sm: 8px;
  --loop-spacing-md: 12px;
  
  /* 基础样式 */
  background: var(--loop-card-bg) !important;
  color: var(--loop-card-text) !important;
  border: 1px solid var(--loop-card-border) !important;
  border-radius: var(--loop-card-radius);
  padding: var(--loop-card-padding);
  margin-bottom: var(--loop-spacing-md);
  min-height: 80px;
  font-size: 14px;
  font-weight: 400;
  line-height: 1.5;
  cursor: grab;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
  transition: all 0.2s ease;
  position: relative;
  
  /* 拖拽指示器 */
  &::before {
    content: '';
    position: absolute;
    left: 6px;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 20px;
    background: var(--loop-card-text-secondary);
    border-radius: 2px;
    opacity: 0.5;
  }
}

/* 悬停效果 */
.loop-step-card:hover {
  background: #047857 !important;
  border-color: #059669 !important;
  box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
}

/* 执行状态 */
.loop-step-card.executing {
  border: 2px solid #10b981 !important;
  box-shadow: 0 0 16px rgba(16, 185, 129, 0.4);
  animation: loop-executing-pulse 2s infinite;
}

@keyframes loop-executing-pulse {
  0%, 100% { box-shadow: 0 0 16px rgba(16, 185, 129, 0.4); }
  50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); }
}

/* 循环开始卡片 */
.loop-step-card.loop-start {
  border-left: 4px solid #10b981;
}

/* 循环结束卡片 */
.loop-step-card.loop-end {
  border-left: 4px solid #f59e0b;
}

/* 禁用所有复杂的Ant Design样式 */
.loop-step-card .ant-card-head,
.loop-step-card .ant-card-body,
.loop-step-card .ant-card-extra {
  background: transparent !important;
  border: none !important;
  padding: 0 !important;
}

/* 文字颜色统一 */
.loop-step-card,
.loop-step-card * {
  color: var(--loop-card-text) !important;
}

/* 次要文字 */
.loop-step-card .text-secondary {
  color: var(--loop-card-text-secondary) !important;
}

/* 按钮样式简化 */
.loop-step-card .ant-btn {
  background: rgba(255, 255, 255, 0.1) !important;
  border-color: rgba(255, 255, 255, 0.2) !important;
  color: var(--loop-card-text) !important;
}

.loop-step-card .ant-btn:hover {
  background: rgba(255, 255, 255, 0.2) !important;
  border-color: rgba(255, 255, 255, 0.3) !important;
}

/* 标签样式 */
.loop-step-card .ant-tag {
  background: rgba(16, 185, 129, 0.2) !important;
  border-color: rgba(16, 185, 129, 0.4) !important;
  color: #ecfdf5 !important;
}

/* 循环对指示器 */
.loop-pair-indicator {
  position: absolute;
  right: 8px;
  top: 8px;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #10b981;
  opacity: 0.8;
}

.loop-step-card.loop-start .loop-pair-indicator {
  background: #10b981; /* 开始：绿色 */
}

.loop-step-card.loop-end .loop-pair-indicator {
  background: #f59e0b; /* 结束：橙色 */
}

/* ===== 循环卡片基础结构 ===== */

.loop-step-card {
  background: var(--loop-card-bg) !important;
  border: 1px solid var(--loop-card-border) !important;
  border-radius: var(--loop-card-radius) !important;
  box-shadow: var(--loop-card-shadow) !important;
  margin-bottom: var(--loop-spacing-lg) !important;
  transition: all 0.3s ease !important;
  
  /* 强制白底黑字主题 */
  color: var(--loop-card-text-primary) !important;
}

/* 循环卡片头部 */
.loop-step-card .ant-card-head {
  background: var(--loop-header-bg) !important;
  border-bottom: 1px solid var(--loop-card-border) !important;
  color: var(--loop-header-text) !important;
}

.loop-step-card .ant-card-head-title {
  color: var(--loop-header-text) !important;
}

/* 循环卡片图标样式 */
.loop-step-card .anticon {
  color: var(--loop-icon-primary) !important;
}

.loop-step-card .ant-card-head .anticon-redo {
  color: var(--loop-icon-primary) !important;
}

/* 循环卡片主体 */
.loop-step-card .ant-card-body {
  background: var(--loop-card-bg) !important;
  color: var(--loop-card-text-primary) !important;
  padding: var(--loop-spacing-lg) !important;
}

/* ===== 执行状态样式 ===== */

.loop-step-card.executing {
  border: 2px solid var(--loop-card-border-active) !important;
  box-shadow: var(--loop-card-shadow-active) !important;
  
  /* 执行时的脉冲动画 */
  animation: loop-executing-pulse 2s infinite;
}

@keyframes loop-executing-pulse {
  0% {
    box-shadow: var(--loop-card-shadow-active);
  }
  50% {
    box-shadow: 0 4px 16px rgba(24, 144, 255, 0.25);
  }
  100% {
    box-shadow: var(--loop-card-shadow-active);
  }
}

/* ===== 折叠状态样式 ===== */

.loop-step-card.collapsed {
  margin-bottom: var(--loop-spacing-sm) !important;
}

.loop-step-card.collapsed .ant-card-body {
  padding: var(--loop-spacing-sm) var(--loop-spacing-lg) !important;
}

/* ===== 循环配置区域 ===== */

.loop-config-area {
  background: var(--bg-2, #f9fafb);
  border: 1px solid var(--border-1, #f3f4f6);
  border-radius: var(--radius-1, 6px);
  padding: var(--loop-spacing-md);
  margin-bottom: var(--loop-spacing-md);
  color: var(--loop-card-text-primary) !important;
}

.loop-config-area label {
  color: var(--loop-card-text-secondary) !important;
  font-weight: 500;
  margin-right: var(--loop-spacing-sm);
}

.loop-config-area .ant-typography {
  color: var(--loop-card-text-secondary) !important;
}

/* ===== 循环体容器 ===== */

.loop-body-area {
  margin-top: var(--loop-spacing-md);
}

.loop-body-container {
  background: var(--loop-body-bg) !important;
  border: 2px dashed var(--loop-body-border) !important;
  border-radius: var(--loop-card-radius) !important;
  padding: var(--loop-spacing-lg) !important;
  color: var(--loop-body-text) !important;
  min-height: 100px;
  transition: all 0.3s ease;
}

.loop-body-container:hover {
  background: #f0f9e8 !important;
  border-color: #95de64 !important;
}

.loop-body-header {
  margin-bottom: var(--loop-spacing-md);
  font-weight: 600;
  color: var(--loop-body-text) !important;
}

.loop-body-content {
  color: var(--loop-body-text) !important;
}

/* ===== 空循环体状态 ===== */

.empty-loop-body {
  text-align: center !important;
  padding: var(--loop-spacing-xl) 0 !important;
  color: var(--text-3, #9ca3af) !important;
  font-style: italic;
  border: 2px dashed transparent;
  border-radius: var(--radius-1, 6px);
  transition: all 0.3s ease;
}

.empty-loop-body:hover {
  color: var(--accent-8, #1677ff) !important;
  background: rgba(24, 144, 255, 0.05) !important;
  border-color: rgba(24, 144, 255, 0.2) !important;
}

/* ===== 循环内步骤样式 ===== */

.loop-inner-step {
  background: var(--bg-light-base, #ffffff);
  border: 1px solid var(--border-1, #f3f4f6);
  border-radius: var(--radius-1, 6px);
  padding: var(--loop-spacing-sm) var(--loop-spacing-md);
  margin-bottom: var(--loop-spacing-sm);
  color: var(--loop-card-text-primary) !important;
  position: relative;
  
  /* 左侧循环指示条 */
  border-left: 3px solid var(--accent-6, #69c0ff);
}

.loop-inner-step:last-child {
  margin-bottom: 0;
}

.loop-inner-step .ant-typography {
  color: var(--loop-card-text-primary) !important;
  margin: 0;
}

/* ===== 循环状态标签 ===== */

.loop-step-card .ant-tag {
  border: 1px solid;
  font-weight: 500;
}

.loop-step-card .ant-tag.ant-tag-processing {
  background: #e6f7ff !important;
  border-color: #91d5ff !important;
  color: #1890ff !important;
}

.loop-step-card .ant-tag.ant-tag-default {
  background: #f5f5f5 !important;
  border-color: #d9d9d9 !important;
  color: #666666 !important;
}

/* ===== 工具栏按钮样式 ===== */

.loop-step-card .ant-card-extra .ant-btn {
  border: none !important;
  box-shadow: none !important;
  color: var(--loop-card-text-secondary) !important;
}

.loop-step-card .ant-card-extra .ant-btn:hover {
  background: var(--bg-2, #f5f5f5) !important;
  color: var(--loop-card-text-primary) !important;
}

.loop-step-card .ant-card-extra .ant-btn.ant-btn-dangerous {
  color: var(--red-6, #f5222d) !important;
}

.loop-step-card .ant-card-extra .ant-btn.ant-btn-dangerous:hover {
  background: var(--red-1, #fff2f0) !important;
  color: var(--red-7, #cf1322) !important;
}

/* ===== 表单控件样式重写 ===== */

.loop-step-card .ant-select,
.loop-step-card .ant-input-number {
  color: var(--loop-card-text-primary) !important;
}

.loop-step-card .ant-select-selector {
  background: var(--bg-light-base, #ffffff) !important;
  border-color: var(--loop-card-border) !important;
  color: var(--loop-card-text-primary) !important;
}

.loop-step-card .ant-input-number {
  background: var(--bg-light-base, #ffffff) !important;
  border-color: var(--loop-card-border) !important;
  color: var(--loop-card-text-primary) !important;
}

/* ===== 响应式设计 ===== */

@media (max-width: 768px) {
  .loop-step-card {
    margin-bottom: var(--loop-spacing-md) !important;
  }
  
  .loop-body-container {
    padding: var(--loop-spacing-md) !important;
  }
  
  .loop-config-area {
    padding: var(--loop-spacing-sm) !important;
  }
}

/* ===== 深色主题兼容 ===== */

.dark .loop-step-card {
  --loop-card-bg: var(--bg-2, #1f2937);
  --loop-card-border: var(--border-2, #374151);
  --loop-card-text-primary: var(--text-1, #f9fafb);
  --loop-card-text-secondary: var(--text-2, #d1d5db);
  --loop-header-bg: var(--bg-3, #111827);
  --loop-header-text: var(--text-1, #f9fafb);
  --loop-body-bg: rgba(34, 197, 94, 0.1);
  --loop-body-border: rgba(34, 197, 94, 0.3);
  --loop-body-text: var(--text-1, #f9fafb);
}

/* ===== 无障碍支持 ===== */

.loop-step-card:focus-within {
  outline: 2px solid var(--accent-6, #69c0ff);
  outline-offset: 2px;
}

.loop-step-card [role="button"]:focus {
  outline: 2px solid var(--accent-6, #69c0ff);
  outline-offset: 1px;
}

/* ===== 打印样式 ===== */

@media print {
  .loop-step-card {
    break-inside: avoid;
    box-shadow: none !important;
    border: 1px solid #000 !important;
  }
  
  .loop-step-card.executing {
    border: 2px solid #000 !important;
  }
}