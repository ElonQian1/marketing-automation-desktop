@layer surfaces {
  /* ==================== 智能工具栏主题适配系统 ==================== */
  
  /* 工具栏CSS变量定义 - 适配主题切换 */
  :root {
    /* 浅色主题工具栏变量 */
    --toolbar-bg: rgba(255, 255, 255, 0.95);
    --toolbar-bg-dragging: rgba(255, 255, 255, 0.9);
    --toolbar-border: #d9d9d9;
    --toolbar-text: #262626;
    --toolbar-text-secondary: #8c8c8c;
    --toolbar-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    --toolbar-shadow-dragging: 0 8px 16px rgba(0, 0, 0, 0.15);
    --toolbar-backdrop-filter: blur(8px);
    
    /* 按钮样式变量 */
    --toolbar-btn-bg: transparent;
    --toolbar-btn-hover-bg: rgba(0, 0, 0, 0.04);
    --toolbar-btn-active-bg: rgba(0, 0, 0, 0.06);
    --toolbar-icon-color: #8c8c8c;
    --toolbar-icon-hover-color: #262626;
  }

  /* 暗色主题变量覆盖 */
  .dark-theme {
    --toolbar-bg: rgba(22, 27, 34, 0.95);
    --toolbar-bg-dragging: rgba(22, 27, 34, 0.9);
    --toolbar-border: #30363d;
    --toolbar-text: #f0f6fc;
    --toolbar-text-secondary: #8b949e;
    --toolbar-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    --toolbar-shadow-dragging: 0 8px 16px rgba(0, 0, 0, 0.4);
    
    /* 暗色主题按钮样式 */
    --toolbar-btn-bg: transparent;
    --toolbar-btn-hover-bg: rgba(255, 255, 255, 0.05);
    --toolbar-btn-active-bg: rgba(255, 255, 255, 0.08);
    --toolbar-icon-color: #8b949e;
    --toolbar-icon-hover-color: #f0f6fc;
  }

  /* ==================== 工具栏基础样式 ==================== */

  /* 主工具栏容器 - 使用!important确保覆盖内联样式 */
  .draggable-toolbar,
  .header-only-drag-toolbar,
  .smart-layout-toolbar-control,
  .smart-layout-toolbar-trigger,
  .layout-control-toolbar,
  .floating-layout-toolbar {
    position: fixed !important;
    z-index: 9999 !important;
    background: var(--toolbar-bg) !important;
    border: 1px solid var(--toolbar-border) !important;
    border-radius: 6px !important;
    box-shadow: var(--toolbar-shadow) !important;
    backdrop-filter: var(--toolbar-backdrop-filter) !important;
    transition: all 0.2s ease !important;
    transform: translateZ(0) !important;
    will-change: auto !important;
    color: var(--toolbar-text) !important;
  }

  /* 拖拽状态样式 - 使用!important确保覆盖内联样式 */
  .draggable-toolbar.dragging,
  .header-only-drag-toolbar.dragging {
    background: var(--toolbar-bg-dragging) !important;
    box-shadow: var(--toolbar-shadow-dragging) !important;
    opacity: 0.9 !important;
    transition: none !important;
    will-change: transform, opacity !important;
  }

  /* 智能工具栏特定样式 */
  .smart-toolbar-optimized {
    /* 继承基础工具栏样式，可添加特定覆盖 */
    position: relative;
  }

  /* ==================== 工具栏内部元素样式 ==================== */

  /* 拖拽手柄样式 */
  .draggable-toolbar .drag-handle,
  .header-only-drag-toolbar .drag-handle {
    cursor: grab;
    padding: 2px;
    border-radius: 2px;
    display: flex;
    align-items: center;
    transition: background-color 0.2s ease;
  }

  .draggable-toolbar .drag-handle:hover,
  .header-only-drag-toolbar .drag-handle:hover {
    background-color: var(--toolbar-btn-hover-bg);
  }

  .draggable-toolbar .drag-handle:active,
  .header-only-drag-toolbar .drag-handle:active {
    cursor: grabbing;
    background-color: var(--toolbar-btn-active-bg);
  }

  /* 拖拽图标样式 */
  .draggable-toolbar .drag-handle .anticon,
  .header-only-drag-toolbar .drag-handle .anticon {
    color: var(--toolbar-icon-color);
    font-size: 12px;
    transition: color 0.2s ease;
  }

  .draggable-toolbar .drag-handle:hover .anticon,
  .header-only-drag-toolbar .drag-handle:hover .anticon {
    color: var(--toolbar-icon-hover-color);
  }

  /* ==================== 工具栏按钮样式适配 ==================== */

  /* 覆盖Ant Design按钮在工具栏中的样式 */
  .draggable-toolbar .ant-btn,
  .header-only-drag-toolbar .ant-btn {
    color: var(--toolbar-text);
    border-color: transparent;
    background-color: var(--toolbar-btn-bg);
    transition: all 0.2s ease;
  }

  .draggable-toolbar .ant-btn:hover,
  .draggable-toolbar .ant-btn:focus,
  .header-only-drag-toolbar .ant-btn:hover,
  .header-only-drag-toolbar .ant-btn:focus {
    color: var(--toolbar-text);
    background-color: var(--toolbar-btn-hover-bg);
    border-color: var(--toolbar-border);
  }

  .draggable-toolbar .ant-btn:active,
  .header-only-drag-toolbar .ant-btn:active {
    background-color: var(--toolbar-btn-active-bg);
  }

  /* 工具栏中的图标样式 */
  .draggable-toolbar .ant-btn .anticon,
  .header-only-drag-toolbar .ant-btn .anticon {
    color: var(--toolbar-icon-color);
    transition: color 0.2s ease;
  }

  .draggable-toolbar .ant-btn:hover .anticon,
  .draggable-toolbar .ant-btn:focus .anticon,
  .header-only-drag-toolbar .ant-btn:hover .anticon,
  .header-only-drag-toolbar .ant-btn:focus .anticon {
    color: var(--toolbar-icon-hover-color);
  }

  /* ==================== 下拉菜单样式适配 ==================== */

  /* 工具栏触发的下拉菜单也需要适配主题 */
  .draggable-toolbar .ant-dropdown-menu,
  .header-only-drag-toolbar .ant-dropdown-menu {
    background: var(--toolbar-bg);
    border: 1px solid var(--toolbar-border);
    box-shadow: var(--toolbar-shadow);
  }

  .draggable-toolbar .ant-dropdown-menu-item,
  .header-only-drag-toolbar .ant-dropdown-menu-item {
    color: var(--toolbar-text);
  }

  .draggable-toolbar .ant-dropdown-menu-item:hover,
  .header-only-drag-toolbar .ant-dropdown-menu-item:hover {
    background-color: var(--toolbar-btn-hover-bg);
  }

  .draggable-toolbar .ant-dropdown-menu-item .anticon,
  .header-only-drag-toolbar .ant-dropdown-menu-item .anticon {
    color: var(--toolbar-icon-color);
  }

  /* ==================== 性能优化指示器 ==================== */

  /* 性能模式指示器适配暗色主题 */
  .draggable-toolbar .performance-indicator,
  .header-only-drag-toolbar .performance-indicator {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #52c41a;
    border: 1px solid var(--toolbar-bg);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    transition: border-color 0.2s ease;
  }

  /* ==================== 响应式适配 ==================== */

  /* 小屏幕下的工具栏适配 */
  @media (max-width: 768px) {
    .draggable-toolbar,
    .header-only-drag-toolbar {
      padding: 6px 8px;
      font-size: 12px;
    }
    
    .draggable-toolbar .ant-btn,
    .header-only-drag-toolbar .ant-btn {
      padding: 2px 6px;
      font-size: 12px;
    }
  }

  /* ==================== 收起状态样式 ==================== */

  /* 工具栏收起状态 */
  .draggable-toolbar.collapsed,
  .header-only-drag-toolbar.collapsed {
    padding: 4px;
  }

  .draggable-toolbar.collapsed .ant-btn,
  .header-only-drag-toolbar.collapsed .ant-btn {
    padding: 2px;
    min-width: auto;
  }

  /* ==================== 无障碍访问支持 ==================== */

  /* 高对比度模式支持 */
  @media (prefers-contrast: high) {
    .draggable-toolbar,
    .header-only-drag-toolbar {
      border-width: 2px;
      box-shadow: none;
    }
  }

  /* 减少动画首选项支持 */
  @media (prefers-reduced-motion: reduce) {
    .draggable-toolbar,
    .draggable-toolbar .ant-btn,
    .draggable-toolbar .drag-handle,
    .header-only-drag-toolbar,
    .header-only-drag-toolbar .ant-btn,
    .header-only-drag-toolbar .drag-handle {
      transition: none;
    }
  }

  /* ==================== 主题切换过渡动画 ==================== */

  /* 主题切换时的平滑过渡 */
  .draggable-toolbar,
  .header-only-drag-toolbar,
  .smart-layout-toolbar-control,
  .smart-layout-toolbar-trigger {
    transition: 
      background-color 0.3s ease,
      border-color 0.3s ease,
      color 0.3s ease,
      box-shadow 0.2s ease;
  }

  .draggable-toolbar .ant-btn,
  .header-only-drag-toolbar .ant-btn {
    transition: 
      background-color 0.2s ease,
      color 0.2s ease,
      border-color 0.2s ease;
  }

  /* ==================== 特殊工具栏样式 ==================== */

  /* SmartLayoutToolbar 特殊样式 */
  .smart-layout-toolbar-control {
    opacity: 0.9 !important;
  }

  .smart-layout-toolbar-trigger {
    opacity: 0.7 !important;
  }

  .smart-layout-toolbar-trigger:hover {
    opacity: 1 !important;
    background: var(--toolbar-btn-hover-bg) !important;
  }

  /* 确保所有工具栏按钮的一致性 */
  .smart-layout-toolbar-control .ant-btn,
  .smart-layout-toolbar-trigger .ant-btn {
    color: var(--toolbar-text) !important;
    border-color: var(--toolbar-border) !important;
  }

  .smart-layout-toolbar-control .ant-btn:hover,
  .smart-layout-toolbar-trigger .ant-btn:hover {
    background: var(--toolbar-btn-hover-bg) !important;
    color: var(--toolbar-icon-hover-color) !important;
  }
}