/**
 * 精确样式分离器 (Precise Style Separator)
 * 根据功能精确分离循环卡片和主程序元素样式
 */

/* =============================================================================
   CSS层级定义 - 确保正确的样式优先级
   ============================================================================= */

@layer theme-base, loop-cards, main-app, universal-ui, overrides;

/* =============================================================================
   1. 主程序默认暗灰色系（应用于所有非循环卡片元素）
   ============================================================================= */

@layer main-app {
  /* 主程序基础样式 - 暗灰色系 */
  .main-app-theme,
  [data-theme="dark"],
  [data-theme="main-app"] {
    --main-bg: #1f2937;
    --main-text: #e5e7eb;
    --main-border: #374151;
    --main-hover: #4b5563;
  }

  /* 主程序元素强制暗色主题 */
  .main-app-theme .ant-table,
  .main-app-theme .ant-card,
  .main-app-theme .ant-list,
  .main-app-theme .ant-descriptions,
  .main-app-theme .ant-form,
  .main-app-theme .ant-input,
  .main-app-theme .ant-select,
  .main-app-theme .ant-textarea {
    background-color: var(--main-bg) !important;
    color: var(--main-text) !important;
    border-color: var(--main-border) !important;
  }
}

/* =============================================================================
   2. 循环卡片专用样式（仅白底黑字）
   ============================================================================= */

@layer loop-cards {
  /* 循环卡片精确选择器 */
  .loop-card,
  .step-card[data-loop="true"],
  [data-step-type="loop"],
  .draggable-step-card[data-is-loop="true"],
  .smart-step-card[data-loop="true"] {
    --loop-bg: #ffffff;
    --loop-text: #333333;
    --loop-border: #e1e4e8;
    
    background-color: var(--loop-bg) !important;
    color: var(--loop-text) !important;
    border: 1px solid var(--loop-border) !important;
  }

  /* 循环卡片内部元素 */
  .loop-card *,
  .step-card[data-loop="true"] *,
  [data-step-type="loop"] *,
  .draggable-step-card[data-is-loop="true"] *,
  .smart-step-card[data-loop="true"] * {
    color: var(--loop-text) !important;
  }

  /* 循环卡片内的Ant Design组件 */
  .loop-card .ant-card,
  .loop-card .ant-btn,
  .loop-card .ant-tag,
  .step-card[data-loop="true"] .ant-card,
  .step-card[data-loop="true"] .ant-btn,
  .step-card[data-loop="true"] .ant-tag {
    background-color: var(--loop-bg) !important;
    color: var(--loop-text) !important;
    border-color: var(--loop-border) !important;
  }
}

/* =============================================================================
   3. Universal UI 专用保护（保持其原有暗色主题）
   ============================================================================= */

@layer universal-ui {
  /* Universal UI 组件保护 */
  .universal-page-finder,
  .universal-ui-container,
  .xml-inspector-modal,
  .grid-element-view,
  .visual-element-view {
    /* 重置为暗色主题 */
    --ui-bg: #1f2937;
    --ui-text: #e5e7eb;
    --ui-border: #374151;
    --ui-hover: #4b5563;
  }

  /* Universal UI 模态框 */
  .universal-page-finder .ant-modal-content,
  .xml-inspector-modal .ant-modal-content {
    background: var(--ui-bg) !important;
  }

  /* Universal UI 内部组件 */
  .universal-page-finder .ant-card,
  .universal-page-finder .ant-table,
  .universal-page-finder .ant-input,
  .universal-page-finder .ant-select,
  .xml-inspector-modal .ant-table,
  .xml-inspector-modal .ant-tree {
    background-color: var(--ui-bg) !important;
    color: var(--ui-text) !important;
    border-color: var(--ui-border) !important;
  }

  /* Universal UI 文本元素 */
  .universal-page-finder *,
  .xml-inspector-modal * {
    color: var(--ui-text) !important;
  }
}

/* =============================================================================
   4. 防止样式污染的边界保护
   ============================================================================= */

@layer overrides {
  /* 防止循环卡片样式泄露到Universal UI */
  .universal-page-finder .loop-card,
  .xml-inspector-modal .loop-card {
    /* 在Universal UI中的循环卡片保持暗色 */
    background-color: var(--ui-bg) !important;
    color: var(--ui-text) !important;
    border-color: var(--ui-border) !important;
  }

  /* 防止主程序样式影响循环卡片 */
  .loop-card .universal-page-finder,
  .step-card[data-loop="true"] .universal-page-finder {
    /* 循环卡片内的Universal UI保持暗色 */
    background-color: var(--ui-bg) !important;
    color: var(--ui-text) !important;
  }
}

/* =============================================================================
   5. ADB XML检查器特殊处理
   ============================================================================= */

@layer overrides {
  /* XML检查器强制可读性 */
  .adb-xml-inspector,
  .xml-content-area,
  .xml-node-detail {
    background-color: #ffffff !important;
    color: #333333 !important;
    border-color: #e1e4e8 !important;
  }

  .adb-xml-inspector .ant-tree,
  .adb-xml-inspector .ant-table,
  .xml-content-area .ant-descriptions {
    background-color: #ffffff !important;
    color: #333333 !important;
  }
}

/* =============================================================================
   性能说明
   ============================================================================= */

/*
  使用CSS层级和CSS自定义属性（变量）确保：
  1. 样式优先级清晰
  2. 无JavaScript运行时开销
  3. 浏览器原生优化
  4. 易于维护和调试
*/