/**
 * 循环卡片强制样式模块
 * 解决黑底黑字问题的终极方案
 */

/* =============================================================================
   循环卡片核心变量
   ============================================================================= */

:root {
  /* 循环卡片专用颜色系统 */
  --loop-white-bg: #ffffff;
  --loop-black-text: #333333;
  --loop-light-border: #e1e4e8;
  --loop-hover-bg: #f6f8fa;
  --loop-active-bg: #e1e4e8;
  --loop-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  --loop-shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* =============================================================================
   循环卡片强制白底黑字 - 最高优先级
   ============================================================================= */

/* 第一层：所有可能的循环卡片选择器 */
.step-card,
.loop-card,
.loop-step-card,
.draggable-step-card,
.smart-step-card,
.ant-card.step-card,
.ant-card.loop-card,
.ant-card.loop-step-card,
[data-loop-badge],
[data-step-type="loop"],
[data-component="loop-card"],
[data-is-loop="true"],
[class*="step-card"],
[class*="loop-card"] {
  /* 强制白色背景 */
  background-color: var(--loop-white-bg) !important;
  background: var(--loop-white-bg) !important;
  
  /* 强制黑色文字 */
  color: var(--loop-black-text) !important;
  
  /* 边框和阴影 */
  border: 1px solid var(--loop-light-border) !important;
  border-color: var(--loop-light-border) !important;
  box-shadow: var(--loop-shadow) !important;
  
  /* 确保可见性 */
  opacity: 1 !important;
  visibility: visible !important;
}

/* 第二层：循环卡片悬停状态 */
.step-card:hover,
.loop-card:hover,
.loop-step-card:hover,
.draggable-step-card:hover,
.ant-card.step-card:hover,
.ant-card.loop-card:hover {
  background-color: var(--loop-hover-bg) !important;
  background: var(--loop-hover-bg) !important;
  box-shadow: var(--loop-shadow-hover) !important;
  color: var(--loop-black-text) !important;
}

/* =============================================================================
   循环卡片内部元素强制样式
   ============================================================================= */

/* 第三层：循环卡片内的所有子元素 */
.step-card *,
.loop-card *,
.loop-step-card *,
.draggable-step-card *,
.smart-step-card *,
.ant-card.step-card *,
.ant-card.loop-card *,
.ant-card.loop-step-card *,
[data-loop-badge] *,
[data-step-type="loop"] *,
[data-component="loop-card"] *,
[data-is-loop="true"] *,
[class*="step-card"] *,
[class*="loop-card"] * {
  color: var(--loop-black-text) !important;
}

/* 第四层：循环卡片内的Ant Design组件 */
.step-card .ant-card,
.step-card .ant-card-head,
.step-card .ant-card-body,
.step-card .ant-card-head-title,
.step-card .ant-card-head-wrapper,
.loop-card .ant-card,
.loop-card .ant-card-head,
.loop-card .ant-card-body,
.loop-card .ant-card-head-title,
.loop-card .ant-card-head-wrapper {
  background-color: var(--loop-white-bg) !important;
  background: var(--loop-white-bg) !important;
  color: var(--loop-black-text) !important;
  border-color: var(--loop-light-border) !important;
}

/* 第五层：循环卡片内的按钮 */
.step-card .ant-btn,
.step-card .ant-button,
.loop-card .ant-btn,
.loop-card .ant-button {
  background-color: transparent !important;
  background: transparent !important;
  color: var(--loop-black-text) !important;
  border-color: var(--loop-light-border) !important;
}

.step-card .ant-btn:hover,
.step-card .ant-button:hover,
.loop-card .ant-btn:hover,
.loop-card .ant-button:hover {
  background-color: var(--loop-hover-bg) !important;
  background: var(--loop-hover-bg) !important;
  color: var(--loop-black-text) !important;
  border-color: var(--loop-light-border) !important;
}

/* 第六层：循环卡片内的图标 */
.step-card .anticon,
.step-card .ant-icon,
.loop-card .anticon,
.loop-card .ant-icon {
  color: var(--loop-black-text) !important;
  fill: var(--loop-black-text) !important;
}

/* 第七层：循环卡片内的标签和徽章 */
.step-card .ant-tag,
.step-card .ant-badge,
.loop-card .ant-tag,
.loop-card .ant-badge {
  background-color: var(--loop-hover-bg) !important;
  background: var(--loop-hover-bg) !important;
  color: var(--loop-black-text) !important;
  border-color: var(--loop-light-border) !important;
}

/* 第八层：循环卡片内的输入控件 */
.step-card .ant-input,
.step-card .ant-select,
.step-card .ant-textarea,
.loop-card .ant-input,
.loop-card .ant-select,
.loop-card .ant-textarea {
  background-color: var(--loop-white-bg) !important;
  background: var(--loop-white-bg) !important;
  color: var(--loop-black-text) !important;
  border-color: var(--loop-light-border) !important;
}

/* 第九层：循环卡片内的开关和单选框 */
.step-card .ant-switch,
.step-card .ant-radio,
.step-card .ant-checkbox,
.loop-card .ant-switch,
.loop-card .ant-radio,
.loop-card .ant-checkbox {
  background-color: var(--loop-white-bg) !important;
  border-color: var(--loop-light-border) !important;
}

/* =============================================================================
   特殊情况处理
   ============================================================================= */

/* 处理内联样式强制覆盖 */
.step-card[style*="background"],
.step-card [style*="background"],
.loop-card[style*="background"],
.loop-card [style*="background"] {
  background-color: var(--loop-white-bg) !important;
  background: var(--loop-white-bg) !important;
}

.step-card[style*="color"],
.step-card [style*="color"],
.loop-card[style*="color"],
.loop-card [style*="color"] {
  color: var(--loop-black-text) !important;
}

/* 处理CSS类强制覆盖 */
.step-card[class*="dark"],
.step-card [class*="dark"],
.loop-card[class*="dark"],
.loop-card [class*="dark"] {
  background-color: var(--loop-white-bg) !important;
  color: var(--loop-black-text) !important;
}

/* 处理主题类覆盖 */
.step-card.dark,
.step-card .dark,
.loop-card.dark,
.loop-card .dark,
.step-card.theme-dark,
.step-card .theme-dark,
.loop-card.theme-dark,
.loop-card .theme-dark {
  background-color: var(--loop-white-bg) !important;
  color: var(--loop-black-text) !important;
}

/* =============================================================================
   文本可读性增强
   ============================================================================= */

/* 确保所有文本元素的对比度 */
.step-card,
.step-card *,
.loop-card,
.loop-card * {
  /* 强制文本颜色，确保可读性 */
  color: var(--loop-black-text) !important;
  
  /* 文本阴影增强可读性 */
  text-shadow: none !important;
  
  /* 确保不透明 */
  opacity: 1 !important;
  
  /* 字体权重适中 */
  font-weight: 400 !important;
  
  /* 行高适中 */
  line-height: 1.5 !important;
}

/* 标题文本增强 */
.step-card h1,
.step-card h2,
.step-card h3,
.step-card h4,
.step-card h5,
.step-card h6,
.step-card .ant-typography-title,
.loop-card h1,
.loop-card h2,
.loop-card h3,
.loop-card h4,
.loop-card h5,
.loop-card h6,
.loop-card .ant-typography-title {
  color: var(--loop-black-text) !important;
  font-weight: 600 !important;
}

/* =============================================================================
   调试辅助
   ============================================================================= */

/* 调试模式边框标识 */
html[data-debug="true"] .step-card,
html[data-debug="true"] .loop-card {
  outline: 2px solid #00ff00 !important;
  outline-offset: 2px !important;
}

html[data-debug="true"] .step-card::after,
html[data-debug="true"] .loop-card::after {
  content: "WHITE THEME APPLIED";
  position: absolute;
  top: -25px;
  right: 0;
  background: #00ff00;
  color: #000000;
  padding: 2px 8px;
  font-size: 10px;
  font-weight: bold;
  z-index: 999999;
  border-radius: 3px;
  letter-spacing: 0.5px;
}