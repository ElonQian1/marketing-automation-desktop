# 通用社交按钮预设测试指南

## 概述

通用社交按钮预设(`universal_social_button`)是一个跨APP的智能预设，能够自动适配不同应用的社交功能按钮。

## 设计特性

### 🎯 智能文本识别
预设支持以下社交操作文本：

**中文操作**：
- 关注类：关注、加关注、取消关注
- 好友类：添加好友、删除好友、移除好友
- 互动类：私聊、发消息、聊天、邀请、分享
- 内容类：收藏、点赞、评论、转发、投票、订阅
- 管理类：拉黑、举报、删除、移除

**英文操作**：
- Follow, Unfollow, Add Friend, Remove Friend, Delete Friend
- Message, Chat, Share, Like, Comment, Subscribe

### 🚫 智能状态排除
自动排除已完成操作的状态：
- 已关注、已添加、已删除、已移除、已拉黑
- Following, Added, Sent, Done, Completed

### 🔧 灵活字段组合
支持多种属性组合匹配：
- `package`: 应用包名识别
- `text`: 按钮直接文本
- `first_child_text`: 子节点文本（如小红书关注按钮）
- `content-desc`: 无障碍描述
- `resource-id`: 资源ID（如果可用）

## 测试场景

### 场景 1：小红书关注按钮
- **包名**：`com.xingin.xhs`
- **结构**：FrameLayout > TextView("关注")
- **预期**：应该能正确识别并点击关注按钮

### 场景 2：抖音删除好友按钮
- **包名**：`com.ss.android.ugc.aweme`
- **可能文本**：删除好友、移除好友
- **预期**：应该能识别并匹配删除操作

### 场景 3：微信添加好友按钮
- **包名**：`com.tencent.mm`
- **可能文本**：添加到通讯录、加为好友
- **预期**：应该能识别添加操作

## 使用步骤

1. **连接设备并打开目标APP**
   ```bash
   adb devices
   # 确保设备连接正常
   ```

2. **抓取当前页面UI结构**
   ```bash
   adb shell uiautomator dump
   adb pull /sdcard/window_dump.xml ./debug_xml/
   ```

3. **在页面分析器中加载XML**
   - 打开http://localhost:5321/
   - 导航到页面分析器
   - 加载抓取的XML文件

4. **选择目标按钮节点**
   - 在UI树中找到社交按钮节点
   - 点击节点查看属性

5. **应用通用社交按钮预设**
   - 在右侧面板点击"通用社交按钮"按钮
   - 查看生成的匹配条件
   - 根据需要调整includes/excludes

6. **创建步骤卡片并测试**
   - 使用生成的匹配条件创建步骤
   - 使用"单步测试"功能验证
   - 观察是否能正确识别和点击目标按钮

## 预期测试结果

### ✅ 成功指标
- 能够正确识别目标APP的社交按钮
- 匹配条件准确，无误报/漏报
- 在不同用户条目上能重复匹配相同类型按钮
- 自动排除已操作状态的按钮

### ❌ 问题排查
如果预设不生效，检查：
1. 按钮文本是否在支持列表中
2. 是否被excludes条件误排除
3. 包名匹配是否正确
4. 按钮是否为可点击状态(clickable="true")

## 调试技巧

1. **查看实际节点属性**：先手动选择节点，查看所有属性
2. **逐步细化条件**：从宽松条件开始，逐步添加限制
3. **对比不同APP**：在多个APP上测试，调整通用性
4. **测试边界情况**：测试已操作状态的按钮是否被正确排除

## 扩展建议

如果需要支持新的APP或新的操作类型：
1. 添加新的文本到`socialButtonTexts`数组
2. 更新`excludes`条件以排除新的已操作状态
3. 根据需要添加特定的字段组合逻辑