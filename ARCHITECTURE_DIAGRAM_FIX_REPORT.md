# æ¶æ„å›¾ä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜åˆ†æ

### å‘ç°çš„ä¸»è¦é—®é¢˜

1. **XMLç»“æ„è§£æä¸å®Œæ•´**
   - `xmlStructureParser.ts` ä¸­çš„ `findButtonChildren` æ–¹æ³•ä½¿ç”¨ç®€å•çš„ç´¢å¼•åˆ†é…è€Œä¸æ˜¯çœŸæ­£çš„è¾¹ç•ŒåŒ…å«å…³ç³»
   - å¯¼è‡´çˆ¶å­å…³ç³»å»ºç«‹ä¸æ­£ç¡®ï¼Œæ¶æ„å›¾åªæ˜¾ç¤ºä¸€ä¸ªæ ¹èŠ‚ç‚¹

2. **é€šç”¨çˆ¶å­å…³ç³»ç¼ºå¤±**
   - `buildXmlBasedHierarchy` åªå¤„ç†ç‰¹æ®Šçš„åº•éƒ¨å¯¼èˆªå®¹å™¨ï¼Œå¿½ç•¥äº†å…¶ä»–å…ƒç´ çš„çˆ¶å­å…³ç³»
   - ç¼ºå°‘é€šç”¨çš„çˆ¶å­å…³ç³»å»ºç«‹é€»è¾‘

3. **è¿‡æ»¤é€»è¾‘æ··ç”¨**
   - é¡¹ç›®ä¸­å­˜åœ¨å¤šç§ä¸åŒç”¨é€”çš„è¿‡æ»¤é€»è¾‘ï¼Œå®¹æ˜“æ··æ·†
   - éœ€è¦æ˜ç¡®åŒºåˆ†"å‘ç°å…ƒç´ "ï¼ˆä¸è¿‡æ»¤ï¼‰å’Œ"å¯è§†åŒ–è§†å›¾"ï¼ˆéœ€è¦è¿‡æ»¤ï¼‰çš„ä½¿ç”¨åœºæ™¯

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ `findButtonChildren` æ–¹æ³•

**åŸæ¥çš„é—®é¢˜**ï¼š
```typescript
// âŒ é”™è¯¯ï¼šæŒ‰ç´¢å¼•åˆ†é…ï¼Œä¸è€ƒè™‘çœŸå®çš„è¾¹ç•Œå…³ç³»
const buttonIndex = allBottomButtons.findIndex(b => b.id === button.id);
if (buttonIndex >= 0 && buttonIndex < containers.length) {
  const targetContainer = containers[buttonIndex]; // ç®€å•çš„ç´¢å¼•åˆ†é…
}
```

**ä¿®å¤å**ï¼š
```typescript
// âœ… æ­£ç¡®ï¼šåŸºäºè¾¹ç•ŒåŒ…å«å…³ç³»
const potentialChildren = allElements.filter((element) => {
  const elementBounds = this.normalizeBounds(element.bounds);
  // æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨æŒ‰é’®è¾¹ç•Œå†…
  return (
    elementBounds.left >= buttonBounds.left &&
    elementBounds.right <= buttonBounds.right &&
    elementBounds.top >= buttonBounds.top &&
    elementBounds.bottom <= buttonBounds.bottom
  );
});
```

### 2. æ–°å¢é€šç”¨çˆ¶å­å…³ç³»å»ºç«‹é€»è¾‘

**æ–°å¢æ–¹æ³•**ï¼š
- `buildGeneralParentChildRelations()` - å»ºç«‹æ‰€æœ‰å…ƒç´ çš„é€šç”¨çˆ¶å­å…³ç³»
- `isDirectParentChild()` - æ£€æŸ¥æ˜¯å¦æ˜¯ç›´æ¥çˆ¶å­å…³ç³»ï¼Œé¿å…è·¨å±‚çº§å…³ç³»
- `findTextChildrenForContainer()` - ä¸“é—¨å¤„ç†æ–‡æœ¬å®¹å™¨çš„å­å…ƒç´ 

**æ ¸å¿ƒé€»è¾‘**ï¼š
```typescript
// æŒ‰é¢ç§¯æ’åºï¼Œå¤§å®¹å™¨åœ¨å‰
const sortedElements = [...elements].sort((a, b) => {
  const aArea = (a.bounds.right - a.bounds.left) * (a.bounds.bottom - a.bounds.top);
  const bArea = (b.bounds.right - b.bounds.left) * (b.bounds.bottom - b.bounds.top);
  return bArea - aArea; // å¤§çš„åœ¨å‰
});

// ä¸ºæ¯ä¸ªæ½œåœ¨çˆ¶å®¹å™¨æŸ¥æ‰¾å­å…ƒç´ 
for (let i = 0; i < sortedElements.length; i++) {
  const potentialParent = sortedElements[i];
  // æ£€æŸ¥åŒ…å«å…³ç³»å’Œç›´æ¥çˆ¶å­å…³ç³»
  const isDirectParent = this.isDirectParentChild(potentialParent, potentialChild, elements);
}
```

### 3. ç¡®ä¿æ¶æ„å±‚çº§å®Œæ•´æ˜¾ç¤º

**ä¿®å¤æµç¨‹**ï¼š
1. **ç¬¬ä¸€æ­¥**ï¼šå¤„ç†ç‰¹æ®Šçš„åº•éƒ¨å¯¼èˆªå®¹å™¨ï¼ˆä¿æŒä¸ºæ ¹èŠ‚ç‚¹ï¼‰
2. **ç¬¬äºŒæ­¥**ï¼šå»ºç«‹æ‰€æœ‰å…¶ä»–å…ƒç´ çš„é€šç”¨çˆ¶å­å…³ç³»
3. **è°ƒè¯•è¾“å‡º**ï¼šå®Œæ•´è®°å½•å±‚çº§ç»“æ„ï¼Œä¾¿äºéªŒè¯

**é¢„æœŸç»“æœ**ï¼š
```
ğŸ  æ ¹èŠ‚ç‚¹: element_32(android.widget.LinearLayout) - åº•éƒ¨å¯¼èˆªå®¹å™¨
  â”œâ”€ element_34(android.widget.LinearLayout) - ç”µè¯æŒ‰é’®
    â”œâ”€ element_35(android.widget.ImageView) - ç”µè¯å›¾æ ‡
    â””â”€ element_36(android.widget.LinearLayout) - æ–‡æœ¬å®¹å™¨
      â””â”€ element_37(android.widget.TextView) - "ç”µè¯"æ–‡æœ¬
  â”œâ”€ element_38(android.widget.LinearLayout) - è”ç³»äººæŒ‰é’® â­ ç›®æ ‡
    â”œâ”€ element_39(android.widget.ImageView) - è”ç³»äººå›¾æ ‡
    â””â”€ element_40(android.widget.LinearLayout) - æ–‡æœ¬å®¹å™¨
      â””â”€ element_41(android.widget.TextView) - "è”ç³»äºº"æ–‡æœ¬
  â””â”€ element_42(android.widget.LinearLayout) - æ”¶è—æŒ‰é’®
    â”œâ”€ element_43(android.widget.ImageView) - æ”¶è—å›¾æ ‡
    â””â”€ element_44(android.widget.LinearLayout) - æ–‡æœ¬å®¹å™¨
      â””â”€ element_45(android.widget.TextView) - "æ”¶è—"æ–‡æœ¬
```

## ğŸ¯ è¿‡æ»¤é€»è¾‘åˆ†ç¦»è¯´æ˜

### é¡¹ç›®ä¸­çš„ä¸åŒè¿‡æ»¤ç”¨é€”

1. **å‘ç°å…ƒç´ æ¶æ„å›¾** - `ArchitectureDiagram.tsx`
   - âœ… **æ— è¿‡æ»¤**ï¼šæ˜¾ç¤ºå®Œæ•´XMLå±‚çº§ç»“æ„
   - ç”¨é€”ï¼šå¸®åŠ©ç”¨æˆ·ç†è§£å…ƒç´ çš„çœŸå®å±‚çº§å…³ç³»
   - åŸåˆ™ï¼šå±•ç¤ºçœŸå®çš„DOMç»“æ„ï¼Œä¸éšè—ä»»ä½•å…ƒç´ 

2. **å¯è§†åŒ–è§†å›¾** - `HierarchyTreeViewerFixed.tsx`
   - âœ… **æœ‰è¿‡æ»¤**ï¼šæä¾›å¤šç§è¿‡æ»¤é€‰é¡¹
   - ç”¨é€”ï¼šå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½æ„Ÿå…´è¶£çš„å…ƒç´ 
   - åŒ…å«ï¼šèŠ‚ç‚¹ç±»å‹è¿‡æ»¤ã€å±æ€§è¿‡æ»¤ã€æœç´¢è¿‡æ»¤ç­‰

3. **Grid View** - `grid-view/utils.ts`
   - âœ… **æœ‰è¿‡æ»¤**ï¼šæä¾›é«˜çº§è¿‡æ»¤åŠŸèƒ½
   - ç”¨é€”ï¼šåœ¨ç½‘æ ¼è§†å›¾ä¸­ç­›é€‰å’Œæœç´¢å…ƒç´ 

### ä½¿ç”¨åŸåˆ™

- **å‘ç°å…ƒç´ **ï¼šæ°¸è¿œæ˜¾ç¤ºå®Œæ•´ç»“æ„ï¼Œä¸åº”ç”¨ä»»ä½•è¿‡æ»¤
- **åˆ†æå·¥å…·**ï¼šå¯ä»¥æä¾›è¿‡æ»¤é€‰é¡¹å¸®åŠ©ç”¨æˆ·èšç„¦
- **å¼€å‘è°ƒè¯•**ï¼šå€¾å‘äºæ˜¾ç¤ºæ›´å¤šä¿¡æ¯è€Œééšè—

## âœ… ä¿®å¤éªŒè¯

### éªŒè¯æ­¥éª¤

1. **å¯åŠ¨åº”ç”¨**ï¼š`npm run tauri dev`
2. **å¯¼èˆªåˆ°å…ƒç´ å‘ç°**ï¼šé€‰æ‹©ä»»æ„UIå…ƒç´ 
3. **æ‰“å¼€å‘ç°å…ƒç´ æ¨¡æ€æ¡†**
4. **åˆ‡æ¢åˆ°"æ¶æ„å›¾"tab**
5. **éªŒè¯æ˜¾ç¤º**ï¼šåº”è¯¥çœ‹åˆ°å®Œæ•´çš„å±‚çº§ç»“æ„

### é¢„æœŸæ”¹è¿›

- âœ… æ¶æ„å›¾æ˜¾ç¤ºå®Œæ•´çš„å±‚çº§æ ‘è€Œä¸æ˜¯å•ä¸€èŠ‚ç‚¹
- âœ… æ­£ç¡®æ˜¾ç¤ºç¥–çˆ¶-çˆ¶-å­-å­™çš„å…³ç³»
- âœ… æ‰€æœ‰ç›¸å…³å…ƒç´ éƒ½æ­£ç¡®åœ°æ˜¾ç¤ºåœ¨å±‚çº§ä¸­
- âœ… ç›®æ ‡å…ƒç´ ï¼ˆå¦‚element_38ï¼‰è¢«æ­£ç¡®æ ‡è®°å’Œé«˜äº®

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ä¿®æ”¹çš„æ–‡ä»¶

1. **`xmlStructureParser.ts`**
   - é‡å†™äº† `findButtonChildren` æ–¹æ³•
   - æ–°å¢äº† `buildGeneralParentChildRelations` æ–¹æ³•
   - æ–°å¢äº† `isDirectParentChild` å’Œ `findTextChildrenForContainer` æ–¹æ³•
   - æ”¹è¿›äº† `buildXmlBasedHierarchy` çš„æµç¨‹

### æ ¸å¿ƒæ”¹è¿›

1. **è¾¹ç•Œæ£€æµ‹ä¼˜å…ˆ**ï¼šåŸºäºçœŸå®çš„å…ƒç´ è¾¹ç•Œè€Œä¸æ˜¯ç´¢å¼•çŒœæµ‹
2. **ç›´æ¥å…³ç³»éªŒè¯**ï¼šé¿å…è·¨å±‚çº§çš„çˆ¶å­å…³ç³»
3. **é€šç”¨ç®—æ³•**ï¼šä¸ä»…é™äºç‰¹å®šçš„UIç»„ä»¶ï¼Œé€‚ç”¨äºæ‰€æœ‰å…ƒç´ 
4. **è¯¦ç»†æ—¥å¿—**ï¼šæä¾›å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯ä¾¿äºé—®é¢˜æ’æŸ¥

## ğŸ“‹ åç»­å»ºè®®

1. **æµ‹è¯•è¦†ç›–**ï¼šé’ˆå¯¹ä¸åŒçš„UIå¸ƒå±€éªŒè¯æ¶æ„å›¾æ˜¾ç¤º
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¦‚æœå…ƒç´ æ•°é‡å¾ˆå¤§ï¼Œè€ƒè™‘ä¼˜åŒ–æ’åºå’Œéå†ç®—æ³•
3. **é”™è¯¯å¤„ç†**ï¼šå¢å¼ºè¾¹ç•Œæ•°æ®å¼‚å¸¸çš„å¤„ç†é€»è¾‘
4. **ç”¨æˆ·ä½“éªŒ**ï¼šè€ƒè™‘æ·»åŠ å±‚çº§å±•å¼€/æ”¶ç¼©çš„å¿«æ·æ“ä½œ

---

**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ  
**å½±å“èŒƒå›´**: å‘ç°å…ƒç´ æ¨¡æ€æ¡†çš„æ¶æ„å›¾tab  
**å‘åå…¼å®¹**: æ˜¯  
**æµ‹è¯•çŠ¶æ€**: ç­‰å¾…ç”¨æˆ·éªŒè¯