# å…³ç³»é”šç‚¹æ•°æ®ä¼ é€’ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜è¯Šæ–­

### é—®é¢˜ç°è±¡
ä»æ—¥å¿—ä¸­å‘ç°ï¼š
```
âš ï¸ [Boundsè¿‡æ»¤] æœªæ‰¾åˆ°å®Œå…¨åŒ¹é…ç”¨æˆ·bounds='[45,1059][249,1263]' çš„å…ƒç´ ï¼Œä½¿ç”¨å…¨éƒ¨ 0 ä¸ªå€™é€‰
ğŸ¯ [å€™é€‰æ”¶é›†] æ‰¾åˆ° 0 ä¸ªåŒ¹é…çš„å€™é€‰å…ƒç´ 
```

### æ ¹æœ¬åŸå› 
å‰ç«¯æå–äº† `siblingTexts`ã€`parentElement`ã€`childrenTexts` ç­‰å…³ç³»é”šç‚¹æ•°æ®ï¼Œä½†è¿™äº›æ•°æ®è¢«å­˜å‚¨åœ¨ `_enrichment` å­—æ®µä¸­ï¼ˆå¸¦ä¸‹åˆ’çº¿è¡¨ç¤ºå†…éƒ¨ä½¿ç”¨ï¼‰ï¼Œ**æ²¡æœ‰æ­£ç¡®ä¼ é€’ç»™åç«¯**ã€‚

ä»æ—¥å¿—çœ‹åˆ°å‰ç«¯å‘é€çš„æ•°æ®ï¼š
```javascript
"original_data": {
  "children_texts": ["é€šè®¯å½•"],  // âœ… æœ‰å­å…ƒç´ æ–‡æœ¬
  "element_bounds": "[45,1059][249,1263]",
  "element_text": "é€šè®¯å½•",
  // âŒ ç¼ºå°‘ siblingTexts å­—æ®µï¼
  // âŒ ç¼ºå°‘ parentElement å­—æ®µï¼
}
```

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. å‰ç«¯ç±»å‹å®šä¹‰ä¿®å¤

#### ä¿®æ”¹æ–‡ä»¶ï¼š`src/modules/universal-ui/types/intelligent-analysis-types.ts`

**ä¿®æ”¹å‰**ï¼š
```typescript
export interface IntelligentElementSelectionContext {
  snapshotId: string;
  elementPath: string;
  // ... å…¶ä»–å­—æ®µ
  // âŒ ç¼ºå°‘å…³ç³»é”šç‚¹å­—æ®µ
}
```

**ä¿®æ”¹å**ï¼š
```typescript
export interface IntelligentElementSelectionContext {
  snapshotId: string;
  elementPath: string;
  // ... å…¶ä»–å­—æ®µ
  // ğŸ”¥ XPathå®‰å…¨æ¨¡å¼å¢å¼ºå­—æ®µ - ç”¨äº"å…³ç³»é”šç‚¹ç­–ç•¥"
  siblingTexts?: string[];
  parentElement?: {
    content_desc: string;
    text: string;
    resource_id: string;
  };
  childrenTexts?: string[];
}
```

### 2. å‰ç«¯æ•°æ®ç»„è£…ä¿®å¤

#### ä¿®æ”¹æ–‡ä»¶ï¼š`src/pages/SmartScriptBuilderPage/hooks/useIntelligentStepCardIntegration.ts`

**ä¿®æ”¹å‰**ï¼š
```typescript
const context: ElementSelectionContext = {
  // ... å…¶ä»–å­—æ®µ
  // âŒ å…³ç³»é”šç‚¹æ•°æ®åœ¨ _enrichment ä¸­ï¼Œåç«¯æ— æ³•æ¥æ”¶
  _enrichment: {
    siblingTexts: siblingTexts,
    parentElement: { ... }
  }
};
```

**ä¿®æ”¹å**ï¼š
```typescript
const context: ElementSelectionContext = {
  // ... å…¶ä»–å­—æ®µ
  // ğŸ”¥ğŸ”¥ğŸ”¥ å…³é”®ä¿®å¤ï¼šå°†å…³ç³»é”šç‚¹æ•°æ®æå‡åˆ°é¡¶å±‚ï¼Œç¡®ä¿ä¼ é€’ç»™åç«¯
  siblingTexts: siblingTexts,
  parentElement: (parentContentDesc || parentText || parentResourceId) ? {
    content_desc: parentContentDesc,
    text: parentText,
    resource_id: parentResourceId
  } : undefined,
  childrenTexts: childTexts,
  // ä¿ç•™ _enrichment ç”¨äºå‰ç«¯å†…éƒ¨ä½¿ç”¨
  _enrichment: { ... }
};
```

åŒæ—¶æ›´æ–°æœ¬åœ°æ¥å£å®šä¹‰ï¼Œæ·»åŠ é¡¶å±‚å­—æ®µï¼š
```typescript
interface ElementSelectionContext {
  // ... å…¶ä»–å­—æ®µ
  // ğŸ”¥ğŸ”¥ğŸ”¥ å…³é”®ä¿®å¤ï¼šå…³ç³»é”šç‚¹æ•°æ®æå‡åˆ°é¡¶å±‚ï¼Œä¼ é€’ç»™åç«¯
  siblingTexts?: string[];
  parentElement?: {
    content_desc: string;
    text: string;
    resource_id: string;
  };
  childrenTexts?: string[];
  _enrichment?: { ... }; // ä¿ç•™ç”¨äºå†…éƒ¨ä½¿ç”¨
}
```

### 3. åç«¯æ•°æ®æ¥æ”¶ä¿®å¤

#### ä¿®æ”¹æ–‡ä»¶ï¼š`src-tauri/src/commands/intelligent_analysis.rs`

**ä¿®æ”¹å‰**ï¼š
```rust
pub struct ElementSelectionContext {
    pub snapshot_id: String,
    pub element_path: String,
    // ... å…¶ä»–å­—æ®µ
    // âŒ ç¼ºå°‘å…³ç³»é”šç‚¹å­—æ®µ
}
```

**ä¿®æ”¹å**ï¼š
```rust
pub struct ElementSelectionContext {
    pub snapshot_id: String,
    pub element_path: String,
    // ... å…¶ä»–å­—æ®µ
    // ğŸ”¥ å…³ç³»é”šç‚¹ç­–ç•¥å¢å¼ºå­—æ®µ
    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "siblingTexts")]
    pub sibling_texts: Option<Vec<String>>,
    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "parentElement")]
    pub parent_element: Option<ParentElementInfo>,
    #[serde(skip_serializing_if = "Option::is_none")]
    #[serde(rename = "childrenTexts")]
    pub children_texts: Option<Vec<String>>,
}

/// çˆ¶å…ƒç´ ä¿¡æ¯ï¼ˆç”¨äºå…³ç³»é”šç‚¹ç­–ç•¥ï¼‰
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ParentElementInfo {
    pub content_desc: String,
    pub text: String,
    pub resource_id: String,
}
```

## âœ… ä¿®å¤éªŒè¯

### ç¼–è¯‘çŠ¶æ€
- âœ… TypeScript ç¼–è¯‘ï¼šæ— é”™è¯¯
- âœ… Rust ç¼–è¯‘ï¼šæˆåŠŸï¼ˆ49.34ç§’ï¼‰

### é¢„æœŸæ•ˆæœ
ä¿®å¤åï¼Œåç«¯å°†èƒ½å¤Ÿæ¥æ”¶åˆ°ï¼š
```json
{
  "element_path": "//element_41",
  "element_text": "é€šè®¯å½•",
  "element_bounds": "[45,1059][249,1263]",
  "siblingTexts": ["é€šè®¯å½•"],  // âœ… ç°åœ¨èƒ½æ¥æ”¶
  "parentElement": {            // âœ… ç°åœ¨èƒ½æ¥æ”¶
    "content_desc": "...",
    "text": "...",
    "resource_id": "..."
  },
  "childrenTexts": ["é€šè®¯å½•"]  // âœ… ç°åœ¨èƒ½æ¥æ”¶
}
```

## ğŸ¯ ä¸‹ä¸€æ­¥éªŒè¯

1. **é‡æ–°è¿è¡Œæµ‹è¯•**ï¼šç‚¹å‡»"é€šè®¯å½•"æŒ‰é’®ï¼Œè§‚å¯Ÿåç«¯æ—¥å¿—
2. **æ£€æŸ¥æ—¥å¿—**ï¼šç¡®è®¤ `siblingTexts` å’Œ `parentElement` æ•°æ®å·²ä¼ é€’
3. **éªŒè¯åŒ¹é…**ï¼šåç«¯åº”ä½¿ç”¨"å…³ç³»é”šç‚¹ç­–ç•¥"è¿›è¡Œç²¾ç¡®åŒ¹é…

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### ä¸ºä»€ä¹ˆä¹‹å‰å¤±è´¥ï¼Ÿ
1. **å‰ç«¯æ•°æ®éš”ç¦»**ï¼š`_enrichment` å­—æ®µå¸¦ä¸‹åˆ’çº¿ï¼Œè¡¨ç¤º"å†…éƒ¨ä½¿ç”¨"ï¼ŒTypeScriptåºåˆ—åŒ–æ—¶å¯èƒ½è¢«å¿½ç•¥
2. **ç±»å‹ä¸åŒ¹é…**ï¼šå‰ç«¯æ¥å£ç¼ºå°‘é¡¶å±‚å­—æ®µï¼Œæ•°æ®æ— æ³•æ­£ç¡®ç»„è£…
3. **åç«¯ç¼ºå°‘å­—æ®µ**ï¼šRustç»“æ„ä½“æ²¡æœ‰å¯¹åº”å­—æ®µï¼Œæ— æ³•ååºåˆ—åŒ–

### æ ¸å¿ƒä¿®å¤æ€è·¯
å°†å…³ç³»é”šç‚¹æ•°æ®ä»"å†…éƒ¨å­—æ®µ"æå‡åˆ°"å…¬å¼€å­—æ®µ"ï¼š
- `_enrichment.siblingTexts` â†’ `siblingTexts`
- `_enrichment.parentElement` â†’ `parentElement`
- `_enrichment.allChildTexts` â†’ `childrenTexts`

## ğŸ” ç›¸å…³æ–‡ä»¶æ¸…å•

### å‰ç«¯ä¿®æ”¹
- âœ… `src/modules/universal-ui/types/intelligent-analysis-types.ts`
- âœ… `src/pages/SmartScriptBuilderPage/hooks/useIntelligentStepCardIntegration.ts`

### åç«¯ä¿®æ”¹
- âœ… `src-tauri/src/commands/intelligent_analysis.rs`

## ğŸ“š å‚è€ƒæ–‡æ¡£
- **é¡¹ç›®è§„èŒƒ**ï¼š`.github/copilot-instructions.md` - æ¨¡å—å†…åˆ†å±‚ + å‘½åå‰ç¼€
- **åŸå§‹éœ€æ±‚**ï¼šç”¨æˆ·è¦æ±‚å®ç°"å…³ç³»é”šç‚¹ç­–ç•¥"ï¼Œæ”¯æŒé€šè¿‡å…„å¼Ÿ/çˆ¶å…ƒç´ æ–‡æœ¬å®šä½æŒ‰é’®
- **XPathç²¾ç¡®åŒ¹é…æŠ¥å‘Š**ï¼š`å…³ç³»é”šç‚¹ç­–ç•¥XPathç²¾ç¡®åŒ¹é…å¢å¼ºæŠ¥å‘Š.md`

---

**ä¿®å¤æ—¶é—´**ï¼š2025-10-28
**ä¿®å¤äººå‘˜**ï¼šGitHub Copilot
**éªŒè¯çŠ¶æ€**ï¼šâœ… ç¼–è¯‘é€šè¿‡ï¼Œå¾…åŠŸèƒ½æµ‹è¯•
