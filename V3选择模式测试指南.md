# V3选择模式测试指南

## 🎯 问题现状
用户在ActionSelector UI中选择的模式（"第一个"、"精确匹配"、"批量全部"）没有传递到V3执行引擎，导致所有模式都执行批量操作。

## 🔧 临时测试方案

### 步骤1：加载测试工具
1. 打开浏览器开发者工具（F12）
2. 复制并粘贴整个 `v3-selection-mode-test-tool.js` 文件内容到控制台
3. 按回车执行，看到"V3选择模式测试工具加载完成"消息

### 步骤2：设置测试模式
```javascript
// 测试"第一个"模式 - 应该只点击第一个关注按钮
setSelectionMode("first")

// 测试"精确匹配"模式 - 应该高置信度匹配特定按钮  
setSelectionMode("match-original")

// 测试"批量全部"模式 - 应该点击所有关注按钮
setSelectionMode("all")

// 恢复默认自动模式
setSelectionMode("auto")
```

### 步骤3：执行测试
1. 设置模式后，点击任意"关注"按钮
2. 选择"智能自动链"执行
3. 观察控制台输出和实际执行行为

### 步骤4：验证结果
观察控制台输出中的关键信息：
- `🎯 [Selection Mode] 当前用户选择模式: first` (确认模式设置成功)
- `🎯 [选择模式] 用户选择: 第一个` (确认后端接收到模式)
- 实际点击行为是否符合设置的模式

## 📊 预期行为对比

| 模式 | 设置命令 | 预期行为 | 验证点 |
|------|----------|----------|--------|
| 第一个 | `setSelectionMode("first")` | 只点击第一个"关注"按钮 | 只看到1次点击操作 |
| 精确匹配 | `setSelectionMode("match-original")` | 点击最相似的特定按钮 | 高置信度匹配，1次精准点击 |
| 批量全部 | `setSelectionMode("all")` | 点击所有"关注"按钮 | 看到多次连续点击 |

## 🚨 故障排除

### 如果模式没生效：
1. 确认控制台显示"选择模式已设置为: xxx"
2. 检查是否有权限设置localStorage
3. 尝试刷新页面后重新设置

### 如果仍然执行批量操作：
1. 检查控制台是否有错误信息
2. 确认使用的是V3系统（不是V2回退）
3. 查看后端日志确认选择模式参数传递

## 🔄 完整修复方案（待实施）

临时测试验证后，需要修复前端参数传递链：
1. ActionSelector组件状态 → ElementSelectionPopover → startAnalysis函数
2. 建立全局状态管理或Context传递用户选择模式
3. 移除localStorage临时方案，使用正式的参数传递

---

**立即行动**：现在就可以使用测试工具验证V3选择模式功能是否正常工作！