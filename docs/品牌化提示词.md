# Tauri 桌面应用前端「品牌化重构」——完整提示词（Chinese）

> 角色：前端品牌化重构工程师（Brand-first Front-end Refactor Engineer）
> 技术栈：**Tauri + React 18 + TypeScript + Tailwind CSS + Ant Design v5 + Radix UI + shadcn/ui + Motion**
> 目标：把当前 **AntD 原生外观** 的项目，升级为 **时尚、现代、面向消费者** 的商业化 UI；在不牺牲复杂交互效率的前提下，建立 **品牌化轻组件体系** 与 **统一动效/令牌**，并保持 **模块化**（单文件 ≤500 行）。

---

## 0) 成功标准（一眼看懂）

- **品牌一致**：颜色/圆角/阴影/密度/字号由 **Design Tokens（CSS 变量）** 驱动，所有页面观感一致。
- **轻组件更好看**：按钮/卡片/标签/弹层等**高曝光轻组件**由 **Radix+shadcn（源码入库）+Tailwind 皮肤** 实现，质感现代。
- **重组件省心**：表单/表格/上传/树/日期/抽屉/步骤 等**重组件**继续用 **AntD v5**，**不覆写 `.ant-*`**，仅通过 tokens 与外层容器皮肤对齐。
- **统一动效**：使用 **Motion** 统一悬停/入场/转场（入场 180–220ms、离场 120–160ms、悬停 80–120ms、ease-out）。
- **A11y 与桌面**：键盘可达、可见焦点环、暗黑对比达标；Tauri 标题栏拖拽/托盘/快捷键不受影响。
- **模块化可维护**：目录分层清晰；单文件 ≤500 行；升级 AntD 或替换轻组件无痛。

---

## 1) 地位重调（谁负责外观，谁负责复杂度）

- **Tailwind（+Design Tokens）= 视觉所有者**：品牌色板、圆角、阴影、密度、排版、布局与响应式；仅在**容器与自有组件**上使用，不进入 AntD 内部改妆。
- **Radix + shadcn/ui = 轻组件源码**：Button / Card / Tag / Tooltip / Dialog / Dropdown 等放入 `components/ui`，作为“外观担当”。
- **Ant Design v5 = 重组件与生产力**：Form / Table / Upload / Tree / DatePicker / Drawer / Steps……通过 **`ConfigProvider` tokens** 与**适配层**统一，不覆写内部样式。
- **Motion = 动效统一**：统一节奏、统一曲线、统一进入/离开/悬停方案。

**坚决不要**：

- 不要用 Tailwind/CSS 去覆盖 `.ant-*` 或 `!important`；
- 不要在 AntD 子元素上加自定义渐变/阴影/圆角；
- 不要让多个页面各自“创新”渐变/阴影，必须走 tokens 与轻组件皮肤。

---

## 2) 设计令牌（Single Source of Truth）

在 `styles/tokens.css` 定义：

```css
/* 基础品牌色 */
--brand            # 主品牌色（例如 #6E8BFF）

/* 背景层级 */
--bg-base          # 页面深色底
--bg-elevated      # 浮层/面板底
--bg-secondary     # 次级背景

/* 局部浅色组件专用（关键！） */
--bg-light-base    # 浅色组件白底 (#FFFFFF)
--bg-light-elevated # 浅色组件提升背景 (#F8FAFC)
--bg-light-secondary # 浅色组件次级背景 (#F1F5F9)
--text-inverse     # 浅色背景下的深色文字 (#1E293B)
--text-muted       # 次要文字颜色 (#94A3B8)

/* 信息色彩 */
--info             # 信息色 (#3B82F6)
--info-bg          # 信息背景 (#DBEAFE)
--success          # 成功色 (#10B981)  
--success-bg       # 成功背景 (#D1FAE5)
--warning          # 警告色 (#F59E0B)
--warning-bg       # 警告背景 (#FEF3C7)
--error            # 错误色 (#EF4444)
--error-bg         # 错误背景 (#FEE2E2)

/* 布局与控件 */
--text-1 / --text-2  # 主/次文本
--radius           # 统一圆角（建议 10–14px）
--shadow           # 统一阴影（软阴影，商业化）
--font             # 基础字号
--control-h        # 控件高度（40/36 两档）
--border-muted     # 边框颜色 (#D1D5DB)

/* 浅色主题强制覆盖类（解决 Ant Design 继承问题） */
.light-theme-force {
  color: var(--text-inverse, #1e293b) !important;
}
.light-theme-force span,
.light-theme-force p,
.light-theme-force strong,
.light-theme-force b,
.light-theme-force em,
.light-theme-force i,
.light-theme-force div {
  color: var(--text-inverse, #1e293b) !important;
}
.light-theme-force .ant-typography,
.light-theme-force .ant-typography-title,
.light-theme-force .ant-typography-paragraph,
.light-theme-force .ant-typography-text {
  color: var(--text-inverse, #1e293b) !important;
}
.light-theme-force .ant-typography-secondary {
  color: var(--text-muted, #94a3b8) !important;
}
.light-theme-force .ant-tag {
  color: var(--text-inverse, #1e293b) !important;
  background: var(--bg-light-secondary, #f1f5f9) !important;
  border-color: var(--border-muted, #d1d5db) !important;
}
.light-theme-force .ant-btn {
  color: var(--text-inverse, #1e293b) !important;
}
.light-theme-force .ant-btn-default {
  background: var(--bg-light-elevated, #f8fafc) !important;
  border-color: var(--border-muted, #d1d5db) !important;
}
```

### 🚨 白底白字问题终极解决方案

**问题原因**：项目采用全局深色主题（`color: rgba(255,255,255,0.85)`），当某些组件使用浅色背景时，如果不显式设置文字颜色，就会继承全局的白色文字，造成白底白字不可读。

### ⚡ 快速检测与修复命令

**开发时立即运行的检测命令**：
```bash
# 搜索项目中所有可能的白底白字问题
grep -r "background.*white\|background.*#fff\|background.*#ffffff" src/ --include="*.tsx" --include="*.ts"

# 检查是否有硬编码白色背景
grep -r "background: 'white'\|background: '#fff'" src/ --include="*.tsx"

# 检查半透明白色背景（常见于浮动元素）
grep -r "background.*rgba(255.*255.*255" src/ --include="*.tsx"

# 检查 position: fixed 的浮动元素（容易忘记设置主题）
grep -r "position.*fixed" src/ --include="*.tsx" -A 5 -B 2
```

**批量修复脚本模板**：
```bash
# 将白色背景改为深色主题背景
sed -i "s/background: 'white'/background: 'var(--bg-elevated, #1e293b)', color: 'var(--text-1, #f8fafc)'/g" src/**/*.tsx
sed -i "s/background: '#fff'/background: 'var(--bg-elevated, #1e293b)', color: 'var(--text-1, #f8fafc)'/g" src/**/*.tsx
```

**AI 代理必须遵守的强制检查清单**：
```
⚡ 立即检测：看到任何包含以下模式的代码立即检查文字颜色
□ background: 'white' 
□ background: '#fff'
□ background: '#ffffff'
□ background: rgba(255, 255, 255, 0.95) （半透明白色）
□ background: var(--bg-light-*)
□ position: 'fixed' + 浅色背景组合

⚡ 强制修复：根据组件用途选择合适的背景色
□ 浮动工具栏/提示框 → 使用深色主题：var(--bg-elevated) + var(--text-1)
□ 内容面板/卡片 → 使用浅色主题：var(--bg-light-base) + var(--text-inverse) + light-theme-force类
□ 半透明浮层 → 使用深色半透明：rgba(30, 41, 59, 0.9)

⚡ 验证检查：确保以下组件类型都已正确处理
□ 浮动工具栏 (FloatingLayoutToolbar, LayoutControlToolbar)
□ 弹出气泡 (ElementSelectionConfirm)
□ 提示面板 (各种 Card, Panel)
□ 侧边栏 (Sider)
□ 页面容器 (Layout)
□ 布局切换器 (ContactImportWorkbench 中的固定位置切换器)
```

**强制检查规则**：

1. **任何使用浅色背景的组件都必须同时设置**：
   ```tsx
   // ✅ 正确模式
   <div 
     style={{ 
       background: 'var(--bg-light-base, #ffffff)',
       color: 'var(--text-inverse, #1e293b)'  // 必须！
     }}
     className="light-theme-force"  // 额外保险
   >
     浮动工具栏内容
   </div>
   ```

2. **对于包含 Ant Design 组件的浅色容器，必须使用 `.light-theme-force` 类**：
   ```tsx
   // ✅ 解决 Ant Design 组件文字颜色继承问题
   <Card 
     style={{ background: 'var(--bg-light-base)' }}
     className="light-theme-force"
   >
     <Title>自动变为深色文字</Title>
     <Text>自动变为深色文字</Text>
     <Tag>自动变为深色文字</Tag>
   </Card>
   ```

3. **AI 代理必须遵守的强制检查清单**：
   ```
   □ 看到 background: 'white' 或 background: '#ffffff' 立即检查是否设置了文字颜色
   □ 看到 background: var(--bg-light-*) 立即检查是否添加了 className="light-theme-force"
   □ 任何浮动组件、弹窗、提示框、卡片使用浅色背景时必须处理文字颜色
   □ 检查是否使用了 CSS 变量而非硬编码颜色值
   □ 验证最终对比度是否满足 WCAG AA 标准（4.5:1）
   ```

**关键原则**：

- **全局暗色 + 局部浅色组件**：整体 UI 保持暗色主题，但特定组件（如弹窗内容、提示卡片、信息面板）可以使用浅色背景以突出内容，**必须配套使用 `--text-inverse` 确保文字可读性**
- **禁止硬编码颜色**：所有颜色值必须通过 CSS 变量定义，便于主题切换和品牌定制
- **浅色组件最佳实践**：
  ```tsx
  // ✅ 正确：浅色背景 + 深色文字 + 强制类
  <div 
    style={{ 
      background: 'var(--bg-light-elevated)', 
      color: 'var(--text-inverse)' 
    }}
    className="light-theme-force"
  >
    内容会自动使用正确的深色文字
  </div>
  
  // ❌ 错误：浅色背景但继承了全局白色文字
  <div style={{ background: '#f8fafc' }}>
    看不见的白色文字！
  </div>
  ```

**典型修复示例**：

```tsx
// ❌ 问题代码1：浮动工具栏白底白字
<div style={{
  background: 'white',  // 硬编码 + 没有文字颜色
  padding: '8px 16px',
  borderRadius: '6px'
}}>
  <Text>布局模式:</Text>  {/* 继承全局白色文字 = 不可读 */}
</div>

// ✅ 修复代码1：使用变量 + 强制类
<div 
  style={{
    background: 'var(--bg-light-base, #ffffff)',
    color: 'var(--text-inverse, #1e293b)',
    padding: '8px 16px',
    borderRadius: '6px'
  }}
  className="light-theme-force"
>
  <Text>布局模式:</Text>  {/* 自动深色文字，清晰可读 */}
</div>

// ❌ 问题代码2：半透明白色浮动切换器（用户实际遇到的问题）
<div
  style={{
    position: 'fixed',
    top: 80,
    right: 16,
    zIndex: 1000,
    background: 'rgba(255, 255, 255, 0.95)', // 半透明白底
    padding: '8px 16px',
    borderRadius: 6,
    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
  }}
>
  <Text>布局模式:</Text>  {/* 白底白字，完全不可读！ */}
</div>

// ✅ 修复代码2：改为深色主题浮动元素
<div
  style={{
    position: 'fixed',
    top: 80,
    right: 16,
    zIndex: 1000,
    background: 'var(--bg-elevated, #1e293b)', // 深色背景
    color: 'var(--text-1, #f8fafc)', // 浅色文字
    padding: '8px 16px',
    borderRadius: 6,
    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.3)', // 增强阴影
    border: '1px solid var(--border-primary, #334155)', // 添加边框增强层次
  }}
>
  <Text>布局模式:</Text>  {/* 深底白字，清晰可读！ */}
</div>
```

### 🎨 主题选择指南

**浮动元素（工具栏、切换器、提示框）**：
- ✅ **推荐**：深色主题 `var(--bg-elevated)` + `var(--text-1)`
- 原因：浮动在任何背景上都清晰可见，符合操作系统原生风格
- 适用：position: fixed/absolute 的所有元素

**内容面板（卡片、表单、详情）**：
- ✅ **推荐**：浅色主题 `var(--bg-light-base)` + `var(--text-inverse)` + `light-theme-force`
- 原因：内容阅读体验更好，与深色背景形成对比
- 适用：主要内容区域、数据展示区域

**要求**：

- Tailwind 在 `tailwind.config.ts` 读取上述变量；
- AntD 在顶层 `ConfigProvider` 用 `algorithm:[theme.darkAlgorithm]` 并以 tokens 对齐（仅少量必要 token）；
- **强制要求**：任何使用浅色背景的组件都必须显式设置 `color: var(--text-inverse)` 或对应的文字颜色变量；
- 视觉变更只能改 tokens，不在页面/组件硬编码视觉值。

---

## 3) 目录与模块化约束

```
src/
  styles/          # tokens.css（令牌）、global.css（层级：antd reset→tailwind）
  theme/           # ThemeBridge.tsx（AntD 主题桥）
  components/
    ui/            # 轻组件（Button/CardShell/TagPill/Tooltip/SmartDialog/...）
    adapters/      # AntD 重组件适配层（AntTableAdapter/AntFormAdapter/...）
    patterns/      # 页面图元（FilterBar/MarketplaceCard/HeaderBar/...）
    layout/        # HeaderNav/PageShell/...（仅编排与栅格）
  pages/           # 按页面组合 patterns
```

- 单文件 ≤500 行；超过即拆分。
- `pages/` 只做编排；视觉在 `ui/` 与 `patterns/` 里；与 AntD 的耦合收敛在 `adapters/`。

---

## 4) 实施步骤（最快见效的迁移路线）

**Phase 0（当日）**

1. 建立 `styles/tokens.css`；在 `tailwind.config.ts` 读取变量；
2. `theme/ThemeBridge.tsx`：`algorithm:[theme.darkAlgorithm]` + 对齐 tokens；
3. 清理所有 `.ant-*` 覆盖/`!important`，保证 AntD 重组件回到“可被 tokens 驱动”的状态。

**Phase 1（1–2 天见效）** 4. 落地 `components/ui`：`Button / CardShell / TagPill / SmartDialog` 等**轻组件**； 5. 用 `patterns/*` 重写高曝光区域（页头/筛选/卡片），**改观立刻现代**； 6. 接入 **Motion**，统一悬停/入场节奏。

**Phase 2（并行）** 7. 为 AntD 重组件加 **适配层**（密度、粘头、滚动容器、分页位置），**不覆写**内部； 8. 完成常用 patterns（FilterBar, MarketplaceCard, EmptyState, Skeleton 等）；

**Phase 3（收尾）** 9. 逐页自检（A11y、暗黑/紧凑、动效一致、性能预算）； 10. 整理文档：tokens 表、动效规范、轻组件用法、AntD 适配约定。

---

## 5) Do / Don’t（落地守则）

**Do**

- 在容器与自有轻组件上使用 Tailwind；
- 通过 tokens 改外观；
- 重组件用 AntD，轻组件用自有源码（Radix/shadcn + Tailwind 皮肤）；
- 统一动效（Motion）。

**Don’t**

- 不覆写 `.ant-*` / 不使用 `!important`；
- 不在 AntD 子元素加渐变/阴影/圆角；
- 不分散定义颜色/阴影（统一走 tokens）。

---

## 6) 动效与可访问性

- 节奏：Enter 180–220ms / Exit 120–160ms / Hover 80–120ms；
- 曲线：ease-out（或 cubic-bezier(0.22, 1, 0.36, 1)）；
- 焦点：可见 `:focus-visible`（品牌色 2px, offset 2px）；
- 键盘可达/读屏语义遵循 Radix/AntD 默认实现。

---

## 7) Tauri 桌面特性

- 自绘标题栏：`.titlebar { -webkit-app-region: drag }`；交互区 `no-drag`；
- 三平台 DPI/字体回归；托盘/快捷键与自动更新保持不变；
- 安全：最小化 allowlist，CSP 限制资源来源。

---

## 8) 性能预算

- 首屏 CSS < 100KB（Tailwind 按需）；
- AntD 组件按需引入；大表虚拟化；路由分包；图片懒加载；
- 动效避免昂贵滤镜；尽量用 transform/opacity。

---

## 9) 交付物与验收

**交付**

- `tokens.css`、`tailwind.config.ts`、`ThemeBridge.tsx`；
- `components/ui/*`、`components/adapters/*`、`components/patterns/*`；
- 关键页面 PR（改造前/后截图、动效录屏、A11y 报告）。

**逐页自检清单**

- [ ] 是否存在 `.ant-*` 覆盖/`!important`（必须 0）。
- [ ] 高曝光轻组件是否已替为 `ui/*`（按钮/卡片/标签/弹层）。
- [ ] AntD 重组件是否通过 `adapters/*` 包装（无内部覆写）。
- [ ] 动效节奏是否统一、焦点环是否可见。
- [ ] 暗黑/紧凑模式无 UI 破坏，DPI/缩放无异常。
- [ ] 首屏 CSS/体积与交互性能符合预算。

---

## 10) 代码输出风格（给 AI/团队的硬性要求）

- **所有代码文件首行**写注释标明“文件路径”，且**中文注释**解释意图；
- 组件与样式分层：`ui`（轻组件）→`patterns`（图元）→`pages`（编排）；
- 不返回超 500 行的单文件；
- 若示例涉及 AntD，**禁止**写 `.ant-*` 覆盖；
- 若示例涉及 Radix/shadcn，需保留 A11y 属性与键盘交互。

---

# Complete Prompt (English)

> **Role**: Brand-first Front-end Refactor Engineer
> **Stack**: **Tauri + React 18 + TypeScript + Tailwind CSS + Ant Design v5 + Radix UI + shadcn/ui + Motion** > **Goal**: Turn an AntD-native-looking app into a **modern, consumer-grade, brand-first UI** without losing heavy-widget productivity. Keep **modularity** (≤500 lines per file).

## 0) Success Criteria

- **Brand consistency** via **CSS tokens**; unified colors/radius/shadows/density/typography.
- **Light components look premium**: implemented with **Radix + shadcn (source-in) + Tailwind skin**.
- **Heavy components stable**: AntD v5 for forms/tables/trees/date etc., **no `.ant-*` overrides**; align via tokens & container skin.
- **Unified motion** with **Motion** (enter 180–220ms, exit 120–160ms, hover 80–120ms, ease-out).
- **A11y & desktop** intact; Tauri-specific behaviors preserved.

## 1) Positioning

- **Tailwind (+ tokens) owns visuals** (brand system, layout, density). Use on containers & your own components.
- **Radix + shadcn** own **light components** (Button/Card/Tag/Tooltip/Dialog/Dropdown).
- **AntD v5** owns **heavy widgets** (Form/Table/Upload/Tree/DatePicker/Drawer/Steps). No internal overrides.
- **Motion** standardizes animation.

## 2) Tokens (SSOT)

Define in `styles/tokens.css`: `--brand, --bg-base, --bg-elevated, --text-1, --text-2, --radius, --shadow, --font, --control-h`. Tailwind reads them; AntD receives them via `ConfigProvider` with `darkAlgorithm`.

## 3) Structure & Modularity

Layered folders: `styles/`, `theme/`, `components/ui`, `components/adapters`, `components/patterns`, `components/layout`, `pages/`. Files ≤500 lines.

## 4) Rollout (fast track)

Phase 0: tokens + theme bridge, remove overrides.
Phase 1: ship light UI kit (Button/CardShell/TagPill/Dialog) + Motion; refactor high-exposure areas.
Phase 2: AntD adapters for heavy widgets; build patterns.
Phase 3: page audits (A11y, dark/compact, motion, perf); docs.

## 5) Do / Don’t

**Do**: tokens drive visuals; Tailwind on containers/own components; Radix/shadcn for light UI; AntD for heavy widgets; unified Motion.
**Don’t**: override `.ant-*` or use `!important`; add gradients/shadows/radius inside AntD internals; define ad-hoc colors.

## 6) Motion & A11y

Enter 180–220ms / Exit 120–160ms / Hover 80–120ms; ease-out. Focus ring visible; keyboard navigation preserved.

## 7) Tauri specifics

Custom titlebar drag region; DPI/typography checks; keep updater/tray/hotkeys; minimal allowlist & CSP.

## 8) Perf Budget

First-screen CSS <100KB; tree-shake AntD; virtualize large lists; route-split; lazy images; animation on transform/opacity only.

## 9) Deliverables & Page-by-Page Audit

Deliver tokens/config/bridge; light UI kit; AntD adapters; patterns; PRs with screenshots & motion clips.
Audit checklist: 0 overrides, light components in place, AntD via adapters, uniform motion, dark/compact OK, perf OK.

## 10) Code Output Policy

Every file starts with a file-path comment; Chinese comments welcomed for clarity; no single file >500 lines; no `.ant-*` overrides; keep A11y when using Radix/shadcn.
