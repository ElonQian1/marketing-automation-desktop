# Tauri 桌面应用前端「品牌化重构」——完整提示词（Chinese）

> 角色：前端品牌化重构工程师（Brand-first Front-end Refactor Engineer）
> 技术栈：**Tauri + React 18 + TypeScript + Tailwind CSS + Ant Design v5 + Radix UI + shadcn/ui + Motion**
> 目标：把当前 **AntD 原生外观** 的项目，升级为 **时尚、现代## 10) 代码输出风格（给 AI/团队的硬性要求）

- **所有代码文件首行**写注释标明"文件路径"，且**中文注释**解释意图；
- 组件与样式分层：`ui`（轻组件）→`patterns`（图元）→`pages`（编排）；
- 不返回超 500 行的单文件；
- 若示例涉及 AntD，**禁止**写 `.ant-*` 覆盖；
- 若示例涉及 Radix/shadcn，需保留 A11y 属性与键盘交互。

### **防白底白字强制检查清单**

**⚠️ 关键提醒：本项目使用深色主题，全局文字为白色。任何浅色背景都必须强制覆盖文字颜色！**

**🚨 真实案例：ElementList.tsx 白底白字问题**
```tsx
// ❌ 导致白底白字的代码（已修复）
<div style={{background: '#fff'}}> {/* 白色背景 */}
  <span style={{fontWeight: 'bold'}}>更多选项</span> {/* 继承全局白色文字 = 看不见！ */}
</div>

// ✅ 修复后的代码
<div className="light-theme-force" style={{background: 'var(--bg-light-base)'}}>
  <span style={{fontWeight: 'bold'}}>更多选项</span> {/* CSS类自动提供深色文字 */}
</div>
```

每次创建包含背景色的组件时，AI 必须自检：

```
□ 背景色是浅色（#ffffff, #f8fafc, white, rgb(255,255,255) 等）吗？
  └─ 是：❗必须添加 className="light-theme-force" 或显式设置 color="var(--text-inverse)"
□ 背景色是深色（#0f172a, #1e293b 等）吗？
  └─ 是：确保文字色为浅色（#f8fafc, #e2e8f0 等）
□ 使用了 CSS 变量（--bg-*, --text-*）而非硬编码？
□ 包含 Ant Design 组件的浅色容器添加了 .light-theme-force 类？
□ 内联样式中的 background: '#fff' / background: 'white' 已替换为 CSS 变量？
□ 测试过在实际界面中的可读性吗？
□ 颜色对比度达到 WCAG AA 标准（4.5:1）吗？
□ 避免了硬编码颜色如 #666, #1890ff 等？
```

**🚨 高风险场景识别：**
- ✅ 任何包含 `background: '#fff'`, `background: 'white'`, `background: rgb(255,255,255)` 的代码
- ✅ Card、Modal、Popover 等浮层组件没有设置主题覆盖
- ✅ 内联 style 对象中硬编码了浅色背景
- ✅ Ant Design 组件在自定义容器中继承了不正确的颜色
- ✅ 使用 `<span>`, `<p>`, `<strong>` 等HTML元素但未设置 `.light-theme-force`
- ✅ 元素列表、卡片网格、数据展示组件等高曝光区域

**⚡ AI开发时强制执行：**
1. 写任何包含 `background` 样式的代码时，立即检查是否需要 `className="light-theme-force"`
2. 发现浅色值（#fff, white, #f8fafc等）立即添加文字颜色覆盖
3. 使用内联样式设置背景时，优先考虑CSS变量 + 主题类组合
4. 测试代码：在浅色背景上放置"测试文字"验证可读性

### **常见修复模式**

```tsx
// ❌ 危险：最常见的白底白字错误（项目实际案例）
<div style={{
  border: '1px solid #d9d9d9',
  background: '#fff',  // 白色背景
  padding: 12
}}>
  <span style={{ fontWeight: 'bold' }}>更多选项</span> {/* 继承全局白色文字 = 看不见! */}
  <Tag color="green">可点击</Tag>
  <Tag color="red">重要</Tag>
</div>

// ✅ 安全：使用 .light-theme-force 类（推荐方案）
<div 
  className="light-theme-force"
  style={{
    border: '1px solid var(--border-muted)',
    background: 'var(--bg-light-base)',
    padding: 'var(--space-3)',
    borderRadius: 'var(--radius-sm)'
  }}
>
  <span style={{ fontWeight: 'bold' }}>更多选项</span> {/* 自动深色文字 */}
  <Tag color="green">可点击</Tag>
  <Tag color="red">重要</Tag>
</div>

// ✅ 安全：显式颜色覆盖方案
<div style={{ 
  background: 'var(--bg-light-base)', 
  color: 'var(--text-inverse)',  // 强制深色文字
  border: '1px solid var(--border-muted)',
  padding: 'var(--space-3)'
}}>
  <Typography.Title style={{ color: 'var(--text-inverse) !important' }}>标题</Typography.Title>
  <Tag color="green">标签</Tag>
</div>

// ✅ 安全：Ant Design Card 组件修复
<div className="light-theme-force">
  <Card size="small" title="卡片标题">
    <p>卡片内容会自动使用正确的文字颜色</p>
    <Tag color="blue">状态标签</Tag>
  </Card>
</div>
```

**📋 修复检查表（Copy-Paste 使用）：**

```tsx
// 搜索并替换这些危险模式：
background: '#fff'           → background: 'var(--bg-light-base)'
background: 'white'          → background: 'var(--bg-light-base)'
background: rgb(255,255,255) → background: 'var(--bg-light-base)'
color: '#666'                → color: 'var(--text-muted)'
color: '#1890ff'             → color: 'var(--brand)'

// 必须添加的类名：
<div style={{ background: '浅色' }}>  → <div className="light-theme-force" style={{ background: '浅色' }}>
```* 的商业化 UI；在不牺牲复杂交互效率的前提下，建立 **品牌化轻组件体系** 与 **统一动效/令牌**，并保持 **模块化**（单文件 ≤500 行）。

---

## 0) 成功标准（一眼看懂）

- **品牌一致**：颜色/圆角/阴影/密度/字号由 **Design Tokens（CSS 变量）** 驱动，所有页面观感一致。
- **轻组件更好看**：按钮/卡片/标签/弹层等**高曝光轻组件**由 **Radix+shadcn（源码入库）+Tailwind 皮肤** 实现，质感现代。
- **重组件省心**：表单/表格/上传/树/日期/抽屉/步骤 等**重组件**继续用 **AntD v5**，**不覆写 `.ant-*`**，仅通过 tokens 与外层容器皮肤对齐。
- **统一动效**：使用 **Motion** 统一悬停/入场/转场（入场 180–220ms、离场 120–160ms、悬停 80–120ms、ease-out）。
- **A11y 与桌面**：键盘可达、可见焦点环、暗黑对比达标；Tauri 标题栏拖拽/托盘/快捷键不受影响。
- **模块化可维护**：目录分层清晰；单文件 ≤500 行；升级 AntD 或替换轻组件无痛。

---

## 1) 地位重调（谁负责外观，谁负责复杂度）

- **Tailwind（+Design Tokens）= 视觉所有者**：品牌色板、圆角、阴影、密度、排版、布局与响应式；仅在**容器与自有组件**上使用，不进入 AntD 内部改妆。
- **Radix + shadcn/ui = 轻组件源码**：Button / Card / Tag / Tooltip / Dialog / Dropdown 等放入 `components/ui`，作为“外观担当”。
- **Ant Design v5 = 重组件与生产力**：Form / Table / Upload / Tree / DatePicker / Drawer / Steps……通过 **`ConfigProvider` tokens** 与**适配层**统一，不覆写内部样式。
- **Motion = 动效统一**：统一节奏、统一曲线、统一进入/离开/悬停方案。

**坚决不要**：

- 不要用 Tailwind/CSS 去覆盖 `.ant-*` 或 `!important`；
- 不要在 AntD 子元素上加自定义渐变/阴影/圆角；
- 不要让多个页面各自“创新”渐变/阴影，必须走 tokens 与轻组件皮肤。

---

## 2) 设计令牌（Single Source of Truth）

在 `styles/tokens.css` 定义：

```css
/* 基础品牌色 */
--brand            # 主品牌色（例如 #6E8BFF）

/* 背景层级 */
--bg-base          # 页面深色底
--bg-elevated      # 浮层/面板底
--bg-secondary     # 次级背景

/* 局部浅色组件专用（关键！） */
--bg-light-base    # 浅色组件白底 (#FFFFFF)
--bg-light-elevated # 浅色组件提升背景 (#F8FAFC)
--bg-light-secondary # 浅色组件次级背景 (#F1F5F9)
--text-inverse     # 浅色背景下的深色文字 (#1E293B)
--text-muted       # 次要文字颜色 (#94A3B8)

/* 信息色彩 */
--info             # 信息色 (#3B82F6)
--info-bg          # 信息背景 (#DBEAFE)
--success          # 成功色 (#10B981)  
--success-bg       # 成功背景 (#D1FAE5)
--warning          # 警告色 (#F59E0B)
--warning-bg       # 警告背景 (#FEF3C7)
--error            # 错误色 (#EF4444)
--error-bg         # 错误背景 (#FEE2E2)

/* 布局与控件 */
--text-1 / --text-2  # 主/次文本
--radius           # 统一圆角（建议 10–14px）
--shadow           # 统一阴影（软阴影，商业化）
--font             # 基础字号
--control-h        # 控件高度（40/36 两档）
--border-muted     # 边框颜色 (#D1D5DB)

/* 浅色主题强制覆盖类（解决 Ant Design 继承问题） */
.light-theme-force {
  color: var(--text-inverse) !important;
}
.light-theme-force .ant-typography,
.light-theme-force .ant-typography-title,
.light-theme-force .ant-typography-paragraph {
  color: var(--text-inverse) !important;
}
.light-theme-force .ant-typography-secondary {
  color: var(--text-muted) !important;
}
```

**关键原则**：

- **全局暗色 + 局部浅色组件**：整体 UI 保持暗色主题，但特定组件（如弹窗内容、提示卡片、信息面板）可以使用浅色背景以突出内容，**必须配套使用 `--text-inverse` 确保文字可读性**
- **禁止硬编码颜色**：所有颜色值必须通过 CSS 变量定义，便于主题切换和品牌定制
- **浅色组件最佳实践**：
  ```css
  /* ✅ 正确：浅色背景 + 深色文字 */
  .light-component {
    background: var(--bg-light-elevated, #f8fafc);
    color: var(--text-inverse, #1e293b);
  }
  
  /* ❌ 错误：浅色背景但继承了全局白色文字 */
  .broken-component {
    background: #f8fafc; /* 硬编码 + 没有指定文字颜色 */
  }
  ```

- **Ant Design 组件颜色继承问题解决方案**：
  ```tsx
  // ❌ 问题：Ant Design 组件会继承全局颜色，即使父容器设置了局部颜色
  <Card style={{ background: 'var(--bg-light-base)', color: 'var(--text-inverse)' }}>
    <Title>标题</Title> {/* 仍然是白色文字！ */}
    <Text>内容</Text> {/* 仍然是白色文字！ */}
  </Card>
  
  // ✅ 解决方案1：为每个 Ant Design 组件显式设置颜色
  <Card style={{ background: 'var(--bg-light-base)' }}>
    <Title style={{ color: 'var(--text-inverse) !important' }}>标题</Title>
    <Text style={{ color: 'var(--text-inverse)' }}>内容</Text>
  </Card>
  
  // ✅ 解决方案2：使用 CSS 类进行统一覆盖
  .light-theme-override {
    color: var(--text-inverse) !important;
  }
  .light-theme-override .ant-typography {
    color: var(--text-inverse) !important;
  }
  .light-theme-override .ant-typography-secondary {
    color: var(--text-muted) !important;
  }
  ```

- **强制颜色覆盖规则**：
  - 对于浅色背景的容器，必须为所有子元素（包括 Ant Design 组件）显式设置文字颜色
  - 使用 `!important` 来覆盖 Ant Design 的默认样式
  - 创建专门的 CSS 类来处理主题覆盖，避免在每个组件中重复设置
  - **强制要求**：任何包含浅色背景的组件都必须添加 `.light-theme-force` 类

**要求**：

- Tailwind 在 `tailwind.config.ts` 读取上述变量；
- AntD 在顶层 `ConfigProvider` 用 `algorithm:[theme.darkAlgorithm]` 并以 tokens 对齐（仅少量必要 token）；
- **强制要求**：任何使用浅色背景的组件都必须显式设置 `color: var(--text-inverse)` 或对应的文字颜色变量；
- 视觉变更只能改 tokens，不在页面/组件硬编码视觉值。

---

## 3) 目录与模块化约束

```
src/
  styles/          # tokens.css（令牌）、global.css（层级：antd reset→tailwind）
  theme/           # ThemeBridge.tsx（AntD 主题桥）
  components/
    ui/            # 轻组件（Button/CardShell/TagPill/Tooltip/SmartDialog/...）
    adapters/      # AntD 重组件适配层（AntTableAdapter/AntFormAdapter/...）
    patterns/      # 页面图元（FilterBar/MarketplaceCard/HeaderBar/...）
    layout/        # HeaderNav/PageShell/...（仅编排与栅格）
  pages/           # 按页面组合 patterns
```

- 单文件 ≤500 行；超过即拆分。
- `pages/` 只做编排；视觉在 `ui/` 与 `patterns/` 里；与 AntD 的耦合收敛在 `adapters/`。

---

## 4) 实施步骤（最快见效的迁移路线）

**Phase 0（当日）**

1. 建立 `styles/tokens.css`；在 `tailwind.config.ts` 读取变量；
2. `theme/ThemeBridge.tsx`：`algorithm:[theme.darkAlgorithm]` + 对齐 tokens；
3. 清理所有 `.ant-*` 覆盖/`!important`，保证 AntD 重组件回到“可被 tokens 驱动”的状态。

**Phase 1（1–2 天见效）** 4. 落地 `components/ui`：`Button / CardShell / TagPill / SmartDialog` 等**轻组件**； 5. 用 `patterns/*` 重写高曝光区域（页头/筛选/卡片），**改观立刻现代**； 6. 接入 **Motion**，统一悬停/入场节奏。

**Phase 2（并行）** 7. 为 AntD 重组件加 **适配层**（密度、粘头、滚动容器、分页位置），**不覆写**内部； 8. 完成常用 patterns（FilterBar, MarketplaceCard, EmptyState, Skeleton 等）；

**Phase 3（收尾）** 9. 逐页自检（A11y、暗黑/紧凑、动效一致、性能预算）； 10. 整理文档：tokens 表、动效规范、轻组件用法、AntD 适配约定。

---

## 5) Do / Don’t（落地守则）

**Do**

- 在容器与自有轻组件上使用 Tailwind；
- 通过 tokens 改外观；
- 重组件用 AntD，轻组件用自有源码（Radix/shadcn + Tailwind 皮肤）；
- 统一动效（Motion）。

**Don’t**

- 不覆写 `.ant-*` / 不使用 `!important`；
- 不在 AntD 子元素加渐变/阴影/圆角；
- 不分散定义颜色/阴影（统一走 tokens）。

---

## 6) 动效与可访问性

- 节奏：Enter 180–220ms / Exit 120–160ms / Hover 80–120ms；
- 曲线：ease-out（或 cubic-bezier(0.22, 1, 0.36, 1)）；
- 焦点：可见 `:focus-visible`（品牌色 2px, offset 2px）；
- 键盘可达/读屏语义遵循 Radix/AntD 默认实现。

---

## 7) Tauri 桌面特性

- 自绘标题栏：`.titlebar { -webkit-app-region: drag }`；交互区 `no-drag`；
- 三平台 DPI/字体回归；托盘/快捷键与自动更新保持不变；
- 安全：最小化 allowlist，CSP 限制资源来源。

---

## 8) 性能预算

- 首屏 CSS < 100KB（Tailwind 按需）；
- AntD 组件按需引入；大表虚拟化；路由分包；图片懒加载；
- 动效避免昂贵滤镜；尽量用 transform/opacity。

---

## 9) 交付物与验收

**交付**

- `tokens.css`、`tailwind.config.ts`、`ThemeBridge.tsx`；
- `components/ui/*`、`components/adapters/*`、`components/patterns/*`；
- 关键页面 PR（改造前/后截图、动效录屏、A11y 报告）。

**逐页自检清单**

- [ ] 是否存在 `.ant-*` 覆盖/`!important`（必须 0）。
- [ ] 高曝光轻组件是否已替为 `ui/*`（按钮/卡片/标签/弹层）。
- [ ] AntD 重组件是否通过 `adapters/*` 包装（无内部覆写）。
- [ ] 动效节奏是否统一、焦点环是否可见。
- [ ] 暗黑/紧凑模式无 UI 破坏，DPI/缩放无异常。
- [ ] 首屏 CSS/体积与交互性能符合预算。

---

## 10) 代码输出风格（给 AI/团队的硬性要求）

- **所有代码文件首行**写注释标明“文件路径”，且**中文注释**解释意图；
- 组件与样式分层：`ui`（轻组件）→`patterns`（图元）→`pages`（编排）；
- 不返回超 500 行的单文件；
- 若示例涉及 AntD，**禁止**写 `.ant-*` 覆盖；
- 若示例涉及 Radix/shadcn，需保留 A11y 属性与键盘交互。

---

# Complete Prompt (English)

> **Role**: Brand-first Front-end Refactor Engineer
> **Stack**: **Tauri + React 18 + TypeScript + Tailwind CSS + Ant Design v5 + Radix UI + shadcn/ui + Motion** > **Goal**: Turn an AntD-native-looking app into a **modern, consumer-grade, brand-first UI** without losing heavy-widget productivity. Keep **modularity** (≤500 lines per file).

## 0) Success Criteria

- **Brand consistency** via **CSS tokens**; unified colors/radius/shadows/density/typography.
- **Light components look premium**: implemented with **Radix + shadcn (source-in) + Tailwind skin**.
- **Heavy components stable**: AntD v5 for forms/tables/trees/date etc., **no `.ant-*` overrides**; align via tokens & container skin.
- **Unified motion** with **Motion** (enter 180–220ms, exit 120–160ms, hover 80–120ms, ease-out).
- **A11y & desktop** intact; Tauri-specific behaviors preserved.

## 1) Positioning

- **Tailwind (+ tokens) owns visuals** (brand system, layout, density). Use on containers & your own components.
- **Radix + shadcn** own **light components** (Button/Card/Tag/Tooltip/Dialog/Dropdown).
- **AntD v5** owns **heavy widgets** (Form/Table/Upload/Tree/DatePicker/Drawer/Steps). No internal overrides.
- **Motion** standardizes animation.

## 2) Tokens (SSOT)

Define in `styles/tokens.css`: `--brand, --bg-base, --bg-elevated, --text-1, --text-2, --radius, --shadow, --font, --control-h`. Tailwind reads them; AntD receives them via `ConfigProvider` with `darkAlgorithm`.

## 3) Structure & Modularity

Layered folders: `styles/`, `theme/`, `components/ui`, `components/adapters`, `components/patterns`, `components/layout`, `pages/`. Files ≤500 lines.

## 4) Rollout (fast track)

Phase 0: tokens + theme bridge, remove overrides.
Phase 1: ship light UI kit (Button/CardShell/TagPill/Dialog) + Motion; refactor high-exposure areas.
Phase 2: AntD adapters for heavy widgets; build patterns.
Phase 3: page audits (A11y, dark/compact, motion, perf); docs.

## 5) Do / Don’t

**Do**: tokens drive visuals; Tailwind on containers/own components; Radix/shadcn for light UI; AntD for heavy widgets; unified Motion.
**Don’t**: override `.ant-*` or use `!important`; add gradients/shadows/radius inside AntD internals; define ad-hoc colors.

## 6) Motion & A11y

Enter 180–220ms / Exit 120–160ms / Hover 80–120ms; ease-out. Focus ring visible; keyboard navigation preserved.

## 7) Tauri specifics

Custom titlebar drag region; DPI/typography checks; keep updater/tray/hotkeys; minimal allowlist & CSP.

## 8) Perf Budget

First-screen CSS <100KB; tree-shake AntD; virtualize large lists; route-split; lazy images; animation on transform/opacity only.

## 9) Deliverables & Page-by-Page Audit

Deliver tokens/config/bridge; light UI kit; AntD adapters; patterns; PRs with screenshots & motion clips.
Audit checklist: 0 overrides, light components in place, AntD via adapters, uniform motion, dark/compact OK, perf OK.

## 10) Code Output Policy

Every file starts with a file-path comment; Chinese comments welcomed for clarity; no single file >500 lines; no `.ant-*` overrides; keep A11y when using Radix/shadcn.
