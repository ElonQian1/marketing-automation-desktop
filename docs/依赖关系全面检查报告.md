# 依赖关系全面检查报告

## 1. ActionParams.tsx 依赖分析

### 1.1 被谁导出

```typescript
// src/components/stepCards/index.ts
export { ActionParams } from './ActionParams';              // 第6行
export type { ActionParamsProps } from './ActionParams';   // 第9行
```

### 1.2 被谁使用

```tsx
// ✅ 唯一使用者: NewStepCard.tsx (第35行)
import { ActionParams } from './ActionParams';

// 使用方式:
const NewStepCard: React.FC<Props> = ({ stepCard }) => {
  return (
    <ActionBar onExecute={handleExecute}>
      <ActionParams
        action={currentAction}
        onChange={(params) => updateAction({ ...currentAction, params })}
      />
    </ActionBar>
  );
};
```

### 1.3 类型引用

```typescript
// ❌ 类型混淆: ActionParams作为组件 vs ActionParams作为类型

// 组件导入 (1处)
src/components/stepCards/NewStepCard.tsx:35
  → import { ActionParams } from './ActionParams';

// 类型导入 (多处 - 不同的ActionParams)
src/types/action-types.ts
  → export interface ActionParams { ... }  // 参数类型定义

src/components/DraggableStepCard.tsx:37
  → import type { ActionParams } from "../types/action-types";  // 类型

src/components/action-system/ActionParamsPanel.tsx:18
  → import type { ActionParams } from '../../types/action-types';  // 类型
```

### 1.4 依赖关系图

```
ActionParams 组件
  ↑
  └── NewStepCard (唯一使用者)
        ↑
        └── src/components/stepCards/index.ts (导出)
              ↑
              └── ❌ 无外部引用 (只在index.ts导出，未被任何地方使用)
```

## 2. NewStepCard.tsx 依赖分析

### 2.1 被谁导出

```typescript
// src/components/stepCards/index.ts
export { NewStepCard } from './NewStepCard';              // 第7行
export type { NewStepCardProps } from './NewStepCard';   // 第10行
```

### 2.2 被谁使用

```bash
grep搜索结果: 
  - ❌ 只在 index.ts 中导出
  - ❌ 无任何生产代码引用 NewStepCard
  - ❌ 无任何文档引用 NewStepCard
```

### 2.3 依赖关系图

```
NewStepCard (288行)
  ├── import useStepCardStateMachine (305行) ✅ V3架构
  ├── import ActionBar (100行)
  ├── import ActionParams (280行) ✅ 包含5个通用配置
  └── import useStepCardStore
        ↑
        └── src/components/stepCards/index.ts (导出)
              ↑
              └── ❌ 无外部引用 (孤立模块)
```

## 3. ActionParamsPanel.tsx 依赖分析

### 3.1 被谁导出

```typescript
// src/components/action-system/index.ts
export { ActionParamsPanel } from './ActionParamsPanel';  // 第6行

// src/modules/action-system/index.ts
export * from '../../components/action-system/ActionParamsPanel';  // 第17行
```

### 3.2 被谁使用

```tsx
// ✅ 生产使用: DraggableStepCard.tsx (第36行)
import { ActionParamsPanel } from "./action-system/ActionParamsPanel";

// 使用场景:
const DraggableStepCard: React.FC<Props> = ({ step }) => {
  return (
    <Collapse>
      <Panel key="params">
        <ActionParamsPanel
          action={currentAction}
          onChange={handleParamsChange}
        />
      </Panel>
    </Collapse>
  );
};
```

### 3.3 依赖关系图

```
ActionParamsPanel (836行)
  ├── import CoordinateSelector
  ├── import type { ActionParams } (类型)
  └── export from action-system/index.ts
        ↑
        └── ✅ DraggableStepCard (生产使用)
              ↑
              └── StepCardSystem.tsx (主要步骤卡片系统)
```

## 4. EnhancedStepCard.tsx 依赖分析

### 4.1 被谁导出

```typescript
// ❌ action-system/index.ts (第19行 - 需要删除)
export * from '../../components/enhanced-step-card/EnhancedStepCard';

// ✅ enhanced-step-card/index.ts (已重定向)
export { default as EnhancedStepCard } from '../universal-ui/ui/components/universal-enhanced-step-card-integration';
```

### 4.2 被谁使用

```bash
grep搜索结果:
  - ❌ 无代码引用旧组件
  - ✅ 模块已重定向到 UniversalEnhancedStepCardIntegration
  - ✅ 文档只引用新组件
```

### 4.3 依赖关系图

```
EnhancedStepCard (284行) ❌ 废弃
  ├── import ActionSelector
  ├── import ActionParamsPanel ✅ 仍在使用
  ├── import ActionPreview
  └── export from action-system/index.ts
        ↑
        └── ❌ 无外部引用
              ↓
        已被替代 by UniversalEnhancedStepCardIntegration (243行)
```

## 5. 完整依赖拓扑

```
生产环境使用:
  StepCardSystem.tsx
    ├── DraggableStepCard ✅
    │     └── ActionParamsPanel ✅ (836行 - 保留)
    │           └── CoordinateSelector ✅
    │           └── type ActionParams ✅
    │
    └── UniversalEnhancedStepCardIntegration ✅
          └── Universal组件族 ✅

孤立模块 (无外部引用):
  NewStepCard ❌ (288行)
    ├── useStepCardStateMachine ✅ (V3架构 - 应该迁移)
    ├── ActionBar ❓ (需要检查)
    └── ActionParams ❌ (280行)
          └── 5个通用配置 ✅ (需要提取)

废弃组件:
  EnhancedStepCard ❌ (284行 - 完全删除)
    └── action-system/index.ts (需要移除导出)
```

## 6. 关键发现

### 6.1 孤立模块发现

```
NewStepCard + ActionParams 是一个孤立模块:
  - ✅ 在 index.ts 中导出
  - ❌ 无任何外部引用
  - ✅ 但包含最佳实践架构 (V3智能策略)
  - ✅ ActionParams 有5个独特的通用配置
```

### 6.2 架构矛盾

```
问题: 最佳架构实践却无人使用

NewStepCard (288行)
  - 使用 useStepCardStateMachine (V3引擎)
  - 使用 StepExecutionGateway
  - 使用 ActionParams (5个通用配置)
  - ❌ 但完全孤立，无外部引用

DraggableStepCard (生产)
  - 使用 ActionParamsPanel (丰富控件)
  - ❌ 缺少通用配置 (选择器优先、坐标兜底等)
  - ❌ 不确定使用V2还是V3执行引擎
```

### 6.3 ActionBar 组件检查

```bash
需要验证:
  - ActionBar 是否只被 NewStepCard 使用?
  - ActionBar 是否有独特价值?
  - 如果 NewStepCard 删除，ActionBar 是否也应删除?
```

## 7. 下一步验证任务

### 7.1 ActionBar 依赖检查

```bash
grep -r "import.*ActionBar" src/
grep -r "from.*ActionBar" src/
```

### 7.2 DraggableStepCard 执行引擎检查

```bash
# 验证 DraggableStepCard 使用的执行系统
grep -r "useSingleStepTest\|useV2StepTest\|StepExecutionGateway" src/components/DraggableStepCard.tsx
```

### 7.3 useStepCardStateMachine 引用检查

```bash
# 验证是否有其他组件使用V3状态机
grep -r "useStepCardStateMachine" src/
```

## 8. 临时结论 (待验证)

### 可能的删除候选

```
高概率删除:
  1. ✅ EnhancedStepCard.tsx (284行) - 已废弃
  2. ⚠️ NewStepCard.tsx (288行) - 孤立但包含最佳实践
  3. ⚠️ ActionParams.tsx (280行) - 只被NewStepCard使用
  4. ❓ ActionBar.tsx (100行) - 待验证

需要保留:
  1. ✅ ActionParamsPanel.tsx (836行) - 生产使用
  2. ✅ useStepCardStateMachine.ts (305行) - V3引擎核心
  3. ✅ StepExecutionGateway - V3架构

需要提取:
  1. ✅ ActionParams的5个通用配置
     → CommonExecutionParams 组件 (~80行)
     → 集成到 ActionParamsPanel
```

### 架构迁移建议

```
不是简单删除，而是架构迁移:

步骤1: 提取通用配置
  - 从 ActionParams 提取5个配置项
  - 创建 CommonExecutionParams 组件
  - 集成到 ActionParamsPanel

步骤2: 验证 DraggableStepCard 执行引擎
  - 检查是否使用V2还是V3
  - 如果使用V2，考虑迁移到V3

步骤3: 决定 NewStepCard 命运
  - 选项A: 删除（如果DraggableStepCard已用V3）
  - 选项B: 迁移（将其模式应用到DraggableStepCard）

步骤4: 安全删除
  - EnhancedStepCard (确定删除)
  - NewStepCard (根据步骤3)
  - ActionParams (提取后删除)
  - ActionBar (根据依赖检查)
```

---

**状态**: 等待验证 ActionBar 和 DraggableStepCard 执行引擎
