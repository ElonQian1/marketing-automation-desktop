å¾ˆå¥½ï¼ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨æ­¥éª¤å¡ç‰‡é‡Œé›†æˆäº†**é‡è¦çš„å…ƒä¿¡æ¯**ï¼ŒåŒ…æ‹¬åŸå§‹XMLå¿«ç…§ã€å…¨å±€XPathã€ç­–ç•¥é€‰æ‹©ç­‰ã€‚æ¥ä¸‹æ¥ï¼Œ**â€œé‡æ–°åˆ†æâ€**æŒ‰é’®çš„åŠŸèƒ½è¦åšå®Œæ•´ï¼Œç›®æ ‡æ˜¯é€šè¿‡ç‚¹å‡»è¯¥æŒ‰é’®èƒ½å¤Ÿ**é‡æ–°å¯åŠ¨æ™ºèƒ½åˆ†æç­–ç•¥**ï¼ŒåŸºäºå½“å‰çš„**æ­¥éª¤å¡ç‰‡çŠ¶æ€**é‡æ–°æ‰§è¡Œåˆ†æå¹¶æ›´æ–°ç»“æœã€‚

### ä½ ç°åœ¨è¦åšçš„ä¸»è¦æ˜¯ï¼š

1. **ç¡®ä¿â€œé‡æ–°åˆ†æâ€æŒ‰é’®è§¦å‘äº†æ­£ç¡®çš„æµç¨‹**ï¼Œä»**åç«¯æ™ºèƒ½åˆ†ææœåŠ¡**é‡æ–°è·å–ç»“æœï¼Œæ›´æ–°å¡ç‰‡å†…å®¹ã€‚
2. **æ›´æ–°æ­¥éª¤å¡ç‰‡ä¸­çš„ç­–ç•¥**ï¼Œæ¯”å¦‚é‡æ–°é€‰æ‹©**æ™ºèƒ½Â·è‡ªåŠ¨é“¾**æˆ–**æ™ºèƒ½Â·å•æ­¥**ï¼Œå¹¶æ ¹æ®æ–°ç­–ç•¥é‡æ–°è¿è¡Œåˆ†æã€‚
3. **åŒæ­¥çŠ¶æ€æ›´æ–°**ï¼Œæ›´æ–°æ­¥éª¤å¡ç‰‡çš„ `status`ï¼ˆä¾‹å¦‚ï¼Œä» `analyzing` â†’ `ready` æˆ– `failed`ï¼‰ï¼ŒåŒæ—¶æŠŠæ–°çš„åˆ†æç»“æœæ˜¾ç¤ºç»™ç”¨æˆ·ã€‚
4. å¦‚æœéœ€è¦ï¼Œå¯ä»¥å®ç°**å¤±è´¥é‡è¯•æœºåˆ¶**ï¼Œåœ¨ç½‘ç»œæˆ–æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè®©ç”¨æˆ·èƒ½æ‰‹åŠ¨æ¢å¤æˆ–å¯ç”¨é»˜è®¤ç­–ç•¥ã€‚

### å…·ä½“å®ç°æ–¹æ¡ˆï¼š

#### 1) è§¦å‘é‡æ–°åˆ†æçš„æŒ‰é’®é€»è¾‘

åœ¨ `StepCard` ç»„ä»¶ä¸­ï¼Œ`onReanalyze` æŒ‰é’®éœ€è¦è§¦å‘ä¸**æ™ºèƒ½åˆ†æåç«¯æœåŠ¡**çš„äº¤äº’ã€‚

**è§¦å‘é‡æ–°åˆ†æ**ï¼š

* æŒ‰é’®ç‚¹å‡»åï¼Œä½¿ç”¨å½“å‰çš„ `elementGlobalXPath` å’Œ `currentStrategy` å‘åç«¯å‘é€é‡æ–°åˆ†æè¯·æ±‚ã€‚
* è¯·æ±‚æˆåŠŸåï¼Œæ›´æ–°æ­¥éª¤å¡ç‰‡çš„ `status` ä¸º `ready`ï¼Œå¹¶æ ¹æ®è¿”å›çš„åˆ†æç»“æœæ›´æ–°æ˜¾ç¤ºï¼ˆåŒ…æ‹¬å®šä½å™¨ã€ç½®ä¿¡åº¦ã€å€™é€‰ç­‰ï¼‰ã€‚

```tsx
// StepCard.tsx - é‡æ–°åˆ†ææŒ‰é’®çš„äº‹ä»¶å¤„ç†
const handleReanalyze = async () => {
  try {
    // å‘åç«¯å‘é€åˆ†æè¯·æ±‚ï¼ŒåŒ…å«æ­¥éª¤æ‰€éœ€ä¿¡æ¯
    const analysisResult = await reanalyzeElement(elementId, currentStrategy);

    // æ›´æ–°æ­¥éª¤å¡ç‰‡çŠ¶æ€
    setStatus('ready');
    setMetrics(analysisResult.metrics);
    setLocatorChosen(analysisResult.locatorChosen);
    setConfidence(analysisResult.confidence);

    // æ ¹æ®è¿”å›ç»“æœæ›´æ–° UI
    onReanalyze?.(analysisResult);  // å›è°ƒ
  } catch (error) {
    // é”™è¯¯æ—¶å¤„ç†
    setStatus('failed');
    console.error('åˆ†æå¤±è´¥ï¼š', error);
  }
};

// æŒ‰é’®è§¦å‘äº‹ä»¶
<Button size="sm" variant="outline" onClick={handleReanalyze} className="gap-1">
  ğŸ”„ é‡æ–°åˆ†æ
</Button>
```

#### 2) åç«¯é‡æ–°åˆ†æè¯·æ±‚ï¼ˆ`reanalyzeElement`ï¼‰

ä½ å·²ç»æœ‰äº†**æ™ºèƒ½åˆ†ææ¨¡å—**ï¼Œç°åœ¨éœ€è¦è¡¥å……ä¸€ä¸ªåç«¯æ¥å£æ¥æ‰§è¡Œ**é‡æ–°åˆ†æ**ï¼Œæ¯”å¦‚æ ¹æ®åŸå§‹ XML å¿«ç…§ã€å…¨å±€ XPathã€é€‰æ‹©çš„ç­–ç•¥æ¥æ‰§è¡Œæ–°ä¸€è½®åˆ†æã€‚

```ts
// src/lib/api/analysis.ts - é‡æ–°åˆ†ææ¥å£
import axios from 'axios';

export const reanalyzeElement = async (elementId: string, strategy: StrategyChoice) => {
  try {
    const response = await axios.post('/api/analysis/reanalyze', {
      elementId,
      strategy,
    });
    return response.data;  // è¿”å›çš„åˆ†æç»“æœ
  } catch (error) {
    console.error('é‡æ–°åˆ†æè¯·æ±‚å¤±è´¥:', error);
    throw error;
  }
};
```

#### 3) æ›´æ–°çŠ¶æ€ä¸æ•°æ®

é‡æ–°åˆ†æåï¼Œéœ€è¦**æ ¹æ®è¿”å›çš„æ•°æ®**æ›´æ–° `StepCard` ä¸­çš„çŠ¶æ€ï¼ˆ`ready`, `failed`ï¼‰ï¼Œå¹¶æ›´æ–°å®šä½å™¨ã€å€™é€‰ã€ç½®ä¿¡åº¦ç­‰ä¿¡æ¯ã€‚ç¡®ä¿æ­¥éª¤å¡ç‰‡èƒ½å¤Ÿ**å‡†ç¡®åæ˜ æœ€æ–°çš„åˆ†æç»“æœ**ã€‚

```tsx
// å‡è®¾ä½ çš„æ­¥éª¤å¡ç‰‡ç»„ä»¶æ¥æ”¶ `metrics`, `locatorChosen`, `confidence` ç­‰ä¿¡æ¯
const [status, setStatus] = useState<StepStatus>('ready');
const [metrics, setMetrics] = useState<Metrics | undefined>(undefined);
const [locatorChosen, setLocatorChosen] = useState<string | undefined>(undefined);
const [confidence, setConfidence] = useState<number | undefined>(undefined);
```

#### 4) é‡è¯•æœºåˆ¶ï¼ˆå¦‚æœéœ€è¦ï¼‰

ä¸ºäº†æé«˜ç³»ç»Ÿçš„å¥å£®æ€§ï¼Œå¯èƒ½éœ€è¦åŠ å…¥**å¤±è´¥é‡è¯•æœºåˆ¶**ï¼Œæ¯”å¦‚ç½‘ç»œæˆ–åç«¯æœåŠ¡é—®é¢˜å¯¼è‡´çš„åˆ†æå¤±è´¥ï¼Œå¯ä»¥æä¾›æŒ‰é’®è®©ç”¨æˆ·æ‰‹åŠ¨é‡è¯•ã€‚

```tsx
// é‡æ–°åˆ†æå¤±è´¥æ—¶æ˜¾ç¤ºçš„æç¤ºä¿¡æ¯
const handleRetry = async () => {
  try {
    setStatus('analyzing');
    await handleReanalyze();  // å†æ¬¡è§¦å‘é‡æ–°åˆ†æ
  } catch (error) {
    setStatus('failed');
    console.error('é‡è¯•å¤±è´¥ï¼š', error);
  }
};

// é”™è¯¯æç¤º
{status === 'failed' && (
  <div className="error-message">
    <p>é‡æ–°åˆ†æå¤±è´¥ï¼Œç‚¹å‡»é‡è¯•</p>
    <Button size="sm" variant="danger" onClick={handleRetry}>
      é‡è¯•
    </Button>
  </div>
)}
```

---

### æ€»ç»“

ä½ ç°åœ¨çš„**â€œé‡æ–°åˆ†æâ€**æŒ‰é’®éœ€è¦åšä»¥ä¸‹å‡ ä¸ªäº‹æƒ…ï¼š

1. **è§¦å‘åç«¯é‡æ–°åˆ†æè¯·æ±‚**ï¼Œé€šè¿‡å½“å‰çš„å…ƒç´ ä¿¡æ¯ï¼ˆå…¨å±€XPathã€ç­–ç•¥ã€å¿«ç…§ç­‰ï¼‰ã€‚
2. **æˆåŠŸåæ›´æ–°çŠ¶æ€**ï¼Œæ˜¾ç¤ºæœ€æ–°çš„å®šä½å™¨ä¿¡æ¯ã€å€™é€‰ã€ç½®ä¿¡åº¦ç­‰æŒ‡æ ‡ã€‚
3. **å¤±è´¥æ—¶æä¾›é‡è¯•æœºåˆ¶**ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿæ‰‹åŠ¨æ¢å¤ã€‚

å¦‚æœç°æœ‰çš„ä»£ç ä¸­å·²ç»æœ‰ç±»ä¼¼åŠŸèƒ½ï¼Œå¯ä»¥åŸºäºè¿™äº›é€»è¾‘è¿›è¡Œæ‰©å±•ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæˆ‘å»ºè®®**åœ¨ç°æœ‰çš„åˆ†ææ¨¡å—åŸºç¡€ä¸Š**å¢åŠ æ–°çš„åç«¯æ¥å£æ¥å¤„ç†é‡æ–°åˆ†æè¯·æ±‚ã€‚

å¦‚æœéœ€è¦æˆ‘ç»§ç»­å¸®ä½ å®ç°æˆ–è€…è¡¥å……æŸä¸ªéƒ¨åˆ†ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼
