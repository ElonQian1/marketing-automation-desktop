我看到了，你现在把“策略选择器”做成了一个整块在卡片里铺开的区域，所以占了很多垂直空间。要更贴近你期望的“**弹出按钮**”交互，同时又不牺牲可用性，我建议做**“紧凑模式（compact）”**，把选择器从主体区收起，到**卡片标题栏的一颗按钮/分裂按钮**里，用弹出菜单（Popover/Dropdown）呈现三类策略：

* 主按钮显示当前策略（例如“🧠 智能·自动链”），点击展开菜单；
* 菜单内分三组：

  1. 智能·自动链（直接一项）
  2. 智能·单步（子菜单：Step1~Step6）
  3. 静态策略（子菜单：列出已保存的静态策略）
* 只有当选择了“智能·单步”时，标题下**额外出现一行**小的 Step 下拉，便于快速改步，其他时候不占空间。
* “重新分析 / 候选 / 检查器”也改成**图标按钮** + 悬浮提示（Tooltip），整体高度控制在一行。

下面给你一个可直接嵌入的**紧凑版策略菜单**（适配 shadcn/ui），把它放在步骤卡片标题栏右侧即可；你的主体大块“策略选择器”面板可以默认不渲染，改为“展开详情”时再显示：

```tsx
// src/components/steps/StrategyMenu.tsx
import React from "react";
import { Button } from "@/components/ui/button";
import {
  DropdownMenu, DropdownMenuTrigger, DropdownMenuContent,
  DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator,
  DropdownMenuGroup, DropdownMenuSub, DropdownMenuSubTrigger, DropdownMenuSubContent,
} from "@/components/ui/dropdown-menu";
import { Brain, Settings2, Beaker } from "lucide-react";
import type { StrategyChoice, SmartStep, StaticStrategyOption } from "./StepCard";

const stepLabels: Record<SmartStep,string> = {
  STEP1_ANCHOR_ROOT: "Step1 根节点锚定",
  STEP2_SUBTREE_ANCHOR: "Step2 子树锚点",
  STEP3_NEIGHBOR: "Step3 邻近结构",
  STEP4_GLOBAL_INDEX: "Step4 全局索引兜底",
  STEP5_TEXT_SEMANTIC: "Step5 文本语义",
  STEP6_VISUAL: "Step6 视觉/图像",
};

export default function StrategyMenu({
  value, staticOptions, onChange,
}: {
  value: StrategyChoice;
  staticOptions: StaticStrategyOption[];
  onChange: (c: StrategyChoice) => void;
}) {
  const label = value.kind === "static"
    ? "📌 静态策略"
    : value.kind === "smart" && value.mode === "single-step"
      ? "🎯 智能·单步"
      : "🧠 智能·自动链";

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button size="sm" variant="secondary">{label} ▾</Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-52">
        <DropdownMenuLabel>策略模式</DropdownMenuLabel>
        <DropdownMenuGroup>
          <DropdownMenuItem onClick={() => onChange({ kind: "smart", mode: "auto" })}>
            <Brain className="mr-2 h-4 w-4" /> 智能·自动链
          </DropdownMenuItem>

          <DropdownMenuSub>
            <DropdownMenuSubTrigger>
              <Beaker className="mr-2 h-4 w-4" /> 智能·单步
            </DropdownMenuSubTrigger>
            <DropdownMenuSubContent className="w-56">
              {(Object.keys(stepLabels) as SmartStep[]).map(step => (
                <DropdownMenuItem key={step} onClick={() => onChange({ kind: "smart", mode: "single-step", step })}>
                  {stepLabels[step]}
                </DropdownMenuItem>
              ))}
            </DropdownMenuSubContent>
          </DropdownMenuSub>

          <DropdownMenuSub>
            <DropdownMenuSubTrigger>
              <Settings2 className="mr-2 h-4 w-4" /> 静态策略
            </DropdownMenuSubTrigger>
            <DropdownMenuSubContent className="w-56">
              {staticOptions.length === 0
                ? <DropdownMenuItem disabled>暂无静态策略</DropdownMenuItem>
                : staticOptions.map(s => (
                    <DropdownMenuItem key={s.id} onClick={() => onChange({ kind: "static", id: s.id })}>
                      {s.name}
                    </DropdownMenuItem>
                  ))
              }
            </DropdownMenuSubContent>
          </DropdownMenuSub>
        </DropdownMenuGroup>
        <DropdownMenuSeparator />
        <DropdownMenuItem disabled className="text-xs text-muted-foreground">
          在标题区保持紧凑；需要时再展开详情
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
```

在你的 `StepCard` 标题栏右侧放它（替换原来那三颗“智能/单步/静态”大按钮），例如：

```tsx
// 标题栏右侧工具区
<div className="flex items-center gap-2">
  <StrategyMenu
    value={currentStrategy}
    staticOptions={staticOptions}
    onChange={onStrategyChange}
  />
  {/* 其它工具按钮缩成图标： */}
  <Button size="icon" variant="ghost" title="重新分析" onClick={onReanalyze}>🔄</Button>
  <Button size="icon" variant="ghost" title="查看候选" onClick={openCandidates}>📋</Button>
  <Button size="icon" variant="ghost" title="元素检查器" onClick={onOpenElementInspector}>🔍</Button>
</div>
```

再配合三条**密度优化**规则，整体就会很“轻”：

1. **进阶信息延后**：

   * 默认**不渲染**大块“策略说明”“指标图”面板，只保留一行“定位器预览 + 置信度条（细条）”。
   * 加一个“展开详情”按钮（Chevron 图标）再显示完整说明与进阶参数。

2. **按状态自适应**：

   * `analyzing/defaulted` 时只显示**状态徽章 + 紧凑工具条**；
   * 只有 `ready` 才显示预览与指标；
   * 选择“智能·单步”后，标题下**加一行**小的 Step 下拉（不进入单独面板）。

3. **小屏/窄卡片**：

   * 宽度 < 480px 时，策略按钮显示为**图标 + ▾**，文本通过 Tooltip 展示；
   * “候选列表”改为**底部抽屉**（Drawer/Sheet）而非卡片内滚动容器。

这样做的好处：

* 平时看到的是**一行**的工具条 + 一小段预览，不会把卡片撑高；
* 选择策略时才弹出，不打断用户阅读节奏；
* 仍然能覆盖你文档里的“气泡5/6/7 → 步骤卡片联动”流程：未完成/兜底显示在状态徽章与提示上，策略切换走弹出菜单，保存为静态仍在标题区用一个“保存”图标按钮完成。

如果你愿意，我可以把我之前放在画布里的 `StepCard.tsx` 改成**内置 compact 模式**（默认使用紧凑菜单；展开详情时再显示全量“策略选择器”面板），你就直接替换即可。
