# ğŸ“‹ æ­¥éª¤å¡ç‰‡é‡å¤å†—ä½™ä¸æ ·å¼é—®é¢˜åˆ†ææŠ¥å‘Š

> ğŸ“… åˆ†ææ—¥æœŸï¼š2025-10-14  
> ğŸ“š åŸºäºæ–‡æ¡£ï¼šç‚¹é€‰å…ƒç´ æ°”æ³¡5/6/7æ­¥éª¤å¡ç‰‡è”åŠ¨.md  
> ğŸ¯ ç›®æ ‡ï¼šæ£€æŸ¥ä»£ç å®ç°ä¸æ–‡æ¡£è¦æ±‚çš„å·®è·ï¼Œè¯†åˆ«é‡å¤å†—ä½™

---

## ä¸€ã€ğŸ“š ä¸‰ä»½æ–‡æ¡£æ ¸å¿ƒæ€»ç»“

### ğŸ“„ æ–‡æ¡£5ï¼šå·¥ä½œæµä¸é˜²ä¸²æ‰°æœºåˆ¶

**æ ¸å¿ƒè®¾è®¡**ï¼š
- âœ… ç‚¹é€‰ä»…é‡‡æ ·ï¼Œä¸è‡ªåŠ¨åˆ†æ
- âœ… æ°”æ³¡æ–°å¢"ğŸ§ æ™ºèƒ½åˆ†æ"æŒ‰é’®ï¼ˆä¸»åŠ¨è§¦å‘ï¼‰
- âœ… æ”¯æŒ"âœ…ç›´æ¥ç¡®å®š"â†’ å…œåº•ç­–ç•¥ç«‹å³å¯ç”¨ + åå°åˆ†æå¹¶è¡Œ
- âœ… ä¸‰é‡é˜²ä¸²æ‰°ï¼š`jobId + selection_hash + stepId`
- âœ… è‡ªåŠ¨å‡çº§é˜ˆå€¼ï¼šç½®ä¿¡åº¦ â‰¥ 0.82

**å…³é”®æµç¨‹**ï¼š
```
ç‚¹é€‰å…ƒç´  â†’ å¼¹å‡ºæ°”æ³¡ï¼ˆä¸è‡ªåŠ¨åˆ†æï¼‰
  â”œâ”€ è·¯å¾„Aï¼šç‚¹å‡»"ğŸ§ åˆ†æç­–ç•¥" â†’ æ˜¾ç¤ºè¿›åº¦ â†’ ç­‰ç»“æœ/ç›´æ¥ç¡®å®š
  â””â”€ è·¯å¾„Bï¼šç›´æ¥ç¡®å®š â†’ é™æ€å…œåº•å»ºå¡ â†’ è‡ªåŠ¨è§¦å‘åˆ†æ â†’ å›å¡«ç»“æœ
```

---

### ğŸ“„ æ–‡æ¡£6ï¼šç­–ç•¥åˆ†ç±»ä¸è¿è¡Œè¯­ä¹‰

**ä¸‰ç§ç­–ç•¥æ¨¡å¼**ï¼š

| æ¨¡å¼ | å†…éƒ¨é”®å | æ˜¯å¦å›é€€ | ç”¨é€” |
|------|----------|----------|------|
| æ™ºèƒ½åŒ¹é…ï¼ˆæ¨èï¼‰ | `mode: "intelligent"` | âœ… å—æ§å›é€€ | å®Œæ•´å†³ç­–é“¾Step1â†’Step6ï¼ŒæŒ‰Plané¡ºåºå›é€€ |
| æ™ºèƒ½-å•æ­¥å›ºå®š | `mode: "manual"`, `active.kind: "smart_variant"` | âŒ ä¸å›é€€ | ä»æ™ºèƒ½åˆ†æä¸­æŒ‘ä¸€æ¡ï¼Œå¤±è´¥ç›´æ¥æŠ¥é”™ |
| ç”¨æˆ·è‡ªå»ºé™æ€ | `mode: "manual"`, `active.kind: "static_user"` | âŒ ä¸å›é€€ | ç”¨æˆ·æ‰‹å†™XPath/CSSï¼Œå¯åŠ å…¥æ™ºèƒ½å€™é€‰ |

**UIç»“æ„è¦æ±‚**ï¼š
```
â”Œâ”€ æ­¥éª¤å¡ç‰‡ Â· ç­–ç•¥é€‰æ‹© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â— æ™ºèƒ½åŒ¹é…ï¼ˆæ¨èï¼‰                    â”‚
â”‚   - æ¨èï¼šåŒºåŸŸ+æ–‡æœ¬ä¸Šæº¯ï¼ˆ93%ï¼‰        â”‚
â”‚   - [æŸ¥çœ‹å€™é€‰é“¾ Plan] [æ”¹ç”¨æ­¤æ¨è]    â”‚
â”‚                                       â”‚
â”‚ â—‹ æ™ºèƒ½-å•æ­¥å›ºå®š                       â”‚
â”‚   â—‹ Step1 è‡ªæˆ‘é”šç‚¹ï¼ˆ95åˆ†ï¼‰            â”‚
â”‚   â—‹ Step2 å­æ ‘é”šç‚¹ï¼ˆ87åˆ†ï¼‰            â”‚
â”‚   ...                                 â”‚
â”‚                                       â”‚
â”‚ â—‹ ç”¨æˆ·è‡ªå»ºé™æ€                        â”‚
â”‚   â—‹ è‡ªå®šä¹‰XPath: ...                  â”‚
â”‚   â—‹ [æ–°å»ºé™æ€ç­–ç•¥â€¦]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“„ æ–‡æ¡£7ï¼šå¡ç‰‡æ ·å¼ä¸çŠ¶æ€é©±åŠ¨

**æ ¸å¿ƒåŸåˆ™**ï¼š
> **ä¸éœ€è¦æ–°ç‰ˆæœ¬ç»„ä»¶**ï¼Œåªåœ¨ç°æœ‰ StepCard ä¸ŠåŠ "**çŠ¶æ€æ¡ + å¾½æ ‡ + å€™é€‰åŒº**"

**é¡¶éƒ¨çŠ¶æ€æ¡ï¼ˆæŒ‰ `analysis_state` å‘ˆç°ï¼‰**ï¼š

| çŠ¶æ€ | é¢œè‰² | æ–‡æ¡ˆç¤ºä¾‹ | æ“ä½œ |
|------|------|----------|------|
| `pending_analysis` | ğŸ”µ è“è‰² | "æ™ºèƒ½åˆ†æè¿›è¡Œä¸­â€¦ 63%ï½œé¢„è®¡ 2sï¼ˆ**æš‚ç”¨å…œåº•ç­–ç•¥**å¯æ‰§è¡Œï¼‰" | è¿›åº¦æ¡ |
| `analysis_completed` | ğŸŸ  ç¥ç€ | "å‘ç°æ›´ä¼˜ç­–ç•¥ï¼šåŒºåŸŸ+æ–‡æœ¬ä¸Šæº¯ï¼ˆ86%ï¼‰ï½œ**ä¸€é”®å‡çº§**" | å‡çº§æŒ‰é’® |
| `analysis_failed` | ğŸ”´ çº¢è‰² | "æ™ºèƒ½åˆ†æå¤±è´¥ï¼šè¶…æ—¶/ä¸Šä¸‹æ–‡ä¸è¶³ï½œ**é‡è¯•åˆ†æ**" | é‡è¯•æŒ‰é’® |
| `analysis_stale` | âšª ç°/é»„ | "åˆ†æå¯èƒ½è¿‡æœŸï¼ˆå¿«ç…§/ç¯å¢ƒå˜åŒ–ï¼‰ï½œ**é‡æ–°åˆ†æ**" | é‡æ–°åˆ†æ |

**ä¸»ä½“ä¿¡æ¯åŒºè¦æ±‚**ï¼š
- âœ… å½“å‰æ¿€æ´»ç­–ç•¥ï¼ˆè‹¥æ˜¯å…œåº•æ˜¾ç¤ºå¾½æ ‡"**æš‚ç”¨å…œåº•**"ï¼‰
- âœ… åŒ¹é…æ¨¡å¼ï¼ˆæ™ºèƒ½åŒ¹é…/æ‰‹åŠ¨å›ºå®šï¼‰
- âœ… å€™é€‰åŒºï¼ˆåˆ†æå®Œæˆåæ˜¾ç¤ºTop-3å€™é€‰ï¼‰
- âœ… è¡Œä¸ºå¼€å…³ï¼ˆæ™ºèƒ½è·Ÿéšon/offã€å…è®¸å›é€€on/offï¼‰
- âœ… æ¥æºä¿¡æ¯ï¼ˆå…ƒç´ æ‘˜è¦ã€XMLå¿«ç…§æ—¶é—´æˆ³ï¼‰

---

## äºŒã€ğŸ” ä»£ç å®ç°ç°çŠ¶åˆ†æ

### âœ… **å·²å®ç°çš„åŠŸèƒ½**

#### 1. **é¡¶éƒ¨çŠ¶æ€æ¡**ï¼ˆéƒ¨åˆ†å®ç°ï¼‰
**æ–‡ä»¶**ï¼š`StepCardSystemClean.tsx` L230-280

```tsx
<div className={`unified-step-card__status-bar--${çŠ¶æ€}`} style={{ 
  background: intelligent.isAnalyzing ? '#e6f7ff' 
    : stepData.analysisState === 'analysis_completed' ? '#fff7e6' 
    : stepData.analysisState === 'analysis_failed' ? '#fff2f0' 
    : '#f5f5f5',
  borderColor: intelligent.isAnalyzing ? '#91d5ff' 
    : stepData.analysisState === 'analysis_completed' ? '#ffd591' 
    : '#ffccc7',
}}>
  <span>{intelligent.analysisStatusText}</span>
  {intelligent.showUpgradeButton && <button>ä¸€é”®å‡çº§</button>}
</div>
```

âœ… **å®ç°äº†**ï¼š
- çŠ¶æ€æ¡é¢œè‰²åˆ‡æ¢ï¼ˆè“/æ©™/çº¢/ç°ï¼‰
- åˆ†æçŠ¶æ€æ–‡æœ¬æ˜¾ç¤º
- ä¸€é”®å‡çº§æŒ‰é’®
- è¿›åº¦æ¡å±•ç¤º

#### 2. **åˆ†æçŠ¶æ€Hook**
**æ–‡ä»¶**ï¼š`use-step-card-actions.ts` L199-270

```tsx
export const useStepCardIntelligent = ({ stepData, enableIntelligent, callbacks }) => {
  const isAnalyzing = stepData.analysisState === 'analyzing' || 
                      stepData.analysisState === 'pending_analysis';
  const analysisProgress = stepData.analysisProgress || 0;
  const hasRecommendation = !!stepData.recommendedStrategy && 
                            stepData.recommendedStrategy.confidence >= 0.82;
  
  const getAnalysisStatusText = () => {
    switch (stepData.analysisState) {
      case 'idle': return 'æœªå¼€å§‹åˆ†æ';
      case 'pending_analysis': return 'ç­‰å¾…åˆ†æä¸­...';
      case 'analyzing': return `æ™ºèƒ½åˆ†æè¿›è¡Œä¸­... ${analysisProgress}%`;
      case 'analysis_completed': 
        return `å‘ç°æ›´ä¼˜ç­–ç•¥ï¼š${stepData.recommendedStrategy?.name} (${confidence}%)`;
      case 'analysis_failed': return `åˆ†æå¤±è´¥ï¼š${stepData.analysisError}`;
      case 'analysis_stale': return 'åˆ†æå¯èƒ½è¿‡æœŸ';
    }
  };
  // ...
};
```

âœ… **å®ç°äº†**ï¼š
- çŠ¶æ€åˆ¤æ–­é€»è¾‘
- æ¨èç­–ç•¥æ£€æµ‹ï¼ˆç½®ä¿¡åº¦ â‰¥ 0.82ï¼‰
- çŠ¶æ€æ–‡æœ¬ç”Ÿæˆ

#### 3. **åˆ†æçŠ¶æ€å±•ç¤ºç»„ä»¶**
**æ–‡ä»¶**ï¼š`universal-analysis-status-section.tsx`

âœ… **å®ç°äº†**ï¼š
- åˆ†æä¸­ï¼šè¿›åº¦æ¡ + "åœæ­¢"æŒ‰é’®
- åˆ†æå®Œæˆï¼šæ¨èç­–ç•¥å±•ç¤º + "ä¸€é”®å‡çº§"/"æŸ¥çœ‹è¯¦æƒ…"
- åˆ†æå¤±è´¥ï¼šè­¦å‘Šæç¤º + "é‡è¯•"æŒ‰é’®

---

### âŒ **ç¼ºå¤±æˆ–ä¸ç¬¦åˆæ–‡æ¡£è¦æ±‚çš„éƒ¨åˆ†**

#### ğŸš¨ 1. **æ ·å¼é—®é¢˜ï¼šç™½åº•ç™½å­—é£é™©**

**é—®é¢˜**ï¼šçŠ¶æ€æ¡ä½¿ç”¨æµ…è‰²èƒŒæ™¯ä½†**æœªæ·»åŠ  `light-theme-force` ç±»**

```tsx
// âŒ å½“å‰å®ç°ï¼ˆStepCardSystemClean.tsx L240ï¼‰
<div style={{ 
  background: '#e6f7ff',  // æµ…è“è‰²èƒŒæ™¯
  // âš ï¸ ç¼ºå°‘ className="light-theme-force"
}}>
  <span>{intelligent.analysisStatusText}</span>  {/* å¯èƒ½æ˜¯ç™½è‰²æ–‡å­— */}
</div>
```

**è¿åé¡¹ç›®è§„èŒƒ**ï¼š
> ğŸ“‹ `.github/copilot-instructions.md` L237-243ï¼š
> - æµ…è‰²èƒŒæ™¯å¿…é¡»é…æ·±è‰²æ–‡å­—
> - å¼ºåˆ¶æ‰§è¡Œå¯¹æ¯”åº¦æ ‡å‡†ï¼šæœ€ä½ 4.5:1 (WCAG AA)
> - åˆ›å»ºç™½åº•ç™½å­—ã€æ·±åº•æ·±å­—ç­‰ä½å¯¹æ¯”åº¦ç»„åˆå±äº**ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**

**å½±å“**ï¼š
- åœ¨å…¨å±€æ·±è‰²ä¸»é¢˜ä¸‹ï¼Œæµ…è‰²èƒŒæ™¯å¯èƒ½ç»§æ‰¿ç™½è‰²æ–‡å­— â†’ **ä¸å¯è¯»**
- è¿åæ— éšœç¢æ ‡å‡†ï¼ˆWCAG AAï¼‰

---

#### ğŸš¨ 2. **ç¼ºå¤±"æš‚ç”¨å…œåº•"å¾½æ ‡**

**æ–‡æ¡£7è¦æ±‚**ï¼š
> å½“å‰æ¿€æ´»ç­–ç•¥ï¼ˆåç§°ã€å‘½ä¸­/è€—æ—¶ï¼›è‹¥æ˜¯å…œåº•æ˜¾ç¤ºå¾½æ ‡"**æš‚ç”¨å…œåº•**"ï¼‰

**å®é™…ä»£ç **ï¼š
```tsx
// âŒ ç¼ºå¤±å¾½æ ‡æ˜¾ç¤º
<div className="unified-step-card__header">
  <div>{stepData.stepName}</div>
  {/* âš ï¸ æ²¡æœ‰æ˜¾ç¤º"æš‚ç”¨å…œåº•"å¾½æ ‡ */}
</div>
```

**éœ€è¦è¡¥å……**ï¼š
```tsx
// âœ… åº”è¯¥å®ç°
{stepData.isFallbackActive && (
  <Tag color="orange" icon={<ExclamationCircleOutlined />}>
    æš‚ç”¨å…œåº•
  </Tag>
)}
```

---

#### ğŸš¨ 3. **ç¼ºå¤±å€™é€‰ç­–ç•¥å±•ç¤ºåŒº**

**æ–‡æ¡£7è¦æ±‚**ï¼š
> å€™é€‰åŒºï¼ˆåˆ†æå®Œæˆåæ˜¾ç¤ºï¼‰ï¼šTop-3 å€™é€‰çš„"åˆ†æ•°/å‘½ä¸­/ç†ç”±/é¢„è§ˆ/è®¾ä¸ºæ¿€æ´»"

**å®é™…ä»£ç **ï¼š
- `universal-analysis-status-section.tsx` åªæ˜¾ç¤ºæ¨èç­–ç•¥çš„åç§°å’Œç½®ä¿¡åº¦
- **æ²¡æœ‰**å±•ç¤º Top-3 å€™é€‰åˆ—è¡¨
- **æ²¡æœ‰**"æŸ¥çœ‹Plan"åŠŸèƒ½
- **æ²¡æœ‰**"è®¾ä¸ºæ¿€æ´»"æ“ä½œ

**æ–‡æ¡£6çš„UIç»“æ„**å®Œå…¨ç¼ºå¤±ï¼š
```
â—‹ æ™ºèƒ½-å•æ­¥å›ºå®š
  â—‹ Step1 è‡ªæˆ‘é”šç‚¹ï¼ˆ95åˆ†ï¼‰  [åº”ç”¨æ­¤ç­–ç•¥]
  â—‹ Step2 å­æ ‘é”šç‚¹ï¼ˆ87åˆ†ï¼‰  [åº”ç”¨æ­¤ç­–ç•¥]
  â—‹ Step3 åŒºåŸŸé™å®šï¼ˆ82åˆ†ï¼‰  [åº”ç”¨æ­¤ç­–ç•¥]
```

---

#### ğŸš¨ 4. **ç¼ºå¤±å‘å¸ƒå‡†å¤‡åº¦é—¸é—¨**

**æ–‡æ¡£7è¦æ±‚**ï¼š
> å‘å¸ƒå¼¹çª—å±•ç¤ºï¼š
> - å·²å®Œæˆåˆ†æï¼š8/10
> - å¾…å®Œæˆï¼š2ï¼ˆåˆ—è¡¨æ˜¾ç¤º step åç§°ï¼‰
> - æŒ‰é’®ï¼š
>   - **ä¸€é”®å®Œæˆåˆ†æåå†å‘å¸ƒ**
>   - **ç›´æ¥å‘å¸ƒï¼ˆå¸¦å…œåº•/å¿«ç…§ï¼Œæ¥æ”¶æ–¹å¯é‡ç®—ï¼‰**

**å®é™…ä»£ç **ï¼š
- âŒ æ²¡æœ‰å‘å¸ƒå‡†å¤‡åº¦æ£€æŸ¥
- âŒ æ²¡æœ‰"ä¸€é”®å®Œæˆåˆ†æ"åŠŸèƒ½
- âŒ æ²¡æœ‰å‘å¸ƒå‰çš„å®Œæˆåº¦æ ¸å¯¹UI

---

#### ğŸš¨ 5. **ç­–ç•¥æ¨¡å¼åˆ†ç±»ä¸å®Œæ•´**

**æ–‡æ¡£6è¦æ±‚ä¸‰ç§æ¨¡å¼**ï¼š
1. æ™ºèƒ½åŒ¹é…ï¼ˆç»„åˆï¼‰
2. æ™ºèƒ½-å•æ­¥å›ºå®š
3. ç”¨æˆ·è‡ªå»ºé™æ€

**å®é™…ä»£ç **ï¼š
```tsx
// src/modules/universal-ui/types/intelligent-analysis-types.ts
export interface IntelligentStepCard {
  strategyMode: 'intelligent' | 'manual' | 'static_user';  // âœ… æœ‰è¿™ä¸ªå­—æ®µ
  // ...
}
```

âœ… ç±»å‹å®šä¹‰æœ‰  
âŒ UIä¸Šæ²¡æœ‰ä¸‰ç§æ¨¡å¼çš„åˆ‡æ¢æ§ä»¶  
âŒ æ²¡æœ‰"æ™ºèƒ½-å•æ­¥å›ºå®š"çš„ç‹¬ç«‹é€‰æ‹©åŒº

---

## ä¸‰ã€ğŸ”„ é‡å¤å†—ä½™é—®é¢˜

### ğŸš¨ **ä¸¥é‡å†—ä½™ï¼šå¤šä¸ªæ­¥éª¤å¡ç‰‡ç»„ä»¶**

#### å‘ç°çš„é‡å¤ç»„ä»¶ï¼š

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” | çŠ¶æ€ |
|---------|------|------|
| `src/modules/universal-ui/components/step-card-system/StepCardSystem.tsx` | å®Œæ•´ç³»ç»Ÿä¸»å…¥å£ | âœ… ä¿ç•™ |
| `src/modules/universal-ui/components/step-card-system/StepCardSystemClean.tsx` | æ¸…æ´ç‰ˆï¼ˆé‡å¤ï¼‰ | âš ï¸ å†—ä½™ |
| `src/modules/universal-ui/components/unified-step-card.tsx` | ç»Ÿä¸€å¡ç‰‡ï¼ˆé‡å¤ï¼‰ | âš ï¸ å†—ä½™ |
| `src/modules/universal-ui/components/intelligent-step-card.tsx` | æ™ºèƒ½å¡ç‰‡ï¼ˆé‡å¤ï¼‰ | âš ï¸ å†—ä½™ |
| `src/modules/universal-ui/ui/StepCard.tsx` | ç­–ç•¥é…ç½®å¡ç‰‡ | âš ï¸ åŠŸèƒ½é‡å  |
| `src/components/DraggableStepCard/*` | å¯æ‹–æ‹½å¡ç‰‡ | âœ… ä¿ç•™ï¼ˆè„šæœ¬æ„å»ºå™¨ä¸“ç”¨ï¼‰ |
| `src/modules/loop-control/components/LoopStepCard.tsx` | å¾ªç¯å¡ç‰‡ | âœ… ä¿ç•™ï¼ˆå¾ªç¯ä¸“ç”¨ï¼‰ |

#### é—®é¢˜åˆ†æï¼š

1. **StepCardSystem vs StepCardSystemClean**
   - ä¸¤ä¸ªæ–‡ä»¶å‡ ä¹å®Œå…¨ç›¸åŒ
   - éƒ½å£°ç§°æ˜¯"å®Œæ•´å®ç°ç‰ˆæœ¬"
   - éƒ½æœ‰ç›¸åŒçš„ Props å’Œé€»è¾‘

2. **UnifiedStepCard vs IntelligentStepCard**
   - åŠŸèƒ½é«˜åº¦é‡å 
   - éƒ½å¤„ç†æ™ºèƒ½åˆ†æçŠ¶æ€
   - æ¥å£ä¸ç»Ÿä¸€

3. **çŠ¶æ€å±•ç¤ºé€»è¾‘åˆ†æ•£**
   - `useStepCardIntelligent` (use-step-card-actions.ts)
   - `useStepCardAnalysis` (universal-use-step-card-analysis.ts)
   - ä¸¤ä¸ªHookåšç›¸åŒçš„äº‹

---

### ğŸš¨ **é‡å¤çš„ç±»å‹å®šä¹‰**

| æ–‡ä»¶ | ç±»å‹å | çŠ¶æ€ |
|------|--------|------|
| `ui/types/AnalysisStepCard.ts` | `StepCardAnalysisData` | æ—§ç‰ˆæœ¬ |
| `ui/types/universal-analysis-step-card.ts` | `UniversalStepCardAnalysisData` | æ–°ç‰ˆæœ¬ |
| `types/intelligent-analysis-types.ts` | `IntelligentStepCard` | æœ€æ–°ç‰ˆæœ¬ |

**é—®é¢˜**ï¼šä¸‰ä¸ªæ–‡ä»¶å®šä¹‰äº†å‡ ä¹ç›¸åŒçš„æ¥å£ï¼Œå­—æ®µç•¥æœ‰å·®å¼‚

---

### ğŸš¨ **é‡å¤çš„æ¼”ç¤ºé¡µé¢**

```
src/modules/universal-ui/pages/unified-step-card-demo.tsx
src/modules/universal-ui/pages/step-card-system-demo.tsx
src/modules/universal-ui/demo/universal-enhanced-step-card-demo.tsx
```

æ‰€æœ‰é¡µé¢éƒ½åœ¨æ¼”ç¤º"ç»Ÿä¸€æ­¥éª¤å¡ç‰‡"ï¼Œä½†ä½¿ç”¨ä¸åŒç»„ä»¶

---

## å››ã€ğŸ¯ é‡æ„å»ºè®®

### ğŸ¥‡ **ä¼˜å…ˆçº§1ï¼šä¿®å¤æ ·å¼é—®é¢˜ï¼ˆç«‹å³æ‰§è¡Œï¼‰**

#### 1.1 æ·»åŠ  `light-theme-force` ç±»

**ä¿®å¤æ–‡ä»¶**ï¼š`StepCardSystemClean.tsx` L230-280

```tsx
// âœ… ä¿®å¤å
<div 
  className={`light-theme-force unified-step-card__status-bar unified-step-card__status-bar--${çŠ¶æ€}`}
  style={{ 
    background: 'var(--bg-light-base, #ffffff)',  // ä½¿ç”¨è®¾è®¡ä»¤ç‰Œ
    // ...
  }}
>
```

#### 1.2 æ·»åŠ "æš‚ç”¨å…œåº•"å¾½æ ‡

```tsx
// åœ¨ StepCardHeader ä¸­æ·»åŠ 
{stepData.isFallbackActive && (
  <Tag 
    className="light-theme-force"
    color="orange" 
    icon={<ExclamationCircleOutlined />}
  >
    æš‚ç”¨å…œåº•
  </Tag>
)}
```

---

### ğŸ¥‡ **ä¼˜å…ˆçº§2ï¼šåˆå¹¶é‡å¤ç»„ä»¶ï¼ˆæœ¬å‘¨å®Œæˆï¼‰**

#### 2.1 ç»Ÿä¸€æ­¥éª¤å¡ç‰‡ç»„ä»¶

**å†³ç­–**ï¼š
```
ä¿ç•™ï¼šStepCardSystem (å®Œæ•´ç‰ˆ)
åˆ é™¤ï¼šStepCardSystemClean (é‡å¤)
åˆå¹¶ï¼šUnifiedStepCard â†’ StepCardSystem
åˆå¹¶ï¼šIntelligentStepCard â†’ StepCardSystem
```

**åˆå¹¶ç­–ç•¥**ï¼š
```tsx
// StepCardSystem ä½œä¸ºå”¯ä¸€å…¥å£
<StepCardSystem
  stepData={stepData}
  config={{
    enableIntelligent: true,  // å¼€å¯æ™ºèƒ½åˆ†æåŠŸèƒ½
    enableDrag: true,          // å¼€å¯æ‹–æ‹½åŠŸèƒ½
    // ...
  }}
/>
```

#### 2.2 ç»Ÿä¸€ç±»å‹å®šä¹‰

**å†³ç­–**ï¼š
```
ä¿ç•™ï¼štypes/intelligent-analysis-types.ts
åˆ é™¤ï¼šui/types/AnalysisStepCard.ts
åˆ é™¤ï¼šui/types/universal-analysis-step-card.ts
```

**è¿ç§»è·¯å¾„**ï¼š
```typescript
// æ‰€æœ‰åœ°æ–¹ç»Ÿä¸€ä½¿ç”¨
import type { IntelligentStepCard } from '@/modules/universal-ui/types/intelligent-analysis-types';
```

#### 2.3 åˆå¹¶çŠ¶æ€ç®¡ç†Hook

**å†³ç­–**ï¼š
```
ä¿ç•™ï¼šhooks/use-step-card-actions.ts (å·²åŒ…å« useStepCardIntelligent)
åˆ é™¤ï¼šui/hooks/universal-use-step-card-analysis.ts
```

---

### ğŸ¥ˆ **ä¼˜å…ˆçº§3ï¼šè¡¥é½ç¼ºå¤±åŠŸèƒ½ï¼ˆä¸‹å‘¨å®Œæˆï¼‰**

#### 3.1 å®ç°å€™é€‰ç­–ç•¥å±•ç¤ºåŒº

**æ–°å»ºç»„ä»¶**ï¼š
```tsx
// src/modules/universal-ui/ui/components/universal-strategy-candidates-section.tsx

export const UniversalStrategyCandidatesSection: React.FC<{
  candidates: StrategyInfo[];
  activeKey: string;
  onApply: (key: string) => void;
}> = ({ candidates, activeKey, onApply }) => {
  return (
    <div className="light-theme-force">
      <Divider>æ™ºèƒ½å€™é€‰ç­–ç•¥</Divider>
      <Space direction="vertical" style={{ width: '100%' }}>
        {candidates.map(candidate => (
          <Card 
            key={candidate.key}
            size="small"
            className={activeKey === candidate.key ? 'active' : ''}
          >
            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
              <Space>
                <Tag color={candidate.isRecommended ? 'success' : 'default'}>
                  {Math.round(candidate.confidence * 100)}åˆ†
                </Tag>
                <Text strong>{candidate.name}</Text>
              </Space>
              <Button 
                size="small" 
                type={activeKey === candidate.key ? 'primary' : 'default'}
                onClick={() => onApply(candidate.key)}
              >
                {activeKey === candidate.key ? 'å½“å‰ç­–ç•¥' : 'åº”ç”¨æ­¤ç­–ç•¥'}
              </Button>
            </div>
            <Text type="secondary" style={{ fontSize: 12 }}>
              {candidate.description}
            </Text>
          </Card>
        ))}
      </Space>
    </div>
  );
};
```

#### 3.2 å®ç°ç­–ç•¥æ¨¡å¼åˆ‡æ¢

**UIç»“æ„**ï¼š
```tsx
<Radio.Group value={stepData.strategyMode} onChange={handleModeChange}>
  <Radio.Button value="intelligent">
    æ™ºèƒ½åŒ¹é…ï¼ˆæ¨èï¼‰
  </Radio.Button>
  <Radio.Button value="manual">
    æ™ºèƒ½-å•æ­¥å›ºå®š
  </Radio.Button>
  <Radio.Button value="static_user">
    ç”¨æˆ·è‡ªå»ºé™æ€
  </Radio.Button>
</Radio.Group>

{/* æ ¹æ®æ¨¡å¼æ˜¾ç¤ºä¸åŒçš„å€™é€‰åŒº */}
{strategyMode === 'intelligent' && <IntelligentModeSection />}
{strategyMode === 'manual' && <ManualModeSection />}
{strategyMode === 'static_user' && <StaticModeSection />}
```

#### 3.3 å®ç°å‘å¸ƒå‡†å¤‡åº¦é—¸é—¨

**æ–°å»ºç»„ä»¶**ï¼š
```tsx
// src/modules/universal-ui/ui/components/universal-publish-readiness-gate.tsx

export const UniversalPublishReadinessGate: React.FC<{
  steps: IntelligentStepCard[];
  onPublish: () => void;
  onCompleteAnalysis: () => Promise<void>;
}> = ({ steps, onPublish, onCompleteAnalysis }) => {
  const completedCount = steps.filter(s => s.analysisState === 'analysis_completed').length;
  const pendingSteps = steps.filter(s => 
    s.analysisState === 'pending_analysis' || 
    s.analysisState === 'idle'
  );
  
  return (
    <Modal title="å‘å¸ƒå‡†å¤‡åº¦æ£€æŸ¥" visible open>
      <Space direction="vertical" style={{ width: '100%' }}>
        <Alert
          type={pendingSteps.length === 0 ? 'success' : 'warning'}
          message={`å·²å®Œæˆåˆ†æï¼š${completedCount}/${steps.length}`}
          description={
            pendingSteps.length > 0 && (
              <div>
                <Text>å¾…å®Œæˆï¼š{pendingSteps.length}</Text>
                <ul>
                  {pendingSteps.map(s => <li key={s.stepId}>{s.stepName}</li>)}
                </ul>
              </div>
            )
          }
        />
        
        <Space>
          <Button 
            type="primary" 
            loading={false}
            onClick={async () => {
              await onCompleteAnalysis();
              onPublish();
            }}
          >
            ä¸€é”®å®Œæˆåˆ†æåå†å‘å¸ƒ
          </Button>
          <Button onClick={onPublish}>
            ç›´æ¥å‘å¸ƒï¼ˆå¸¦å…œåº•/å¿«ç…§ï¼‰
          </Button>
        </Space>
      </Space>
    </Modal>
  );
};
```

---

## äº”ã€âœ… éªŒæ”¶æ ‡å‡†ï¼ˆDoDï¼‰

### é˜¶æ®µ1ï¼šæ ·å¼ä¿®å¤ âœ…
- [ ] æ‰€æœ‰çŠ¶æ€æ¡æ·»åŠ  `light-theme-force` ç±»
- [ ] å¯¹æ¯”åº¦æ»¡è¶³ WCAG AA æ ‡å‡†ï¼ˆ4.5:1ï¼‰
- [ ] æ·»åŠ "æš‚ç”¨å…œåº•"å¾½æ ‡
- [ ] è§†è§‰å›å½’æµ‹è¯•é€šè¿‡

### é˜¶æ®µ2ï¼šé‡å¤å†—ä½™æ¶ˆé™¤ âœ…
- [ ] åªä¿ç•™ä¸€ä¸ªä¸»æ­¥éª¤å¡ç‰‡ç»„ä»¶ï¼ˆStepCardSystemï¼‰
- [ ] ç»Ÿä¸€ç±»å‹å®šä¹‰ï¼ˆIntelligentStepCardï¼‰
- [ ] åˆå¹¶çŠ¶æ€ç®¡ç†Hook
- [ ] åˆ é™¤é‡å¤æ¼”ç¤ºé¡µé¢
- [ ] æ›´æ–°æ‰€æœ‰å¼•ç”¨

### é˜¶æ®µ3ï¼šåŠŸèƒ½è¡¥é½ âœ…
- [ ] å®ç°å€™é€‰ç­–ç•¥å±•ç¤ºåŒºï¼ˆTop-3 + è¯¦æƒ…ï¼‰
- [ ] å®ç°ç­–ç•¥æ¨¡å¼åˆ‡æ¢ï¼ˆæ™ºèƒ½åŒ¹é…/å•æ­¥å›ºå®š/ç”¨æˆ·è‡ªå»ºï¼‰
- [ ] å®ç°å‘å¸ƒå‡†å¤‡åº¦é—¸é—¨
- [ ] æ”¯æŒ"æŸ¥çœ‹Plan"åŠŸèƒ½
- [ ] æ”¯æŒ"è®¾ä¸ºæ¿€æ´»"æ“ä½œ

---

## å…­ã€ğŸ“Š å½±å“è¯„ä¼°

### é£é™©ç­‰çº§ï¼šğŸŸ¡ ä¸­ç­‰

**é«˜é£é™©åŒºåŸŸ**ï¼š
- åˆ é™¤é‡å¤ç»„ä»¶å¯èƒ½å½±å“ç°æœ‰å¼•ç”¨ï¼ˆéœ€å…¨å±€æœç´¢æ›¿æ¢ï¼‰
- ç±»å‹å®šä¹‰åˆå¹¶å¯èƒ½å¯¼è‡´ TypeScript é”™è¯¯

**ä½é£é™©åŒºåŸŸ**ï¼š
- æ ·å¼ä¿®å¤ï¼ˆåªåŠ ç±»åï¼Œä¸æ”¹é€»è¾‘ï¼‰
- æ–°å¢ç»„ä»¶ï¼ˆä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼‰

### å·¥ä½œé‡ä¼°ç®—ï¼š

| é˜¶æ®µ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|------|--------|--------|
| æ ·å¼ä¿®å¤ | 2å°æ—¶ | ğŸ”´ ç´§æ€¥ |
| é‡å¤å†—ä½™æ¶ˆé™¤ | 1å¤© | ğŸŸ  é«˜ |
| åŠŸèƒ½è¡¥é½ | 2-3å¤© | ğŸŸ¡ ä¸­ |

---

## ä¸ƒã€ğŸ¯ æ€»ç»“

### æ–‡æ¡£è¦æ±‚ vs å®é™…å®ç°å¯¹æ¯”è¡¨

| åŠŸèƒ½éœ€æ±‚ | æ–‡æ¡£è¦æ±‚ | å®é™…å®ç° | çŠ¶æ€ |
|---------|---------|---------|------|
| é¡¶éƒ¨çŠ¶æ€æ¡ | âœ… 4ç§çŠ¶æ€ + é¢œè‰² | âœ… å·²å®ç° | âš ï¸ ç¼º `light-theme-force` |
| è¿›åº¦å±•ç¤º | âœ… è¿›åº¦æ¡ + ç™¾åˆ†æ¯” | âœ… å·²å®ç° | âœ… å®Œæ•´ |
| æš‚ç”¨å…œåº•å¾½æ ‡ | âœ… å¿…é¡»æ˜¾ç¤º | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± |
| å€™é€‰ç­–ç•¥å±•ç¤º | âœ… Top-3 + è¯¦æƒ… | âŒ åªæ˜¾ç¤ºæ¨è | ğŸ”´ ç¼ºå¤± |
| ç­–ç•¥æ¨¡å¼åˆ‡æ¢ | âœ… 3ç§æ¨¡å¼ | âŒ æ— åˆ‡æ¢UI | ğŸ”´ ç¼ºå¤± |
| å‘å¸ƒå‡†å¤‡åº¦é—¸é—¨ | âœ… å®Œæˆåº¦æ ¸å¯¹ | âŒ æœªå®ç° | ğŸ”´ ç¼ºå¤± |
| ä¸€é”®å‡çº§ | âœ… å¿…é¡»æœ‰ | âœ… å·²å®ç° | âœ… å®Œæ•´ |
| é˜²ä¸²æ‰°æœºåˆ¶ | âœ… ä¸‰é‡æ ¡éªŒ | âš ï¸ éƒ¨åˆ†å®ç° | ğŸŸ¡ å¾…éªŒè¯ |

### é‡å¤å†—ä½™ç»Ÿè®¡

- ğŸš¨ **é‡å¤ç»„ä»¶**ï¼š4ä¸ª
- ğŸš¨ **é‡å¤ç±»å‹å®šä¹‰**ï¼š3ä¸ª
- ğŸš¨ **é‡å¤Hook**ï¼š2ä¸ª
- ğŸš¨ **é‡å¤æ¼”ç¤ºé¡µé¢**ï¼š3ä¸ª

### æœ€ç»ˆå»ºè®®

> **ä¸éœ€è¦é‡æ„"æ–°ç‰ˆæœ¬"ï¼Œä½†éœ€è¦ç«‹å³æ¶ˆé™¤é‡å¤å¹¶è¡¥é½ç¼ºå¤±åŠŸèƒ½**

1. **ç«‹å³ä¿®å¤**ï¼šæ ·å¼é—®é¢˜ï¼ˆç™½åº•ç™½å­—é£é™©ï¼‰
2. **æœ¬å‘¨å®Œæˆ**ï¼šåˆå¹¶é‡å¤ç»„ä»¶ï¼Œç»Ÿä¸€ä¸º StepCardSystem
3. **ä¸‹å‘¨å®Œæˆ**ï¼šè¡¥é½å€™é€‰åŒºã€æ¨¡å¼åˆ‡æ¢ã€å‘å¸ƒé—¸é—¨

---

## é™„å½•ï¼šå¿«é€Ÿä¿®å¤è„šæœ¬

### A1. æ‰¹é‡æ·»åŠ  `light-theme-force` ç±»

```bash
# æœç´¢æ‰€æœ‰éœ€è¦ä¿®å¤çš„æ–‡ä»¶
grep -r "background.*#e6f7ff\|background.*#fff7e6\|background.*#fff2f0" src/modules/universal-ui --include="*.tsx" -l

# æ‰‹åŠ¨ä¿®å¤æ¯ä¸ªæ–‡ä»¶ï¼Œæ·»åŠ  className="light-theme-force"
```

### A2. åˆ é™¤é‡å¤ç»„ä»¶

```bash
# å¤‡ä»½ååˆ é™¤
git mv src/modules/universal-ui/components/step-card-system/StepCardSystemClean.tsx \
       src/modules/universal-ui/components/step-card-system/_archived_StepCardSystemClean.tsx

# æ›´æ–°æ‰€æœ‰å¼•ç”¨
grep -r "StepCardSystemClean" src --include="*.tsx" --include="*.ts"
# æ‰‹åŠ¨æ›¿æ¢ä¸º StepCardSystem
```

---

**æŠ¥å‘Šç»“æŸ** ğŸ“‹
