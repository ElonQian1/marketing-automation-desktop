è®©æˆ‘è¯¦ç»†åˆ†æ V2 æ¶æ„çš„ç»“æ„å’Œç»„ç»‡ï¼š 

è¯»å– [](file:///d%3A/rust/active-projects/%E5%B0%8F%E7%BA%A2%E4%B9%A6/employeeGUI/src-tauri/src/commands/run_step_v2.rs#1-1)ï¼Œè¡Œ 1 åˆ° 51

æœç´¢ `V2|run_step_v2` (`**/src-tauri/src/commands/**`)ã€20 ç»“æœçš„æ–‡æœ¬

è¯»å– [](file:///d%3A/rust/active-projects/%E5%B0%8F%E7%BA%A2%E4%B9%A6/employeeGUI/src-tauri/src/commands)

è¯»å– [](file:///d%3A/rust/active-projects/%E5%B0%8F%E7%BA%A2%E4%B9%A6/employeeGUI/src-tauri/src/commands/mod.rs#1-1)ï¼Œè¡Œ 1 åˆ° 41

æœç´¢ `run_step_v2|V2` (`**/src-tauri/src/main.rs`)ã€15 ç»“æœçš„æ–‡æœ¬

å·²åœ¨ ä»£ç åº“ ä¸­æœç´¢ "V2 architecture legacy simple selection engine strategy"ã€2 ç»“æœ

ç°åœ¨è®©æˆ‘çœ‹ä¸€ä¸‹æ”¯æŒ V2 æ¶æ„çš„æ ¸å¿ƒæ–‡ä»¶ï¼š 

æœç´¢ `legacy.*selection|simple.*selection` (`**/src-tauri/src/services/**`)ã€4 ç»“æœçš„æ–‡æœ¬

è¯»å– [](file:///d%3A/rust/active-projects/%E5%B0%8F%E7%BA%A2%E4%B9%A6/employeeGUI/src-tauri/src/services/legacy_simple_selection_engine.rs#1-1)ï¼Œè¡Œ 1 åˆ° 81

åŸºäºæœç´¢å’Œåˆ†æï¼Œè¿™æ˜¯ **V2 æ¶æ„çš„å®Œæ•´æ¦‚è§ˆ**ï¼š

## ğŸ—ï¸ V2 æ¶æ„æ€»è§ˆ

### ğŸ“ ç›®å½•ç»“æ„

```
src-tauri/src/commands/
â”œâ”€â”€ run_step_v2.rs              # ğŸ¯ V2 æ¶æ„æ ¸å¿ƒæ–‡ä»¶ (1968è¡Œ)
â”œâ”€â”€ step_execution.rs           # ç»Ÿä¸€æ­¥éª¤æ‰§è¡Œå‘½ä»¤
â”œâ”€â”€ intelligent_analysis.rs     # æ™ºèƒ½åˆ†æå‘½ä»¤
â”œâ”€â”€ strategy_matching.rs        # ç­–ç•¥åŒ¹é…å‘½ä»¤
â”œâ”€â”€ smart_selection.rs          # æ™ºèƒ½é€‰æ‹©ç³»ç»Ÿå‘½ä»¤
â””â”€â”€ mod.rs                     # å‘½ä»¤æ¨¡å—å¯¼å‡º

src-tauri/src/services/
â”œâ”€â”€ legacy_simple_selection_engine.rs  # âš ï¸ å·²å¼ƒç”¨çš„ç®€åŒ–é€‰æ‹©å¼•æ“
â”œâ”€â”€ smart_script_executor.rs            # æ™ºèƒ½è„šæœ¬æ‰§è¡Œå™¨
â”œâ”€â”€ execution/                          # æ‰§è¡Œç›¸å…³æœåŠ¡
â”‚   â”œâ”€â”€ matching/                       # åŒ¹é…ç­–ç•¥
â”‚   â””â”€â”€ model/                          # æ‰§è¡Œæ¨¡å‹
â””â”€â”€ ...

src-tauri/src/engine/
â”œâ”€â”€ strategy_engine.rs          # ç­–ç•¥å¼•æ“
â”œâ”€â”€ strategy_plugin.rs          # ç­–ç•¥æ’ä»¶ç³»ç»Ÿ
â”œâ”€â”€ strategy_plugin_v2.rs       # V2 ç­–ç•¥æ’ä»¶
â”œâ”€â”€ xml_indexer.rs              # XML ç´¢å¼•å™¨
â””â”€â”€ gating.rs                   # å®‰å…¨æ£€æŸ¥
```

## ğŸ¯ V2 æ¶æ„ç‰¹ç‚¹

### **1. å•æ–‡ä»¶å·¨çŸ³æ¶æ„**
- **æ ¸å¿ƒæ–‡ä»¶**: run_step_v2.rs (1968è¡Œä»£ç )
- **ç‰¹ç‚¹**: æ‰€æœ‰ V2 é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­
- **åŒ…å«**: ç±»å‹å®šä¹‰ã€æ‰§è¡Œé€»è¾‘ã€ç­–ç•¥å¤„ç†ã€å®‰å…¨æ£€æŸ¥

### **2. ä¸‰æ¡æ‰§è¡Œé“¾**
```rust
// V2 æ‰§è¡Œæ¨¡å¼
pub enum StepRunMode {
    MatchOnly,      // ä»…åŒ¹é…ï¼Œä¸æ‰§è¡Œ
    Execute,        // å®Œæ•´æ‰§è¡Œ
    Static,         // é™æ€åˆ†æ
}
```

### **3. ç­–ç•¥ç³»ç»Ÿ**
```rust
// V2 ç­–ç•¥ç±»å‹
pub enum StrategyKind {
    Simple,         // ç®€å•åŒ¹é…
    Enhanced,       // å¢å¼ºåŒ¹é…  
    Legacy,         // é—ç•™ç³»ç»Ÿ
    Intelligent,    // æ™ºèƒ½åˆ†æ
}
```

## ğŸ”§ V2 æ ¸å¿ƒç»„ä»¶åˆ†æ

### **ä¸»è¦ç±»å‹å®šä¹‰**
```rust
// V2 è¯·æ±‚ç»“æ„
pub struct RunStepRequestV2 {
    pub device_id: String,
    pub mode: StepRunMode,
    pub strategy: StrategyKind,
    pub step: serde_json::Value,
    // ... å…¶ä»–å­—æ®µ
}

// V2 å“åº”ç»“æ„
pub struct StepResponseV2 {
    pub success: bool,
    pub message: String,
    pub candidates: Option<Vec<MatchCandidate>>,
    pub execution_time_ms: i64,
    // ... å…¶ä»–å­—æ®µ
}
```

### **æ‰§è¡Œæµç¨‹**
```
å‰ç«¯è°ƒç”¨ run_step_v2 â†’
execute_v2_step() å¤„ç† â†’
ç­–ç•¥é€‰æ‹©ä¸åŒ¹é… â†’
å®‰å…¨æ£€æŸ¥ (SafetyGatekeeper) â†’
æ‰§è¡ŒåŠ¨ä½œ â†’
è¿”å›ç»“æœ
```

## ğŸ›ï¸ V2 vs V3 æ¶æ„å¯¹æ¯”

| ç»´åº¦ | V2 æ¶æ„ | V3 æ¶æ„ |
|---|---|---|
| **æ–‡ä»¶ç»„ç»‡** | å•æ–‡ä»¶å·¨çŸ³ (run_step_v2.rs) | æ¨¡å—åŒ–ç›®å½• (`exec/v3/`) |
| **ä»£ç è¡Œæ•°** | ~2000è¡Œå•æ–‡ä»¶ | åˆ†æ•£åœ¨å¤šä¸ªä¸“ä¸šæ–‡ä»¶ |
| **ç±»å‹ç³»ç»Ÿ** | ç´§è€¦åˆåœ¨å‘½ä»¤æ–‡ä»¶ä¸­ | ç‹¬ç«‹çš„ types.rs |
| **äº‹ä»¶ç³»ç»Ÿ** | åŸºç¡€æ—¥å¿— | ç»“æ„åŒ–äº‹ä»¶æµ (events.rs) |
| **æ‰§è¡Œæ¨¡å¼** | ä¸‰ç§æ¨¡å¼æ··åˆ | æ¸…æ™°çš„å•æ­¥/é“¾å¼/é™æ€åˆ†ç¦» |
| **ç­–ç•¥åˆ†æ** | ç®€åŒ–ç‰ˆæœ¬ | å®Œæ•´ Step 0-6 åˆ†æ |
| **æ‰©å±•æ€§** | ä¿®æ”¹éœ€è¦æ”¹åŠ¨æ ¸å¿ƒæ–‡ä»¶ | æ¨¡å—åŒ–ï¼Œæ˜“äºæ‰©å±• |
| **æµ‹è¯•æ€§** | éš¾ä»¥å•å…ƒæµ‹è¯• | ç»„ä»¶åŒ–ï¼Œä¾¿äºæµ‹è¯• |

## ğŸ“‹ V2 æ¶æ„çš„ä¸»è¦é—®é¢˜

### **1. ä»£ç ç»„ç»‡é—®é¢˜**
- ğŸš¨ **å·¨çŸ³æ¶æ„**: å•ä¸ªæ–‡ä»¶ 1968 è¡Œä»£ç 
- ğŸš¨ **èŒè´£æ··æ‚**: ç±»å‹å®šä¹‰ã€ä¸šåŠ¡é€»è¾‘ã€æ‰§è¡Œå™¨éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶
- ğŸš¨ **éš¾ä»¥ç»´æŠ¤**: ä¿®æ”¹ä»»ä½•åŠŸèƒ½éƒ½éœ€è¦ç¼–è¾‘æ ¸å¿ƒæ–‡ä»¶

### **2. ä¾èµ–æ··ä¹±**
```rust
// V2 æ–‡ä»¶ä¸­æ··æ‚äº†å¤šç§ä¾èµ–
use crate::engine::{FallbackController, XmlIndexer, SafetyGatekeeper};
use crate::engine::strategy_plugin::{StrategyRegistry, ExecutionEnvironment};
use crate::services::ui_reader_service::{get_ui_dump, UIElement};
// ... å¤§é‡å…¶ä»–ä¾èµ–
```

### **3. ç±»å‹ç³»ç»Ÿè€¦åˆ**
- ç±»å‹å®šä¹‰ä¸å®ç°é€»è¾‘æ··åˆ
- éš¾ä»¥åœ¨å…¶ä»–æ¨¡å—ä¸­å¤ç”¨ç±»å‹
- å‰ç«¯æ¥å£å˜æ›´å½±å“æ ¸å¿ƒé€»è¾‘

## ğŸ¯ V2 é—ç•™ç³»ç»Ÿ

### **Legacy Components**
```rust
// å·²å¼ƒç”¨ä½†ä»å­˜åœ¨çš„ç»„ä»¶
legacy_simple_selection_engine.rs  // âš ï¸ ç®€åŒ–é€‰æ‹©å¼•æ“
strategy_plugin_v2.rs              // V2 ç­–ç•¥æ’ä»¶  
xml_indexer.rs                     // XML ç´¢å¼•å™¨ï¼ˆV2 ç±»å‹ï¼‰
```

### **Tauri å‘½ä»¤æ¥å£**
```rust
// åœ¨ main.rs ä¸­æ³¨å†Œçš„ V2 å‘½ä»¤
run_step_v2                        // V2 ç»Ÿä¸€æ­¥éª¤æ‰§è¡Œ
start_intelligent_analysis         // V2 æ™ºèƒ½åˆ†æå…¥å£
cancel_intelligent_analysis        // V2 å–æ¶ˆåˆ†ææ“ä½œ
bind_analysis_result_to_step       // V2 æ‰‹åŠ¨ç»‘å®šåˆ†æç»“æœ
```

## ğŸš€ è¿ç§»å»ºè®®

### **ä» V2 åˆ° V3 çš„è¿ç§»è·¯å¾„**
```typescript
// V2 è°ƒç”¨æ–¹å¼
await invoke('run_step_v2', {
  device_id: 'emulator-5554',
  mode: 'Execute',
  strategy: 'Intelligent',
  step: stepData
});

// V3 è°ƒç”¨æ–¹å¼ (æ¨è)
await invoke('execute_chain_test_v3', {
  deviceId: 'emulator-5554',
  steps: [stepData],
  threshold: 0.72,
  dryRun: false
});
```

## ğŸ“Š V2 æ¶æ„æ€»ç»“

**V2 æ¶æ„çš„æœ¬è´¨**:
- **å‘½ä»¤å¼æ¶æ„**: ä»¥ Tauri å‘½ä»¤ä¸ºä¸­å¿ƒçš„å•æ–‡ä»¶å®ç°
- **åŠŸèƒ½å®Œæ•´**: è™½ç„¶æ¶æ„æœ‰é—®é¢˜ï¼Œä½†åŠŸèƒ½ç›¸å¯¹å®Œæ•´
- **å‘åå…¼å®¹**: ä¿ç•™ä½œä¸º V3 çš„å›é€€é€‰é¡¹
- **ç»´æŠ¤çŠ¶æ€**: å¤„äºç»´æŠ¤æ¨¡å¼ï¼Œä¸å†æ–°å¢åŠŸèƒ½

**é€‚ç”¨åœºæ™¯**:
- ç°æœ‰åŠŸèƒ½çš„å‘åå…¼å®¹
- V3 ç³»ç»Ÿæ•…éšœæ—¶çš„å›é€€æ–¹æ¡ˆ
- ç®€å•çš„å•æ­¥æ‰§è¡Œéœ€æ±‚

V2 æ¶æ„è™½ç„¶å­˜åœ¨æ˜æ˜¾çš„è®¾è®¡é—®é¢˜ï¼Œä½†åœ¨è¿‡æ¸¡æœŸä»ç„¶å‘æŒ¥ç€é‡è¦çš„ç¨³å®šæ€§ä½œç”¨ï¼