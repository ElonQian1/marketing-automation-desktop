# æ‰§è¡Œæµç¨‹æ§åˆ¶åŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼š"åœ¨æ‰€æœ‰å¡ç‰‡é‚£é‡Œå¢åŠ ä¸€ä¸ªå‚æ•°é…ç½®é€‰é¡¹ã€‚å¯ä»¥é€‰æ‹©è¿™ä¸€æ­¥å¤±è´¥äº†ç»“æŸæ•´ä¸ªè„šæœ¬ï¼Œè¿˜æ˜¯ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œæˆ–è€…è·³è½¬åˆ°å“ªä¸€æ­¥"ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†å®Œæ•´çš„æ‰§è¡Œæµç¨‹æ§åˆ¶æ¨¡å—ã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒæ¨¡å—æ¶æ„ (DDD åˆ†å±‚)

```
src/modules/execution-flow-control/
â”œâ”€â”€ domain/                   # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ failure-handling-strategy.ts      # å¤±è´¥å¤„ç†ç­–ç•¥æšä¸¾å’ŒéªŒè¯
â”‚   â””â”€â”€ extended-step-types.ts           # æ‰©å±•æ­¥éª¤ç±»å‹å®šä¹‰
â”œâ”€â”€ application/              # åº”ç”¨å±‚
â”‚   â””â”€â”€ execution-flow-use-case.ts       # æ‰§è¡Œæµç¨‹æ§åˆ¶å™¨
â”œâ”€â”€ services/                 # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ execution-flow-decision-service.ts  # å¤±è´¥å†³ç­–æœåŠ¡
â”‚   â””â”€â”€ execution-engine-integration.ts    # æ‰§è¡Œå¼•æ“é›†æˆ
â”œâ”€â”€ ui/                       # UIå±‚
â”‚   â”œâ”€â”€ execution-failure-config.tsx     # å¤±è´¥å¤„ç†é…ç½®ç»„ä»¶
â”‚   â””â”€â”€ step-failure-config-panel.tsx    # æ­¥éª¤å¤±è´¥é…ç½®é¢æ¿
â”œâ”€â”€ hooks/                    # React Hooks
â”‚   â””â”€â”€ use-execution-flow-control.ts    # æ‰§è¡Œæµç¨‹æ§åˆ¶é’©å­
â”œâ”€â”€ utils/                    # å·¥å…·å±‚
â”‚   â””â”€â”€ step-type-adapter.ts             # ç±»å‹é€‚é…å™¨
â””â”€â”€ index.ts                  # ç»Ÿä¸€å¯¼å‡º
```

### 2. å¤±è´¥å¤„ç†ç­–ç•¥

å®ç°äº† 5 ç§å¤±è´¥å¤„ç†ç­–ç•¥ï¼š

- **STOP_SCRIPT**: åœæ­¢æ•´ä¸ªè„šæœ¬æ‰§è¡Œ
- **CONTINUE_NEXT**: ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥
- **JUMP_TO_STEP**: è·³è½¬åˆ°æŒ‡å®šæ­¥éª¤
- **RETRY_CURRENT**: é‡è¯•å½“å‰æ­¥éª¤
- **SKIP_CURRENT**: è·³è¿‡å½“å‰æ­¥éª¤

### 3. æ•°æ®æ¨¡å‹æ‰©å±•

æ‰©å±•äº† `ExtendedSmartScriptStep` ç±»å‹ï¼š

```typescript
interface ExtendedSmartScriptStep {
  // ... åŸæœ‰å­—æ®µ
  
  // âš¡ æ‰§è¡Œæµç¨‹æ§åˆ¶æ”¯æŒ
  failureHandling?: {
    strategy: 'STOP_SCRIPT' | 'CONTINUE_NEXT' | 'JUMP_TO_STEP' | 'RETRY_CURRENT' | 'SKIP_CURRENT';
    jumpTarget?: string; // è·³è½¬ç›®æ ‡æ­¥éª¤ID
    retryCount?: number; // é‡è¯•æ¬¡æ•°
    retryDelay?: number; // é‡è¯•é—´éš”(ms)
    enabled: boolean; // æ˜¯å¦å¯ç”¨å¤±è´¥å¤„ç†
  };
}
```

### 4. UI ç»„ä»¶é›†æˆ

#### ExecutionFailureConfig ç»„ä»¶
- æ”¯æŒå¼¹çª—/è¡Œå†…ä¸¤ç§æ˜¾ç¤ºæ¨¡å¼
- æ™ºèƒ½è¡¨å•éªŒè¯
- è·³è½¬ç›®æ ‡æ­¥éª¤é€‰æ‹©å™¨
- é‡è¯•æ¬¡æ•°å’Œå»¶æ—¶é…ç½®

#### StepFailureConfigPanel é¢æ¿
- å®Œæ•´çš„é…ç½®ç•Œé¢
- ç­–ç•¥è¯´æ˜å’Œå¸®åŠ©ä¿¡æ¯
- çŠ¶æ€æŒ‡ç¤ºå™¨

#### ModernStepCard é›†æˆ
- åœ¨æ­¥éª¤å¡ç‰‡ä¸­æ·»åŠ å¤±è´¥å¤„ç†é…ç½®æŒ‰é’®
- å¼¹çª—å¼é…ç½®ç•Œé¢
- è§†è§‰æŒ‡ç¤ºå™¨æ˜¾ç¤ºé…ç½®çŠ¶æ€

### 5. ç±»å‹é€‚é…å’Œå·¥å…·

#### step-type-adapter.ts
æä¾›å®Œæ•´çš„ç±»å‹è½¬æ¢åŠŸèƒ½ï¼š
- `extractFailureConfigFromStep()` - æå–å¤±è´¥é…ç½®
- `applyFailureConfigToStep()` - åº”ç”¨å¤±è´¥é…ç½®
- `hasValidFailureHandling()` - æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆé…ç½®
- `getStepFailureStrategy()` - è·å–å¤±è´¥ç­–ç•¥

### 6. React Hooks API

#### useExecutionFlowControl
```typescript
const {
  state,
  startExecution,
  pauseExecution,
  resumeExecution,
  stopExecution,
  setStepFailureHandling,
  clearStepFailureHandling,
  getExecutionStats
} = useExecutionFlowControl(steps, options);
```

#### useStepFailureHandling
```typescript
const {
  config,
  updateConfig,
  resetConfig,
  hasConfig
} = useStepFailureHandling(stepId, initialConfig);
```

### 7. æ‰§è¡Œå¼•æ“é›†æˆ

#### EnhancedScriptExecutor ç±»
- æ£€æµ‹å¤±è´¥å¤„ç†é…ç½®
- è‡ªåŠ¨åº”ç”¨å¤±è´¥ç­–ç•¥
- ä¸ç°æœ‰æ‰§è¡Œé€»è¾‘å…¼å®¹
- è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—

#### é›†æˆåŠŸèƒ½
- `hasFailureHandlingSteps()` - æ£€æŸ¥è„šæœ¬æ˜¯å¦åŒ…å«å¤±è´¥å¤„ç†
- `getFailureHandlingSummary()` - è·å–é…ç½®æ‘˜è¦
- `createEnhancedExecuteScript()` - åˆ›å»ºå¢å¼ºæ‰§è¡Œå™¨

### 8. æµ‹è¯•éªŒè¯

#### ExecutionFlowTestPage
å®Œæ•´çš„æµ‹è¯•é¡µé¢åŒ…å«ï¼š
- é¢„è®¾æµ‹è¯•åœºæ™¯
- æ¨¡æ‹Ÿæ‰§è¡Œå™¨
- å®æ—¶æ—¥å¿—æ˜¾ç¤º
- ç­–ç•¥æ•ˆæœéªŒè¯

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### 1. **å®Œå…¨å‘åå…¼å®¹**
- ç°æœ‰æ­¥éª¤æ— éœ€ä¿®æ”¹
- æœªé…ç½®å¤±è´¥å¤„ç†çš„æ­¥éª¤ä½¿ç”¨é»˜è®¤è¡Œä¸º
- æ¸è¿›å¼é‡‡ç”¨

### 2. **DDD æ¶æ„**
- æ¸…æ™°çš„åˆ†å±‚ç»“æ„
- é«˜å†…èšä½è€¦åˆ
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•

### 3. **ç±»å‹å®‰å…¨**
- å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- IntelliSense æ”¯æŒ

### 4. **ç”¨æˆ·å‹å¥½**
- ç›´è§‚çš„é…ç½®ç•Œé¢
- æ™ºèƒ½éªŒè¯å’Œæç¤º
- ä¸€é”®å¼é…ç½®

### 5. **å¯è§‚æµ‹æ€§**
- è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—
- ç­–ç•¥å†³ç­–è·Ÿè¸ª
- ç»Ÿè®¡ä¿¡æ¯æ”¶é›†

## ğŸ“ å…³é”®æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒå®ç°æ–‡ä»¶
1. `src/modules/execution-flow-control/domain/failure-handling-strategy.ts` - å¤±è´¥ç­–ç•¥å®šä¹‰
2. `src/modules/execution-flow-control/ui/execution-failure-config.tsx` - é…ç½®ç»„ä»¶
3. `src/modules/execution-flow-control/utils/step-type-adapter.ts` - ç±»å‹é€‚é…å™¨
4. `src/types/loopScript.ts` - æ‰©å±•çš„æ­¥éª¤ç±»å‹å®šä¹‰

### é›†æˆæ–‡ä»¶
1. `src/components/step-cards/ModernStepCard.tsx` - æ­¥éª¤å¡ç‰‡é›†æˆ
2. `src/modules/execution-flow-control/services/execution-engine-integration.ts` - æ‰§è¡Œå¼•æ“é›†æˆ

### æµ‹è¯•æ–‡ä»¶
1. `src/pages/ExecutionFlowTestPage.tsx` - åŠŸèƒ½æµ‹è¯•é¡µé¢

### é…ç½®æ–‡ä»¶
1. `tsconfig.app.json` - æ·»åŠ äº†è·¯å¾„åˆ«å `@execution-flow/*`
2. `src/modules/execution-flow-control/index.ts` - ç»Ÿä¸€å¯¼å‡º

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åŸºç¡€ç”¨æ³•

```typescript
import { ModernStepCard } from '../components/step-cards/ModernStepCard';

// åœ¨æ­¥éª¤å¡ç‰‡ä¸­ä½¿ç”¨
<ModernStepCard
  step={step}
  index={index}
  allSteps={allSteps}
  onStepUpdate={handleStepUpdate}
/>
```

### 2. ç¼–ç¨‹å¼é…ç½®

```typescript
import { 
  applyFailureConfigToStep,
  ExecutionFailureStrategy 
} from '@execution-flow/*';

const updatedStep = applyFailureConfigToStep(step, {
  strategy: ExecutionFailureStrategy.STOP_SCRIPT,
  enabled: true,
  retryCount: 3,
  retryDelay: 1000
});
```

### 3. æ‰§è¡Œæ—¶æ£€æŸ¥

```typescript
import { hasValidFailureHandling, getStepFailureStrategy } from '@execution-flow/*';

// æ£€æŸ¥æ­¥éª¤æ˜¯å¦æœ‰å¤±è´¥å¤„ç†é…ç½®
if (hasValidFailureHandling(step)) {
  const strategy = getStepFailureStrategy(step);
  console.log('å¤±è´¥ç­–ç•¥:', strategy);
}
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Frontend**: React 18, TypeScript, Ant Design
- **State Management**: Zustand
- **Architecture**: DDD (Domain-Driven Design)
- **Build Tool**: Vite
- **Desktop Framework**: Tauri

## ğŸ“Š ä»£ç ç»Ÿè®¡

- **æ–°å¢æ–‡ä»¶**: 11 ä¸ª
- **ä¿®æ”¹æ–‡ä»¶**: 3 ä¸ª
- **æ–°å¢ä»£ç è¡Œæ•°**: ~2000 è¡Œ
- **æµ‹è¯•è¦†ç›–**: åŠŸèƒ½æµ‹è¯•é¡µé¢

## ğŸ‰ æ€»ç»“

æˆåŠŸå®ç°äº†ç”¨æˆ·éœ€æ±‚çš„å®Œæ•´æ‰§è¡Œæµç¨‹æ§åˆ¶åŠŸèƒ½ï¼š

âœ… **"è¿™ä¸€æ­¥å¤±è´¥äº†ç»“æŸæ•´ä¸ªè„šæœ¬"** - STOP_SCRIPT ç­–ç•¥  
âœ… **"ç»§ç»­ä¸‹ä¸€æ­¥"** - CONTINUE_NEXT ç­–ç•¥  
âœ… **"è·³è½¬åˆ°å“ªä¸€æ­¥"** - JUMP_TO_STEP ç­–ç•¥  
âœ… **é¢å¤–å¢å¼º**: RETRY_CURRENT, SKIP_CURRENT ç­–ç•¥  

åŠŸèƒ½å·²å®Œå…¨é›†æˆåˆ°ç°æœ‰æ­¥éª¤å¡ç‰‡ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç›´è§‚çš„UIç•Œé¢é…ç½®å¤±è´¥å¤„ç†ç­–ç•¥ï¼Œæå‡äº†è„šæœ¬æ‰§è¡Œçš„å¯é æ€§å’Œçµæ´»æ€§ã€‚

## ğŸ“ˆ åç»­ä¼˜åŒ–å»ºè®®

1. **æ€§èƒ½ä¼˜åŒ–**: å¤§è§„æ¨¡æ­¥éª¤åœºæ™¯ä¸‹çš„æ€§èƒ½ä¼˜åŒ–
2. **é«˜çº§ç­–ç•¥**: æ¡ä»¶å¼å¤±è´¥å¤„ç†ã€ä¾èµ–å…³ç³»æ£€æŸ¥
3. **å¯è§†åŒ–**: æ‰§è¡Œæµç¨‹å›¾ã€å†³ç­–æ ‘å¯è§†åŒ–
4. **æŒä¹…åŒ–**: å¤±è´¥å¤„ç†é…ç½®çš„å¯¼å…¥å¯¼å‡º
5. **ç›‘æ§**: å¤±è´¥æ¨¡å¼åˆ†æå’Œä¼˜åŒ–å»ºè®®

åŠŸèƒ½å·²å®Œæ•´å®ç°å¹¶é€šè¿‡æµ‹è¯•éªŒè¯ã€‚ğŸ¯