# Round 3｜任务队列与查重频控（讲义总览）

> 目标（30–45 分钟）：把“任务是怎么流动的、如何避免撞单与超频、出现异常怎么兜底”讲清楚，并形成团队共识的**可操作规范**。

---

## 1. 本轮范围
- **任务队列**：状态机、分配、锁、重试、熔断、审计。
- **查重**：评论级、用户级、文本级（近重复）、跨设备合并与 TTL。
- **频控**：账号级、用户/视频级、平台级、安全窗口、抖动策略。
- **操作台**：如何在 UI 上体现这些规则（见《操作台交互稿》）。

> 不覆盖：平台 API 细节（Round 7）、白名单采集实现（Round 7）。

---

## 2. 我们要达成的效果
1) **零撞单**：同一评论只被一个账号处理一次；同一用户在时间窗内只被一个设备触达一次。
2) **稳频不封**：严格遵守小时/日上限，动作间隔随机抖动，遇到风控自动降速与熔断。
3) **可追溯**：任何任务的创建→分配→执行→签收都有审计；失败可复盘。

---

## 3. 输出物（本轮文档）
- 《Round 3｜状态机与错误码（v1）》
- 《Round 3｜频控策略（v1）》
- 《Round 3｜查重策略（v1）》
- 《Round 3｜操作台交互稿（v1）》
- 《Round 3｜演练脚本（任务队列与查重频控）》

---

## 4. 验收（DoD）
- 任务在状态机中**无死路**，所有边界条件有明确处理（含超时/取消）。
- 频控指标、阈值、抖动、降速与熔断**有默认配置**且能被审计。
- 查重键、窗口期、跨设备策略、文本相似度阈值**有清晰定义**。
- 操作台能准确呈现频控/查重/熔断原因，运营可理解与申诉。

---

## 5. 术语速记
- **队列**：按优先级与可用额度出队的任务集合。
- **锁**：避免同一对象在多个设备并发执行（乐观+租约）。
- **熔断**：错误码或失败率到阈值，暂停某账号/来源的执行。
- **抖动**：动作之间引入随机间隔，降低“机器节拍”痕迹。
- **窗口期**：查重或频控生效的时间范围（如 7 天）。

