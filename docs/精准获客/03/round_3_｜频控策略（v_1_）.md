# Round 3｜频控策略（v1）

> 目标：让任何账号在“看起来像真人”的节奏里稳定运行；把所有阈值与策略参数化、可审计。

---

## 1) 频控层级与默认值
- **账号级**：小时/日上限、最小间隔（随机抖动）；
  - 默认：小时 ≤ 20，日 ≤ 150，最小间隔 **90–180s 随机**。
- **视频级**：同一视频每日最多回复 ≤ 10；
- **用户级**：同一用户 **7 天**内不重复触达（与查重联动）；
- **平台级**：遵守平台公开节流建议（若有），本地再+10–30% 冗余。

---

## 2) 调度策略
- **配额优先**：仅当账号有**可用额度**且满足间隔，任务才会出队。
- **时段曲线**：可配置“活跃时段权重”（如 10:00–22:00 权重高，夜间降权）。
- **随机抖动**：对每次动作注入 5–20% 的随机等待，打散节拍。
- **冷启动/预热**：新账号前 3 天减半额度；逐日上调（50%→75%→100%）。

---

## 3) 降速与熔断配合
- 触发 `RATE_LIMITED` 或 HTTP 429 增多 → **自动降速**（减少 20–50% 配额）。
- 连续 `PERMISSION_DENIED/ BLOCKED` → 进入**熔断**（见《状态机与错误码》）。
- 恢复：窗口期后缓升（阶梯式 60%→80%→100%）。

---

## 4) 配置与审计
- 所有阈值保存在 `rate_limit.yaml`（或等效配置），变更需：原因、操作者、时间、影响说明。
- 审计指标：
  - `rate_limit_hits`（频控命中次数）、`avg_interval`（平均间隔）、`burst_count`（突发次数）、`cooldown_time`（冷却时长）。

---

## 5) 特殊场景
- **大促/热点**：临时提高阈值，但必须同步提高**随机间隔**与**模板多样性**，避免同文高频。
- **账号受限**：平台提示限流 → 立即降至 30–50%，并延长最小间隔至 180–300s。
- **多机协作**：同一账号只在一台机器执行（云端分布式锁），避免跨机叠频。

