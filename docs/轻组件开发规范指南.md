# 轻组件开发规范指南

**版本**: v1.0  
**制定人**: 员工B - 轻组件动效工程师  
**最后更新**: 2025-10-02 00:05:00 (UTC+08:00)

---

## 📋 概述

本文档是轻组件（Light Components）开发的权威指南，基于已完成的14个核心轻组件的实践经验制定。所有新的轻组件都必须严格遵循这些规范，以确保代码质量、用户体验和维护性的一致性。

## 🎯 核心原则

### 1. 100% 基于 Design Tokens
- **禁止硬编码**: 任何颜色、阴影、间距、字体都必须基于design tokens
- **语法要求**: 使用 `var(--token-name)` 或 `[var(--token-name)]` 语法
- **主题支持**: 确保支持 dark/light 主题自动切换

### 2. 统一动效系统
- **必须使用**: `motionPresets` 中定义的动效参数
- **时长标准**: 入场 180-220ms，出场 120-160ms，悬停 80-120ms
- **缓动曲线**: 使用预定义的 `motionEasings.easeOut` 或 `motionEasings.brand`

### 3. CVA 变体系统
- **变体管理**: 使用 `class-variance-authority` 进行变体管理
- **类型安全**: 所有 props 必须有完整的 TypeScript 类型定义
- **一致性**: 变体命名和行为保持与现有组件一致

## 🏗️ 技术规范

### 文件结构
```
src/components/ui/
├── component-name/
│   ├── ComponentName.tsx      # 主组件文件
│   ├── index.ts              # 导出文件
│   └── types.ts              # 类型定义（可选）
```

### 代码模板
```tsx
import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '@/lib/utils';
import { motionTransitions } from '@/components/ui/motion/presets';

// CVA 变体定义
const componentVariants = cva(
  // 基础样式 - 必须基于 design tokens
  "inline-flex items-center justify-center rounded-[var(--radius)] border transition-all",
  {
    variants: {
      variant: {
        default: "bg-[var(--bg-primary)] text-[var(--text-primary)] border-[var(--border)]",
        secondary: "bg-[var(--bg-secondary)] text-[var(--text-secondary)] border-[var(--border-secondary)]",
      },
      size: {
        sm: "h-8 px-3 text-sm",
        md: "h-10 px-4 text-base",
        lg: "h-12 px-6 text-lg",
      }
    },
    defaultVariants: {
      variant: "default",
      size: "md",
    },
  }
);

// TypeScript 接口
export interface ComponentNameProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof componentVariants> {
  /** 组件是否禁用 */
  disabled?: boolean;
  /** 是否显示加载状态 */
  loading?: boolean;
}

// 主组件
export const ComponentName = React.forwardRef<
  HTMLDivElement,
  ComponentNameProps
>(({ className, variant, size, disabled, loading, children, ...props }, ref) => {
  return (
    <div
      ref={ref}
      className={cn(
        componentVariants({ variant, size }),
        disabled && "opacity-50 cursor-not-allowed",
        loading && "cursor-wait",
        className
      )}
      style={{
        // 使用 motion presets
        transitionDuration: `${motionTransitions.hover.duration}s`,
        transitionTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)',
      }}
      {...props}
    >
      {loading ? <LoadingSpinner /> : children}
    </div>
  );
});

ComponentName.displayName = "ComponentName";
```

## 🎨 Design Tokens 使用指南

### 颜色系统
```tsx
// ✅ 正确
"bg-[var(--bg-primary)]"
"text-[var(--text-primary)]"
"border-[var(--border)]"

// ❌ 错误
"bg-blue-500"
"text-gray-900"
"border-slate-200"
```

### 阴影系统
```tsx
// ✅ 正确
"shadow-[var(--shadow-sm)]"
"shadow-[var(--shadow-lg)]"
"drop-shadow-[var(--shadow-tooltip)]"

// ❌ 错误
"shadow-lg"
"drop-shadow-[0px_4px_10px_rgba(15,23,42,0.18)]"
```

### 间距和尺寸
```tsx
// ✅ 正确
"rounded-[var(--radius)]"
"p-[var(--spacing-md)]"

// ❌ 错误（但在特定情况下可接受）
"rounded-lg"
"p-4"
```

## ⚡ 动效集成标准

### 使用 Motion Presets
```tsx
import { motionTransitions, fadeVariants } from '@/components/ui/motion/presets';

// 过渡效果
style={{
  transitionDuration: `${motionTransitions.hover.duration}s`,
  transitionTimingFunction: 'cubic-bezier(0, 0, 0.2, 1)',
}}

// Framer Motion 变体
<motion.div
  variants={fadeVariants}
  initial="initial"
  animate="animate"
  exit="exit"
>
```

### 悬停效果标准
```tsx
// 基础悬停
"hover:bg-[var(--bg-hover)] hover:scale-[var(--motion-scale-hover)]"

// 提升效果
"hover:shadow-[var(--shadow-lg)] hover:-translate-y-0.5"

// 时长控制
"transition-all duration-[var(--duration-hover)]"
```

## 🧪 质量检查清单

### 开发阶段
- [ ] 所有样式基于 design tokens
- [ ] 支持 dark/light 主题
- [ ] 使用 CVA 变体系统
- [ ] 完整的 TypeScript 类型
- [ ] 集成 motion presets
- [ ] Accessibility 支持（ARIA、键盘导航）

### 测试阶段
```bash
# 硬编码检测
node scripts/check-hardcoded-styles.js

# TypeScript 检查
npm run type-check

# 视觉回归测试
npm run test:visual
```

### 发布前检查
- [ ] 组件在 Storybook 中正常显示
- [ ] 支持所有预定义变体
- [ ] 响应式设计正常
- [ ] 无障碍访问测试通过
- [ ] 性能测试通过（< 16ms 渲染时间）

## 📝 命名规范

### 组件命名
- **文件名**: PascalCase（如 `ButtonPrimary.tsx`）
- **组件名**: PascalCase（如 `ButtonPrimary`）
- **Props 接口**: ComponentName + Props（如 `ButtonPrimaryProps`）

### 变体命名
```tsx
variant: {
  default: "默认样式",      // 主要变体
  secondary: "次要样式",    // 次要变体
  outline: "轮廓样式",      // 轮廓变体
  ghost: "幽灵样式",        // 透明变体
  destructive: "危险样式",  // 危险操作
}

size: {
  sm: "小尺寸",           // 小尺寸
  md: "中等尺寸",         // 默认尺寸
  lg: "大尺寸",           // 大尺寸
  xl: "超大尺寸",         // 超大尺寸（可选）
}
```

## 🚫 禁止事项

### 严格禁止
1. **硬编码颜色**: 任何 hex、rgb、rgba 颜色值
2. **硬编码阴影**: 非基于 token 的阴影定义
3. **直接 Tailwind 颜色类**: bg-blue-500、text-red-600 等
4. **内联样式**: 除非用于动态计算的值
5. **覆盖 AntD 样式**: 不允许修改 `.ant-*` 类

### 限制使用
1. **固定尺寸**: 优先使用相对单位和 tokens
2. **绝对定位**: 除非必要，优先使用 flexbox/grid
3. **复杂动画**: 超出 motion presets 范围的需要评审

## 🔧 调试和故障排除

### 常见问题
1. **主题切换不生效**: 检查是否使用了硬编码颜色
2. **动效不一致**: 确认使用了正确的 motion presets
3. **类型错误**: 检查 CVA 变体定义和 props 接口

### 调试工具
```bash
# 质量检查
npm run check:quality

# 硬编码检测
npm run check:hardcoded

# 视觉对比
npm run test:visual
```

## 📚 参考资源

### 核心文件
- `src/components/ui/motion/presets.ts` - 动效参数定义
- `src/styles/design-tokens.css` - 设计令牌定义
- `src/lib/utils.ts` - 工具函数（cn 等）

### 示例组件
- `src/components/ui/button/Button.tsx` - 完整的按钮组件示例
- `src/components/ui/card/Card.tsx` - 卡片组件示例
- `src/components/ui/tooltip/Tooltip.tsx` - 工具提示组件示例

### 工具和脚本
- `scripts/check-hardcoded-styles.js` - 硬编码检测脚本
- `.storybook/` - Storybook 配置和故事

## 📞 支持和协作

### 问题反馈
- **技术问题**: 提交 GitHub Issue
- **设计相关**: 联系设计团队
- **架构决策**: 联系架构师

### 代码审查
所有轻组件的修改都需要经过：
1. 自动化质量检查
2. 至少一名资深开发者审查
3. 设计团队视觉确认（如有UI变更）

---

**注意**: 此规范基于员工B完成的14个核心轻组件实践制定，随着项目发展可能会更新。请定期检查最新版本。

**制定依据**: 
- 轻组件动效任务实践经验
- Design Tokens 系统架构
- Motion Presets 动效规范
- TypeScript 和 React 最佳实践