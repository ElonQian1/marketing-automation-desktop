# 普通步骤卡片 vs 循环卡片样式对比分析

## 问题诊断

用户反映循环卡片的独立样式基准线可能没有启用，需要对比普通步骤卡片和循环卡片的样式差异。

## 普通步骤卡片样式系统

### 1. 主要组件
- **文件**: `src/components/DraggableStepCard.tsx`
- **样式文件**: `src/components/DraggableStepCard.module.css`
- **样式系统**: CSS Modules + 内联样式混合

### 2. 样式特点
```css
/* DraggableStepCard.module.css */
.darkThemeCard {
  background: #1E293B !important;  /* 深色主题 */
  color: #F8FAFC !important;       /* 浅色文字 */
  border: 1px solid #334155 !important;
  
  /* 使用设计令牌常量 */
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI'...;
  font-size: 14px;
  line-height: 1.5;
}
```

### 3. 内联样式使用
```tsx
// 大量内联样式混合
<div style={{
  display: "flex",
  alignItems: "center", 
  gap: STEP_CARD_DESIGN_TOKENS.spacing.md,
  fontSize: STEP_CARD_DESIGN_TOKENS.typography.fontSize.md,
  color: STEP_CARD_DESIGN_TOKENS.colors.text.muted,
}}>
```

## 循环卡片样式系统

### 1. 主要组件
- **文件**: `src/modules/loop-control/components/LoopStepCard.tsx`
- **样式文件**: `src/styles/surfaces/loop.css`
- **样式系统**: 独立CSS类 + 设计令牌

### 2. 独立样式基准线
```css
/* src/styles/surfaces/loop.css */
.loop-step-card {
  /* CSS变量系统 */
  --loop-card-bg: var(--bg-light-base, #ffffff);
  --loop-card-border: var(--border-2, #e5e7eb);
  --loop-card-text-primary: var(--text-inverse, #111827);
  
  /* 基础样式 */
  background: var(--loop-card-bg) !important;
  border: 1px solid var(--loop-card-border) !important;
  color: var(--loop-card-text-primary) !important;
}
```

### 3. 组件使用
```tsx
// LoopStepCard.tsx - 纯CSS类名
<Card
  className={`loop-step-card ${executing ? 'executing' : ''} ${collapsed ? 'collapsed' : ''}`}
  // 无内联样式
>
```

## 关键差异对比

| 特性 | 普通步骤卡片 | 循环卡片 |
|------|-------------|----------|
| **主题** | 深色主题 (#1E293B) | 强制浅色主题 (#ffffff) |
| **文字颜色** | 浅色文字 (#F8FAFC) | 深色文字 (#111827) |
| **样式方式** | CSS Modules + 内联 | 独立CSS类 |
| **设计令牌** | STEP_CARD_DESIGN_TOKENS | CSS变量系统 |
| **主题适配** | 固定深色主题 | 响应式主题切换 |

## 样式加载验证

### 1. 样式文件导入路径
```css
/* src/style.css */
@import './styles/tokens.css';          /* ✅ 设计令牌 */
@import './styles/surfaces.css';        /* ✅ 表面样式 */
@import './components/DraggableStepCard/styles/loopTheme.css';  /* ⚠️ 兼容性 */
```

```css
/* src/styles/surfaces.css */
@import './surfaces/loop.css';          /* ✅ 循环卡片样式 */
```

### 2. 类名应用验证
```tsx
// LoopStepCard.tsx
className={`loop-step-card ${executing ? 'executing' : ''} ${collapsed ? 'collapsed' : ''}`}
```

### 3. 样式优先级
- **循环卡片**: `!important` 确保样式优先级
- **普通卡片**: CSS Modules 局部作用域

## 可能的问题原因

### 1. 样式冲突
- `loopTheme.css` 可能覆盖了新的样式基准线
- 全局深色主题影响循环卡片显示

### 2. 缓存问题
- 浏览器样式缓存
- 构建缓存未更新

### 3. 样式加载顺序
```css
/* 当前加载顺序 */
tokens.css → surfaces.css → loopTheme.css
```

## 解决方案

### 1. 验证样式是否生效
在浏览器开发者工具中检查：
```css
.loop-step-card {
  background: #ffffff !important;  /* 应该是白色背景 */
  color: #111827 !important;       /* 应该是深色文字 */
}
```

### 2. 清除缓存重新构建
```bash
# 清除缓存
npm run clean
# 重新构建
npm run build
```

### 3. 样式调试
在循环卡片组件中添加调试样式：
```tsx
<Card
  className="loop-step-card"
  style={{ 
    backgroundColor: 'red',  // 临时调试：应该被CSS覆盖为白色
    border: '2px solid blue' // 临时调试：应该被CSS覆盖
  }}
>
```

## 预期行为 vs 实际行为

### 预期效果
- **循环卡片**: 白色背景 + 深色文字 + 蓝色边框
- **普通卡片**: 深色背景 + 浅色文字 + 灰色边框

### 检查点
1. ✅ 样式文件是否存在: `src/styles/surfaces/loop.css`
2. ✅ 样式文件是否导入: `src/styles/surfaces.css`
3. ✅ 主样式文件是否导入surfaces: `src/style.css`
4. ✅ 组件是否使用正确类名: `loop-step-card`
5. ⚠️ 是否有样式冲突: 需要检查
6. ⚠️ 浏览器是否应用样式: 需要验证

## 建议调试步骤

1. **检查网络面板**: 确认`loop.css`文件已加载
2. **检查Elements面板**: 确认`.loop-step-card`类名已应用
3. **检查Computed样式**: 确认最终计算的样式值
4. **清除样式缓存**: 硬刷新页面 (Ctrl+Shift+R)
5. **临时添加调试样式**: 验证CSS选择器是否工作

## 结论

循环卡片的独立样式基准线已经正确创建和配置，但可能存在以下问题：
1. 样式加载顺序或冲突
2. 浏览器缓存问题
3. 其他全局样式的干扰

需要通过浏览器开发者工具进行实际验证。