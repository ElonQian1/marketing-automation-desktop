# ğŸ¤– çœŸæ­£çš„ AI Agent æ¶æ„

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ Agent æ§åˆ¶é¢æ¿                        â”‚
â”‚  [å¯åŠ¨] [æš‚åœ] [æ¢å¤] [åœæ­¢]  |  çŠ¶æ€: æ€è€ƒä¸­  |  è¿›åº¦: 35%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Tauri Commands / Events
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Agent Runtime Service                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  çŠ¶æ€æœº      â”‚  â”‚  ç›®æ ‡ç®¡ç†    â”‚  â”‚  è®°å¿†ç³»ç»Ÿ    â”‚         â”‚
â”‚  â”‚ StateMachineâ”‚  â”‚  GoalTree   â”‚  â”‚ AgentMemory â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Agent Loop                              â”‚
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  è§‚å¯Ÿ   â”‚ â”€â”€â†’ â”‚  æ€è€ƒ   â”‚ â”€â”€â†’ â”‚  è¡ŒåŠ¨   â”‚ â”€â”           â”‚
â”‚   â”‚ Observe â”‚     â”‚  Think  â”‚     â”‚ Execute â”‚  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚        â–²                                        â”‚           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ AI Provider â”‚    â”‚    MCP      â”‚    â”‚    ADB      â”‚
    â”‚  (æ··å…ƒ/GPT) â”‚    â”‚   Tools     â”‚    â”‚   Service   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒç»„ä»¶

### 1. é¢†åŸŸå±‚ (`domain/agent_runtime/`)

| æ¨¡å— | èŒè´£ |
|------|------|
| `agent_goal.rs` | ç›®æ ‡å®šä¹‰ã€ç›®æ ‡æ ‘ã€å®Œæˆæ¡ä»¶ |
| `agent_state.rs` | çŠ¶æ€æœºã€çŠ¶æ€è½¬æ¢è§„åˆ™ |
| `agent_memory.rs` | çŸ­æœŸ/å·¥ä½œ/é•¿æœŸè®°å¿† |
| `agent_action.rs` | è¡ŒåŠ¨ç±»å‹ã€é£é™©ç­‰çº§ã€æ‰§è¡Œè®°å½• |

### 2. åº”ç”¨å±‚ (`application/`)

| æ¨¡å— | èŒè´£ |
|------|------|
| `agent_runtime_service.rs` | è¿è¡Œæ—¶çŠ¶æ€ç®¡ç†ã€å‘½ä»¤å¤„ç† |
| `agent_loop.rs` | è‡ªä¸»å¾ªç¯å¼•æ“ï¼šè§‚å¯Ÿâ†’æ€è€ƒâ†’è¡ŒåŠ¨ |

### 3. è¿è¡ŒçŠ¶æ€

```
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                â”‚
     â–¼                                                â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”  GoalReceived  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ActionDecided â”‚
  â”‚ Idle â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ Thinking â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â””â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
     â–²                         â”‚                      â”‚
     â”‚                         â”‚ ApprovalRequired     â–¼
     â”‚                         â–¼                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ Executing â”‚
     â”‚                  â”‚ WaitingApprovalâ”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
     â”‚                         â”‚                     â”‚ ActionCompleted
     â”‚                         â”‚ Approved            â–¼
     â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                        â”‚ Observing â”‚
     â”‚  GoalCompleted                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è®°å¿†ç³»ç»Ÿ

### çŸ­æœŸè®°å¿† (Short-Term Memory)
- æœ€è¿‘ 50 æ¡æ“ä½œè®°å½•
- æ»‘åŠ¨çª—å£ï¼Œè‡ªåŠ¨æ·˜æ±°æ—§è®°å½•
- ç”¨äºæä¾› AI ä¸Šä¸‹æ–‡

### å·¥ä½œè®°å¿† (Working Memory)
- å½“å‰ç›®æ ‡å’Œè®¡åˆ’
- å½“å‰æ­¥éª¤ç´¢å¼•
- ä¸Šæ¬¡è¡ŒåŠ¨å’Œç»“æœ
- ä¸´æ—¶å˜é‡

### é•¿æœŸè®°å¿† (Long-Term Memory)
- åº”ç”¨æ“ä½œçŸ¥è¯†
- é”™è¯¯è§£å†³æ–¹æ¡ˆ
- æˆåŠŸæ¨¡å¼
- ç”¨æˆ·åå¥½

## ä½¿ç”¨ç¤ºä¾‹

```rust
// åˆ›å»ºè¿è¡Œæ—¶
let runtime = create_shared_runtime(AgentConfig::default(), AgentMode::SemiAutonomous);

// å¯åŠ¨ Agent
{
    let mut rt = runtime.write().await;
    rt.handle_command(AgentCommand::Start {
        goal: "æ‰“å¼€å¾®ä¿¡ï¼Œè¿›å…¥é€šè®¯å½•ï¼Œæ·»åŠ æ‰‹æœºå· 13800138000".to_string(),
        device_id: "device123".to_string(),
    })?;
}

// å¯åŠ¨å¾ªç¯
let mut agent_loop = AgentLoop::new(
    runtime.clone(),
    ai_provider,
    tool_provider,
    AgentLoopConfig::default(),
    event_tx,
    stop_rx,
);
agent_loop.run().await?;
```

## ä¸ç°æœ‰ç³»ç»Ÿçš„åŒºåˆ«

| ç‰¹æ€§ | åŸæ¥ï¼ˆCopilot æ¨¡å¼ï¼‰ | ç°åœ¨ï¼ˆAgent æ¨¡å¼ï¼‰ |
|------|---------------------|-------------------|
| é©±åŠ¨æ–¹å¼ | ç”¨æˆ·å‘æŒ‡ä»¤ | AI è‡ªä¸»å¾ªç¯ |
| çŠ¶æ€ç®¡ç† | æ—  | å®Œæ•´çŠ¶æ€æœº |
| è®°å¿† | ä»…èŠå¤©å†å² | åˆ†å±‚è®°å¿†ç³»ç»Ÿ |
| ç›®æ ‡ | å•æ¬¡è¯·æ±‚ | ç›®æ ‡æ ‘ + è¿›åº¦è¿½è¸ª |
| é”™è¯¯å¤„ç† | è¿”å›é”™è¯¯ä¿¡æ¯ | è‡ªåŠ¨æ¢å¤ + äººå·¥å¹²é¢„ |
| é£é™©æ§åˆ¶ | æ—  | é£é™©ç­‰çº§ + å®¡æ‰¹æœºåˆ¶ |

## ä¸‹ä¸€æ­¥è®¡åˆ’

1. **å®Œå–„ Agent Loop**ï¼šå®ç°çœŸæ­£çš„ AI è°ƒç”¨å’Œè¡ŒåŠ¨æ‰§è¡Œ
2. **å‰ç«¯æ§åˆ¶é¢æ¿**ï¼šå¯åŠ¨/æš‚åœ/åœæ­¢æŒ‰é’®ã€å®æ—¶çŠ¶æ€æ˜¾ç¤º
3. **å¼‚å¸¸æ¢å¤**ï¼šæ™ºèƒ½é‡è¯•ã€å›æ»šç­–ç•¥
4. **é•¿æœŸè®°å¿†æŒä¹…åŒ–**ï¼šå­¦ä¹ ç”¨æˆ·åå¥½å’Œæ“ä½œæ¨¡å¼
