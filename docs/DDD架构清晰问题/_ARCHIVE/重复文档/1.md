# 你的重构需求总纲（浓缩版）

## 目标

* 把项目统一到**“模块优先（按业务切片）+ 模块内分层”**。
* 解决**同名子目录**（如 `strategies/、services/、utils/…`）在不同模块里引发的**误改**问题。
* **尽量少加限制**：允许跨模块协作，不引入重度流程。

---

## 架构原则

* 目录主轴：`src/modules/<module>/{domain,application,services,api,stores,hooks,ui,pages}/`
* 模块示例：`adb/`, `contact-import/`, `prospecting/`, `script-builder/`
* **跨模块使用**：优先从对方**门牌** `src/modules/<m>/index.ts` 导入（不鼓励深挖内部实现）。
* **共享**：通用算法放 `src/shared/**`；需要公开的领域契约放 `domain/public/**` 并由门牌导出。

---

## 四件套（最小又管用）

1. **命名前缀**

   * 给**容易重名的目录内的文件/类型**加**模块前缀**：

     * `prospecting` → `prospecting-*/Prospecting*`
     * `script-builder` → `script-*/Script*`
     * `contact-import` → `contact-*/Contact*`
     * `adb` → `adb-*/Adb*`
   * 重点目录：`domain/strategies`, `services`, `utils`, `validators`, `adapters`, `pipelines`, `mappers`, `repositories` 等。

2. **门牌导出（index.ts）**

   * 每个模块 `index.ts` **只导出**：`domain/public/**` 契约/预设、`application` 用例、公开 `hooks`/轻类型。
   * **不导出**内部实现（如 `domain/strategies/*`）。

3. **别名（tsconfig paths）**

   * `@prospecting/*`, `@script/*`, `@contact/*`, `@adb/*`, `@shared/*` → 指向各模块根。
   * 跨模块导入统一写：`import { ... } from '@prospecting'`（命中门牌）。

4. **文件头（三行注释）**

   * 每个 `ts/tsx` 顶部：

     ```ts
     // src/modules/<module>/<layer>/path/File.ts
     // module: <module> | layer: <ui|hooks|application|domain|services|api|stores|pages> | role: <简短角色>
     // summary: 一句中文职责摘要
     ```

---

## 最小硬底线（仅此一条）

* **domain 不得依赖 UI/IO**（禁止 `domain → ui/services/api/hooks/pages` 的 import）。
* 其它（跨模块导入、访问内部目录）**不强禁**，尽量走门牌与 `public/`。

---

## 命名与导出示例

* 文件：`src/modules/prospecting/domain/strategies/prospecting-strategy-weighted.ts`
  类型：`ProspectingStrategyWeighted`
* 文件：`src/modules/script-builder/domain/strategies/script-strategy-standard.ts`
  类型：`ScriptStrategyStandard`
* 门牌导出：

  ```ts
  // src/modules/prospecting/index.ts
  export * from './domain/public/strategies/contracts';
  export * from './application/BuildLeadScoreUseCase';
  export * from './hooks/useProspectingWizard';
  ```

---

## 员工A的主要任务（按优先顺序）

1. **前缀化命名**：对上述“易重名目录”里的文件/类型进行前缀化（先做 `prospecting` 与 `script-builder`）。
2. **修导入**：把跨模块导入改为 **别名 + 门牌**；避免直指内部实现。
3. **完善门牌**：每个模块 `index.ts` 仅导出契约/用例/Hook。
4. **补文件头**：所有改动文件加三行注释（可用自动脚本补齐）。
5. **共享抽取（可选）**：共用算法抽到 `src/shared/**`；要公开的领域契约放 `domain/public/**` 并由门牌导出。
6. **生成迁移表**：`docs/architecture/prefix-migration-plan.md` 列出 `from → to` 重命名清单与进度。

---

## 验收标准

* 搜索 `strategy/service/validator`：**文件名与类型名都带模块前缀**，肉眼可区分所属模块。
* 跨模块导入**大多来自** `@<module>`（门牌），而不是深层路径。
* 每个改动文件有**三行文件头**。
* 编译与核心流程通过；迁移表清晰展示已完成与待办。
* 规则仅拦截“domain 反依赖 UI/IO”，其余不阻塞开发。

---

## 可选的轻量自动化（不强制）

* **自动补文件头**脚本：缺了就加，不拦提交。
* **扫描重复子目录**脚本：列出跨模块高频同名目录，辅助制定前缀化计划。
* **前缀建议**脚本：提示还没加前缀的文件名（仅提醒）。

---

### 一句话总结

用**前缀化命名 + 门牌导出 + 别名 + 文件头**四件套，把“模块优先 + 模块内分层”落到地，让 AI 在大仓里**不迷路、不串改**，同时维持**低限制、高灵活**的开发体验。
