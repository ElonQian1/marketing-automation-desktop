# 参数面板详细功能对比

## 📊 子功能对比矩阵

### 1. 支持的动作类型

| 动作类型 | ActionParams (280行) | ActionParamsPanel (836行) | 差异 |
|---------|---------------------|--------------------------|------|
| **tap** | ✅ X/Y坐标 + 偏移 | ✅ X/Y坐标 + 偏移 + 可视化选择 | ActionParamsPanel 多了坐标选择器 |
| **doubleTap** | ✅ 基础参数 | ✅ 基础参数 + 可视化 | 同上 |
| **longPress** | ✅ + 按住时长 | ✅ + 按住时长 + 可视化 | 同上 |
| **swipe** | ✅ 方向+距离+时长 | ✅ 方向+距离+时长+起点 | ActionParamsPanel 多了起点选择 |
| **type(input)** | ✅ 文本+开关 | ✅ 文本+速度+模拟人类+清空 | ActionParamsPanel 功能更丰富 |
| **wait** | ✅ 等待时长 | ✅ 等待时长 | 功能相同 |
| **back** | ✅ 无参数 | ✅ 无参数 | 功能相同 |
| **scroll** | ❌ 不支持 | ✅ 支持 | ActionParamsPanel 独有 |
| **swipe_up/down/left/right** | ❌ 合并在swipe | ✅ 独立四个方向 | ActionParamsPanel 更细分 |

---

### 2. 通用参数对比

| 功能 | ActionParams | ActionParamsPanel | 差异 |
|------|-------------|-------------------|------|
| **选择器优先** | ✅ Switch | ❌ 无 | ActionParams 独有 |
| **坐标兜底** | ✅ Switch | ❌ 无 | ActionParams 独有 |
| **置信度阈值** | ✅ InputNumber | ❌ 无 | ActionParams 独有 |
| **重试次数** | ✅ InputNumber | ❌ 无 | ActionParams 独有 |
| **执行后验证** | ✅ Switch | ❌ 无 | ActionParams 独有 |

**🚨 重大发现**：ActionParams 的**通用参数**是 ActionParamsPanel **没有的**！

---

### 3. 特有功能对比

#### ActionParams 独有：
```tsx
// ✅ 通用配置面板（5个控制项）
renderCommonParams() {
  - 选择器优先 (useSelector)
  - 坐标兜底 (allowAbsolute)
  - 置信度阈值 (confidenceThreshold)
  - 重试次数 (retries)
  - 执行后验证 (verifyAfter)
}
```

#### ActionParamsPanel 独有：
```tsx
// ✅ 1. 坐标选择器（可视化）
<CoordinateSelector
  onCoordinateSelected={(x, y) => updateParams({ x, y })}
/>

// ✅ 2. 输入速度控制
<Select>
  - 极快 (instant)
  - 快速 (50ms)
  - 正常 (100ms)
  - 慢速 (200ms)
</Select>

// ✅ 3. 模拟人类输入
<Checkbox>模拟人类输入节奏</Checkbox>

// ✅ 4. 状态管理优化
useState + useRef  // 防止循环依赖

// ✅ 5. 更多动作类型
- scroll（滚动）
- swipe_up/down/left/right（四方向滑动）
```

---

### 4. 代码质量对比

| 指标 | ActionParams | ActionParamsPanel | 评价 |
|------|-------------|-------------------|------|
| **文件大小** | 280行 | 836行 | ActionParamsPanel 3倍 |
| **类型安全** | ⚠️ 类型转换多 | ✅ 严格类型 | ActionParamsPanel 更好 |
| **状态管理** | ❌ 依赖外部 | ✅ 内部 useState | ActionParamsPanel 独立 |
| **循环依赖** | ❌ 无防护 | ✅ useRef 防护 | ActionParamsPanel 更健壮 |
| **样式修复** | ✅ light-theme-force | ✅ light-theme-force | 都已修复 |

---

## 🎯 结论

### ❌ **不能简单删除 ActionParams**

**原因**：
1. ✅ **通用参数面板是独特功能**
   - 选择器优先、坐标兜底、置信度、重试、验证
   - 这5个配置项是 ActionParamsPanel **完全没有的**

2. ⚠️ **ActionParamsPanel 也不完美**
   - 缺少通用配置
   - 只专注于动作特定参数

3. **两者互补**：
   - ActionParams: 通用配置 + 基础参数
   - ActionParamsPanel: 丰富控件 + 可视化选择

---

## 🔄 合并方案

### 方案A: 扩展 ActionParamsPanel（推荐）

```tsx
// 1. 将 ActionParams 的通用参数提取为独立组件
// src/components/step-card/CommonExecutionParams.tsx
export const CommonExecutionParams = ({ common, onChange }) => {
  return (
    <Card title="执行配置" size="small">
      <Space wrap>
        <span>选择器优先</span>
        <Switch checked={common.useSelector} onChange={...} />
        
        <span>坐标兜底</span>
        <Switch checked={common.allowAbsolute} onChange={...} />
        
        <span>置信度阈值</span>
        <InputNumber value={common.confidenceThreshold} ... />
        
        <span>重试次数</span>
        <InputNumber value={common.retries} ... />
        
        <span>执行后验证</span>
        <Switch checked={common.verifyAfter} onChange={...} />
      </Space>
    </Card>
  );
};

// 2. 在 ActionParamsPanel 中集成
import { CommonExecutionParams } from '../step-card/CommonExecutionParams';

export const ActionParamsPanel = ({ ... }) => {
  return (
    <Space direction="vertical">
      {/* 动作特定参数 */}
      {renderActionSpecificParams()}
      
      {/* 通用执行配置 */}
      {showCommonParams && (
        <CommonExecutionParams common={common} onChange={onCommonChange} />
      )}
    </Space>
  );
};
```

### 方案B: 保留 ActionParams 作为轻量版

```tsx
// ActionParams 用于简单场景
// ActionParamsPanel 用于完整场景

// 使用场景：
<NewStepCard>
  <ActionParams />  {/* 轻量级 */}
</NewStepCard>

<DraggableStepCard>
  <ActionParamsPanel />  {/* 完整功能 */}
</DraggableStepCard>
```

---

## ✅ 安全删除建议

**暂时保留**：
- ✅ `stepCards/ActionParams.tsx` (280行)
  - 提取通用参数到独立组件
  - 合并到 ActionParamsPanel 后再删除

**删除计划**：
1. 创建 `CommonExecutionParams.tsx`
2. 扩展 ActionParamsPanel
3. 迁移 NewStepCard 使用扩展版
4. 删除 ActionParams.tsx

**预计收益**：
- 删除 280行
- 但需新增 ~80行（CommonExecutionParams）
- 净收益: ~200行
