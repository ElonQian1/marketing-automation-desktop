# 小红书评论数据服务端架构方案

## 📋 需求分析

**目标**：为 AI 代理捕获的小红书评论数据提供：
1. **远程数据存储** - 将评论数据同步到云服务器
2. **Web 管理界面** - 查看、筛选、导出潜在客户信息
3. **API 服务** - 供桌面端和移动端上传数据

---

## 🏗️ 推荐架构

```
employeeGUI/
├── server/                     # 🆕 新增服务端目录
│   ├── Cargo.toml             # Rust 项目配置
│   ├── src/
│   │   ├── main.rs            # 入口
│   │   ├── config.rs          # 配置管理
│   │   ├── db/                # 数据库层
│   │   │   ├── mod.rs
│   │   │   ├── schema.rs      # 表结构（复用现有）
│   │   │   ├── comments.rs    # 评论 CRUD
│   │   │   └── analyses.rs    # 分析结果 CRUD
│   │   ├── api/               # API 路由
│   │   │   ├── mod.rs
│   │   │   ├── comments.rs    # 评论接口
│   │   │   ├── analyses.rs    # 分析接口
│   │   │   └── auth.rs        # 认证中间件
│   │   ├── web/               # Web 管理界面
│   │   │   ├── mod.rs
│   │   │   └── static/        # 前端静态资源
│   │   └── sync/              # 数据同步逻辑
│   │       └── mod.rs
│   └── migrations/            # 数据库迁移
└── ...
```

---

## 🛠️ 技术选型

| 组件 | 技术 | 说明 |
|------|------|------|
| **Web 框架** | Axum | Rust 异步 Web 框架，性能优秀 |
| **数据库** | SQLite → PostgreSQL | 开发用 SQLite，生产迁移到 PostgreSQL |
| **ORM** | SQLx | 异步、编译时检查 SQL |
| **前端** | 内嵌静态页面 或 独立 React | 简单起见先用服务端渲染 |
| **认证** | JWT / API Key | 简单 API Key 认证 |
| **部署** | Docker | 方便部署到你的 Ubuntu 服务器 |

---

## 📦 核心功能

### 1. API 接口

```
POST   /api/comments/batch     # 批量上传评论
GET    /api/comments           # 查询评论列表（分页）
GET    /api/comments/:id       # 查询单条评论
DELETE /api/comments/:id       # 删除评论

POST   /api/analyses           # 上传分析结果
GET    /api/analyses           # 查询分析结果
GET    /api/analyses/leads     # 查询潜在客户（高意向）

GET    /api/stats              # 统计数据（总数、分类等）
GET    /api/export/csv         # 导出 CSV
```

### 2. 数据同步流程

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  桌面端 Tauri   │     │  云端 Rust API  │     │  Web 管理界面   │
│  (本地 SQLite)  │────▶│  (PostgreSQL)   │◀────│  (查看/导出)    │
└─────────────────┘     └─────────────────┘     └─────────────────┘
         │                       │
         ▼                       ▼
┌─────────────────┐     ┌─────────────────┐
│  Android Agent  │────▶│  实时同步评论   │
│  (MCP 工具)     │     │                 │
└─────────────────┘     └─────────────────┘
```

### 3. Web 管理功能

- **评论列表**：分页、搜索、按平台/意向筛选
- **潜在客户**：高意向用户列表，一键导出
- **数据统计**：每日新增、意向分布图表
- **回复管理**：查看建议回复、标记已处理

---

## 🚀 实施步骤

### Phase 1: 基础 API（1-2天）

1. 创建 `server/` 目录和 Cargo.toml
2. 实现 Axum Web 服务器
3. 复用现有数据库 schema
4. 实现评论/分析 CRUD API

### Phase 2: 数据同步（1天）

1. 桌面端添加"同步到云端"功能
2. 实现批量上传 API
3. 增量同步（只上传新数据）

### Phase 3: Web 管理界面（2-3天）

1. 简单的 HTML/JS 管理页面
2. 评论列表、筛选、导出
3. 简单的数据统计

### Phase 4: 部署（1天）

1. Docker 化
2. 部署到 119.91.19.232
3. 配置 HTTPS（可选）

---

## 💻 服务器信息

```yaml
操作系统: Ubuntu Server 24.04 LTS 64bit
IP: 119.91.19.232
用户名: ubuntu
```

---

## ⚡ 快速开始命令

```bash
# 在项目根目录创建 server 子项目
cd employeeGUI
cargo new server --name lead-server

# 添加依赖
cd server
cargo add axum tokio sqlx serde serde_json tower-http

# 运行开发服务器
cargo run
```

---

## 🤔 是否需要立即开始？

如果确认这个方案，我可以：

1. **立即创建** `server/` 目录结构
2. **生成** 基础的 Axum 服务器代码
3. **复用** 现有的数据库 schema
4. **添加** 桌面端到云端的同步功能

请告诉我你的决定！
