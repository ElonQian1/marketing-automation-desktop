# MDE - MCP æ•°æ®æå–ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> **æ¨¡å—ä»£å·**: MDE (MCP Data Extraction)  
> **åˆ›å»ºæ—¥æœŸ**: 2025-12-21  
> **çŠ¶æ€**: âœ… Phase 1-3 å·²å®Œæˆ

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡

æ„å»ºä¸€ä¸ª**é€šç”¨ã€å¯æ‰©å±•**çš„æ•°æ®æå–ç³»ç»Ÿï¼Œè®© MCP AI ä»£ç†èƒ½å¤Ÿï¼š
1. è‡ªåŠ¨è¯†åˆ«æ‰‹æœºå±å¹•ä¸Šçš„ APP å’Œé¡µé¢ç±»å‹
2. ä»ä»»æ„ APPï¼ˆæŠ–éŸ³/å°çº¢ä¹¦/å¿«æ‰‹ç­‰ï¼‰æå–ç»“æ„åŒ–æ•°æ®ï¼ˆè¯„è®º/å•†å“/ç”¨æˆ·ç­‰ï¼‰
3. å°†æå–çš„æ•°æ®å­˜å…¥æ•°æ®åº“
4. æ”¯æŒè§„åˆ™æ¨¡å¼ + AI æ¨¡å¼ + æ··åˆæ¨¡å¼
5. å…·å¤‡è‡ªæˆ‘å­¦ä¹ èƒ½åŠ›ï¼ˆAI æå–æˆåŠŸåå¯ç”Ÿæˆè§„åˆ™ï¼‰

---

## ğŸ“› å‘½åè§„èŒƒï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

### å‰ç¼€è§„åˆ™

| å±‚çº§ | å‘½åè§„åˆ™ | ç¤ºä¾‹ |
|------|----------|------|
| **ç›®å½•** | `mde_<å­æ¨¡å—>/` | `mde_extraction/` |
| **æ–‡ä»¶** | `mde_<èŒè´£>.rs` | `mde_selector.rs`, `mde_rule_engine.rs` |
| **ç»“æ„ä½“** | `Mde<Name>` | `MdeExtractor`, `MdeRuleEngine` |
| **æšä¸¾** | `Mde<Name>` | `MdeDataType`, `MdeSelectorKind` |
| **å‡½æ•°** | `mde_<action>_<target>()` | `mde_extract_comments()` |
| **Trait** | `Mde<Name>` | `MdeExtractable` |
| **å¸¸é‡** | `MDE_<NAME>` | `MDE_DEFAULT_CONFIDENCE` |
| **MCP å·¥å…·** | `mde_<action>` | `mde_extract`, `mde_detect_page` |
| **æ•°æ®åº“è¡¨** | `mde_<name>` | `mde_extracted_items` |
| **é…ç½®æ–‡ä»¶** | `mde_<name>.json` | `mde_extraction_rules.json` |

### å‘½åæ£€æŸ¥æ¸…å•

åœ¨å†™æ¯ä¸ªæ–‡ä»¶å‰ï¼Œç¡®è®¤ï¼š
- [x] ç›®å½•åä»¥ `mde_` å¼€å¤´
- [x] æ–‡ä»¶åä»¥ `mde_` å¼€å¤´
- [x] pub struct/enum ä»¥ `Mde` å¼€å¤´
- [x] pub fn ä»¥ `mde_` å¼€å¤´ï¼ˆimpl å†…éƒ¨æ–¹æ³•é™¤å¤–ï¼‰
- [x] MCP å·¥å…·ä»¥ `mde_` å¼€å¤´

---

## ğŸ“Š å½“å‰è¿›åº¦

### Phase 1: Domain å±‚æ•°æ®æ¨¡å‹ âœ…

| Step | æè¿° | æ–‡ä»¶ä½ç½® | çŠ¶æ€ |
|------|------|----------|------|
| 1.1 | æ•°æ®æ¨¡å‹ | `core/domain/mde_extraction/mde_data_types.rs` | âœ… |
| 1.2 | é€‰æ‹©å™¨ç³»ç»Ÿ | `core/domain/mde_extraction/mde_selector.rs` | âœ… |
| 1.3 | è§„åˆ™ç»“æ„ | `core/domain/mde_extraction/mde_rule.rs` | âœ… |
| 1.4 | æ³¨å†Œæ¨¡å— | `core/domain/mde_extraction/mod.rs` + `domain/mod.rs` | âœ… |

### Phase 2: Application å±‚è§„åˆ™å¼•æ“ âœ…

| Step | æè¿° | æ–‡ä»¶ä½ç½® | çŠ¶æ€ |
|------|------|----------|------|
| 2.1 | æå–å™¨æœåŠ¡ | `core/application/mde_extractor_service.rs` | âœ… |
| 2.2 | XML è§£æå™¨ | `MdeXmlParser` in mde_extractor_service.rs | âœ… |
| 2.3 | é¡µé¢æ£€æµ‹ | `detect_page()` æ–¹æ³• | âœ… |
| 2.4 | æ•°æ®æå– | `extract()` æ–¹æ³• | âœ… |
| 2.5 | åå¤„ç†è§„åˆ™ | `apply_post_process()` æ–¹æ³• | âœ… |

### Phase 3: MCP å·¥å…·å±‚ âœ…

| Step | æè¿° | æ–‡ä»¶ä½ç½® | çŠ¶æ€ |
|------|------|----------|------|
| 3.1 | mde_extract å·¥å…· | `core/adapters/inbound/mcp_server/mde_tools.rs` | âœ… |
| 3.2 | mde_detect_page å·¥å…· | åŒä¸Š | âœ… |
| 3.3 | mde_save å·¥å…· | åŒä¸Š (TODO: æ•°æ®åº“å®ç°) | âœ… |
| 3.4 | mde_list_supported_apps å·¥å…· | åŒä¸Š | âœ… |
| 3.5 | å·¥å…·æ³¨å†Œ | `tools.rs` + `mod.rs` é›†æˆ | âœ… |

### Phase 4: é¢„ç½®è§„åˆ™ä¸æ–‡æ¡£ â³

| Step | æè¿° | æ–‡ä»¶ä½ç½® | çŠ¶æ€ |
|------|------|----------|------|
| 4.1 | æŠ–éŸ³è¯„è®ºè§„åˆ™ | å†…ç½®åœ¨ `mde_tools.rs` | âœ… |
| 4.2 | å°çº¢ä¹¦è¯„è®ºè§„åˆ™ | å†…ç½®åœ¨ `mde_tools.rs` | âœ… |
| 4.3 | JSON è§„åˆ™é…ç½®æ–‡ä»¶ | `data/mde_extraction_rules.json` | â¬œ |
| 4.4 | ä½¿ç”¨æ–‡æ¡£ | `docs/4ã€mcp/extraction-system/01-ä½¿ç”¨æŒ‡å—.md` | â¬œ |

### Phase 5: AI å¢å¼ºï¼ˆåç»­ï¼‰ â¬œ

| Step | æè¿° | æ–‡ä»¶ä½ç½® | çŠ¶æ€ |
|------|------|----------|------|
| 5.1 | AI æå–å¼•æ“ | `core/application/mde_ai_extractor.rs` | â¬œ |
| 5.2 | æ··åˆæ¨¡å¼è°ƒåº¦ | `MdeExtractor` æ‰©å±• | â¬œ |
| 5.3 | è§„åˆ™å­¦ä¹ å™¨ | `mde_rule_learner.rs` | â¬œ |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MCP AI ä»£ç†                                  â”‚
â”‚                    (Claude/GPT/æ··å…ƒ)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ MCP åè®®è°ƒç”¨
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MCP å·¥å…·å±‚ (tools.rs)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ mde_extract â”‚  â”‚ mde_detect_page â”‚  â”‚  mde_save   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Application å±‚ (mde_extraction/)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    MdeExtractor (è°ƒåº¦å™¨)                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ RuleEngine  â”‚  â”‚ AiExtractor â”‚  â”‚    PageDetector     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ (è§„åˆ™åŒ¹é…)   â”‚  â”‚ (AI åˆ†æ)   â”‚  â”‚    (é¡µé¢è¯†åˆ«)       â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚         â”‚                â”‚                    â”‚               â”‚   â”‚
â”‚  â”‚         â–¼                â–¼                    â–¼               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚              MdeRuleLoader (è§„åˆ™åŠ è½½)                  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚         â†“ è¯»å– mde_extraction_rules.json              â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚  MdeStorage    â”‚  â”‚ MdeRuleLearner â”‚                             â”‚
â”‚  â”‚  (æ•°æ®å­˜å‚¨)     â”‚  â”‚  (è§„åˆ™å­¦ä¹ )    â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Domain å±‚ (mde_extraction/)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ MdeDataType  â”‚  â”‚ MdeSelector  â”‚  â”‚   MdeRule    â”‚               â”‚
â”‚  â”‚ MdeFieldValueâ”‚  â”‚ MdeSelectorKindâ”‚ â”‚ MdeAppRule  â”‚               â”‚
â”‚  â”‚ MdeExtracted â”‚  â”‚              â”‚  â”‚ MdePageRule â”‚               â”‚
â”‚  â”‚    Item      â”‚  â”‚              â”‚  â”‚ MdeFieldRuleâ”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src-tauri/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ mde_extraction_rules.json       # è§„åˆ™é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â””â”€â”€ core/
â”‚       â”œâ”€â”€ domain/
â”‚       â”‚   â”œâ”€â”€ mod.rs                  # [ä¿®æ”¹] å¯¼å‡º mde_extraction
â”‚       â”‚   â””â”€â”€ mde_extraction/         # [æ–°å¢] Domain å±‚
â”‚       â”‚       â”œâ”€â”€ mod.rs
â”‚       â”‚       â”œâ”€â”€ mde_data_types.rs   # æ•°æ®ç±»å‹å®šä¹‰
â”‚       â”‚       â”œâ”€â”€ mde_selector.rs     # é€‰æ‹©å™¨ç³»ç»Ÿ
â”‚       â”‚       â””â”€â”€ mde_rule.rs         # è§„åˆ™ç»“æ„
â”‚       â”œâ”€â”€ application/
â”‚       â”‚   â”œâ”€â”€ mod.rs                  # [ä¿®æ”¹] å¯¼å‡º mde_extraction
â”‚       â”‚   â”œâ”€â”€ context.rs              # [ä¿®æ”¹] æ·»åŠ  MdeExtractor
â”‚       â”‚   â””â”€â”€ mde_extraction/         # [æ–°å¢] Application å±‚
â”‚       â”‚       â”œâ”€â”€ mod.rs              # MdeExtractor å…¥å£
â”‚       â”‚       â”œâ”€â”€ mde_rule_loader.rs  # è§„åˆ™åŠ è½½å™¨
â”‚       â”‚       â”œâ”€â”€ mde_rule_engine.rs  # è§„åˆ™åŒ¹é…å¼•æ“
â”‚       â”‚       â”œâ”€â”€ mde_page_detector.rs# é¡µé¢æ£€æµ‹å™¨
â”‚       â”‚       â”œâ”€â”€ mde_ai_extractor.rs # AI æå–å¼•æ“
â”‚       â”‚       â”œâ”€â”€ mde_rule_learner.rs # è§„åˆ™å­¦ä¹ å™¨
â”‚       â”‚       â””â”€â”€ mde_storage.rs      # æ•°æ®å­˜å‚¨
â”‚       â””â”€â”€ adapters/
â”‚           â””â”€â”€ inbound/
â”‚               â””â”€â”€ mcp_server/
â”‚                   â””â”€â”€ tools.rs        # [ä¿®æ”¹] æ·»åŠ  mde_* å·¥å…·
```

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**å½“å‰ä»»åŠ¡**: Phase 1.1 - åˆ›å»ºæ•°æ®æ¨¡å‹

åˆ›å»ºæ–‡ä»¶ `src-tauri/src/core/domain/mde_extraction/mde_data_types.rs`ï¼Œå®šä¹‰ï¼š
- `MdeDataType` - æ•°æ®ç±»å‹æšä¸¾
- `MdeFieldValue` - å­—æ®µå€¼ç±»å‹
- `MdeExtractedItem` - æå–çš„å•æ¡æ•°æ®
- `MdeExtractionResult` - æå–ç»“æœ
- `MdeExtractionMethod` - æå–æ–¹æ³•
- `MdeAppInfo` - APP ä¿¡æ¯

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|----------|
| 2025-12-21 | åˆ›å»ºè®¾è®¡æ–‡æ¡£ï¼Œå¼€å§‹ Phase 1 |

