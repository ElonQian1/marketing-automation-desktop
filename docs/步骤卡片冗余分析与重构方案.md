# ğŸ”¥ æ­¥éª¤å¡ç‰‡å†—ä½™åˆ†æä¸é‡æ„æ–¹æ¡ˆ

## ğŸ“Š å‘ç°çš„å†—ä½™å®ç°

### ğŸš¨ ä¸¥é‡å†—ä½™çš„æ­¥éª¤å¡ç‰‡ç»„ä»¶

1. **æ™ºèƒ½åˆ†æç›¸å…³æ­¥éª¤å¡ç‰‡** (4ä¸ªé‡å¤)
   - `src/modules/universal-ui/components/intelligent-step-card.tsx` âœ… (æ–°å»ºçš„ç»Ÿä¸€ç»„ä»¶)
   - `src/modules/universal-ui/ui/components/universal-smart-step-card.tsx` âŒ (å†—ä½™)
   - `src/modules/universal-ui/ui/components/universal-enhanced-step-card.tsx` âŒ (å†—ä½™)
   - `src/modules/universal-ui/demo/universal-enhanced-step-card-demo.tsx` âŒ (æ¼”ç¤ºç»„ä»¶ï¼Œå†—ä½™)

2. **ç­–ç•¥é…ç½®æ­¥éª¤å¡ç‰‡** (2ä¸ªé‡å¤)
   - `src/modules/universal-ui/ui/StepCard.tsx` âŒ (ç­–ç•¥é…ç½®å¡ç‰‡ï¼ŒåŠŸèƒ½é‡å )
   - `src/components/feature-modules/script-builder/components/StepCard.tsx` âŒ (è„šæœ¬æ­¥éª¤å¡ç‰‡)

3. **è„šæœ¬æ„å»ºæ­¥éª¤å¡ç‰‡** (å¤šä¸ªå˜ä½“)
   - `src/components/DraggableStepCard.tsx` (ä¸»è¦çš„å¯æ‹–æ‹½æ­¥éª¤å¡ç‰‡)
   - `src/components/SmartStepCardWrapper.tsx` (åŒ…è£…å™¨)
   - `src/modules/enhanced-step-card/EnhancedStepCard.tsx` (å¢å¼ºæ­¥éª¤å¡ç‰‡)
   - `src/modules/loop-control/components/LoopStepCard.tsx` (å¾ªç¯æ­¥éª¤å¡ç‰‡)

4. **å…¶ä»–æ­¥éª¤ç›¸å…³ç»„ä»¶**
   - `src/components/universal-ui/script-builder/components/StepItem.tsx`
   - `src/components/universal-ui/script-builder/components/StepItemBase.tsx`
   - `src/components/universal-ui/script-builder/components/StepCardItem.tsx`

## ğŸ¯ æ ¸å¿ƒé—®é¢˜åˆ†æ

### 1. **åŠŸèƒ½é‡å **
- æ™ºèƒ½åˆ†ææ­¥éª¤å¡ç‰‡æœ‰4ä¸ªä¸åŒå®ç°
- æ¯ä¸ªéƒ½è¯•å›¾è§£å†³"åˆ†ææœªå®Œæˆæ—¶çš„é»˜è®¤å€¼å±•ç¤º"é—®é¢˜
- æ¥å£ä¸ç»Ÿä¸€ï¼Œå¯¼è‡´ä½¿ç”¨æ··ä¹±

### 2. **æ¶æ„æ··ä¹±**
- åŒæ ·çš„ä¸šåŠ¡é€»è¾‘åœ¨å¤šä¸ªç»„ä»¶ä¸­é‡å¤å®ç°
- æ²¡æœ‰ç»Ÿä¸€çš„æ•°æ®æµå’ŒçŠ¶æ€ç®¡ç†
- è¿åäº†DRYåŸåˆ™å’Œå•ä¸€èŒè´£åŸåˆ™

### 3. **ç”¨æˆ·ä½“éªŒä¸ä¸€è‡´**
- ä¸åŒåœºæ™¯ä¸‹çš„æ­¥éª¤å¡ç‰‡æ ·å¼å’Œäº¤äº’ä¸ç»Ÿä¸€
- åˆ†æçŠ¶æ€å±•ç¤ºé€»è¾‘åˆ†æ•£ï¼Œç”¨æˆ·å›°æƒ‘

## ğŸš€ é‡æ„æ–¹æ¡ˆï¼šç»Ÿä¸€æ­¥éª¤å¡ç‰‡æ¶æ„

### Phase 1: ç»Ÿä¸€æ™ºèƒ½åˆ†ææ­¥éª¤å¡ç‰‡ (ç«‹å³æ‰§è¡Œ)

#### 1.1 ä¿ç•™ç»Ÿä¸€ç»„ä»¶
```typescript
// âœ… ä¿ç•™ï¼šsrc/modules/universal-ui/components/intelligent-step-card.tsx
// è¿™æ˜¯æˆ‘ä»¬æ–°å»ºçš„ç»Ÿä¸€æ™ºèƒ½æ­¥éª¤å¡ç‰‡ï¼ŒåŠŸèƒ½å®Œæ•´
```

#### 1.2 åˆ é™¤å†—ä½™ç»„ä»¶
```bash
# âŒ åˆ é™¤è¿™äº›å†—ä½™ç»„ä»¶
src/modules/universal-ui/ui/components/universal-smart-step-card.tsx
src/modules/universal-ui/ui/components/universal-enhanced-step-card.tsx  
src/modules/universal-ui/demo/universal-enhanced-step-card-demo.tsx
```

#### 1.3 æ›´æ–°å¯¼å…¥å¼•ç”¨
```typescript
// æ‰€æœ‰åœ°æ–¹ç»Ÿä¸€ä½¿ç”¨
import { IntelligentStepCard } from '@/modules/universal-ui';
```

### Phase 2: æ•´åˆç­–ç•¥é…ç½®å¡ç‰‡

#### 2.1 åˆå¹¶ç­–ç•¥é…ç½®é€»è¾‘
å°† `src/modules/universal-ui/ui/StepCard.tsx` çš„ç­–ç•¥é…ç½®åŠŸèƒ½æ•´åˆåˆ° `IntelligentStepCard` ä¸­

#### 2.2 ç»Ÿä¸€æ•°æ®æ¥å£
```typescript
interface UnifiedStepCardData {
  // åŸºç¡€ä¿¡æ¯
  stepId: string;
  stepName: string;
  stepType: string;
  
  // æ™ºèƒ½åˆ†æç›¸å…³
  analysisState: AnalysisState;
  analysisProgress: number;
  smartCandidates: StrategyCandidate[];
  activeStrategy: StrategyCandidate;
  fallbackStrategy: StrategyCandidate;
  
  // ç­–ç•¥é…ç½®ç›¸å…³
  strategyMode: 'intelligent' | 'manual' | 'static';
  availableStrategies: Strategy[];
}
```

### Phase 3: è„šæœ¬æ­¥éª¤å¡ç‰‡ä¸“ä¸šåŒ–

#### 3.1 æ˜ç¡®èŒè´£åˆ†å·¥
- `DraggableStepCard.tsx` â†’ ä¸“é—¨ç”¨äºè„šæœ¬æ„å»ºå™¨çš„å¯æ‹–æ‹½æ­¥éª¤å¡ç‰‡
- `IntelligentStepCard.tsx` â†’ ä¸“é—¨ç”¨äºæ™ºèƒ½åˆ†æçš„æ­¥éª¤å¡ç‰‡
- `LoopStepCard.tsx` â†’ ä¸“é—¨ç”¨äºå¾ªç¯æ§åˆ¶çš„æ­¥éª¤å¡ç‰‡

#### 3.2 å»ºç«‹æ¸…æ™°çš„ä½¿ç”¨åœºæ™¯
```typescript
// è„šæœ¬æ„å»ºå™¨åœºæ™¯
<DraggableStepCard step={scriptStep} onDrag={handleDrag} />

// æ™ºèƒ½åˆ†æåœºæ™¯  
<IntelligentStepCard stepCard={analysisStep} onUpgrade={handleUpgrade} />

// å¾ªç¯æ§åˆ¶åœºæ™¯
<LoopStepCard loopConfig={config} onConfigChange={handleChange} />
```

## ğŸ”§ "åˆ†ææœªå®Œæˆï¼Œå…ˆé‡‡ç”¨é»˜è®¤å€¼"çš„æœ€ç»ˆå®ç°

### æ ¸å¿ƒè®¾è®¡åŸåˆ™
1. **ç«‹å³å¯ç”¨** - ç‚¹é€‰å…ƒç´ åç«‹å³åˆ›å»ºå¸¦é»˜è®¤å€¼çš„æ­¥éª¤å¡ç‰‡
2. **åå°åˆ†æ** - åˆ†æåœ¨åå°è¿›è¡Œï¼Œä¸é˜»å¡ç”¨æˆ·æ“ä½œ
3. **æ™ºèƒ½å‡çº§** - åˆ†æå®Œæˆåæä¾›å‡çº§é€‰é¡¹æˆ–è‡ªåŠ¨å‡çº§
4. **çŠ¶æ€é€æ˜** - ç”¨æˆ·å§‹ç»ˆçŸ¥é“å½“å‰çš„åˆ†æçŠ¶æ€å’Œå¯ç”¨é€‰é¡¹

### å®ç°æµç¨‹
```mermaid
graph TD
    A[ç”¨æˆ·ç‚¹é€‰å…ƒç´ ] --> B[ç«‹å³åˆ›å»ºæ­¥éª¤å¡ç‰‡]
    B --> C[ä½¿ç”¨FallbackStrategyä½œä¸ºé»˜è®¤å€¼]
    C --> D[æ­¥éª¤å¡ç‰‡ç«‹å³å¯ç”¨]
    C --> E[å¯åŠ¨åå°æ™ºèƒ½åˆ†æ]
    E --> F[æ˜¾ç¤ºåˆ†æè¿›åº¦]
    F --> G[åˆ†æå®Œæˆ]
    G --> H{ç½®ä¿¡åº¦ >= é˜ˆå€¼?}
    H -->|æ˜¯| I[è‡ªåŠ¨å‡çº§åˆ°æ¨èç­–ç•¥]
    H -->|å¦| J[æ˜¾ç¤º"ä¸€é”®å‡çº§"æŒ‰é’®]
    I --> K[ç”¨æˆ·å¯ç»§ç»­æ“ä½œ]
    J --> K
```

### çŠ¶æ€å±•ç¤ºè®¾è®¡
```typescript
// åˆ†æçŠ¶æ€çš„UIå±•ç¤º
const getAnalysisStatusInfo = (state: AnalysisState) => {
  switch (state) {
    case 'idle':
      return {
        type: 'info',
        message: 'ä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼Œç«‹å³å¯ç”¨',
        description: 'åå°æ™ºèƒ½åˆ†æå¯è·å¾—æ›´ä¼˜ç­–ç•¥',
        showProgress: false
      };
      
    case 'analyzing':
      return {
        type: 'info', 
        message: 'æ™ºèƒ½åˆ†æè¿›è¡Œä¸­...',
        description: `è¿›åº¦ ${progress}% | å½“å‰ä½¿ç”¨é»˜è®¤ç­–ç•¥`,
        showProgress: true
      };
      
    case 'completed':
      return {
        type: 'success',
        message: 'å‘ç°æ›´ä¼˜ç­–ç•¥',
        description: `ç½®ä¿¡åº¦ ${confidence}% | ç‚¹å‡»å‡çº§`,
        showProgress: false,
        action: <Button type="primary">ä¸€é”®å‡çº§</Button>
      };
  }
};
```

## ğŸ“‹ ç«‹å³è¡ŒåŠ¨è®¡åˆ’

### ä»Šæ—¥ä»»åŠ¡ (2å°æ—¶å†…å®Œæˆ)

1. **æ¸…ç†å†—ä½™ç»„ä»¶** (30åˆ†é’Ÿ)
   - åˆ é™¤ `universal-smart-step-card.tsx`
   - åˆ é™¤ `universal-enhanced-step-card.tsx` 
   - åˆ é™¤æ¼”ç¤ºç»„ä»¶

2. **æ›´æ–°å¯¼å…¥å¼•ç”¨** (30åˆ†é’Ÿ)
   - æ›´æ–°æ‰€æœ‰ä½¿ç”¨æ—§ç»„ä»¶çš„åœ°æ–¹
   - ç»Ÿä¸€ä½¿ç”¨ `IntelligentStepCard`

3. **æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§** (30åˆ†é’Ÿ)
   - ç¡®ä¿æ¼”ç¤ºé¡µé¢æ­£å¸¸å·¥ä½œ
   - éªŒè¯åˆ†æçŠ¶æ€å±•ç¤ºæ­£ç¡®

4. **æ–‡æ¡£æ›´æ–°** (30åˆ†é’Ÿ)
   - æ›´æ–°ç»„ä»¶ä½¿ç”¨æ–‡æ¡£
   - è®°å½•é‡æ„ç»“æœ

### éªŒæ”¶æ ‡å‡†

- âœ… åªæœ‰ä¸€ä¸ªæ™ºèƒ½æ­¥éª¤å¡ç‰‡ç»„ä»¶ `IntelligentStepCard`
- âœ… æ‰€æœ‰åˆ†æçŠ¶æ€éƒ½èƒ½æ­£ç¡®å±•ç¤º
- âœ… "ä¸ç­‰åˆ†æå®Œæˆ"çš„æµç¨‹å·¥ä½œæ­£å¸¸
- âœ… æ— TypeScriptç¼–è¯‘é”™è¯¯
- âœ… æ¼”ç¤ºé¡µé¢åŠŸèƒ½å®Œæ•´

è¿™ä¸ªé‡æ„å°†å½»åº•è§£å†³ä»£ç å†—ä½™é—®é¢˜ï¼Œå»ºç«‹æ¸…æ™°ç»Ÿä¸€çš„æ­¥éª¤å¡ç‰‡æ¶æ„ï¼