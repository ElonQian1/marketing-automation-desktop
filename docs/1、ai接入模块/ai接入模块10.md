下面是我给你准备好的**任务清单文档**（直接放进仓库即可）。已按你的规范：**第一行是文件路径**。把它保存为 `docs/lead-hunt/TASKS.md`，然后发给你的 AI 代理开工就行。

```markdown
# docs/lead-hunt/TASKS.md

## 🎯 目标
在 ADB 真机 dump 未就绪的情况下，先闭环跑通“精准获客”：**导入评论 → AI 意图识别 → 列表筛选与建议回复 → 生成 & 执行（模拟）回放计划**。  
等 ADB/dump 模块完成后，仅替换 Provider，无需改上层业务与 UI。

> 约定：不新建分支，直接在 `main` 迭代小步提交；提交信息用中文；所有新文件代码块首行写“文件相对路径”。

---

## ✅ 交付路线（3 个连续提交 / 或 3 个 PR）

### PR-1：数据与协议初始化（导入 → 列表 → 生成回放计划到文件）
**新增/修改（后端 / Rust）**
- `src-tauri/src/services/lead_hunt.rs`  
  - `RawComment { id, platform, videoUrl?, author, content, ts? }`  
  - `ReplayPlan { id, platform, videoUrl, author, comment, suggested_reply? }`  
  - `save_comments(Vec<RawComment>)` / `list_comments()` / `write_replay_plan(ReplayPlan)`
- `src-tauri/src/commands_lead_hunt.rs`  
  - `lh_save_comments(items)` / `lh_list_comments()` / `lh_import_comments()` / `lh_create_replay_plan(plan)`
- `src-tauri/src/mock/social_comments.json`（3~5 条示例数据）
- `src-tauri/src/main.rs` 注册上述命令

**新增/修改（前端 / React）**
- `src/pages/LeadHunt.tsx`  
  - 顶部按钮：导入（`lh_import_comments`）、刷新（`lh_list_comments`）  
  - 表格：platform/author/content；行操作：**生成回放计划**（`lh_create_replay_plan`）

**完成标准（DoD）**
- 运行 `pnpm tauri dev`，进入“精准获客”页  
- 能导入 mock 评论并展示  
- 点击任意行“生成回放计划”，写入 `debug/outbox/replay_plans.json`

**建议提交信息**
```

feat(lead-hunt): 初始化精准获客闭环（导入/列表/生成回放计划-模拟）

```

---

### PR-2：AI 意图识别（函数调用工具，OpenAI/混元均可）
**新增/修改（前端）**
- `src/ai/schemas/leadIntent.schema.ts`：`return_lead_analysis` 函数工具（intent/信心/实体/建议回复）
- `src/features/leadHunt/analyzeLead.ts`：`analyzeOne` / `analyzeBatch`（默认并发 4，指数退避重试）
- `src/pages/LeadHunt.tsx`  
  - 新增“**AI 批量分析**”按钮；展示 `intent(%) / reply_suggestion`；支持按意图过滤

> 可选强化：把批处理下沉到后端命令 `lh_analyze_comments`，统一限流与入库（当前先前端直调可行，后续再沉下去）。

**完成标准（DoD）**
- 在“AI 设置”页填好 provider+模型（如 `gpt-4o-mini` / `hunyuan-turbos-latest`）  
- 点击“AI 批量分析”，出现意图/置信度/建议回复，可按意图筛选  
- 生成回放计划时，把 `reply_suggestion` 一起写入 `suggested_reply`

**建议提交信息**
```

feat(lead-hunt): 接入AI意图识别（函数调用），支持批量分析与建议回复展示

````

---

### PR-3：回放模拟执行器（Orchestrator + MockDumpProvider）
**新增/修改（后端 / Rust）**
- `src-tauri/src/device/provider.rs`  
  ```rust
  #[async_trait] pub trait DumpProvider {
    async fn open_app(&self, platform: &str) -> anyhow::Result<()>;
    async fn open_video(&self, url: &str) -> anyhow::Result<()>;
    async fn dump_xml(&self) -> anyhow::Result<String>;
    async fn reply(&self, author: &str, text: &str) -> anyhow::Result<()>;
  }
````

* `src-tauri/src/device/mock.rs`：`MockDumpProvider`（返回固定 XML，reply 记日志）
* `src-tauri/src/device/orchestrator.rs`：`ReplayOrchestrator<P: DumpProvider>::run(&ReplayPlan)`
* `src-tauri/src/commands_lead_hunt.rs` 新增

  * `lh_run_replay_plan(plan_id)`：读取 `replay_plans.json`，用 `ReplayOrchestrator::<MockDumpProvider>` 执行；过程中通过 `app.emit_all("orchestrator://status", "...")` 推送步骤事件

**新增/修改（前端 / React）**

* `src/pages/LeadHunt.tsx`

  * 行操作新增“**执行模拟**”（`lh_run_replay_plan`）
  * 订阅 `orchestrator://status`（可先弹窗/console，后续做漂亮的日志面板）

**完成标准（DoD）**

* “执行模拟”能看到：open_app → open_video → dump → reply 的顺序日志
* 不依赖 ADB；ADB dump 就绪后仅需新增 `AdbDumpProvider` 并替换绑定

**建议提交信息**

```
feat(lead-hunt): 新增回放 Orchestrator 与 MockDumpProvider，支持执行模拟与事件日志
```

---

## 🔧 运行与验证（AI 代理执行提示）

1. **安装依赖**

   * 前端：`pnpm i`（或 `npm i` / `yarn`）
   * Rust：确保 stable 工具链 & OS Keyring 可用

2. **启动**

   * `pnpm tauri dev`

3. **验证流程**

   * 打开“AI 设置”页（选择 OpenAI/混元、设置模型）
   * 进入“精准获客”页
   * PR-1：导入 mock → 列表 → 生成 `debug/outbox/replay_plans.json`
   * PR-2：AI 批量分析 → 过滤与建议回复 → 生成计划（含 suggested_reply）
   * PR-3：执行模拟 → 观察 `orchestrator://status` 日志

---

## 📐 契约与类型速记

```ts
// 前端：生成回放计划
invoke("lh_create_replay_plan", {
  plan: {
    id, platform, videoUrl, author, comment, suggested_reply?: string
  }
})

// 执行模拟
invoke("lh_run_replay_plan", { planId: string })
```

函数调用工具（两端通用）：

```ts
// return_lead_analysis
{
  intent: "询价" | "询地址" | "售后" | "咨询" | "无效",
  confidence: number, // 0..1
  entities: { product?, quantity?, location?, phone?, priceTarget? },
  reply_suggestion: string,
  tags?: string[]
}
```

---

## 🧩 后续拓展（不在本轮交付，但保留接口位）

* **AdbDumpProvider**：替换 `MockDumpProvider`，接入真机 ADB / UiAutomator dump；Orchestrator 无需变更
* **入库与观测**：将 `lead_analyses` 与 `replay_plans` 存 SQLite（状态机：pending/running/done/failed）
* **定位策略**：在 `dump_xml()` 的 XML 中实现 作者/评论 文本相似度 + 邻接定位；分页策略
* **速率/重试面板**：在设置页暴露并发/重试参数；进度条与剩余时间估计
* **隐私合规**：对手机号/地址等做脱敏；详情页点击显示原文

---

```

需要我把这个 `TASKS.md` 直接再拆分成 3 份 PR 说明（各自 README 级别）也可以；或者要一个**最小演示页**把 `orchestrator://status` 日志渲染得更好看，也可以马上补上。
::contentReference[oaicite:0]{index=0}
```
