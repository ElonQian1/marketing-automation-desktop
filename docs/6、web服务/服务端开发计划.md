# æœåŠ¡ç«¯å¼€å‘è®¡åˆ’

> åˆ›å»ºæ—¶é—´ï¼š2025-12-30
> çŠ¶æ€ï¼šğŸš§ è¿›è¡Œä¸­

---

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

ä¸ºå°çº¢ä¹¦è¥é”€è‡ªåŠ¨åŒ–é¡¹ç›®æ–°å¢äº‘ç«¯æœåŠ¡ï¼Œå®ç°ï¼š
1. **è¯„è®ºæ•°æ®äº‘ç«¯å­˜å‚¨** - PC ç«¯å’Œ Android ç«¯é‡‡é›†çš„è¯„è®ºåŒæ­¥åˆ°æœåŠ¡å™¨
2. **è®¾å¤‡é…ç½®äº‘ç«¯åŒæ­¥** - æ”¯æŒé‡è£…åæ¢å¤è®¾ç½®ï¼ˆAI API Key ç­‰ï¼‰
3. **Web ç®¡ç†ç•Œé¢** - æŸ¥çœ‹è¯„è®ºã€ç­›é€‰æ½œåœ¨å®¢æˆ·ã€å¯¼å‡ºæ•°æ®

---

## ğŸ—ï¸ æ¶æ„å†³ç­–

| å†³ç­–é¡¹ | é€‰æ‹© | è¯´æ˜ |
|--------|------|------|
| ç›®å½•ç»“æ„ | æŠ˜ä¸­æ–¹æ¡ˆ A' | ä¿æŒ `employeeGUI/` ä¸æ”¹åï¼Œæ–°å¢ `server/` |
| ä¾èµ–ç®¡ç† | Cargo Workspace | å…±äº«ä¾èµ–ï¼Œç»Ÿä¸€ç‰ˆæœ¬ |
| æ•°æ®åº“ | PostgreSQL | å…è´¹ã€æ€§èƒ½å¥½ã€æ”¯æŒå¹¶å‘ |
| Web æ¡†æ¶ | Axum | Rust å¼‚æ­¥æ¡†æ¶ï¼Œå·²åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ |
| éƒ¨ç½²æ–¹å¼ | äº¤å‰ç¼–è¯‘ | cargo-zigbuildï¼Œæ— éœ€ Docker |
| è®¤è¯æ–¹å¼ | æ— éœ€ç™»å½• | è®¾å¤‡ ID å³èº«ä»½ |
| æ•°æ®åŒæ­¥ | å®æ—¶ä¸Šä¼  | APK ç¦»çº¿æ—¶æœ¬åœ°ç¼“å­˜ |
| é…ç½®åŒæ­¥ | æœ¬åœ°ä¼˜å…ˆ + äº‘ç«¯å¢é‡åˆå¹¶ | ä¸ä¸¢æ•°æ® |
| AI Key ç­–ç•¥ | æœ¬åœ°ä¼˜å…ˆï¼ŒæœåŠ¡å™¨å…œåº• | æœ¬åœ°æ²¡æœ‰åˆ™ç”¨æœåŠ¡å™¨çš„ |

### æœåŠ¡å™¨ä¿¡æ¯

```
IP: 119.91.19.232
ç³»ç»Ÿ: Ubuntu Server 24.04 LTS 64bit
ç”¨æˆ·: ubuntu
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
employeeGUI/
â”œâ”€â”€ Cargo.toml          # ğŸ†• Workspace æ ¹é…ç½®
â”œâ”€â”€ src-tauri/          # PC ç«¯ Rust åç«¯ (workspace member)
â”œâ”€â”€ server/             # ğŸ†• äº‘ç«¯æœåŠ¡ (workspace member)
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.rs
â”‚   â”‚   â”œâ”€â”€ config.rs
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ comments.rs
â”‚   â”‚   â”‚   â””â”€â”€ device_configs.rs
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ device.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ comments.rs
â”‚   â”‚   â”‚   â””â”€â”€ stats.rs
â”‚   â”‚   â””â”€â”€ web/
â”‚   â”‚       â””â”€â”€ static/
â”‚   â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ deploy.ps1
â”œâ”€â”€ src/                # PC ç«¯ React å‰ç«¯
â””â”€â”€ android-agent/      # Android ç«¯ (Git Submodule)
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

```sql
-- 1. è®¾å¤‡é…ç½®è¡¨ï¼ˆè®¾å¤‡å³èº«ä»½ï¼‰
CREATE TABLE device_configs (
    device_id VARCHAR(128) PRIMARY KEY,
    device_type VARCHAR(16) NOT NULL,         -- 'pc' | 'android'
    device_name VARCHAR(64),                  -- ç”¨æˆ·è‡ªå®šä¹‰è®¾å¤‡å
    ai_api_key TEXT,
    ai_provider VARCHAR(32),
    config_json JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 2. è¯„è®ºè¡¨ï¼ˆæŒ‰è®¾å¤‡éš”ç¦»ï¼‰
CREATE TABLE lead_comments (
    id VARCHAR(64) PRIMARY KEY,
    device_id VARCHAR(128) NOT NULL,
    platform VARCHAR(16) NOT NULL,
    video_url TEXT,
    author VARCHAR(128) NOT NULL,
    content TEXT NOT NULL,
    ts BIGINT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- 3. åˆ†æç»“æœè¡¨
CREATE TABLE lead_analyses (
    id SERIAL PRIMARY KEY,
    comment_id VARCHAR(64) REFERENCES lead_comments(id) ON DELETE CASCADE,
    intent VARCHAR(32) NOT NULL,
    confidence REAL NOT NULL,
    entities_json JSONB,
    reply_suggestion TEXT,
    tags_json JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 4. æœåŠ¡å™¨å…¬å…±é…ç½®
CREATE TABLE server_configs (
    key VARCHAR(64) PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at TIMESTAMP DEFAULT NOW()
);
```

---

## ğŸ”Œ API æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/device/{id}/config` | GET | è·å–è®¾å¤‡é…ç½® |
| `/api/device/{id}/config` | PUT | æ›´æ–°è®¾å¤‡é…ç½® |
| `/api/comments/batch` | POST | æ‰¹é‡ä¸Šä¼ è¯„è®º |
| `/api/comments` | GET | åˆ†é¡µæŸ¥è¯¢è¯„è®º |
| `/api/ai-config/fallback` | GET | æœåŠ¡å™¨å…œåº• AI Key |
| `/api/stats` | GET | ç»Ÿè®¡æ•°æ® |
| `/api/export/csv` | GET | å¯¼å‡º CSV |

---

## âœ… å®æ–½æ£€æŸ¥æ¸…å•

### Phase 1: Workspace é…ç½®
- [x] åˆ›å»ºæ ¹ç›®å½• `Cargo.toml`
- [x] ä¿®æ”¹ `src-tauri/Cargo.toml` é€‚é… workspace

### Phase 2: Server åŸºç¡€æ¡†æ¶
- [x] åˆ›å»º `server/Cargo.toml`
- [x] å®ç° `main.rs`
- [x] å®ç° `config.rs`

### Phase 3: æ•°æ®åº“å±‚
- [x] å®ç° `db/schema.rs`
- [x] å®ç° `db/device_configs.rs`
- [x] å®ç° `db/comments.rs`

### Phase 4: API å±‚
- [x] å®ç° `api/device.rs`
- [x] å®ç° `api/comments.rs`
- [x] å®ç° `api/stats.rs`

### Phase 5: éƒ¨ç½²
- [ ] ç¼–å†™ `deploy.ps1` âœ… å·²åˆ›å»º
- [ ] æœåŠ¡å™¨å®‰è£… PostgreSQL
- [ ] é¦–æ¬¡éƒ¨ç½²

---

## ğŸ› é—®é¢˜è®°å½•

ï¼ˆå¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜è®°å½•äºæ­¤ï¼‰

