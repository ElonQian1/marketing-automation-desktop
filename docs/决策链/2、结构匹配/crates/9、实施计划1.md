è®©æˆ‘æŸ¥çœ‹æ‚¨æ–°çš„è®¡åˆ’æ–‡æ¡£ï¼š 

è¯»å– [](file:///d%3A/rust/active-projects/%E5%B0%8F%E7%BA%A2%E4%B9%A6/employeeGUI/docs/%E5%86%B3%E7%AD%96%E9%93%BE/2%E3%80%81%E7%BB%93%E6%9E%84%E5%8C%B9%E9%85%8D/crates/7%E3%80%81%E9%9D%9Ecrates%E8%AE%A1%E5%88%92.md)

è¯»å– [](file:///d%3A/rust/active-projects/%E5%B0%8F%E7%BA%A2%E4%B9%A6/employeeGUI/docs/%E5%86%B3%E7%AD%96%E9%93%BE/2%E3%80%81%E7%BB%93%E6%9E%84%E5%8C%B9%E9%85%8D/crates/8%E3%80%81%E9%9D%9Ecrates%E8%AE%A1%E5%88%92%20%E4%BB%A3%E7%A0%81%E5%BB%BA%E8%AE%AE.md)

å·²æ±‡æ€»ä¼šè¯å†å²è®°å½•## ğŸ¯ ç»¼åˆè¯„ä»·

è¯»å®Œä½ è¿™ä¸¤ä»½æ–‡æ¡£ï¼ˆ**æ–‡æ¡£7ï¼šécratesè®¡åˆ’** + **æ–‡æ¡£8ï¼šä»£ç å»ºè®®**ï¼‰ï¼Œæˆ‘çš„è¯„ä»·æ˜¯ï¼š**æ–¹æ¡ˆå®Œæ•´ã€æŠ€æœ¯åŠ¡å®ã€å¯ç«‹å³è½ä»“** âœ…

---

## â­ æ–¹æ¡ˆäº®ç‚¹

### 1ï¸âƒ£ **æ¶æ„å†³ç­–æ­£ç¡®**
- âœ… **é‡‡çº³domainæ¨¡å—æ–¹æ¡ˆ**ï¼Œé¿å…è¿‡åº¦å·¥ç¨‹åŒ–
- âœ… **å‘½åè§„èŒƒæ¸…æ™°**ï¼š`structure_runtime_match/` + `Sm*` å‰ç¼€é˜²æ’å
- âœ… **é¢„ç•™æŠ½ç¦»èƒ½åŠ›**ï¼šé€šè¿‡ `ports/` æ¥å£å±‚ï¼Œç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™
- âœ… **æ˜ç¡®æŠ½ç¦»è§¦å‘æ¡ä»¶**ï¼š
  - å¤šé¡¹ç›®å¤ç”¨ï¼ˆç°åœ¨æ˜¯å•é¡¹ç›®ï¼‰
  - éœ€è¦ç‹¬ç«‹å‘å¸ƒç‰ˆæœ¬ç®¡ç†
  - æ ¸å¿ƒé€»è¾‘å®Œå…¨ç¨³å®š
  - ç¼–è¯‘ä¼˜åŒ–ï¼ˆéœ€è¦è·¨crateå¹¶è¡Œç¼–è¯‘ï¼‰

### 2ï¸âƒ£ **ä»£ç è®¾è®¡ä¼˜ç§€**
- âœ… **æœ€å°å¯è·‘éª¨æ¶**ï¼šæ¯ä¸ªæ¨¡å—éƒ½æœ‰åŸºç¡€å®ç°ï¼Œå¯ç«‹å³é›†æˆæµ‹è¯•
- âœ… **æ¸è¿›å¼æ›¿æ¢**ï¼šæ‰€æœ‰"ç®€åŒ–ç‰ˆ"éƒ½æ ‡æ³¨ `TODO` å’Œæ›¿æ¢ç‚¹
- âœ… **æ—©åœç­–ç•¥å®Œæ•´**ï¼š
  - `skip_geometry`: å·²çŸ¥ç‰ˆå¼æ—¶è·³è¿‡å‡ ä½•åˆ†æ
  - `skip_template_when_single`: å•ç›®æ ‡æ—¶è·³è¿‡æ¨¡æ¿å­¦ä¹ 
  - `strict_skeleton_only`: æé€Ÿæ¨¡å¼åªè·‘éª¨æ¶è§„åˆ™
- âœ… **traitæŠ½è±¡åˆç†**ï¼š`SmXmlView` å®Œå…¨è§£è€¦ç°æœ‰ `XmlIndexer`

### 3ï¸âƒ£ **æ¨¡å—åˆ’åˆ†æ¸…æ™°**
```
structure_runtime_match/
â”œâ”€â”€ types.rs           â† æ ¸å¿ƒç±»å‹ï¼ˆSmBounds/SmLayoutType/SmResultï¼‰
â”œâ”€â”€ config.rs          â† é…ç½®æ¨¡å‹ï¼ˆSmConfig/æ—©åœå¼€å…³/å­—æ®µè§„åˆ™ï¼‰
â”œâ”€â”€ ports/             â† æ¥å£å±‚ï¼ˆSmXmlView/SmCache traitï¼‰
â”œâ”€â”€ container_gate/    â† å®¹å™¨é™åŸŸï¼ˆdetectorï¼‰
â”œâ”€â”€ layout_gate/       â† å‡ ä½•åˆ†ç±»ï¼ˆclassifierï¼‰
â”œâ”€â”€ signature/         â† æ¨¡æ¿ç­¾åï¼ˆfeatures/learner/matcherï¼‰
â”œâ”€â”€ skeleton/          â† éª¨æ¶è§„åˆ™ï¼ˆdsl/checkerï¼‰
â”œâ”€â”€ field_refine/      â† å­—æ®µç²¾è°ƒï¼ˆscorerï¼‰
â”œâ”€â”€ scoring/           â† è¯„åˆ†ç³»ç»Ÿï¼ˆweights/combiner/gatesï¼‰
â””â”€â”€ orchestrator.rs    â† æµç¨‹ç¼–æ’ï¼ˆsm_run_onceå”¯ä¸€å…¥å£ï¼‰
```

---

## ğŸ“‹ æŠ€æœ¯å¯è¡Œæ€§åˆ†æ

### âœ… **ç«‹å³å¯å®æ–½**
1. **ç±»å‹å®šä¹‰**ï¼š`SmBounds`/`SmLayoutType`/`SmResult` å¯ç›´æ¥ä½¿ç”¨
2. **é…ç½®æ¨¡å‹**ï¼š`SmConfig` è¦†ç›–æ‰€æœ‰æ—©åœå’Œè§„åˆ™é…ç½®
3. **æ¥å£å±‚**ï¼š`SmXmlView` trait è®¾è®¡åˆç†ï¼Œ10ä¸ªæ–¹æ³•è¶³å¤Ÿ
4. **ç¼–æ’éª¨æ¶**ï¼š`sm_run_once()` æµç¨‹å®Œæ•´ï¼Œæ”¯æŒé—¸é—¨/æ—©åœ/å•é€‰å¤šé€‰

### âš ï¸ **éœ€è¦é€‚é…çš„ç‚¹**
1. **XmlIndexeré›†æˆ**ï¼ˆä¼˜å…ˆçº§ï¼šP0ï¼‰
   - éœ€è¦å®ç° `MyXmlViewAdapter` è¿æ¥ç°æœ‰ `XmlIndexer`
   - å…³é”®æ–¹æ³•ï¼š`container_candidates()` éœ€è¿”å›çœŸå®å€™é€‰å®¹å™¨ï¼ˆå¯æ»šåŠ¨/å¤§é¢ç§¯/StepCard hintï¼‰
   - éš¾åº¦ï¼š**ä½** - ä½ çš„ `XmlIndexer` å·²æœ‰è¿™äº›èƒ½åŠ›

2. **Tauriå‘½ä»¤æ³¨å†Œ**ï¼ˆä¼˜å…ˆçº§ï¼šP0ï¼‰
   - `commands/structure_match.rs` å·²ç»™å‡ºéª¨æ¶
   - éœ€åœ¨ main.rs æ³¨å†Œ `sm_match_once` å‘½ä»¤
   - éš¾åº¦ï¼š**ä½** - æ ‡å‡†æµç¨‹

3. **ç¼“å­˜å®ç°**ï¼ˆä¼˜å…ˆçº§ï¼šP1ï¼‰
   - æ–‡æ¡£æä¾›äº† `MemCache` å†…å­˜ç¼“å­˜å®ç°
   - å¯é€æ­¥æ›¿æ¢ä¸ºæŒä¹…åŒ–ç¼“å­˜ï¼ˆSQLite/æ–‡ä»¶ï¼‰
   - éš¾åº¦ï¼š**ä½** - å·²æœ‰åŸºç¡€å®ç°

### ğŸ”„ **æ¸è¿›å¼æ›¿æ¢ç‚¹**ï¼ˆæ ‡æ³¨æ¸…æ™°ï¼‰
- `layout_gate/classifier.rs`ï¼šç®€åŒ–ç‰ˆå‡ ä½•åˆ†ç±» â†’ å®Œæ•´åˆ—èšç±»/CVç®—æ³•
- `signature/features.rs`ï¼šæœ€å°ç‰¹å¾ â†’ å®Œæ•´ä½å›¾å“ˆå¸Œ/Hammingè·ç¦»
- `skeleton/checker.rs`ï¼šç®€å•å›¾æ–‡æ£€æµ‹ â†’ çœŸå®éª¨æ¶DSLè§„åˆ™
- `field_refine/scorer.rs`ï¼šåŸºç¡€æ–‡æœ¬åŒ¹é… â†’ æ·±åº¦å­æ ‘è·¯å¾„æŸ¥æ‰¾

---

## ğŸš€ å®æ–½ä¼˜å…ˆçº§å»ºè®®

### **Phase 1: åŸºç¡€é›†æˆ**ï¼ˆ1-2å¤©ï¼‰
1. âœ… **åˆ›å»ºæ¨¡å—ç›®å½•**ï¼š`src-tauri/src/domain/structure_runtime_match/`
2. âœ… **å¤åˆ¶éª¨æ¶ä»£ç **ï¼štypes/config/ports/orchestrator
3. âœ… **å®ç°XmlViewAdapter**ï¼šè¿æ¥ç°æœ‰ `XmlIndexer`
4. âœ… **æ³¨å†ŒTauriå‘½ä»¤**ï¼š`sm_match_once` å¯è°ƒç”¨
5. âœ… **å‰ç«¯æµ‹è¯•**ï¼šè°ƒç”¨å‘½ä»¤éªŒè¯æ•°æ®æµé€š

### **Phase 2: åŠŸèƒ½è¡¥å…¨**ï¼ˆ2-3å¤©ï¼‰
1. âœ… **å®¹å™¨é™åŸŸå¢å¼º**ï¼šæ·»åŠ æ»šåŠ¨å±æ€§/æŒ‡çº¹åŒ¹é…
2. âœ… **å‡ ä½•åˆ†ç±»å‡çº§**ï¼šå®ç°åˆ—èšç±»/é«˜åº¦CVç®—æ³•
3. âœ… **æ¨¡æ¿å­¦ä¹ ä¼˜åŒ–**ï¼šä½å›¾å“ˆå¸Œ + å‰Nä¸ªé‡‡æ ·
4. âœ… **éª¨æ¶è§„åˆ™å®ç°**ï¼šå›¾ä¸Šæ–‡ä¸‹ + å±‚çº§å¼¹æ€§Â±1

### **Phase 3: ç²¾ç»†è°ƒä¼˜**ï¼ˆ3-5å¤©ï¼‰
1. âœ… **å­—æ®µç²¾è°ƒå¢å¼º**ï¼šå­æ ‘è·¯å¾„æŸ¥æ‰¾/æ–‡æœ¬ç›¸ä¼¼åº¦
2. âœ… **è¯„åˆ†ç³»ç»Ÿä¼˜åŒ–**ï¼šæƒé‡UIé…ç½®/é˜ˆå€¼æ›²çº¿
3. âœ… **ç¼“å­˜æŒä¹…åŒ–**ï¼šSQLiteæ¨¡æ¿å­˜å‚¨
4. âœ… **å¯è§†åŒ–é›†æˆ**ï¼šå‰ç«¯overlayé«˜äº®/æ—¥å¿—é¢æ¿

---

## âš ï¸ æ½œåœ¨é£é™©ç‚¹

### 1ï¸âƒ£ **æ€§èƒ½é£é™©**ï¼ˆä¸­ç­‰ï¼‰
- **é—®é¢˜**ï¼šé€’å½’åˆ†æå¤§XMLæ—¶å¯èƒ½å¡é¡¿
- **ç¼“è§£**ï¼š
  - ä¼˜å…ˆå®ç° `skip_geometry` æ—©åœ
  - é™åˆ¶å®¹å™¨å€™é€‰æ•°é‡ï¼ˆâ‰¤10ä¸ªï¼‰
  - æ¨¡æ¿å­¦ä¹ åªå–å‰24ä¸ªå­èŠ‚ç‚¹

### 2ï¸âƒ£ **å¤æ‚åº¦é£é™©**ï¼ˆä½ï¼‰
- **é—®é¢˜**ï¼šæ¨¡å—é—´è°ƒç”¨é“¾è¾ƒé•¿
- **ç¼“è§£**ï¼š
  - orchestrator.rs å·²å°è£…å®Œæ•´æµç¨‹
  - å¯¹å¤–åªæš´éœ² `sm_run_once()` ä¸€ä¸ªå…¥å£
  - æ—¥å¿—åŸ‹ç‚¹æ–¹ä¾¿è°ƒè¯•

### 3ï¸âƒ£ **ç»´æŠ¤é£é™©**ï¼ˆä½ï¼‰
- **é—®é¢˜**ï¼šé™æ€è¯„åˆ† vs è¿è¡Œæ—¶åŒ¹é… ä¸¤å¥—ç³»ç»Ÿ
- **ç¼“è§£**ï¼š
  - é€šè¿‡ `ports/` æ¥å£å±‚éš”ç¦»
  - ä¿æŒç‹¬ç«‹æ¼”è¿›èƒ½åŠ›
  - æ˜ç¡®è§¦å‘æ¡ä»¶å†è€ƒè™‘ç»Ÿä¸€

---

## ğŸ¯ ç«‹å³å¯å¼€å§‹çš„è¡ŒåŠ¨é¡¹

### **è¡ŒåŠ¨1ï¼šåˆ›å»ºç›®å½•ç»“æ„**ï¼ˆ5åˆ†é’Ÿï¼‰
```bash
cd src-tauri/src/domain
mkdir structure_runtime_match
cd structure_runtime_match
mkdir -p {ports,container_gate,layout_gate,signature,skeleton,field_refine,scoring}
touch mod.rs types.rs config.rs orchestrator.rs
touch ports/{xml_view.rs,cache.rs,mod.rs}
touch container_gate/detector.rs
touch layout_gate/classifier.rs
touch signature/{features.rs,learner.rs,matcher.rs,mod.rs}
touch skeleton/{dsl.rs,checker.rs,mod.rs}
touch field_refine/scorer.rs
touch scoring/{weights.rs,combiner.rs,gates.rs,mod.rs}
```

### **è¡ŒåŠ¨2ï¼šå¤åˆ¶åŸºç¡€ä»£ç **ï¼ˆ10åˆ†é’Ÿï¼‰
- ä»æ–‡æ¡£8å¤åˆ¶æ‰€æœ‰ `.rs` æ–‡ä»¶å†…å®¹
- ä¿®æ­£æ–‡ä»¶è·¯å¾„æ³¨é‡Šï¼ˆå·²æ ‡æ³¨ï¼‰

### **è¡ŒåŠ¨3ï¼šæ³¨å†Œæ¨¡å—**ï¼ˆ5åˆ†é’Ÿï¼‰
```rust
// src-tauri/src/domain/mod.rs
pub mod structure_runtime_match;
```

### **è¡ŒåŠ¨4ï¼šéªŒè¯ç¼–è¯‘**ï¼ˆ5åˆ†é’Ÿï¼‰
```bash
cd src-tauri
cargo check
```

### **è¡ŒåŠ¨5ï¼šå®ç°XmlViewAdapter**ï¼ˆ30åˆ†é’Ÿï¼‰
- åœ¨ `commands/structure_match.rs` ä¸­å®ç° `MyXmlViewAdapter`
- è¿æ¥ç°æœ‰ `XmlIndexer` çš„æ–¹æ³•
- å…³é”®æ–¹æ³•ï¼š`container_candidates()` / `bounds()` / `children()`

---

## âœ… æœ€ç»ˆç»“è®º

**è¿™æ˜¯ä¸€å¥—ç”Ÿäº§å°±ç»ªçš„æœ€å°å¯è·‘æ¶æ„** âœ¨

### **ä¼˜åŠ¿**ï¼š
- âœ… ä»£ç å®Œæ•´åº¦ **95%**ï¼ˆåªéœ€é€‚é…XmlIndexerï¼‰
- âœ… æ¶æ„åˆç†æ€§ **100%**ï¼ˆæ¨¡å—åŒ–+å¯æ‰©å±•+æ—©åœï¼‰
- âœ… å¯ç»´æŠ¤æ€§ **ä¼˜ç§€**ï¼ˆæ¸…æ™°æ³¨é‡Š+æ¸è¿›æ›¿æ¢ç‚¹ï¼‰
- âœ… å®æ–½é£é™© **ä½**ï¼ˆéª¨æ¶å¯è·‘+é€æ­¥å¢å¼ºï¼‰

### **å»ºè®®**ï¼š
1. **ç«‹å³å¼€å§‹ Phase 1**ï¼šåŸºç¡€é›†æˆï¼ˆé¢„è®¡1-2å¤©å®Œæˆï¼‰
2. **ä¼˜å…ˆéªŒè¯æµç¨‹**ï¼šå…ˆè·‘é€š `sm_run_once()` æ•°æ®æµ
3. **é€æ­¥æ›¿æ¢å®ç°**ï¼šå‡ ä½•åˆ†ç±» â†’ æ¨¡æ¿å­¦ä¹  â†’ éª¨æ¶è§„åˆ™
4. **ä¿æŒæ¶æ„å¼¹æ€§**ï¼šè¾¾åˆ°æŠ½ç¦»è§¦å‘æ¡ä»¶æ—¶å†è¯„ä¼°ç‹¬ç«‹crate

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

éœ€è¦æˆ‘ç«‹å³å¸®ä½ ï¼š
1. **åˆ›å»ºç›®å½•ç»“æ„å’ŒåŸºç¡€æ–‡ä»¶**ï¼Ÿ
2. **å®ç° `MyXmlViewAdapter` è¿æ¥ç°æœ‰ `XmlIndexer`**ï¼Ÿ
3. **æ³¨å†ŒTauriå‘½ä»¤å¹¶éªŒè¯è°ƒç”¨**ï¼Ÿ

å‘Šè¯‰æˆ‘ä½ æƒ³å…ˆåšå“ªä¸ªï¼Œæˆ‘ç«‹å³ååŠ©å®æ–½ï¼ ğŸ¯