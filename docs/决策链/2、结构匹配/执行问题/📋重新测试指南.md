# ğŸ”„ é‡æ–°æµ‹è¯•æŒ‡å— - Bounds ä¼ é€’ä¿®å¤

## âš ï¸ é‡è¦æç¤º

æ‚¨æä¾›çš„æ—¥å¿—æ˜¯**æ—§çš„æµ‹è¯•ç»“æœ**,ä¸åŒ…å«æœ€æ–°çš„ä¿®å¤ä»£ç ã€‚ä¿®å¤ä»£ç å·²ç»æˆåŠŸåº”ç”¨,ä½†éœ€è¦**é‡å¯å‰ç«¯**æ‰èƒ½ç”Ÿæ•ˆã€‚

## ğŸ› ï¸ ä¿®å¤å†…å®¹ç¡®è®¤

å·²ä¿®æ”¹æ–‡ä»¶: `src/modules/structural-matching/hooks/use-hierarchical-matching-modal.ts`

**å…³é”®ä¿®å¤ç‚¹**:
```typescript
// âœ… å·²æ·»åŠ è¯¦ç»†çš„ bounds æå–è°ƒè¯•æ—¥å¿—
console.log('ğŸ” [Bounds Debug] selectedElement.bounds åŸå§‹æ•°æ®:', {...});

// âœ… å·²æ”¹è¿› bounds å¯¹è±¡æ ¼å¼æå–é€»è¾‘
if ('left' in b && 'top' in b && 'right' in b && 'bottom' in b) {
  boundsArray = [Number(b.left), Number(b.top), Number(b.right), Number(b.bottom)];
  console.log('âœ… [Bounds Debug] ä»å¯¹è±¡æå–æˆåŠŸ:', boundsArray);
}

// âœ… å·²æ·»åŠ  fingerprint.hints ç»“æ„
fingerprint: boundsArray ? {
  role: 'AUTO_DETECT',
  hints: {
    selected_element_id: elementId,
    selected_element_bounds: boundsArray,  // â† å…³é”®ä¿®å¤
    selected_element_class: className,
    strategy: 'scrollable_ancestor'
  }
} : undefined
```

## ğŸ“‹ æµ‹è¯•æ­¥éª¤

### ç¬¬ä¸€æ­¥: é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨ âš¡

**å¿…é¡»æ‰§è¡Œæ­¤æ­¥éª¤,å¦åˆ™ä¿®æ”¹ä¸ä¼šç”Ÿæ•ˆ!**

```powershell
# 1. åœæ­¢å½“å‰è¿è¡Œçš„ dev server
#    æŒ‰ Ctrl+C åœæ­¢

# 2. é‡æ–°å¯åŠ¨
npm run tauri dev
```

### ç¬¬äºŒæ­¥: æ‰§è¡Œæµ‹è¯•æµç¨‹ ğŸ§ª

1. **æ‰“å¼€é¡µé¢åˆ†æ**
   - åŠ è½½ XML æ–‡ä»¶: `ui_dump_e0d909c3_20251030_122312.xml`

2. **ç‚¹å‡»å…ƒç´ **
   - ç‚¹é€‰ `element_32` (ç€‘å¸ƒæµå¡ç‰‡)
   - ç”Ÿæˆæ­¥éª¤å¡ç‰‡

3. **æ‰“å¼€ç»“æ„åŒ¹é…æ¨¡æ€æ¡†**
   - åœ¨æ­¥éª¤å¡ç‰‡ä¸Šç‚¹å‡»ç­–ç•¥èœå•
   - é€‰æ‹© "ç»“æ„åŒ¹é…"

4. **ç¡®è®¤é…ç½®**
   - **ä¸ä¿®æ”¹ä»»ä½•å‚æ•°**,ä¿æŒé»˜è®¤å€¼
   - ç›´æ¥ç‚¹å‡» "ç¡®å®š" æŒ‰é’®

5. **æ‰§è¡Œæ­¥éª¤**
   - ç‚¹å‡» "æ‰§è¡Œæ­¥éª¤" æŒ‰é’®
   - è§‚å¯Ÿæ—¥å¿—è¾“å‡º

### ç¬¬ä¸‰æ­¥: æ£€æŸ¥å…³é”®æ—¥å¿— ğŸ”

#### A. å‰ç«¯æµè§ˆå™¨æ§åˆ¶å° (å¿…æŸ¥)

**æŸ¥æ‰¾è¿™äº›æ–°çš„è°ƒè¯•æ—¥å¿—**:

```javascript
// 1ï¸âƒ£ bounds åŸå§‹æ•°æ®æ£€æŸ¥
ğŸ” [Bounds Debug] selectedElement.bounds åŸå§‹æ•°æ®: {
  type: 'object',  // â† åº”è¯¥æ˜¯ 'object'
  value: {left: 546, top: 225, right: 1067, bottom: 1083},
  isString: false,
  isObject: true,
  keys: ['left', 'top', 'right', 'bottom']
}

// 2ï¸âƒ£ bounds æå–æˆåŠŸ
âœ… [Bounds Debug] ä»å¯¹è±¡æå–æˆåŠŸ: [546, 225, 1067, 1083]

// 3ï¸âƒ£ æœ€ç»ˆç»“æ„ç­¾åç”Ÿæˆ
âœ… [Enhanced] å¢å¼ºç»“æ„åŒ–ç­¾åç”Ÿæˆå®Œæˆ: {
  skeletonRules: 3,
  containerRole: 'FrameLayout',
  depth: 1,
  hasBounds: true,     // â† å¿…é¡»æ˜¯ true
  bounds: [546, 225, 1067, 1083]  // â† å¿…é¡»æœ‰å€¼
}

// 4ï¸âƒ£ æœ€ç»ˆå‘é€çš„æ•°æ®
[StructuralMatchingModal] æœ€ç»ˆç»“æ„ç­¾å: {
  "container": {
    "role": "AUTO_DETECT",
    "depth": 1,
    "fingerprint": {  // â† å¿…é¡»å­˜åœ¨
      "role": "AUTO_DETECT",
      "hints": {
        "selected_element_bounds": [546, 225, 1067, 1083]  // â† å…³é”®!
      }
    }
  }
}
```

#### B. åç«¯ Tauri ç»ˆç«¯ (å¿…æŸ¥)

**æŸ¥æ‰¾è¿™äº›æ—¥å¿—**:

```rust
// âœ… æˆåŠŸæå– bounds
âœ… [V3 SM Integration] æå–å®¹å™¨æç¤ºæˆåŠŸ: bounds=[546, 225, 1067, 1083]

// âœ… ä¼ é€’ç»™ SM Runtime
âœ… [V3 SM Integration] å®¹å™¨æç¤ºå·²æå–ï¼Œå°†ä¼ é€’ç»™SM Runtime

// âœ… å®šä½åˆ°æ­£ç¡®çš„å…ƒç´ 
âœ… [SM Runtime] é€šè¿‡boundså®šä½åˆ°èŠ‚ç‚¹: node_id=32, bounds=(546, 225, 1067, 1083)

// âœ… æ‰¾åˆ°æ­£ç¡®çš„å®¹å™¨ (ä¸æ˜¯ 0!)
ğŸ—ï¸ [SM Runtime] å®¹å™¨é™åŸŸå®Œæˆ: container_id=XX  // XX åº”è¯¥æ˜¯ RecyclerView çš„ ID
```

## âœ… æˆåŠŸæ ‡å‡†

### å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶:

| æ£€æŸ¥é¡¹ | é¢„æœŸç»“æœ | è¯´æ˜ |
|--------|----------|------|
| **å‰ç«¯ - bounds åŸå§‹æ•°æ®** | `type: 'object'` | selectedElement åŒ…å« bounds å¯¹è±¡ |
| **å‰ç«¯ - bounds æå–** | `âœ… ä»å¯¹è±¡æå–æˆåŠŸ` | æå–é€»è¾‘å·¥ä½œæ­£å¸¸ |
| **å‰ç«¯ - hasBounds** | `true` | bounds æ•°ç»„ç”ŸæˆæˆåŠŸ |
| **å‰ç«¯ - bounds æ•°ç»„** | `[546, 225, 1067, 1083]` | å€¼æ­£ç¡® |
| **å‰ç«¯ - fingerprint** | å­˜åœ¨äº container ä¸­ | ç»“æ„å®Œæ•´ |
| **åç«¯ - æå–æˆåŠŸ** | `âœ… æå–å®¹å™¨æç¤ºæˆåŠŸ` | åç«¯æ”¶åˆ°æ•°æ® |
| **åç«¯ - å®šä½èŠ‚ç‚¹** | `node_id=32` | é€šè¿‡ bounds æ‰¾åˆ°å…ƒç´  |
| **åç«¯ - å®¹å™¨ ID** | **NOT 0** | æ‰¾åˆ°æ­£ç¡®çš„ RecyclerView |

## âŒ å¤±è´¥è¯Šæ–­

### åœºæ™¯ 1: å‰ç«¯æ—¥å¿—ä¸­æ²¡æœ‰ `[Bounds Debug]`

**åŸå› **: å‰ç«¯æ²¡æœ‰é‡å¯,ä»åœ¨ä½¿ç”¨æ—§ä»£ç 

**è§£å†³**: 
1. ç¡®è®¤å·²åœæ­¢æ—§çš„ dev server
2. é‡æ–°è¿è¡Œ `npm run tauri dev`
3. ç­‰å¾…ç¼–è¯‘å®Œæˆåå†æµ‹è¯•

### åœºæ™¯ 2: `hasBounds: false`

**æ£€æŸ¥ `[Bounds Debug]` æ—¥å¿—**:

```javascript
ğŸ” [Bounds Debug] selectedElement.bounds åŸå§‹æ•°æ®: {
  type: '???',  // â† æ£€æŸ¥è¿™ä¸ªå€¼
  value: ???    // â† æ£€æŸ¥è¿™ä¸ªå€¼
}
```

**å¯èƒ½åŸå› **:
- `type: 'undefined'` â†’ selectedElement ä¸åŒ…å« bounds
- `type: 'string'` ä½†æå–å¤±è´¥ â†’ å­—ç¬¦ä¸²æ ¼å¼ä¸åŒ¹é…
- `type: 'object'` ä½†ç¼ºå°‘å­—æ®µ â†’ æŸ¥çœ‹è­¦å‘Šæ—¥å¿—

### åœºæ™¯ 3: å‰ç«¯æœ‰ bounds,åç«¯æå–å¤±è´¥

**æ£€æŸ¥åç«¯æ—¥å¿—ä¸­çš„ structural_signatures**:

```rust
ğŸ” [V3 SM Integration] structural_signatures: {
  "container": {
    "fingerprint": {  // â† æ£€æŸ¥æ˜¯å¦å­˜åœ¨
      "hints": {
        "selected_element_bounds": [...]  // â† æ£€æŸ¥æ˜¯å¦å­˜åœ¨
      }
    }
  }
}
```

**å¦‚æœ fingerprint ä¸å­˜åœ¨**:
- æ£€æŸ¥æ¨¡æ€æ¡†æ˜¯å¦æ­£ç¡®ä½¿ç”¨äº† Hook è¿”å›çš„æ•°æ®
- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä»£ç è¦†ç›–äº† structural_signatures

## ğŸ“ å¦‚ä½•æä¾›æ—¥å¿—

å¦‚æœæµ‹è¯•å¤±è´¥,è¯·æä¾›:

### 1. å‰ç«¯å®Œæ•´æ—¥å¿—

**æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å° â†’ å¤åˆ¶æ‰€æœ‰æ—¥å¿—**

é‡ç‚¹åŒ…å«:
```
ğŸ” [Bounds Debug] selectedElement.bounds åŸå§‹æ•°æ®:
âœ… æˆ– âš ï¸ [Bounds Debug] æå–ç»“æœ
âœ… [Enhanced] å¢å¼ºç»“æ„åŒ–ç­¾åç”Ÿæˆå®Œæˆ:
[StructuralMatchingModal] æœ€ç»ˆç»“æ„ç­¾å:
```

### 2. åç«¯å®Œæ•´æ—¥å¿—

**æŸ¥çœ‹ Tauri ç»ˆç«¯è¾“å‡º**

é‡ç‚¹åŒ…å«:
```
[V3 SM Integration] ç›¸å…³æ—¥å¿—
[SM Runtime] ç›¸å…³æ—¥å¿—
```

### 3. æµ‹è¯•ç¯å¢ƒä¿¡æ¯

```
- æ˜¯å¦é‡å¯äº†å‰ç«¯? (æ˜¯/å¦)
- XML æ–‡ä»¶å: ???
- ç‚¹å‡»çš„å…ƒç´  ID: ???
- æ“ä½œç³»ç»Ÿ: ???
```

## ğŸ¯ é¢„æœŸç»“æœæ€»ç»“

ä¿®å¤æˆåŠŸå,æ•´ä¸ªæ•°æ®æµåº”è¯¥æ˜¯:

```
ğŸ“Š æ•°æ®æµ:
1. selectedElement.bounds = {left:546, top:225, right:1067, bottom:1083}
   â†“
2. Hook æå–: boundsArray = [546, 225, 1067, 1083]
   â†“
3. æ·»åŠ åˆ°: container.fingerprint.hints.selected_element_bounds
   â†“
4. å‰ç«¯å‘é€ç»™åç«¯
   â†“
5. åç«¯æå–: bounds=[546, 225, 1067, 1083]
   â†“
6. SM Runtime: å®šä½ element_32 â†’ å‘ä¸Šæ‰¾ RecyclerView
   â†“
7. åœ¨ RecyclerView å®¹å™¨å†…åŒ¹é… âœ…
```

---

**âš¡ ç°åœ¨å¼€å§‹æµ‹è¯•å§!**

è®°å¾—å…ˆé‡å¯å‰ç«¯,ç„¶åæŒ‰ç…§æ­¥éª¤æ“ä½œ,æœ€åæä¾›å®Œæ•´çš„å‰åç«¯æ—¥å¿—ã€‚
