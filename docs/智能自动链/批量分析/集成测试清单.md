# 智能选择高级功能集成测试清单

**测试范围**: 排除过滤 · 智能去重 · 轻量校验 · Auto 模式优化  
**测试环境**: Windows 10/11 + Android 设备（小红书 App）  
**测试版本**: v2025.01.XX  

---

## 🎯 测试目标

验证前后端集成的 **4 个高级功能** 在真实场景下的：
- ✅ 功能正确性（是否按预期工作）
- ⚡ 性能表现（响应速度、内存占用）
- 🛡️ 稳定性（异常处理、边界情况）
- 🎨 用户体验（配置便捷性、反馈清晰度）

---

## 📋 一、前端 UI 测试

### 1.1 排除过滤配置界面

#### 测试步骤
1. 打开脚本编辑器 → 添加/编辑 `smartSelection` 动作
2. 找到 **🔥 高级功能（新）** 区域
3. 在 **🚫 排除** 输入框中输入：`已关注`

**预期结果**:
- [ ] 输入框正常显示文本
- [ ] 无 JavaScript 控制台错误
- [ ] 输入框宽度适配（200px）

#### 测试用例
| 用例 | 输入值 | 预期行为 |
|-----|-------|---------|
| TC-EX-01 | `已关注` | 单个关键词，正常保存 |
| TC-EX-02 | `已关注\|Following` | 多关键词，分隔符解析正确 |
| TC-EX-03 | `已关注\|\|Following` | 连续分隔符，自动过滤空值 |
| TC-EX-04 | 清空输入框 | `excludeText` 保存为空数组 `[]` |
| TC-EX-05 | 超长文本（100 字符） | 输入框滚动，不溢出布局 |

**验证方法**:
```javascript
// 浏览器控制台执行
console.log(JSON.parse(localStorage.getItem('scriptData')).params.smartSelection.excludeText);
// 应输出: ["已关注", "Following"]
```

---

### 1.2 去重容差配置界面

#### 测试步骤
1. 在同一配置面板找到 **🔄 去重** 区域
2. 观察默认值（应为 10）
3. 使用鼠标/键盘调整数值

**预期结果**:
- [ ] 默认显示 `10 px`
- [ ] 上下箭头可调整（步进 1）
- [ ] 手动输入生效

#### 测试用例
| 用例 | 操作 | 预期行为 |
|-----|------|---------|
| TC-DD-01 | 点击上箭头 5 次 | 数值增加到 15 |
| TC-DD-02 | 输入 `5` | 接受（最小值） |
| TC-DD-03 | 输入 `50` | 接受（最大值） |
| TC-DD-04 | 输入 `3` | 拒绝/重置为 5（低于最小值） |
| TC-DD-05 | 输入 `100` | 拒绝/重置为 50（超过最大值） |
| TC-DD-06 | 输入非数字 `abc` | 拒绝，保持原值 |

**验证方法**:
```javascript
console.log(JSON.parse(localStorage.getItem('scriptData')).params.smartSelection.dedupeTolerance);
// 应输出: 15 (假设调整到 15)
```

---

### 1.3 轻校验开关界面

#### 测试步骤
1. 在同一配置面板找到 **✅ 轻校验** 区域
2. 观察默认状态（应为"开启"）
3. 切换开关状态

**预期结果**:
- [ ] 默认选中"开启"
- [ ] 切换到"关闭"后，下拉框显示更新
- [ ] 提示文字显示"（点击后验证状态变化）"

#### 测试用例
| 用例 | 操作 | 预期行为 |
|-----|------|---------|
| TC-LV-01 | 初始状态 | 显示"开启" |
| TC-LV-02 | 切换到"关闭" | 下拉框更新，值为 `false` |
| TC-LV-03 | 再次切换到"开启" | 下拉框更新，值为 `true` |
| TC-LV-04 | 保存后刷新页面 | 状态保持（持久化验证） |

**验证方法**:
```javascript
console.log(JSON.parse(localStorage.getItem('scriptData')).params.smartSelection.enableLightValidation);
// 应输出: true 或 false
```

---

### 1.4 UI 整体性测试

#### 布局适配
- [ ] **宽屏显示**（1920×1080）：所有元素正常排列
- [ ] **窄屏显示**（1366×768）：无横向滚动条，内容换行合理
- [ ] **深色模式**：背景色 `#f8f9fa` 与深色主题对比清晰
- [ ] **浅色模式**：文字颜色 `#666` 可读性良好

#### 交互反馈
- [ ] **输入框聚焦**：边框高亮（蓝色）
- [ ] **下拉框展开**：选项列表正确显示
- [ ] **鼠标悬停**：提示文字显示（如有 Tooltip）

---

## 🔌 二、前后端联调测试

### 2.1 数据序列化测试

#### 测试步骤
1. 前端配置：
   - 排除："已关注|Following|已互关"
   - 去重容差：15px
   - 轻校验：关闭
2. 保存脚本
3. 在 Rust 后端打印接收到的参数

**预期结果**:
```rust
// src-tauri/src/services/smart_selection_engine.rs
println!("{:?}", params);
// 应输出类似：
// SmartSelectionParams {
//   exclude_text: Some(["已关注", "Following", "已互关"]),
//   dedupe_tolerance: Some(15),
//   enable_light_validation: Some(false),
//   ...
// }
```

**验证方法**:
- [ ] 启动 Tauri 开发模式：`pnpm tauri dev`
- [ ] 观察终端输出，查找 `SmartSelectionParams` 日志
- [ ] 确认字段值与前端配置一致

---

### 2.2 排除过滤功能测试

#### 测试场景：小红书粉丝列表批量关注

**前置条件**:
- Android 设备已连接（`adb devices` 可见）
- 小红书 App 已登录
- 进入某用户粉丝列表页面（包含已关注和未关注用户）

**测试步骤**:
1. 配置脚本：
   - 动作类型：`smartSelection`
   - 自动链：配置"关注按钮"特征（如 text="关注"）
   - 排除：`已关注|Following`
2. 启动批量执行
3. 观察执行过程

**预期结果**:
- [ ] **日志输出**：Rust 后端显示 `[INFO] 排除候选元素 (text=已关注)`
- [ ] **实际行为**：跳过所有显示"已关注"的按钮，只点击"关注"按钮
- [ ] **统计数据**：执行报告显示"跳过 X 个元素（排除规则）"

**失败场景测试**:
| 场景 | 配置 | 预期行为 |
|-----|------|---------|
| FC-EX-01 | 排除词拼写错误 `已關注`（繁体） | 无法排除，点击所有按钮（预期） |
| FC-EX-02 | 排除词为空 `[]` | 不排除任何元素（预期） |
| FC-EX-03 | 页面文本为英文 "Following" | 正确排除（多语言支持） |

---

### 2.3 智能去重功能测试

#### 测试场景：同一页面多次执行

**前置条件**:
- 粉丝列表页面已加载
- 页面包含多个相同位置的按钮（如垂直列表布局）

**测试步骤**:
1. 配置去重容差：10px（默认值）
2. 执行批量关注（第一轮）
3. **不滚动页面**，再次执行（第二轮）
4. 观察第二轮是否重复点击

**预期结果**:
- [ ] **第一轮**：正常点击所有候选按钮
- [ ] **第二轮**：所有候选元素被标记为"重复"，跳过
- [ ] **日志输出**：`[INFO] 去重：跳过 Y 个重复元素 (容差=10px)`

**边界测试**:
| 用例 | 配置 | 场景 | 预期行为 |
|-----|------|------|---------|
| TC-DD-10 | 容差 5px | 两个按钮 Y 坐标相差 3px | 识别为重复，去重 |
| TC-DD-11 | 容差 5px | 两个按钮 Y 坐标相差 8px | 识别为不同，都点击 |
| TC-DD-12 | 容差 50px | 两个按钮 Y 坐标相差 40px | 识别为重复，去重 |
| TC-DD-13 | 容差 10px | 滚动页面后再执行 | 新元素正常点击（坐标已变） |

**验证方法**:
```rust
// 后端日志示例
[2025-01-XX 10:30:45] [INFO] 候选元素 A (Y=120, text="关注")
[2025-01-XX 10:30:45] [INFO] 候选元素 B (Y=122, text="关注") -> 去重 (与 A 差值 2px < 10px)
```

---

### 2.4 轻量校验功能测试

#### 测试场景：点击"关注"按钮后验证状态变化

**前置条件**:
- 页面包含未关注用户
- 网络正常，点击后能正常变为"已关注"

**测试步骤**:
1. 配置轻校验：开启
2. 执行批量关注
3. 观察每次点击后的等待和验证过程

**预期结果**:
- [ ] **点击后等待**：200ms 延迟（避免动画未完成）
- [ ] **UI 重新抓取**：执行 `adb shell uiautomator dump`
- [ ] **文本变化检测**：
  - 点击前：text="关注"
  - 点击后：text="已关注" → ✅ 验证成功
  - 点击后：text="关注"（未变化） → ❌ 验证失败，记录错误

**日志验证**:
```rust
[2025-01-XX 10:35:12] [INFO] 轻校验：点击元素 (text="关注", bounds=[100,200][200,250])
[2025-01-XX 10:35:12] [INFO] 等待 200ms...
[2025-01-XX 10:35:12] [INFO] 重新抓取 UI...
[2025-01-XX 10:35:13] [INFO] 轻校验成功：文本变化 "关注" -> "已关注"
```

**失败场景测试**:
| 场景 | 模拟方法 | 预期行为 |
|-----|---------|---------|
| FC-LV-01 | 网络延迟（点击后 5 秒才变化） | 200ms 后抓取仍为"关注"，标记失败 |
| FC-LV-02 | 点击无效（元素已失效） | 文本未变化，标记失败 |
| FC-LV-03 | 轻校验关闭 | 跳过验证步骤，直接成功 |

---

### 2.5 Auto 模式优化测试

#### 测试场景：高置信度指纹自动匹配

**前置条件**:
- 已有指纹库中存在"关注按钮"指纹（置信度 ≥0.85）
- 页面包含多个候选元素

**测试步骤**:
1. 配置模式：`auto`
2. 执行批量关注
3. 观察是否自动选择高置信度匹配

**预期结果**:
- [ ] **日志输出**：`[INFO] Auto 模式：找到高置信度匹配 (confidence=0.92)`
- [ ] **跳过手动选择**：不弹出选择弹窗
- [ ] **直接执行**：自动点击匹配元素

**对比测试**:
| 模式 | 候选元素 | 指纹置信度 | 预期行为 |
|-----|---------|-----------|---------|
| Auto | 3 个候选 | 0.92, 0.65, 0.40 | 自动选择 0.92 的元素 |
| Auto | 3 个候选 | 0.75, 0.70, 0.68 | 无高置信度（<0.85），降级为 Manual |
| Manual | 3 个候选 | 0.92, 0.65, 0.40 | 弹窗让用户手动选择（即使有 0.92） |

---

## 🏭 三、实际场景端到端测试

### 场景 A：小红书批量关注粉丝（完整流程）

**业务目标**：在某 KOL 粉丝列表页，批量关注 20 个未关注用户

#### 配置参数
```json
{
  "actionType": "smartSelection",
  "smartSelection": {
    "mode": "auto",
    "excludeText": ["已关注", "Following", "已互关"],
    "dedupeTolerance": 10,
    "enableLightValidation": true,
    "lightAssertions": [
      { "type": "text", "value": "关注" }
    ]
  }
}
```

#### 执行流程
1. **第 1 轮**（页面顶部 5 个用户）
   - 候选元素：10 个按钮（5 个"关注"，5 个"已关注"）
   - 排除过滤：剩余 5 个"关注"按钮
   - 逐一点击，轻校验成功 5 次

2. **滚动页面**（加载新用户）
   - 候选元素：15 个按钮（8 个"关注"，7 个"已关注"）
   - 去重：排除第 1 轮已点击的 5 个（Y 坐标相同）
   - 排除过滤：剩余 8 个"关注"按钮
   - 执行 8 次点击

3. **再次滚动**（继续加载）
   - 候选元素：12 个按钮
   - 去重 + 排除：剩余 7 个待点击
   - 执行 7 次，达到目标 20 次（5+8+7）

**预期结果**:
- [ ] **总点击次数**：20 次
- [ ] **跳过次数**：X 次（已关注） + Y 次（重复）
- [ ] **轻校验成功率**：100%（所有点击后文本变化）
- [ ] **执行时间**：约 40-60 秒（每次点击 + 校验 2-3 秒）

---

### 场景 B：抖音批量点赞视频

**业务目标**：在推荐页滑动并点赞 15 个视频

#### 特殊配置
```json
{
  "excludeText": ["已点赞"],  // 排除已点赞视频
  "dedupeTolerance": 50,      // 视频高度较大，容差调高
  "enableLightValidation": false  // 点赞无明显文本变化，关闭校验
}
```

#### 验证点
- [ ] 去重容差 50px 是否有效防止重复点赞
- [ ] 关闭轻校验后执行速度是否提升（节省 200ms×15 = 3 秒）

---

## 🛡️ 四、异常场景与压力测试

### 4.1 异常输入处理

| 测试用例 | 输入 | 预期行为 |
|---------|------|---------|
| TE-01 | `excludeText` 包含空字符串 `["", "已关注", ""]` | 自动过滤空值 |
| TE-02 | `dedupeTolerance` 为负数 `-10` | 后端处理为 10（默认值）或拒绝 |
| TE-03 | `enableLightValidation` 为 `null` | 处理为 `true`（默认开启） |
| TE-04 | JSON 序列化错误 | Tauri 返回错误提示，不崩溃 |

---

### 4.2 性能与稳定性

#### 大批量测试（100 次点击）
- [ ] **内存占用**：执行前后内存增长 <50MB
- [ ] **CPU 使用率**：峰值 <30%
- [ ] **无内存泄漏**：连续执行 3 次，内存回归初始水平

#### 长时间运行（30 分钟）
- [ ] **进程不崩溃**
- [ ] **日志文件大小** <10MB
- [ ] **ADB 连接保持稳定**

---

## ✅ 五、验收标准

### 功能完整性
- [x] 排除过滤：前端配置 → 后端执行 → 日志验证
- [x] 智能去重：容差可调 → 坐标桶算法 → 去重日志
- [x] 轻量校验：开关可控 → 200ms 延迟 → 文本变化检测
- [x] Auto 模式：置信度阈值 0.85 → 自动选择 → 跳过手动

### 质量指标
- [ ] **准确率**：排除/去重/校验准确率 >95%
- [ ] **性能**：单次动作平均耗时 <3 秒
- [ ] **稳定性**：连续 50 次执行无崩溃
- [ ] **用户体验**：配置界面操作流畅，无卡顿

### 文档与交付
- [x] 前端集成完成报告（已完成）
- [x] 集成测试清单（本文档）
- [ ] 实际测试录屏/GIF
- [ ] 用户使用指南更新

---

## 📅 测试时间表

| 阶段 | 任务 | 负责人 | 截止日期 | 状态 |
|-----|------|--------|---------|------|
| Phase 1 | 前端 UI 测试 | QA/Dev | Day 1 | ⏳ 进行中 |
| Phase 2 | 前后端联调 | Dev | Day 2 | ⏳ 待开始 |
| Phase 3 | 实际场景测试 | PM + Dev | Day 3 | ⏳ 待开始 |
| Phase 4 | 压力测试 | QA | Day 4 | ⏳ 待开始 |
| Phase 5 | 问题修复 | Dev | Day 5 | ⏳ 待开始 |
| Phase 6 | 验收发布 | PM | Day 6 | ⏳ 待开始 |

---

**测试负责人**: [待分配]  
**文档版本**: v1.0  
**最后更新**: 2025-01-XX
