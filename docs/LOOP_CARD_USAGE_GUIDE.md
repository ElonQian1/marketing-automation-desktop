# 循环卡片重新设计 - 快速使用指南

## 📌 新设计亮点

### ✨ 视觉升级
- **循环开始卡片**：白色背景 + 绿色边框 (#10b981) + 左侧绿色指示器
- **循环结束卡片**：白色背景 + 橙色边框 (#f59e0b) + 左侧橙色指示器
- **简洁设计**：移除复杂装饰，聚焦核心功能

### 🎯 支持拖拽
- ✅ 可以像普通步骤一样拖拽排序
- ✅ 拖拽时有视觉反馈（阴影、旋转）
- ✅ 完全集成到拖拽系统

### 🔧 功能完整
- ✅ 循环次数配置
- ✅ 无限循环支持
- ✅ 删除确认提示
- ✅ 一键编辑

## 🚀 使用方法

### 1. 创建循环

在智能脚本构建器中：

```tsx
// 点击"添加循环"按钮
// 会自动创建循环开始和结束标记
```

### 2. 配置循环次数

**循环开始卡片**：
1. 点击"设置"图标 ⚙️
2. 输入循环次数（1-999）
3. 点击"保存"

**循环结束卡片**：
1. 点击"设置"图标 ⚙️  
2. 配置循环次数或启用无限循环
3. 点击"保存"

### 3. 拖拽排序

```
拖拽循环开始卡片 → 移动整个循环
拖拽普通步骤     → 移动单个步骤
```

### 4. 删除循环

1. 点击"删除"图标 🗑️
2. 确认删除提示
3. 循环标记被删除，内部步骤保留

## 🎨 视觉识别

### 循环开始（绿色）
```
┌─────────────────────────────────┐
│ 🔄 新循环    循环开始            │ ← 绿色边框
│ ────────────────────────────────│
│ ▶ 执行次数: 3                   │
│ ────────────────────────────────│
│ 👇 将步骤拖拽到此循环内           │
└─────────────────────────────────┘
▌← 左侧绿色指示器
```

### 循环结束（橙色）
```
┌─────────────────────────────────┐
│ ✓ 新循环    循环结束            │ ← 橙色边框
│ ────────────────────────────────│
│ 🔄 完成次数: 3                   │
│ ────────────────────────────────│
│ 🔄 执行完成后返回循环开始         │
└─────────────────────────────────┘
▌← 左侧橙色指示器
```

### 普通步骤（深色）
```
┌─────────────────────────────────┐
│ 点击按钮                         │ ← 深色背景
│ ────────────────────────────────│
│ 查找元素: #submit_button        │
└─────────────────────────────────┘
```

## 🔍 故障排查

### 问题1：循环卡片不能拖拽
**解决**：确保卡片没有被其他元素覆盖，cursor 应该显示为 grab

### 问题2：颜色显示不正常
**解决**：清除浏览器缓存，确保新的 CSS 文件被加载

### 问题3：删除按钮无响应
**解决**：检查是否有循环ID，确保 loopConfig 正确传递

## 📋 开发者注意事项

### 样式文件位置
```
src/components/LoopStartCard/styles.css
```

### 组件文件
```
src/components/LoopStartCard/index.tsx  (循环开始)
src/components/LoopEndCard.tsx          (循环结束)
```

### Props 接口
```tsx
interface LoopStartCardProps {
  step: ExtendedSmartScriptStep;
  index: number;
  loopConfig?: LoopConfig;
  isDragging?: boolean;
  onLoopConfigUpdate: (config: LoopConfig) => void;
  onDeleteLoop: (loopId: string) => void;
  onToggle: (stepId: string) => void;
}
```

## 🎯 与普通卡片的差异

| 特性 | 循环卡片 | 普通步骤卡片 |
|------|---------|------------|
| 背景颜色 | 白色 (#ffffff) | 深色 (#1E293B) |
| 边框颜色 | 绿色/橙色 | 灰色 |
| 左侧指示器 | 4px 渐变条 | 无 |
| 拖拽支持 | ✅ | ✅ |
| 配置界面 | 简化模态框 | 参数编辑器 |

## 📝 最佳实践

### 1. 循环命名
```
✅ 推荐：遍历联系人列表
✅ 推荐：重试连接 (3次)
❌ 避免：新循环、循环1
```

### 2. 循环次数
```
✅ 1-10次：适合大多数场景
⚠️ 10-100次：注意性能
❌ 100+次：考虑优化逻辑
∞ 无限循环：仅用于守护任务
```

### 3. 嵌套循环
```
支持，但建议不超过2层
嵌套过深影响可读性
```

## 🚀 性能提示

- 循环卡片使用轻量级组件
- CSS 使用硬件加速属性
- 拖拽时使用 transform 而非 position

---

**版本**: v2.0
**最后更新**: 2025-10-25
