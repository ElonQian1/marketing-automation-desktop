# è§†å£å›¾ç‰‡ä½ç½®ä¿®å¤éªŒè¯æŒ‡å—

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š"è§†å£è£å‰ªçš„å›¾ç‰‡ä½ç½®ä¸å¯¹"ï¼Œæ‚¬æµ®è§†è§‰çª—å£ä¸­çš„æˆªå›¾æ˜¾ç¤ºä½ç½®ä¸æ­£ç¡®ã€‚

## ä¿®å¤å†…å®¹

### 1. æ ¸å¿ƒä¿®å¤ä½ç½®

- **æ–‡ä»¶**: `src/modules/structural-matching/ui/components/visual-preview/floating-window/components/aligned-image-display.tsx`
- **æ–¹æ³•**: `getImageDisplayStyle()`
- **ä¿®å¤ç±»å‹**: å›¾ç‰‡å®šä½ç®—æ³•ä¼˜åŒ–

### 2. ä¿®å¤å‰çš„é—®é¢˜

```typescript
// ğŸš« ä¿®å¤å‰ï¼šå¤æ‚çš„ transform + objectPosition ç»„åˆå¯¼è‡´ä½ç½®é”™ä¹±
return {
  position: "absolute" as const,
  left: imageDisplay.offset.x,
  top: imageDisplay.offset.y,
  width: cropArea.width * imageDisplay.scale,
  height: cropArea.height * imageDisplay.scale,
  objectFit: "none" as const,
  objectPosition: `-${cropArea.x * imageDisplay.scale}px -${
    cropArea.y * imageDisplay.scale
  }px`,
  transform: `scale(${imageDisplay.scale})`,
  transformOrigin: "0 0",
  // ... å¤šç§å®šä½æ–¹å¼å†²çª
};
```

### 3. ä¿®å¤åçš„æ–¹æ¡ˆ

```typescript
// âœ… ä¿®å¤åï¼šç®€åŒ–çš„ CSS clip å®šä½æ–¹æ¡ˆ
return {
  position: "absolute" as const,
  left: -cropArea.x * imageDisplay.scale + imageDisplay.offset.x,
  top: -cropArea.y * imageDisplay.scale + imageDisplay.offset.y,
  width: imageNaturalSize.width * imageDisplay.scale,
  height: imageNaturalSize.height * imageDisplay.scale,
  maxWidth: "none",
  maxHeight: "none",
};
```

## ä¿®å¤åŸç†

### 1. å®šä½é€»è¾‘ç®€åŒ–

- **é¿å…å¤æ‚ç»„åˆ**: ä¸å†åŒæ—¶ä½¿ç”¨ `objectPosition`ã€`transform` å’Œ `left/top` å®šä½
- **å•ä¸€å®šä½æ–¹å¼**: ä»…ä½¿ç”¨ `left/top` é…åˆå®¹å™¨çš„ `overflow:hidden` æ¥å®ç°è£å‰ªæ•ˆæœ

### 2. è®¡ç®—å…¬å¼

- **æ°´å¹³ä½ç½®**: `left = -cropArea.x * scale + containerOffset.x`
- **å‚ç›´ä½ç½®**: `top = -cropArea.y * scale + containerOffset.y`
- **å›¾ç‰‡å°ºå¯¸**: ä½¿ç”¨åŸå§‹å›¾ç‰‡å°ºå¯¸ä¹˜ä»¥ç¼©æ”¾æ¯”ä¾‹

### 3. è£å‰ªæœºåˆ¶

- **å®¹å™¨è£å‰ª**: ä¾èµ–çˆ¶å®¹å™¨çš„ `overflow: hidden` æ¥è£å‰ªè¶…å‡ºéƒ¨åˆ†
- **ç²¾ç¡®å®šä½**: é€šè¿‡è´Ÿåç§»æ¥æ˜¾ç¤ºè£å‰ªåŒºåŸŸçš„æ­£ç¡®éƒ¨åˆ†

## éªŒè¯æ­¥éª¤

### 1. æµ‹è¯•ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿å¼€å‘æœåŠ¡å™¨è¿è¡Œ
npm run tauri dev
```

### 2. æµ‹è¯•ç”¨ä¾‹éªŒè¯

1. **æ‰“å¼€ç»“æ„åŒ¹é…åŠŸèƒ½**
2. **é€‰æ‹©ä»»æ„æ­¥éª¤å¡ç‰‡**
3. **ç‚¹å‡»"å¯è§†åŒ–é¢„è§ˆ"æŒ‰é’®**
4. **è§‚å¯Ÿæ‚¬æµ®çª—å£ä¸­çš„æˆªå›¾æ˜¾ç¤º**

### 3. é¢„æœŸç»“æœ

- âœ… **å›¾ç‰‡æ˜¾ç¤ºæ­£ç¡®**: æˆªå›¾åº”è¯¥æ˜¾ç¤ºåœ¨æ­£ç¡®çš„ä½ç½®
- âœ… **è£å‰ªåŒºåŸŸå‡†ç¡®**: æ˜¾ç¤ºçš„åŒºåŸŸåº”è¯¥å¯¹åº”é€‰ä¸­çš„å…ƒç´ 
- âœ… **æ— ä½ç½®åç§»**: å›¾ç‰‡ä¸åº”è¯¥å‡ºç°æ˜æ˜¾çš„ä½ç½®é”™ä½
- âœ… **ç¼©æ”¾æ¯”ä¾‹æ­£å¸¸**: å›¾ç‰‡ç¼©æ”¾åº”è¯¥ä¿æŒæ­£ç¡®çš„æ¯”ä¾‹

### 4. è°ƒè¯•æ—¥å¿—

ä¿®å¤åçš„ä»£ç ä¼šè¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š

```javascript
ğŸ¨ [AlignedImageDisplay] è®¡ç®—å›¾ç‰‡æ˜¾ç¤ºæ ·å¼: {
  cropArea: { x: 100, y: 200, width: 300, height: 150 },
  imageDisplay: {
    scale: 0.8,
    offset: { x: 10, y: 20 },
    containerSize: { width: 400, height: 300 }
  },
  imageNaturalSize: { width: 1080, height: 1920 }
}
```

## æ–‡ä»¶ç»“æ„è¯´æ˜

### ç›¸å…³ç»„ä»¶

- **AlignedImageDisplay**: æ ¸å¿ƒå›¾ç‰‡æ˜¾ç¤ºç»„ä»¶ï¼ˆå·²ä¿®å¤ï¼‰
- **ScreenshotDisplay**: æˆªå›¾æ˜¾ç¤ºå®¹å™¨ç»„ä»¶
- **FloatingVisualWindow**: æ‚¬æµ®çª—å£ä¸»ç»„ä»¶
- **ViewportAlignment**: è§†å£å¯¹é½è®¡ç®—å·¥å…·

### ä¾èµ–å…³ç³»

```
FloatingVisualWindow
â”œâ”€â”€ ScreenshotDisplay
â”‚   â””â”€â”€ AlignedImageDisplay (âœ… å·²ä¿®å¤)
â””â”€â”€ ViewportAlignment (è®¡ç®—å·¥å…·)
```

## æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½è€ƒè™‘

- è°ƒè¯•æ—¥å¿—ä¼šåœ¨ä¿®å¤éªŒè¯å®Œæˆåç¦ç”¨
- å›¾ç‰‡åŠ è½½æ—¶ä¼šæœ‰ä¸´æ—¶çš„"ğŸ“· åŠ è½½æˆªå›¾ä¸­..."æç¤º

### 2. æµè§ˆå™¨å…¼å®¹æ€§

- CSS `overflow: hidden` è£å‰ªåœ¨æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä¸­éƒ½æ”¯æŒè‰¯å¥½
- é¿å…äº†å¤æ‚çš„ CSS transform ç»„åˆï¼Œæé«˜äº†å…¼å®¹æ€§

### 3. é”™è¯¯å¤„ç†

- å›¾ç‰‡åŠ è½½å¤±è´¥ä¼šæ˜¾ç¤ºé”™è¯¯çŠ¶æ€
- æ— æ•ˆçš„è£å‰ªé…ç½®ä¼šéšè—å›¾ç‰‡æ˜¾ç¤º

## å¦‚æœä»æœ‰é—®é¢˜

### 1. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—

æŸ¥çœ‹æ˜¯å¦æœ‰ `ğŸ¨ [AlignedImageDisplay]` çš„è°ƒè¯•ä¿¡æ¯

### 2. éªŒè¯æ•°æ®å®Œæ•´æ€§

ç¡®ä¿ `cropConfig` å’Œ `viewportAlignment` æ•°æ®æ­£ç¡®

### 3. æµè§ˆå™¨å¼€å‘è€…å·¥å…·

æ£€æŸ¥å›¾ç‰‡å…ƒç´ çš„å®é™… CSS æ ·å¼æ˜¯å¦ç¬¦åˆé¢„æœŸ

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025 å¹´ 11 æœˆ 1 æ—¥  
**ä¿®å¤èŒƒå›´**: æ‚¬æµ®è§†è§‰çª—å£å›¾ç‰‡å®šä½ç®—æ³•  
**å½±å“ç»„ä»¶**: AlignedImageDisplay ç»„ä»¶  
**æµ‹è¯•å»ºè®®**: ä½¿ç”¨å¤šä¸ªä¸åŒçš„æ­¥éª¤å¡ç‰‡éªŒè¯ä¿®å¤æ•ˆæœ
