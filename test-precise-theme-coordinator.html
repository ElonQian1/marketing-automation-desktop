<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨æµ‹è¯•é¡µé¢</title>
    <style>
        /* æ¨¡æ‹Ÿå¾ªç¯å¡ç‰‡æ ·å¼ */
        .step-card {
            margin: 10px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background: white;
        }
        
        .step-card .loop-skin {
            background: #f0f0f0;
            padding: 10px;
            margin: 5px 0;
        }
        
        /* æ¨¡æ‹ŸADBæ£€æŸ¥å™¨æ ·å¼ */
        .adb-inspector {
            margin: 10px;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 8px;
            background: #2d2d2d;
            color: #fff;
        }
        
        .adb-xml-content {
            background: #1e1e1e;
            color: #e6e6e6;
            padding: 10px;
            font-family: monospace;
        }
        
        /* å…¶ä»–æš—è‰²ç»„ä»¶ */
        .dark-component {
            background: #333;
            color: #fff;
            padding: 15px;
            margin: 10px;
            border-radius: 5px;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #fff;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            z-index: 1000;
        }
        
        .controls button {
            margin: 5px;
            padding: 8px 15px;
            cursor: pointer;
        }
        
        /* çŠ¶æ€æ˜¾ç¤º */
        .status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-width: 400px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h4>ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨æµ‹è¯•</h4>
        <button onclick="analyzeCurrentState()">åˆ†æå½“å‰çŠ¶æ€</button>
        <button onclick="forceRefixLoopCards()">å¼ºåˆ¶ä¿®å¤å¾ªç¯å¡ç‰‡</button>
        <button onclick="forceProtectDarkTheme()">å¼ºåˆ¶ä¿æŠ¤æš—è‰²ä¸»é¢˜</button>
        <button onclick="toggleDebugMode()">åˆ‡æ¢è°ƒè¯•æ¨¡å¼</button>
        <button onclick="getStats()">è·å–ç»Ÿè®¡ä¿¡æ¯</button>
        <button onclick="clearHighlights()">æ¸…é™¤é«˜äº®</button>
    </div>
    
    <div class="status" id="status">
        çŠ¶æ€ï¼šåŠ è½½ä¸­...
    </div>
    
    <h1>ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨æµ‹è¯•é¡µé¢</h1>
    
    <h2>æ¨¡æ‹Ÿå¾ªç¯å¡ç‰‡åŒºåŸŸ</h2>
    <div class="step-card" data-test-type="loop-card">
        <h3>å¾ªç¯å¡ç‰‡ #1</h3>
        <div class="loop-skin">
            è¿™æ˜¯ä¸€ä¸ªå¾ªç¯çš®è‚¤å†…å®¹ï¼Œåº”è¯¥ä¿æŒç™½è‰²èƒŒæ™¯å’Œé»‘è‰²æ–‡å­—
        </div>
        <p>è¿™ä¸ªå¡ç‰‡åº”è¯¥è¢«ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨è¯†åˆ«ä¸ºå¾ªç¯å¡ç‰‡</p>
    </div>
    
    <div class="step-card loop-card" data-test-type="loop-card">
        <h3>å¾ªç¯å¡ç‰‡ #2</h3>
        <div class="loop-skin">
            å¦ä¸€ä¸ªå¾ªç¯çš®è‚¤ï¼Œæµ‹è¯•æ‰¹é‡å¤„ç†
        </div>
        <p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ªç¯å¡ç‰‡</p>
    </div>
    
    <h2>æ¨¡æ‹ŸADBæ£€æŸ¥å™¨åŒºåŸŸ</h2>
    <div class="adb-inspector" data-test-type="adb-inspector">
        <h3>ADB XML æ£€æŸ¥å™¨</h3>
        <div class="adb-xml-content">
            &lt;node index="0" text="Button" class="android.widget.Button"&gt;
                &lt;node index="1" text="Click me" bounds="[100,200][300,250]"/&gt;
            &lt;/node&gt;
        </div>
        <p>è¿™ä¸ªåŒºåŸŸåº”è¯¥ä¿æŒæš—è‰²ä¸»é¢˜ï¼Œä¸è¢«å¾ªç¯å¡ç‰‡ä¿®å¤å™¨å½±å“</p>
    </div>
    
    <h2>å…¶ä»–æš—è‰²ç»„ä»¶</h2>
    <div class="dark-component" data-test-type="dark-component">
        <h3>æ™®é€šæš—è‰²ç»„ä»¶</h3>
        <p>è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„æš—è‰²ä¸»é¢˜ç»„ä»¶ï¼Œåº”è¯¥è¢«ä¿æŠ¤å™¨ä¿æŠ¤</p>
    </div>
    
    <div class="dark-component" data-test-type="dark-component">
        <h3>å¦ä¸€ä¸ªæš—è‰²ç»„ä»¶</h3>
        <p>è¿™ä¹Ÿåº”è¯¥ä¿æŒæš—è‰²ä¸»é¢˜</p>
    </div>
    
    <script>
        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('é¡µé¢åŠ è½½å®Œæˆï¼Œç­‰å¾…ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨åˆå§‹åŒ–...');
            
            // ç­‰å¾…ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨åˆå§‹åŒ–
            setTimeout(function() {
                checkThemeCoordinator();
            }, 1000);
            
            // å®šæœŸæ›´æ–°çŠ¶æ€
            setInterval(function() {
                updateStats();
            }, 5000);
        });
        
        function checkThemeCoordinator() {
            if (typeof window.preciseThemeCoordinator !== 'undefined') {
                updateStatus('âœ… ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨å·²åŠ è½½');
                logAvailableMethods();
            } else {
                updateStatus('âŒ ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨æœªæ‰¾åˆ°');
            }
        }
        
        function logAvailableMethods() {
            const methods = [
                'preciseThemeCoordinator',
                'getPreciseThemeStats',
                'analyzeThemeConflicts',
                'fixPreciseLoopCards',
                'protectDarkTheme',
                'analyzeLoopSelectors',
                'highlightLoopCards',
                'removeLoopHighlight'
            ];
            
            let available = [];
            let missing = [];
            
            methods.forEach(method => {
                if (typeof window[method] !== 'undefined') {
                    available.push(method);
                } else {
                    missing.push(method);
                }
            });
            
            console.log('ğŸ”§ å¯ç”¨çš„è°ƒè¯•æ–¹æ³•:', available);
            if (missing.length > 0) {
                console.log('âš ï¸ ç¼ºå¤±çš„æ–¹æ³•:', missing);
            }
        }
        
        function analyzeCurrentState() {
            if (typeof window.analyzeThemeConflicts === 'function') {
                window.analyzeThemeConflicts();
                updateStatus('ğŸ” ä¸»é¢˜å†²çªåˆ†æå®Œæˆï¼ŒæŸ¥çœ‹æ§åˆ¶å°');
            } else {
                updateStatus('âŒ analyzeThemeConflicts æ–¹æ³•ä¸å¯ç”¨');
            }
        }
        
        function forceRefixLoopCards() {
            if (typeof window.fixPreciseLoopCards === 'function') {
                window.fixPreciseLoopCards();
                updateStatus('ğŸ”§ å¼ºåˆ¶ä¿®å¤å¾ªç¯å¡ç‰‡å®Œæˆ');
            } else {
                updateStatus('âŒ fixPreciseLoopCards æ–¹æ³•ä¸å¯ç”¨');
            }
        }
        
        function forceProtectDarkTheme() {
            if (typeof window.protectDarkTheme === 'function') {
                window.protectDarkTheme();
                updateStatus('ğŸ›¡ï¸ å¼ºåˆ¶ä¿æŠ¤æš—è‰²ä¸»é¢˜å®Œæˆ');
            } else {
                updateStatus('âŒ protectDarkTheme æ–¹æ³•ä¸å¯ç”¨');
            }
        }
        
        function toggleDebugMode() {
            if (typeof window.hybridThemeOverrideManager !== 'undefined') {
                if (typeof window.hybridThemeOverrideManager.enableDebug === 'function') {
                    window.hybridThemeOverrideManager.enableDebug();
                    updateStatus('ğŸ”§ è°ƒè¯•æ¨¡å¼å·²å¯ç”¨');
                } else {
                    updateStatus('âŒ enableDebug æ–¹æ³•ä¸å¯ç”¨');
                }
            } else {
                updateStatus('âŒ hybridThemeOverrideManager ä¸å¯ç”¨');
            }
        }
        
        function getStats() {
            if (typeof window.getPreciseThemeStats === 'function') {
                const stats = window.getPreciseThemeStats();
                console.log('ğŸ“Š ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨ç»Ÿè®¡:', stats);
                updateStatus('ğŸ“Š ç»Ÿè®¡ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°');
            } else {
                updateStatus('âŒ getPreciseThemeStats æ–¹æ³•ä¸å¯ç”¨');
            }
        }
        
        function clearHighlights() {
            if (typeof window.removeLoopHighlight === 'function') {
                window.removeLoopHighlight();
                updateStatus('ğŸ§¹ é«˜äº®æ¸…é™¤å®Œæˆ');
            } else {
                updateStatus('âŒ removeLoopHighlight æ–¹æ³•ä¸å¯ç”¨');
            }
        }
        
        function updateStats() {
            if (typeof window.getPreciseThemeStats === 'function') {
                const stats = window.getPreciseThemeStats();
                const statusEl = document.getElementById('status');
                const content = `
                    ç²¾ç¡®ä¸»é¢˜åè°ƒå™¨çŠ¶æ€ï¼š
                    - å·²åˆå§‹åŒ–: ${stats.initialized ? 'âœ…' : 'âŒ'}
                    - æœ‰æ•ˆå¾ªç¯å¡ç‰‡: ${stats.validLoopCards}
                    - æš—è‰²ä¿æŠ¤å…ƒç´ : ${stats.darkProtectedElements}
                    - å¾ªç¯å¡ç‰‡ä¿®å¤: ${stats.loopCardFixer?.fixedCards || 0}
                    - æš—è‰²ä¸»é¢˜ä¿æŠ¤: ${stats.darkThemeProtector?.protectedElements || 0}
                    - å†²çªæ£€æµ‹: ${stats.conflictResolver?.conflictsDetected || 0}
                `;
                statusEl.innerHTML = content.replace(/\n\s+/g, '<br>').trim();
            }
        }
        
        function updateStatus(message) {
            const statusEl = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            statusEl.innerHTML = `[${timestamp}] ${message}`;
            console.log(`[${timestamp}] ${message}`);
        }
    </script>
</body>
</html>