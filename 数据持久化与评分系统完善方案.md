# æ•°æ®æŒä¹…åŒ–ä¸è¯„åˆ†ç³»ç»Ÿå®Œå–„æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜è¯Šæ–­

### æ ¸å¿ƒé—®é¢˜
1. **æ•°æ®æŒä¹…åŒ–**ï¼šxpath å’Œ original_xml ä¿å­˜åœ¨å“ªé‡Œï¼Ÿä¼šä¸ä¼šä¸¢å¤±ï¼Ÿ
2. **æ•°æ®ä¼ é€’**ï¼šå¦‚ä½•ä¼ é€’ç»™å…¶ä»–è„šæœ¬ç”¨æˆ·ï¼Ÿ
3. **è¯„åˆ†ç³»ç»Ÿ**ï¼šå¦‚ä½•é¿å…é€‰æ‹©ç¬¬ä¸€ä¸ªè€Œä¸æ˜¯æœ€åä¸€ä¸ª/æ­£ç¡®çš„ï¼Ÿ

---

## ğŸ” å½“å‰æ•°æ®æµå®Œæ•´åˆ†æ

### Phase 1: ç”¨æˆ·ç‚¹å‡»å¯è§†åŒ–å…ƒç´ ï¼ˆé™æ€åˆ†æï¼‰

```typescript
// 1. VisualPageAnalyzerContent.tsx
ç”¨æˆ·ç‚¹å‡»å¯è§†åŒ–å…ƒç´ 
  â†“
ä¿å­˜XMLåˆ°å†…å­˜ç¼“å­˜ï¼ˆXmlCacheManagerï¼‰
  xmlCacheId: xml_{hash}_{timestamp}
  xmlContent: å®Œæ•´XMLå†…å®¹
  xmlHash: SHA256å“ˆå¸Œ
  â†“
ä¼ é€’ç»™ UniversalPageFinderModal
```

### Phase 2: åˆ›å»ºæ­¥éª¤å¡ç‰‡

```typescript
// 2. useIntelligentStepCardIntegration.ts - convertElementToContext()
ä» element.xmlCacheId è·å–XML
  â†“
æ„å»º ElementSelectionContext:
  - snapshotId: xmlCacheId
  - elementPath: ç»å¯¹å…¨å±€XPath (é€šè¿‡buildXPathç”Ÿæˆ)
  - xmlContent: å®Œæ•´XML
  - xmlHash: SHA256å“ˆå¸Œ
  â†“
handleQuickCreateStep() åˆ›å»ºæ­¥éª¤
  â†“
æ­¥éª¤å‚æ•°ä¸­åŒ…å«:
  parameters: {
    element_selector: {
      xpath: "...",
      element_text: "é€šè®¯å½•",
      bounds: "[45,1059][249,1263]",
      resource_id: "iwk",
      content_desc: "",
      class_name: "LinearLayout",
      // ğŸ”¥ å…³é”®ï¼šå®Œæ•´XMLå¿«ç…§
      xmlSnapshot: {
        xmlCacheId: "xml_5c595fdf..._1730123456789",
        xmlContent: "<?xml version='1.0'...>å®Œæ•´XML</xml>",
        xmlHash: "5c595fdf...",
        timestamp: 1730123456789,
        elementGlobalXPath: "//*[@resource-id='com.ss.android.ugc.aweme:id/iwk']",
        elementSignature: {
          class: "LinearLayout",
          resourceId: "iwk",
          text: null,  // â† çˆ¶å®¹å™¨æ— æ–‡æœ¬
          contentDesc: null,
          bounds: "[45,1059][249,1263]",
          indexPath: []
        }
      }
    }
  }
```

### Phase 3: è„šæœ¬å¯¼å‡ºï¼ˆä¼ é€’ç»™å…¶ä»–ç”¨æˆ·ï¼‰

```typescript
// 3. script-bundle-manager.ts - exportScriptBundle()
æ”¶é›†æ‰€æœ‰æ­¥éª¤å¼•ç”¨çš„ xmlHash/xmlCacheId
  â†“
ä» XmlCacheManager æå–å®Œæ•´XMLå†…å®¹
  â†“
ç”Ÿæˆ ScriptBundle:
  {
    metadata: {
      exportVersion: "2.0",
      exportedAt: timestamp,
      generator: "Script Bundle Manager v2.0"
    },
    steps: [
      // æ­¥éª¤åªä¿ç•™å¼•ç”¨ï¼ˆä¸é‡å¤å­˜å‚¨XMLï¼‰
      {
        parameters: {
          element_selector: {
            xmlCacheId: "xml_5c595fdf...",
            xmlSnapshot: {
              xmlHash: "5c595fdf...",
              // xmlContent ç§»é™¤ï¼ˆæ”¹ä¸ºå¼•ç”¨ï¼‰
            }
          }
        }
      }
    ],
    xmlCache: {
      // ç»Ÿä¸€å­˜å‚¨æ‰€æœ‰XMLï¼ˆé¿å…é‡å¤ï¼‰
      "xml_5c595fdf...": {
        content: "<?xml version='1.0'...>å®Œæ•´XML</xml>",
        metadata: {
          deviceId: "e0d909c3",
          timestamp: 1730123456789,
          pageType: "æŠ–éŸ³ä¸»é¡µ"
        }
      }
    }
  }
  â†“
ä¿å­˜ä¸º .json æ–‡ä»¶
  â†“
âœ… å…¶ä»–ç”¨æˆ·å¯ä»¥å¯¼å…¥æ­¤æ–‡ä»¶
```

### Phase 4: è„šæœ¬å¯¼å…¥ï¼ˆå…¶ä»–ç”¨æˆ·ä½¿ç”¨ï¼‰

```typescript
// 4. script-bundle-manager.ts - importScriptBundle()
è¯»å– .json æ–‡ä»¶
  â†“
è§£æ ScriptBundle
  â†“
æ¢å¤ xmlCache åˆ° XmlCacheManager:
  for (hash, xmlData) in bundle.xmlCache:
    XmlCacheManager.putXml(hash, xmlData.content, xmlData.metadata)
  â†“
æ¢å¤æ­¥éª¤ï¼Œé‡å»º xmlSnapshot å¼•ç”¨
  â†“
âœ… æ­¥éª¤ä¸­çš„ xmlCacheId ç°åœ¨å¯ä»¥ä»ç¼“å­˜ä¸­è·å–XML
```

### Phase 5: çœŸæœºæ‰§è¡Œ

```typescript
// 5. åç«¯æ‰§è¡Œ - execute_chain_test_v3()
æ¥æ”¶æ­¥éª¤å‚æ•°
  â†“
ä» original_data æå–:
  - selected_xpath: ç”¨æˆ·é€‰æ‹©çš„ç»å¯¹å…¨å±€XPath
  - element_text: "é€šè®¯å½•"
  - element_bounds: "[45,1059][249,1263]"
  - original_xml: å®Œæ•´åŸå§‹XMLå¿«ç…§
  â†“
Step 0-6 æ™ºèƒ½åˆ†æ:
  ä½¿ç”¨ selected_xpath + element_text ç”Ÿæˆå€™é€‰
  â†“
å¤šå€™é€‰è¯„ä¼°:
  ä½¿ç”¨æ–°çš„è¯„åˆ†ç³»ç»Ÿé€‰æ‹©æœ€ä½³å…ƒç´ 
  â†“
æ‰§è¡Œç‚¹å‡»
```

---

## âš ï¸ å½“å‰å­˜åœ¨çš„é—®é¢˜

### é—®é¢˜1: å†…å­˜ç¼“å­˜æ˜“ä¸¢å¤± âŒ

**ç°è±¡**ï¼š
```typescript
// XmlCacheManager æ˜¯å†…å­˜ç¼“å­˜
class XmlCacheManager {
  private cache = new Map<string, XmlCacheEntry>();  // â† å†…å­˜å­˜å‚¨
  
  // é¡µé¢åˆ·æ–° â†’ ç¼“å­˜æ¸…ç©º â†’ XMLä¸¢å¤± âŒ
}
```

**å½±å“**ï¼š
- ç”¨æˆ·åˆ·æ–°é¡µé¢ â†’ XMLç¼“å­˜æ¸…ç©º
- æ­¥éª¤ä¸­çš„ `xmlCacheId` å˜æˆæ— æ•ˆå¼•ç”¨
- çœŸæœºæ‰§è¡Œæ—¶æ‰¾ä¸åˆ° `original_xml`

**è§£å†³æ–¹æ¡ˆ**ï¼šâœ… **å·²æœ‰** - é€šè¿‡è„šæœ¬å¯¼å‡º/å¯¼å…¥æœºåˆ¶ä¿å­˜

### é—®é¢˜2: æ­¥éª¤åºåˆ—åŒ–å¯èƒ½ä¸¢å¤±XML âš ï¸

**ç°è±¡**ï¼š
```typescript
// æ­¥éª¤ä¿å­˜åˆ° localStorage/IndexedDB
const savedSteps = JSON.stringify(steps);

// å¦‚æœ xmlSnapshot.xmlContent å¤ªå¤§ï¼ˆå‡ MBï¼‰
// å¯èƒ½è¶…å‡ºå­˜å‚¨é™åˆ¶ â†’ è¢«æˆªæ–­æˆ–ä¸¢å¤±
```

**è§£å†³æ–¹æ¡ˆ**ï¼šâœ… **å·²æœ‰** - script-bundle-manager ä½¿ç”¨å¼•ç”¨æœºåˆ¶

### é—®é¢˜3: è·¨è®¾å¤‡XMLä¸å¯ç”¨ âš ï¸

**ç°è±¡**ï¼š
```
è®¾å¤‡A: å½•åˆ¶è„šæœ¬ï¼Œç”Ÿæˆ xmlCacheId
  â†“
å¯¼å‡º JSON æ–‡ä»¶
  â†“
è®¾å¤‡B: å¯¼å…¥ JSON æ–‡ä»¶
  â†“
âœ… xmlCache å·²åŒ…å«å®Œæ•´XML
  â†“
âœ… å¯ä»¥æ­£å¸¸æ‰§è¡Œ
```

**å½“å‰çŠ¶æ€**ï¼šâœ… **å·²è§£å†³** - ScriptBundle åŒ…å«å®Œæ•´xmlCache

---

## ğŸ¯ è¯„åˆ†ç³»ç»Ÿçš„å®Œå–„

### å½“å‰è¯„åˆ†è§„åˆ™ï¼ˆå·²å®ç°ï¼‰

```rust
ğŸ”¥ å­å…ƒç´ æ–‡æœ¬å®Œå…¨åŒ¹é…ï¼š+0.35  â† æœ€é«˜ä¼˜å…ˆçº§ï¼ˆçˆ¶å®¹å™¨+å­æ–‡æœ¬æ¨¡å¼ï¼‰
   XPathé—´æ¥åŒ¹é…ï¼š      +0.25  â† ä»XPathæå–å±æ€§å¯¹æ¯”
   è‡ªèº«æ–‡æœ¬åŒ¹é…ï¼š        +0.2   â† å…ƒç´ è‡ªå·±çš„textå±æ€§
   Content-descåŒ¹é…ï¼š    +0.1   â† å†…å®¹æè¿°åŒ¹é…
   Resource-idåŒ¹é…ï¼š     +0.05  â† èµ„æºIDåŒ¹é…
   Boundsä½ç½®æ¥è¿‘ï¼š      +0.05  â† ç©ºé—´ä½ç½®ç›¸ä¼¼åº¦
```

### é—®é¢˜ï¼šå¦‚ä½•é¿å…é€‰æ‹©ç¬¬ä¸€ä¸ªè€Œä¸æ˜¯æœ€åä¸€ä¸ªï¼Ÿ

**åœºæ™¯åˆ†æ**ï¼š
```xml
<!-- å¤šä¸ªç›¸ä¼¼å…ƒç´  -->
<node text="å…³æ³¨" bounds="[0,100][100,200]" />    â† å€™é€‰1
<node text="å…³æ³¨" bounds="[0,300][100,400]" />    â† å€™é€‰2
<node text="å…³æ³¨" bounds="[0,500][100,600]" />    â† å€™é€‰3ï¼ˆç”¨æˆ·é€‰æ‹©ï¼‰
```

**é—®é¢˜**ï¼š
- å¦‚æœ3ä¸ªå€™é€‰è¯„åˆ†ç›¸åŒï¼ˆéƒ½æ˜¯0.55ï¼‰
- å½“å‰ä¼šé€‰æ‹©ç¬¬ä¸€ä¸ª âŒ
- ä½†ç”¨æˆ·é€‰æ‹©çš„æ˜¯æœ€åä¸€ä¸ª âœ…

**è§£å†³æ–¹æ¡ˆ**ï¼šå¢åŠ "ä½ç½®åå¥½"å’Œ"ç»å¯¹XPathåŒ¹é…"

---

## ğŸš€ å®Œå–„åçš„è¯„åˆ†ç³»ç»Ÿ

### æ–°çš„è¯„åˆ†è§„åˆ™ï¼ˆå»ºè®®ï¼‰

```rust
// æ€»åˆ† 1.0ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åº

ğŸ”¥ğŸ”¥ğŸ”¥ ç»å¯¹å…¨å±€XPathå®Œå…¨åŒ¹é…ï¼š+0.4   â† æœ€é«˜ä¼˜å…ˆçº§ï¼ï¼ˆç”¨æˆ·ç²¾ç¡®é€‰æ‹©ï¼‰
ğŸ”¥ğŸ”¥   å­å…ƒç´ æ–‡æœ¬å®Œå…¨åŒ¹é…ï¼š    +0.3   â† çˆ¶å®¹å™¨+å­æ–‡æœ¬æ¨¡å¼
ğŸ”¥     è‡ªèº«æ–‡æœ¬å®Œå…¨åŒ¹é…ï¼š      +0.15  â† å…ƒç´ è‡ªå·±çš„text
       Content-descå®Œå…¨åŒ¹é…ï¼š   +0.08  â† æè¿°åŒ¹é…
       Resource-idå®Œå…¨åŒ¹é…ï¼š    +0.05  â† èµ„æºID
       Boundsç²¾ç¡®åŒ¹é…ï¼ˆ0pxï¼‰ï¼š  +0.02  â† ä½ç½®å®Œå…¨ç›¸åŒ
       
// ç‰¹æ®ŠåŠ åˆ†
       ä½ç½®åå¥½ï¼ˆæœ€åä¸€ä¸ªï¼‰ï¼š   +0.05  â† å½“è¯„åˆ†ç›¸è¿‘æ—¶
       å¯ç‚¹å‡»å±æ€§ï¼š            +0.03  â† ä¼˜å…ˆé€‰æ‹©å¯ç‚¹å‡»å…ƒç´ 
```

### æ ¸å¿ƒæ”¹è¿›1: ç»å¯¹å…¨å±€XPathå®Œå…¨åŒ¹é…

```rust
// multi_candidate_evaluator.rs

fn score_candidate(elem: &UIElement, criteria: &EvaluationCriteria) -> (f32, Vec<String>) {
    let mut score = 0.0;
    let mut reasons = Vec::new();
    
    // ğŸ”¥ğŸ”¥ğŸ”¥ è¯„åˆ†é¡¹0: ç»å¯¹å…¨å±€XPathå®Œå…¨åŒ¹é…ï¼ˆ0-0.4åˆ†ï¼‰æœ€é«˜ä¼˜å…ˆçº§ï¼
    if let Some(ref selected_xpath) = criteria.selected_xpath {
        // æ–¹æ¡ˆ1: é€šè¿‡boundsç²¾ç¡®åŒ¹é…ï¼ˆå› ä¸ºUIElementæ²¡æœ‰xpathå­—æ®µï¼‰
        if let (Some(ref selected_bounds), Some(ref elem_bounds)) = 
            (&criteria.original_bounds, &elem.bounds) {
            if selected_bounds == elem_bounds {
                // Boundså®Œå…¨åŒ¹é… = XPathå®Œå…¨åŒ¹é…çš„é«˜æ¦‚ç‡æŒ‡ç¤º
                score += 0.4;
                reasons.push(format!("âœ…âœ…âœ…âœ… Boundså®Œå…¨åŒ¹é…: '{}' (å¯èƒ½æ˜¯XPathå®Œå…¨åŒ¹é…)", elem_bounds));
            }
        }
        
        // æ–¹æ¡ˆ2: é€šè¿‡resource-id + textç»„åˆåŒ¹é…
        if let Some(ref elem_resource_id) = elem.resource_id {
            if selected_xpath.contains(elem_resource_id) {
                if let Some(ref elem_text) = elem.text {
                    if selected_xpath.contains(elem_text) {
                        score += 0.35;  // Resource-id + text éƒ½åœ¨XPathä¸­
                        reasons.push(format!("âœ…âœ…âœ… XPathåŒ…å«Resource-id+æ–‡æœ¬: '{}'+'{}' (é«˜ç½®ä¿¡åº¦)", 
                                           elem_resource_id, elem_text));
                    }
                } else {
                    score += 0.2;  // åªæœ‰resource-id
                    reasons.push(format!("âœ…âœ… XPathåŒ…å«Resource-id: '{}'", elem_resource_id));
                }
            }
        }
    }
    
    // ... å…¶ä»–è¯„åˆ†é¡¹ ...
}
```

### æ ¸å¿ƒæ”¹è¿›2: ä½ç½®åå¥½ï¼ˆprefer_lastï¼‰

```rust
// multi_candidate_evaluator.rs

pub fn evaluate_candidates<'a>(
    candidates: Vec<&'a UIElement>,
    criteria: &EvaluationCriteria,
) -> Option<MatchCandidate<'a>> {
    // ... è¯„åˆ†é€»è¾‘ ...
    
    // æŒ‰è¯„åˆ†é™åºæ’åˆ—
    scored_candidates.sort_by(|a, b| b.score.partial_cmp(&a.score).unwrap());
    
    // ğŸ”¥ å…³é”®é€»è¾‘ï¼šå¦‚æœå‰Nåè¯„åˆ†éå¸¸æ¥è¿‘ï¼ˆå·®è·<0.05ï¼‰ï¼Œé€‰æ‹©æœ€åä¸€ä¸ª
    if scored_candidates.len() >= 2 {
        let top_score = scored_candidates[0].score;
        let close_candidates: Vec<_> = scored_candidates.iter()
            .filter(|c| (top_score - c.score) < 0.05)
            .collect();
        
        if close_candidates.len() > 1 && criteria.prefer_last {
            tracing::warn!(
                "âš ï¸ [å€™é€‰è¯„ä¼°] å‰{}åè¯„åˆ†æ¥è¿‘ï¼ˆå·®è·<0.05ï¼‰ï¼Œæ ¹æ®prefer_lasté€‰æ‹©æœ€åä¸€ä¸ª",
                close_candidates.len()
            );
            
            // è¿”å›è¿™äº›æ¥è¿‘å€™é€‰ä¸­çš„æœ€åä¸€ä¸ª
            // ï¼ˆåœ¨åŸå§‹candidatesåˆ—è¡¨ä¸­çš„ä½ç½®æœ€åï¼‰
            let last_close = close_candidates.iter()
                .max_by_key(|c| {
                    // æ‰¾åˆ°åœ¨åŸå§‹candidatesä¸­çš„ç´¢å¼•
                    candidates.iter().position(|e| std::ptr::eq(*e, c.element)).unwrap_or(0)
                })
                .unwrap();
            
            return Some((*last_close).clone());
        }
    }
    
    scored_candidates.into_iter().next()
}
```

### æ ¸å¿ƒæ”¹è¿›3: å¯ç‚¹å‡»å±æ€§åŠ åˆ†

```rust
// multi_candidate_evaluator.rs

fn score_candidate(elem: &UIElement, criteria: &EvaluationCriteria) -> (f32, Vec<String>) {
    // ... å‰é¢çš„è¯„åˆ†é¡¹ ...
    
    // ğŸ¯ è¯„åˆ†é¡¹6: å¯ç‚¹å‡»å±æ€§ï¼ˆ0-0.03åˆ†ï¼‰
    if elem.clickable.unwrap_or(false) {
        score += 0.03;
        reasons.push("âœ… å…ƒç´ å¯ç‚¹å‡» (+0.03)".to_string());
    } else {
        reasons.push("âš ï¸ å…ƒç´ ä¸å¯ç‚¹å‡» (0.0)".to_string());
    }
    
    // ... å…¶ä»–è¯„åˆ†é¡¹ ...
}
```

---

## ğŸ“Š å®Œå–„åçš„æ•ˆæœé¢„æœŸ

### åœºæ™¯1: å¤šä¸ª"å…³æ³¨"æŒ‰é’®

```xml
<node text="å…³æ³¨" bounds="[0,100][100,200]" clickable="true" />    â† å€™é€‰1
<node text="å…³æ³¨" bounds="[0,300][100,400]" clickable="true" />    â† å€™é€‰2
<node text="å…³æ³¨" bounds="[0,500][100,600]" clickable="true" />    â† å€™é€‰3ï¼ˆç”¨æˆ·é€‰æ‹©ï¼‰
```

**ç”¨æˆ·é€‰æ‹©**: å€™é€‰3ï¼Œbounds="[0,500][100,600]"

**è¯„åˆ†ç»“æœ**ï¼ˆæ–°ç³»ç»Ÿï¼‰:
```
å€™é€‰3: æ€»åˆ† 0.98 â† æœ€é«˜åˆ†ï¼
  âœ…âœ…âœ…âœ… Boundså®Œå…¨åŒ¹é…: '[0,500][100,600]' (+0.4)
  âœ…âœ…âœ…   è‡ªèº«æ–‡æœ¬å®Œå…¨åŒ¹é…: 'å…³æ³¨' (+0.15)
  âœ…      Content-descåŒ¹é… (+0.08)
  âœ…      Resource-idåŒ¹é… (+0.05)
  âœ…      Boundsç²¾ç¡®åŒ¹é…: 0px (+0.02)
  âœ…      å…ƒç´ å¯ç‚¹å‡» (+0.03)
  ğŸ¯      ä½ç½®åå¥½: æœ€åä¸€ä¸ª (+0.05)

å€™é€‰2: æ€»åˆ† 0.26
  âœ… è‡ªèº«æ–‡æœ¬åŒ¹é…: 'å…³æ³¨' (+0.15)
  âœ… Content-descåŒ¹é… (+0.08)
  âœ… å…ƒç´ å¯ç‚¹å‡» (+0.03)

å€™é€‰1: æ€»åˆ† 0.26
  âœ… è‡ªèº«æ–‡æœ¬åŒ¹é…: 'å…³æ³¨' (+0.15)
  âœ… Content-descåŒ¹é… (+0.08)
  âœ… å…ƒç´ å¯ç‚¹å‡» (+0.03)
```

**ç»“æœ**: âœ… æ­£ç¡®é€‰æ‹©å€™é€‰3ï¼ˆç”¨æˆ·ç²¾ç¡®é€‰æ‹©çš„å…ƒç´ ï¼‰

### åœºæ™¯2: çˆ¶å®¹å™¨+å­æ–‡æœ¬ï¼ˆé€šè®¯å½•ï¼‰

```xml
<node resource-id="iwk" clickable="true" bounds="[45,1059][249,1263]">  â† å€™é€‰1ï¼ˆç”¨æˆ·é€‰æ‹©ï¼‰
  <node text="é€šè®¯å½•" clickable="false" />
</node>
<node text="æ·»åŠ æœ‹å‹" clickable="true" bounds="[300,1059][500,1263]">  â† å€™é€‰2
</node>
```

**ç”¨æˆ·é€‰æ‹©**: å€™é€‰1ï¼ˆçˆ¶å®¹å™¨ï¼‰ï¼Œç›®æ ‡æ–‡æœ¬="é€šè®¯å½•"

**è¯„åˆ†ç»“æœ**ï¼ˆæ–°ç³»ç»Ÿï¼‰:
```
å€™é€‰1: æ€»åˆ† 0.98 â† æœ€é«˜åˆ†ï¼
  âœ…âœ…âœ…âœ… Boundså®Œå…¨åŒ¹é…: '[45,1059][249,1263]' (+0.4)
  âœ…âœ…âœ…   å­å…ƒç´ æ–‡æœ¬å®Œå…¨åŒ¹é…: 'é€šè®¯å½•' (+0.3)
  âœ…      Resource-idåŒ¹é…: 'iwk' (+0.05)
  âœ…      Boundsç²¾ç¡®åŒ¹é…: 0px (+0.02)
  âœ…      å…ƒç´ å¯ç‚¹å‡» (+0.03)

å€™é€‰2: æ€»åˆ† 0.26
  âœ… è‡ªèº«æ–‡æœ¬åŒ¹é…: 'æ·»åŠ æœ‹å‹' (+0.15)
  âŒ æ–‡æœ¬ä¸åŒ¹é…ç”¨æˆ·ç›®æ ‡: 'æ·»åŠ æœ‹å‹' vs 'é€šè®¯å½•'
  âœ… å…ƒç´ å¯ç‚¹å‡» (+0.03)
  ğŸ“ Boundsè·ç¦»: 200px (+0.01)
```

**ç»“æœ**: âœ… æ­£ç¡®é€‰æ‹©å€™é€‰1ï¼ˆåŒ…å«"é€šè®¯å½•"å­æ–‡æœ¬çš„çˆ¶å®¹å™¨ï¼‰

---

## ğŸ¯ æ•°æ®æŒä¹…åŒ–æ€»ç»“

### æ•°æ®å­˜å‚¨ä½ç½®

```
1. å†…å­˜ï¼ˆå¼€å‘ä¸­ï¼‰
   - XmlCacheManager: Map<string, XmlCacheEntry>
   - ç”¨é€”ï¼šä¸´æ—¶å­˜å‚¨ï¼Œå¿«é€Ÿè®¿é—®
   - ç”Ÿå‘½å‘¨æœŸï¼šé¡µé¢ä¼šè¯æœŸé—´

2. å‰ç«¯æœ¬åœ°å­˜å‚¨ï¼ˆå¾…å®Œå–„ï¼‰
   - localStorage: å°é‡æ•°æ®ï¼ˆ<10MBï¼‰
   - IndexedDB: å¤§é‡æ•°æ®ï¼ˆ>10MBï¼‰
   - ç”¨é€”ï¼šæŒä¹…åŒ–ç¼“å­˜ï¼Œç¦»çº¿è®¿é—®

3. è„šæœ¬æ–‡ä»¶ï¼ˆ.jsonï¼‰
   - ScriptBundle.xmlCache: å®Œæ•´XMLæ˜ å°„
   - ç”¨é€”ï¼šè·¨è®¾å¤‡/è·¨ç”¨æˆ·åˆ†äº«
   - ç”Ÿå‘½å‘¨æœŸï¼šæ°¸ä¹…ä¿å­˜
```

### æ•°æ®ä¼ é€’æµç¨‹

```
å½•åˆ¶è€…ï¼ˆè®¾å¤‡Aï¼‰:
  åˆ›å»ºæ­¥éª¤ â†’ xmlSnapshotåŒ…å«å®Œæ•´æ•°æ®
    â†“
  å¯¼å‡ºè„šæœ¬ â†’ ScriptBundle.json
    {
      steps: [æ­¥éª¤å¼•ç”¨],
      xmlCache: {å®Œæ•´XMLæ˜ å°„}
    }
    â†“
  åˆ†äº«æ–‡ä»¶

æ‰§è¡Œè€…ï¼ˆè®¾å¤‡Bï¼‰:
  å¯¼å…¥è„šæœ¬ â†’ æ¢å¤xmlCacheåˆ°XmlCacheManager
    â†“
  æ‰§è¡Œæ­¥éª¤ â†’ ä»original_dataè·å–å®Œæ•´ä¿¡æ¯
    - selected_xpath: ç”¨æˆ·ç²¾ç¡®é€‰æ‹©
    - element_text: ç›®æ ‡æ–‡æœ¬
    - original_xml: å®Œæ•´XMLå¿«ç…§
    â†“
  æ™ºèƒ½åˆ†æ + å¤šå€™é€‰è¯„ä¼°
    â†“
  âœ… æ­£ç¡®æ‰§è¡Œ
```

---

## âœ… éªŒè¯æ¸…å•

### æ•°æ®å®Œæ•´æ€§
- [x] âœ… æ­¥éª¤åˆ›å»ºæ—¶ä¿å­˜å®Œæ•´xmlSnapshot
- [x] âœ… è„šæœ¬å¯¼å‡ºæ—¶åŒ…å«å®Œæ•´xmlCache
- [x] âœ… è„šæœ¬å¯¼å…¥æ—¶æ¢å¤xmlCache
- [x] âœ… çœŸæœºæ‰§è¡Œæ—¶å¯è®¿é—®original_xml
- [ ] âš ï¸ éœ€è¦æµ‹è¯•ï¼šè·¨è®¾å¤‡å¯¼å…¥å¯¼å‡º

### è¯„åˆ†ç³»ç»Ÿ
- [x] âœ… å­å…ƒç´ æ–‡æœ¬åŒ¹é…ï¼š0.3åˆ†ï¼ˆå·²å®ç°ï¼‰
- [ ] ğŸ”„ ç»å¯¹XPathåŒ¹é…ï¼š0.4åˆ†ï¼ˆéœ€è¦å®Œå–„ï¼‰
- [ ] ğŸ”„ ä½ç½®åå¥½ï¼šprefer_lasté€»è¾‘ï¼ˆéœ€è¦å®Œå–„ï¼‰
- [x] âœ… å¯ç‚¹å‡»å±æ€§ï¼š0.03åˆ†ï¼ˆå¯é€‰ï¼‰
- [ ] ğŸ”„ Boundsç²¾ç¡®åŒ¹é…ï¼š0.02åˆ†ï¼ˆéœ€è¦å®Œå–„ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥å®æ–½è®¡åˆ’

### Phase 1: å®Œå–„è¯„åˆ†ç³»ç»Ÿ âš ï¸ **ä¼˜å…ˆ**

1. **å¢åŠ Boundså®Œå…¨åŒ¹é…æ£€æµ‹**
   ```rust
   // å½“boundså®Œå…¨ç›¸åŒ â†’ æå¤§æ¦‚ç‡æ˜¯ç”¨æˆ·é€‰æ‹©çš„å…ƒç´ 
   if selected_bounds == elem_bounds {
       score += 0.4;  // æœ€é«˜åˆ†ï¼
   }
   ```

2. **ä¼˜åŒ–ä½ç½®åå¥½é€»è¾‘**
   ```rust
   // å½“å¤šä¸ªå€™é€‰è¯„åˆ†æ¥è¿‘ â†’ é€‰æ‹©æœ€åä¸€ä¸ª
   if top_candidates.len() > 1 && prefer_last {
       return last_candidate;
   }
   ```

3. **æ·»åŠ å¯ç‚¹å‡»å±æ€§æ£€æŸ¥**
   ```rust
   // ä¼˜å…ˆé€‰æ‹©å¯ç‚¹å‡»å…ƒç´ 
   if elem.clickable == true {
       score += 0.03;
   }
   ```

### Phase 2: æµ‹è¯•éªŒè¯ âš ï¸ **å…³é”®**

1. **æµ‹è¯•"é€šè®¯å½•"åœºæ™¯**
   - éªŒè¯çˆ¶å®¹å™¨+å­æ–‡æœ¬è¯†åˆ«
   - éªŒè¯Boundså®Œå…¨åŒ¹é…
   - éªŒè¯ä¸ä¼šè¯¯é€‰"æ·»åŠ æœ‹å‹"

2. **æµ‹è¯•å¤šä¸ªç›¸åŒæ–‡æœ¬åœºæ™¯**
   - 3ä¸ª"å…³æ³¨"æŒ‰é’®
   - éªŒè¯é€‰æ‹©ç”¨æˆ·ç²¾ç¡®é€‰æ‹©çš„é‚£ä¸ª
   - éªŒè¯ä½ç½®åå¥½ç”Ÿæ•ˆ

3. **æµ‹è¯•è·¨è®¾å¤‡åœºæ™¯**
   - å¯¼å‡º â†’ å¯¼å…¥ â†’ æ‰§è¡Œ
   - éªŒè¯original_xmlå¯ç”¨
   - éªŒè¯æ™ºèƒ½åˆ†ææ­£å¸¸

### Phase 3: æŒä¹…åŒ–å®Œå–„ ğŸ”„ **å¯é€‰**

1. **å‰ç«¯æœ¬åœ°å­˜å‚¨**
   ```typescript
   // ä½¿ç”¨IndexedDBå­˜å‚¨XMLç¼“å­˜
   // é¿å…é¡µé¢åˆ·æ–°ä¸¢å¤±
   ```

2. **è‡ªåŠ¨æ¸…ç†æœºåˆ¶**
   ```typescript
   // æ¸…ç†è¶…è¿‡30å¤©çš„XMLç¼“å­˜
   // é¿å…å­˜å‚¨ç©ºé—´è†¨èƒ€
   ```

---

**å®Œå–„å®Œæˆåº¦**: **60%**
- âœ… æ•°æ®æŒä¹…åŒ–æœºåˆ¶: 80%ï¼ˆåŸºç¡€å®Œå–„ï¼Œå¾…æµ‹è¯•ï¼‰
- ğŸ”„ è¯„åˆ†ç³»ç»Ÿå®Œå–„: 40%ï¼ˆå­æ–‡æœ¬å·²å®ç°ï¼ŒXPath/ä½ç½®åå¥½å¾…å®Œå–„ï¼‰
- âœ… æ¶æ„ç†è§£: 95%ï¼ˆå®Œæ•´ç†è§£æ•°æ®æµï¼‰

**ä¸‹ä¸€æ­¥**: å…ˆå®Œå–„è¯„åˆ†ç³»ç»Ÿï¼ˆå¢åŠ Boundså®Œå…¨åŒ¹é… + ä½ç½®åå¥½ï¼‰ï¼Œç„¶åæµ‹è¯•éªŒè¯ï¼
