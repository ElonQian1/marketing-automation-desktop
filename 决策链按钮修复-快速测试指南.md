# 决策链按钮修复 - 快速测试指南

## 🚀 立即测试（3分钟）

### 步骤 1：确认代码已生效
打开浏览器控制台，应该看到项目正在运行。如果没有自动重载，执行：
```bash
# 如果需要重启（一般不需要，会自动热重载）
npm run tauri dev
```

---

### 步骤 2：创建测试步骤

1. **点击"智能分析我"按钮** 或创建任意步骤
2. **点击决策链按钮**，例如：
   - 🧠 智能·自动链
   - 🎯 第一个
   - 👆 点击

3. **验证按钮状态**：按钮应该高亮显示

---

### 步骤 3：保存脚本

1. 点击**"保存脚本"**按钮
2. **查看控制台**，应该看到：
   ```
   🎯 [序列化] 保存 enableStrategySelector 到 parameters: true
   🎯 [序列化] 保存 strategySelector 到 parameters: Object
   ```
3. 等待提示："脚本保存成功！ID: script_xxxxx"

---

### 步骤 4：重新加载脚本

1. **刷新页面** 或 **重新打开应用**
2. **打开刚才保存的脚本**
3. **查看控制台**，应该看到：
   ```
   🎯 [反序列化] 恢复 enableStrategySelector: true
   🎯 [反序列化] 恢复 strategySelector: Object
   ```

---

### 步骤 5：验证结果

✅ **成功标志**：
- 决策链按钮依然存在（🧠 智能·自动链、🎯 第一个、👆 点击）
- 按钮状态保持高亮
- 点击按钮仍然可以正常工作

❌ **如果按钮消失**：
- 检查控制台是否有序列化日志
- 如果没有日志，可能需要手动重启 Tauri dev
- 查看下一节的详细诊断

---

## 🔍 详细诊断（如果出问题）

### 检查 1：查看保存的 JSON 文件

```powershell
# 1. 找到最新保存的脚本文件
Get-ChildItem "d:\rust\active-projects\小红书\employeeGUI\src-tauri\data\scripts\" -Filter "script_*.json" | 
  Sort-Object LastWriteTime -Descending | 
  Select-Object -First 1

# 2. 查看文件内容（检查是否包含决策链字段）
Get-Content "路径\到\script_xxxxx.json" | ConvertFrom-Json | 
  Select-Object -ExpandProperty steps | 
  Select-Object -First 1 | 
  Select-Object enableStrategySelector, strategySelector, parameters | 
  Format-List
```

**应该看到**：
```powershell
enableStrategySelector : True
strategySelector       : @{selectedStrategy=smart-auto; ...}
parameters             : @{_enableStrategySelector=True; _strategySelector=...}
```

### 检查 2：验证序列化器文件

```powershell
# 确认修改的文件存在
Test-Path "d:\rust\active-projects\小红书\employeeGUI\src\modules\smart-script-management\utils\serializer.ts"
```

应该返回 `True`

### 检查 3：查看完整日志

在浏览器控制台执行：
```javascript
// 查看步骤数据
console.log(useStepCardStore.getState().steps[0])
```

应该看到：
```javascript
{
  id: "step_xxx",
  enableStrategySelector: true,
  strategySelector: {
    selectedStrategy: "smart-auto",
    // ...
  }
}
```

---

## ⚡ 快速验证命令

```powershell
# 一键验证：检查最新保存的脚本是否包含决策链字段
$latestScript = Get-ChildItem "d:\rust\active-projects\小红书\employeeGUI\src-tauri\data\scripts\" -Filter "script_*.json" | Sort-Object LastWriteTime -Descending | Select-Object -First 1
$json = Get-Content $latestScript.FullName | ConvertFrom-Json
$firstStep = $json.steps[0]

Write-Host "===== 决策链字段检查 =====" -ForegroundColor Cyan
Write-Host "文件: $($latestScript.Name)" -ForegroundColor Yellow
Write-Host ""
Write-Host "✅ 顶级字段:" -ForegroundColor Green
Write-Host "  enableStrategySelector: $($firstStep.enableStrategySelector)"
Write-Host "  strategySelector: $($firstStep.strategySelector -ne $null)"
Write-Host ""
Write-Host "✅ parameters 备份:" -ForegroundColor Green
Write-Host "  _enableStrategySelector: $($firstStep.parameters._enableStrategySelector)"
Write-Host "  _strategySelector: $($firstStep.parameters._strategySelector -ne $null)"
```

---

## 📋 测试清单

- [ ] 代码已重新编译/热重载
- [ ] 创建了测试步骤
- [ ] 点击了决策链按钮
- [ ] 保存时看到序列化日志
- [ ] 保存成功
- [ ] 重新打开脚本
- [ ] 加载时看到反序列化日志
- [ ] **决策链按钮依然存在** ✨

---

## 🎯 预期结果

### 成功状态
```
保存前：🧠 智能·自动链 [高亮]
保存中：🎯 [序列化] 保存字段...
重新打开：🎯 [反序列化] 恢复字段...
打开后：🧠 智能·自动链 [高亮] ✅
```

### 失败状态（不应该出现）
```
保存前：🧠 智能·自动链 [高亮]
保存中：❌ 无日志
重新打开：❌ 无日志
打开后：❌ 按钮消失
```

---

**现在立即测试，3分钟内就能验证修复是否成功！**
