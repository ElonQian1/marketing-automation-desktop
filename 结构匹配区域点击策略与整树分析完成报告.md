# ç»“æ„åŒ¹é…åŒºåŸŸç‚¹å‡»ç­–ç•¥ä¸æ•´æ ‘åˆ†æå®ŒæˆæŠ¥å‘Š

## ğŸ¯ ç”¨æˆ·éœ€æ±‚ç†è§£ä¸å®ç°

### æ ¸å¿ƒçº¦å®š
âœ… **è¾¹ç•Œé‡åˆåŸåˆ™**: ä¸å¯ç‚¹çˆ¶å®¹å™¨ï¼ˆelement_43ï¼‰ä¸å¯ç‚¹å­å…ƒç´ boundså®Œå…¨ç›¸åŒ
âœ… **åŒºåŸŸç‚¹å‡»ç­–ç•¥**: ç›´æ¥ç”¨çˆ¶å®¹å™¨boundsè¿›è¡Œåæ ‡ç‚¹å‡»ï¼Œæ— éœ€UIElementè½¬æ¢
âœ… **æ•´æ ‘å­¦ä¹ èŒƒå›´**: ä»é€‰ä¸­å®¹å™¨å¼€å§‹ï¼Œé€’å½’åˆ†ææ‰€æœ‰å­å­™å…ƒç´ çš„å­—æ®µç‰¹å¾

### åŒ¹é…æ³•åˆ™  
âœ… **ç©º/éç©ºç­–ç•¥**: å­—æ®µä¸ºç©ºåˆ™åŒ¹é…ç©ºï¼Œå­—æ®µæœ‰å€¼åˆ™åŒ¹é…æœ‰å€¼
âœ… **ç€‘å¸ƒæµé€‚é…**: é€‚ç”¨äºæ‰€æœ‰ç€‘å¸ƒæµå¡ç‰‡çš„åŒæ„ç»“æ„ç‰¹å¾

---

## ğŸš€ å®ç°æ–¹æ¡ˆ

### 1. åŒºåŸŸç‚¹å‡»ç­–ç•¥é…ç½®

åœ¨ `StructuralSnapshot` ä¸­æ–°å¢ `click` é…ç½®ï¼š

```typescript
click: {
  strategy: 'region',              // ç›´æ¥åŒºåŸŸç‚¹å‡»ï¼Œä¸éœ€è¦UIElementè½¬æ¢
  inset_ratio: 0.08,               // å®‰å…¨å†…ç¼©8%é˜²æ­¢ç‚¹åˆ°è¾¹ç¼˜
  allow_clickable_parent: false,   // ç”¨æˆ·çº¦å®šï¼šä¸éœ€è¦æ‰¾å¯ç‚¹å‡»çˆ¶å…ƒç´   
  require_convertible: false       // å…³é”®ï¼šä¸å¼ºåˆ¶è¦æ±‚UIElementè½¬æ¢æˆåŠŸ
}
```

**æ•ˆæœ**: åç«¯å°†ä½¿ç”¨åŒºåŸŸç‚¹å‡»ï¼Œä¸å†å› "æ— æ³•è½¬æ¢ä¸ºUIElement"è€Œå¤±è´¥ã€‚

### 2. æ•´æ ‘ç»“æ„åˆ†æ

#### ğŸŒ³ é€’å½’å­—æ®µåˆ†ææ–¹æ³• `analyzeDescendantFields`

- **åˆ†ææ·±åº¦**: æœ€å¤š5å±‚ï¼Œè¦†ç›–å®Œæ•´çš„UIå­æ ‘
- **å­—æ®µè¦†ç›–**: `resource_id`, `content_desc`, `text`, `class_name`  
- **ç©º/éç©ºç­–ç•¥**: 
  - æœ‰å€¼å­—æ®µ â†’ `presence_only: true`
  - ç©ºå­—æ®µ â†’ `must_be_empty: true`
  - çŸ­æ–‡æœ¬ â†’ `must_equal_text` ç²¾ç¡®åŒ¹é…
  - é•¿æ–‡æœ¬ â†’ `presence_only` å­˜åœ¨æ€§åŒ¹é…

#### ğŸ“ ä½ç½®æ ‡è®°ç³»ç»Ÿ

æ¯ä¸ªå­—æ®µè§„åˆ™åŒ…å« `position_hint`ï¼Œå¦‚ï¼š
- `level_0` (æ ¹å…ƒç´ )
- `level_0_child0_level_1` (ç¬¬1å±‚ç¬¬0ä¸ªå­å…ƒç´ )
- `level_0_child0_level_1_child1_level_2` (ç¬¬2å±‚ç¬¬1ä¸ªå­å…ƒç´ )

### 3. ç”¨æˆ·é€‰æ‹©å…ƒç´ å¤„ç†

```typescript
// ğŸ¯ ã€ç”¨æˆ·çº¦å®šã€‘ä»é€‰ä¸­çš„å¤–å±‚å®¹å™¨å¼€å§‹åˆ†æï¼Œä¸è®ºæ˜¯å¦å¯ç‚¹å‡»
const targetElement = element; // ç›´æ¥ä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„å…ƒç´ ï¼Œä¸åšæ™ºèƒ½è½¬æ¢
```

**ä¸å†è¿›è¡Œå¯ç‚¹å‡»å…ƒç´ æŸ¥æ‰¾**ï¼Œå®Œå…¨æŒ‰ç…§ç”¨æˆ·é€‰æ‹©çš„å®¹å™¨è¿›è¡Œåˆ†æã€‚

---

## ğŸ“Š ç”Ÿæˆçš„ç»“æ„ç­¾åç¤ºä¾‹

åŸºäº `element_43` æ¡ˆä¾‹ï¼Œç³»ç»Ÿå°†ç”Ÿæˆï¼š

```json
{
  "container": {
    "xpath": "//RecyclerView[@scrollable='true']",
    "fingerprint": { "role": "RecyclerView", "scrollable": true }
  },
  "card_root": { "role": "FrameLayout" },
  "click": {
    "strategy": "region",
    "inset_ratio": 0.08, 
    "allow_clickable_parent": false,
    "require_convertible": false
  },
  "skeleton_rules": {
    "require_image_above_text": true,
    "allow_depth_flex": 1
  },
  "field_rules": {
    "rules": [
      // æ ¹å®¹å™¨ element_43 å­—æ®µ
      {
        "resource_id": "",
        "must_be_empty": true,
        "position_hint": "level_0"
      },
      {
        "content_desc": "ç¬”è®° æ·±åœ³ä¹Ÿå¤ªç‰›äº†ï¼Œå–æ¶ˆäº†ï¼ æ¥è‡ªå°ä½•è€å¸ˆ 55èµ",
        "presence_only": true,
        "position_hint": "level_0"
      },
      // ç¬¬1å±‚å­å…ƒç´ ï¼ˆå¯ç‚¹å‡»FrameLayoutï¼‰å­—æ®µ
      {
        "class_contains": "FrameLayout",
        "presence_only": true,
        "position_hint": "level_0_child0_level_1"
      },
      // ç¬¬2å±‚ViewGroupå­—æ®µ
      {
        "class_contains": "ViewGroup", 
        "presence_only": true,
        "position_hint": "level_0_child0_level_1_child0_level_2"
      },
      // å›¾ç‰‡å®¹å™¨å­—æ®µ
      {
        "class_contains": "ImageView",
        "presence_only": true,
        "position_hint": "level_0_child0_level_1_child0_level_2_child0_level_3"
      },
      // ä½œè€…ä¿¡æ¯æ å­—æ®µ
      {
        "text": "å°ä½•è€å¸ˆ",
        "must_equal_text": "å°ä½•è€å¸ˆ",
        "position_hint": "level_0_child0_level_1_child0_level_2_child2_level_3_child1_level_4"
      },
      {
        "text": "55", 
        "must_equal_text": "55",
        "position_hint": "level_0_child0_level_1_child0_level_2_child2_level_3_child3_level_4"
      }
      // ... æ›´å¤šå­å…ƒç´ å­—æ®µè§„åˆ™
    ]
  }
}
```

---

## ğŸ¯ åç«¯é€‚é…è¦æ±‚

ä¸ºäº†å®Œå…¨æ”¯æŒç”¨æˆ·çš„çº¦å®šï¼Œåç«¯éœ€è¦ï¼š

### 1. è¯†åˆ«åŒºåŸŸç‚¹å‡»ç­–ç•¥
```rust
if click_config.strategy == "region" && !click_config.require_convertible {
    // è·³è¿‡UIElementè½¬æ¢å¤±è´¥æ£€æŸ¥
    // ç›´æ¥ä½¿ç”¨boundsè¿›è¡Œåæ ‡ç‚¹å‡»
    let safe_bounds = apply_inset_ratio(matched_bounds, click_config.inset_ratio);
    return execute_coordinate_tap(safe_bounds.center());
}
```

### 2. å®‰å…¨åæ ‡ç‚¹å‡»æ£€æŸ¥
- **éæ•´å±æ£€æŸ¥**: `area_ratio < 0.95`
- **æœ€å°å°ºå¯¸**: `min(width,height) â‰¥ 24px`  
- **å†…ç¼©è®¡ç®—**: æŒ‰ `inset_ratio` è®¡ç®—å®‰å…¨ç‚¹å‡»åŒºåŸŸ

### 3. IoUé‡åˆåº¦éªŒè¯ï¼ˆå¯é€‰ï¼Œä»…å‘Šè­¦ï¼‰
```rust
let child_clickable_bounds = find_first_clickable_child_bounds(matched_element);
let iou = calculate_iou(parent_bounds, child_clickable_bounds);
if iou < 0.98 {
    warn!("è¾¹ç•Œé‡åˆåº¦è¾ƒä½: IoU={:.2}, ä½†ä»ç»§ç»­åŒºåŸŸç‚¹å‡»", iou);
}
```

---

## âœ… å®ŒæˆçŠ¶æ€

- âœ… **åŒºåŸŸç‚¹å‡»ç­–ç•¥é…ç½®** - å·²å®ç°
- âœ… **æ•´æ ‘é€’å½’å­—æ®µåˆ†æ** - å·²å®ç°  
- âœ… **ç©º/éç©ºç­–ç•¥æ ¸å¿ƒé€»è¾‘** - å·²å®ç°
- âœ… **ä½ç½®æ ‡è®°ç³»ç»Ÿ** - å·²å®ç°
- âœ… **ç”¨æˆ·çº¦å®šéµå¾ª** - å·²å®ç°
- âœ… **TypeScriptç±»å‹å®‰å…¨** - å·²éªŒè¯

---

## ğŸ‰ é¢„æœŸæ•ˆæœ

### å‰ç«¯ä½“éªŒ
- ç”¨æˆ·é€‰æ‹©ä»»ä½•å®¹å™¨å…ƒç´ ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ†ææ•´ä¸ªå­æ ‘ç»“æ„
- ç”Ÿæˆå®Œæ•´çš„å­—æ®µç‰¹å¾å¿«ç…§ï¼Œè¦†ç›–æ‰€æœ‰å±‚çº§
- æ”¯æŒå¤æ‚çš„ç€‘å¸ƒæµå¡ç‰‡ç»“æ„åˆ†æ

### åç«¯æ‰§è¡Œ  
- ä¸å†å‡ºç°"SMåŒ¹é…æˆåŠŸä½†æ— æ³•è½¬æ¢ä¸ºUIElement"é”™è¯¯
- ç›´æ¥ä½¿ç”¨åŒºåŸŸåæ ‡ç‚¹å‡»ï¼Œç¬¦åˆç”¨æˆ·çš„è¾¹ç•Œé‡åˆçº¦å®š
- ç»“æ„åŒ¹é…æ›´åŠ ç¨³å®šå’Œå¯é 

### ä¸šåŠ¡ä»·å€¼
- **ç€‘å¸ƒæµé€‚é…**: å®Œç¾é€‚é…å°çº¢ä¹¦ç­‰ç€‘å¸ƒæµåº”ç”¨
- **ç»“æ„ç¨³å®šæ€§**: åŸºäºæ•´æ ‘ç‰¹å¾ï¼ŒåŒ¹é…æ›´åŠ å¯é 
- **ç»´æŠ¤ç®€åŒ–**: éµå¾ªç»Ÿä¸€çš„åŒºåŸŸç‚¹å‡»çº¦å®šï¼Œå‡å°‘ç‰¹æ®Šå¤„ç†