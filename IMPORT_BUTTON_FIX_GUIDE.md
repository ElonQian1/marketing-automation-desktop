# 导入功能测试指南

## 🎯 当前状态

已经完成了DeviceCard组件的修改，现在导入按钮的工作流程是：

1. **点击导入按钮** → 自动检测并准备VCF文件
2. **如果有现成的pending会话** → 使用现有VCF文件
3. **如果没有VCF文件** → 自动生成新的VCF文件
4. **VCF准备完成** → 显示策略选择对话框
5. **用户选择策略** → 执行导入

## 🔧 修改内容

### DeviceCard.tsx 主要变更：
- ✅ 添加了 `preparingVcf` 状态显示准备过程
- ✅ 添加了 `prepareVcfForImport()` 函数自动处理VCF文件
- ✅ 修改导入按钮显示"准备中..."状态
- ✅ 集成了VCF生成、批次创建、会话记录
- ✅ 传递正确的`vcfFilePath`给策略对话框

### 导入流程：
```
点击导入 → 检查pending会话 → [有]使用现有VCF | [无]自动生成VCF → 显示策略选择 → 执行导入 → 刷新设备状态
```

## 🧪 测试步骤

### 1. 基本功能测试
```bash
# 启动应用
npm run tauri dev
```

1. 导航到"联系人导入向导"页面
2. 点击任意设备卡片的蓝色"导入"按钮
3. **预期结果**：
   - 按钮显示"准备中..."
   - 几秒后弹出策略选择对话框
   - 对话框中显示推荐的导入策略

### 2. VCF文件状态测试
**场景A：有现成的pending会话**
- 应该直接使用现有VCF文件
- 控制台显示"使用现有VCF文件: ..."

**场景B：没有现成VCF文件**
- 自动生成新VCF文件
- 控制台显示"自动生成VCF文件..."
- 控制台显示"VCF文件生成完成: ..."

### 3. 策略选择测试
- 对话框应该显示适合当前设备的推荐策略
- 可以选择不同的vCard版本(2.1/3.0/4.0)
- 可以选择不同的触发方法
- 可以配置验证选项

### 4. 导入执行测试
- 选择策略后点击"执行导入"
- 应该看到导入进度和结果
- 成功后应该显示导入的联系人数量
- 设备卡片上的联系人数量应该更新

## 🚨 可能的问题和解决方案

### 问题1：导入按钮仍然无响应
**解决方案**：
- 检查控制台是否有JavaScript错误
- 确认所有导入路径正确
- 检查数据库连接和服务状态

### 问题2：VCF文件准备失败
**解决方案**：
- 检查"没有可用的未分类号码"错误
- 确认数据库中有联系人数据
- 检查文件写入权限

### 问题3：策略选择对话框不显示
**解决方案**：
- 检查`vcfFilePath`是否正确设置
- 确认ImportStrategyDialog组件正常加载
- 检查设备信息是否正确获取

### 问题4：导入执行失败
**解决方案**：
- 检查设备连接状态
- 确认ADB服务正常运行
- 检查设备权限设置

## 💡 调试信息

在浏览器控制台中可以看到以下调试信息：
- `使用现有VCF文件: ...` 或 `自动生成VCF文件...`
- `VCF文件生成完成: ...`
- 策略执行的详细日志

## 🔄 如果需要回退

如果新的逻辑有问题，可以临时恢复原有的导入逻辑：
```tsx
// 在DeviceCard.tsx中替换导入按钮的onClick
onClick={(e) => { e.stopPropagation(); props.onImport(); }}
```

---

**当前状态**: 🟡 待测试  
**预期结果**: ✅ 导入按钮可以点击并弹出策略选择对话框  
**下一步**: 根据测试结果进一步优化